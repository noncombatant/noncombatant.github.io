if("undefined"==typeof tiger)var tiger={};"undefined"==typeof tiger.components&&(tiger.components={}),"undefined"==typeof tiger.components.discussion&&(tiger.components.discussion={}),"undefined"==typeof tiger.components.forms&&(tiger.components.forms={}),"undefined"==typeof tiger.components.forms.modals&&(tiger.components.forms.modals={}),"undefined"==typeof tiger.components.groupchats&&(tiger.components.groupchats={}),"undefined"==typeof tiger.components.invites&&(tiger.components.invites={}),"undefined"==typeof tiger.components.invites.menuItems&&(tiger.components.invites.menuItems={}),"undefined"==typeof tiger.components.invites.modals&&(tiger.components.invites.modals={}),"undefined"==typeof tiger.components.post&&(tiger.components.post={}),"undefined"==typeof tiger.components.post.meta&&(tiger.components.post.meta={}),"undefined"==typeof tiger.components.spinner&&(tiger.components.spinner={}),"undefined"==typeof tiger.icons&&(tiger.icons={}),"undefined"==typeof tiger.icons.essential&&(tiger.icons.essential={}),"undefined"==typeof tiger.messages&&(tiger.messages={}),"undefined"==typeof tiger.messages.postAction&&(tiger.messages.postAction={}),define("apiclient/post",["config","apiclient/apirequest","apiclient/gettoken","singleton/Feature"],function(e,t,n,s){"use strict";var i,o=s.isOn("postsecuretoken")?e.api.core.secureUrl+"/post":e.api.core.url+"/post";return i={create:t.postJson(n.append(o+"/add",s.isOn("postsecuretoken")?n.secure:n.fresh,!0)),read:t.getJson(n.append(o+"/preview/{{id}}",s.isOn("postsecuretoken")?n.secure:n.fresh)),update:t.postJson(n.append(o+"/{{id}}/update",s.isOn("postsecuretoken")?n.secure:n.fresh,!0)),delete:t.postJson(n.append(o+"/{{id}}/delete",s.isOn("postsecuretoken")?n.secure:n.fresh,!0)),generatePostJson:function(e){return t.postJson(n.append(o+e,s.isOn("postsecuretoken")?n.secure:n.fresh,!0))},socialStats:t.getJson(e.api.core.url+"/dfp/post/{{id}}/stats")}}),define("model/post/Post",["config","jquery","backbone","underscore","singleton/CurrentUser","singleton/Utils","apiclient/gettoken","apiclient/post"],function(e,t,n,s,o,i,a,r){"use strict";var c=t("<div />"),d=function(e){var s,t=e.getHours(),n=e.getMinutes(),o=e.getMonth()+1+"/"+e.getDate()+"/"+e.getFullYear();return 10>t&&(t="0"+t),10>n&&(n="0"+n),s=t+":"+n,{MdyHm:[o,s].join(" ")}},l={dateTimeFormat:/^\d{1,2}\/\d{1,2}\/\d{4} \d{1,2}:\d{2}$/,chompImgType:/img\.gawkerassets\.com\/img\/(\w+)\/[\w-]+\./g},u=n.Model.extend({constructor:function(e){window.__postModelStorage=window.__postModelStorage||{};var t,o,s=window.__postModelStorage,i=0[0]!==e&&0[0]!==e.id&&0[0]!==s,a={};if(i&&0[0]!==s[e.id]){for(t in e)e.hasOwnProperty(t)&&null!==e[t]&&(a[t]=e[t]);return o=s[e.id],o.set(a),o}n.Model.prototype.constructor.apply(this,arguments),i&&(s[e.id]=this)},initialize:function(){l=t.extend(l,{mediaInPost:new RegExp("<("+this.mediaTags.join("|")+")","gim")})},storeInMemory:function(){var e=window.__postModelStorage||{},t=0[0]!==this.id&&0[0]!==e;return t&&0[0]!==e[this.id]?e[this.id].set(this.attributes):e[this.id]=this,this},mediaTags:["img","embed","object","iframe","video","audio","canvas"],defaults:{promoteState:{},publishTime:d(new Date),blogs:new n.Collection,liked:!1},validationRules:{PUBLISHTIME_IS_REQUIRED:function(e){var t=!0;return"SCHEDULED"!==e.status||e.publishTimeMillis||(t=!1),t},POST_CONTENT_IS_REQUIRED:function(e){var n=!0,s=e.headline&&t.trim(c.html(e.headline)),o=e.original&&t.trim(c.html(e.original).text()),i=e.original&&(l.mediaInPost.test(e.original)||c.html(e.original).find("img").length),a=e.hasFile||e.files&&e.files.length;return s||o||i||a||(n=!1),n},POST_CONTENT_CANNOT_CONTAIN_BAD_CONTENT:function(e){var t=!0,n=["form"].join("");return c.html(e.original).find(n).length&&(t=!1),t}},savePipeline:t.Deferred().resolve(),publishTime:function(e){return d(e)},sync:function(e,n,o){var i,c,l,d,u,h;if("create"!==e&&(0[0]===n.id||null===n.id))throw new Error("Post.sync(): Model undefined");switch(n.attributes.meta={},"undefined"!=typeof n.attributes.status&&(n.attributes.meta.status=n.attributes.status),"undefined"!=typeof n.attributes.allowReplies&&(n.attributes.meta.allowReplies=n.attributes.allowReplies),"undefined"!=typeof n.attributes.showByline&&(n.attributes.meta.showByline=n.attributes.showByline),"undefined"!=typeof n.attributes.byline&&(n.attributes.meta.byline=n.attributes.byline),"undefined"!=typeof n.attributes.properties&&(n.attributes.meta.properties=n.attributes.properties),e){case"create":c="POST",l=n.has("parentId")&&""!==n.get("parentId")?"/api/core/post/"+n.get("parentId")+"/jsonReplyWithApproval":"/api/core/post/add",u=JSON.stringify(n);break;case"read":c="GET",l=0[0]!==o.preview&&o.preview===!0?"/api/core/post/preview/"+n.id:0[0]!==o.showcase&&o.showcase===!0?"/api/core/post/showcase/"+n.id:"/api/core/post/"+n.id;break;case"update":c="POST",l="/api/core/post/"+n.id+"/update",u=JSON.stringify(n);break;case"delete":c="POST",l="/api/core/post/"+n.id+"/delete"}return d={type:c,dataType:"json",contentType:"application/json",url:l,data:u||null},i=t.Deferred(),h=i.promise(),a.secure().done(function(a){d.url=d.url+"?token="+a,"delete"===e?r[e]({id:n.id},o).done(i.resolve).fail(i.reject):t.ajax(s.extend(d,o)).done(i.resolve).fail(i.reject)}),h},parse:function(e){if(0[0]===e)throw new Error("Post.parse(): no response to parse");var t={};return t=e.data?e.data:e,0[0]!==t.id&&null!==t.id&&(t.id=parseInt(t.id,10)),t.tagDescriptions=t.tags.map(function(e){return e.description}),t.images&&t.images.length&&(t.images=[]),t},toFormData:function(){var t=["id","headline","original","tags","publishTimeMillis","publishTimeZone","status","blogId","defaultBlogId","annotation.annotationType","annotation.imageUrl","annotation.imageChompId","annotation.imageWidth","annotation.imageHeight","annotation.x","annotation.y","annotation.annotationText","annotation.annotationTextHash","allowReplies","sponsored","showByline","byline","salesAvatar","salesAvatarMap","share","properties","shareBlogId","sharedPostId","images","parentId","adZone"],e=["status","allowReplies","showByline","byline","properties"],n=function(t){var n=t[0],o=t[1];return-1!==s.indexOf(e,n)&&(n="meta."+n),[n,o]},o=s.pick(this.toJSON(),s.union(t,s.map(e,function(e){return"meta."+e}))),i=s.object(s.pairs(o).map(n));return i},getUrl:function(){return 0[0]!==this.get("permalink")?this.get("permalink"):"/"+this.id},getActionState:function(){var e=t.Deferred();return this.has("actionState")?e.resolve():this.getPostInfo().done(function(){e.resolve()}),e.promise()},getPostInfo:function(n){var s,i=this,a=parseInt(this.id,10);if(!o.isLoggedIn())throw new Error("Post.getPostInfo(): user not logged in");return n=n||{},n.success=n.success||function(){},s=[e.api.core.url,"/post/",a,"/actionstatus?token=",o.get("token")].join(""),t.ajax({type:"GET",dataType:"jsonp",jsonp:"jsonp",url:s,success:function(e){200===e.meta.status&&(i.setActionState(e.data),n.success.call(i))}})},isPublished:function(){return"PUBLISHED"===this.get("status")},setAction:function(t,n,s){var o,i={};if(!t||"repost"!==t&&"dismiss"!==t&&"actionreset"!==t)throw new Error("Post:setAction(): Invalid post action: "+t);if(!n)throw new Error("Post:setAction(): Invalid blogId: "+n);return o="repost"===t?e.api.core.url+"/post/"+this.id+"/"+t+"/"+n:"/ajax/post/"+this.id+"/"+t+"/"+n,"repost"===t&&s.publishTimeMillis&&(i.repostTime=s.publishTimeMillis),this.setLikeOrAction(s,t,o,i)},setLikeOrAction:function(e,n,s,i){var r,c,l,d;return e=e||{},i=i||{},e.success=e.success||function(){},e.error=e.error||function(){},o.isLoggedIn()||e.error.call(this,{reason:"user"}),c=t.Deferred(),d=c.promise(),r=this,a.fresh().done(function(o){i.token=o,l="repost"===n?{url:s+"?"+t.param(i),type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:"{}"}:{url:s+"?"+t.param(i),type:"POST"},t.ajax(l).done(function(t){0[0]!==t.meta?"repost"===n||"dismiss"===n||"actionreset"===n?(r.setActionState(t.data),e.success.call(r,{response:t.data})):(r.setLikeState(t.data),e.success.call(r,{response:t.data})):e.error.call(r,{reason:"action error"}),c.resolve()}).fail(function(t){e.error.call(this,t.responseJSON,t.status,t.statusText),c.reject(t.responseJSON,t.status,t.statusText)})}),d},setActionState:function(e){var t={};s.each(e,function(e){t[e.blogId]=e.relation.toLowerCase()},this),this.set({actionState:t})},setLike:function(e,t){var n,o=["like","unlike"];if(!e||!s.contains(o,e))throw new Error("Post:setLike(): Invalid post action: "+e);return"like"===e&&(e+="AndApprove"),n="likeAndApprove"!==e?["/api/core/post",this.id,e].join("/"):["/ajax/post",this.id,e].join("/"),this.setLikeOrAction(t,e,n)},setLikeState:function(e){var t=e||{},n=t.like||t;0[0]!==n.objectId&&n.objectId===this.get("id")?this.set({liked:!0}):this.set({liked:!1})},prepareAnnotations:function(){if(this.has("annotation")){var e=this.get("annotation"),n=t().text(e.annotationText),s=170;0[0]===e.annotationShortText&&n.length>s&&(e.annotationShortText=i.cut(n,s))}return this},parseFromDom:function(e){var t=JSON.parse(decodeURIComponent(e.data("model")));return new u(t)},replaceImagesWithOriginal:function(){var e=this.get("display");return this.set("display",e.replace(l.chompImgType,"img.gawkerassets.com/img/$1/original.")),this},validate:function(){var e=[],t=this.toJSON();return t.mode&&s.each(this.validationRules,function(n,s){n(t)||e.push({error:"CLIENT_VALIDATION_ERROR",reason:s})},this),!!e.length&&e},getShareOptionsForUser:function(e){var i=t.Deferred(),n=[],a=[],r=[],o=e.get("defaultBlogId"),c=!1;return this.getActionState().done(function(){s.each(this.get("actionState"),function(e,t){"repost"===e&&n.push(parseInt(t,10))}),c=-1!==s.indexOf(n,o),e.get("membership").each(function(e){e.get("blogId")===o||"ENABLED"!==e.get("blog").status&&"SPAM"!==e.get("blog").status||(-1!==s.indexOf(n,e.get("blog").id)?r.push({name:e.get("blog").displayName,id:e.get("blog").id}):a.push({name:e.get("blog").displayName,id:e.get("blog").id}))},this),i.resolve({repostedTo:n,repostedToPersonal:c,personalBlogId:o,blogsUndo:r,blogsRepost:a})}.bind(this)),i.promise()}});return u}),define("collection/PaginationCollection",["backbone"],function(e){"use strict";var t=e.Collection.extend({_stepIndex:0,_stepSize:10,_doneStepping:!1,constructor:function(t,n){t=t||[],n=n||{},e.Collection.prototype.constructor.call(this,t,n)},_incrementStep:function(){this._stepIndex+=this._stepSize},_checkDone:function(e){var t=this.parse(e);return!t||!t.length},getStepIndex:function(){return this._stepIndex},getStepSize:function(){return this._stepSize},hasMore:function(){return!this._doneStepping},disablePagination:function(){this._doneStepping=!0}});return t}),define("module/discussion/model/comment.model",["underscore","backbone","model/post/Post"],function(e,t,n){"use strict";var s=n.extend({initialize:function(){n.prototype.initialize.call(this),this.on("change:approved",this.approveAncestors)},setLike:function(e,t){var s=n.prototype.setLike.call(this,e,t);return("like"===e||"unlike"===e)&&s.done(function(){this.trigger("discussion:comment:likestatechanged",this.get("id"),e)}.bind(this)),s},parse:function(e){return e=e||{},s.addDiscussionId(e,{commentModel:this})},constructor:function(e,n){t.Model.prototype.constructor.call(this,e,n),this.cid=e._discussionId},_commentCollection:null,getChildren:function(){if(!this._commentCollection){var t=require("module/discussion/model/comment.collection"),e=this.collection;this._commentCollection=new t([],{parent:this,approvedOnly:e.getApprovedOnly(),parentDepth:e.getDepth(),discussionType:e.getDiscussionType()})}return this._commentCollection},getParent:function(){var e=function(t,n){var s,o;return(o=t.findWhere({id:n}))||(s=t.getParent(),s&&s.collection?e(s.collection,n):null)};return this.collection&&this.get("parentId")?e(this.collection,this.get("parentId")):null},approveAncestors:function(){for(var e=this.getParent();e;)e.set("approved",!0),e=e.getParent()}},{addDiscussionId:function(t,n){var s,o;return n.hasOwnProperty("discussionType")?o=n.discussionType:n.hasOwnProperty("commentModel")&&(s=n.commentModel,s.collection?o=s.collection.getDiscussionType():s._parent&&s._parent.collection&&(o=s._parent.collection.getDiscussionType())),e.extend(t,{_discussionId:o+"_"+t.id})}});return s}),define("templates/tiger/components/groupchats/flagreason",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(e,t,n,s){t.components.groupchats.flagreason=function(e,n,s){return'<form><label class="reason-head">Why are you flagging this?<a class="icon" href="http://help.gawker.com/customer/portal/articles/1726140-what-is-flagging-?b_id=5895" target="_blank">'+t.icons.actions.information(null,null,s)+`</a></label><div class="row radio-cont"><div class="column small-12 js_error hide proxima"><small class="warningmessage">Please select a reason</small></div><div class="columns small-12"><label><input type="radio" name="reason" value="HARASSMENT">It's harassment</label></div></div><div class="row radio-cont"><div class="columns small-12"><label><input type="radio" name="reason" value="HATE_SPEECH">It's hate speech</label></div></div><div class="row radio-cont"><div class="columns small-12"><label><input type="radio" name="reason" value="SPAM">It's spam</label></div></div><div class="flag-reason-ctas"><a class="button secondary tiny cancel js_cancel">Cancel</a><a class="button primary tiny submit js_submit">Save</a></div></form>`},s.DEBUG&&(t.components.groupchats.flagreason.soyTemplateName="tiger.components.groupchats.flagreason")}),define("module/flagging/view/FlagReasonDropdown",["backbone.marionette","templates/tiger/components/groupchats/flagreason"],function(e){"use strict";var t=e.ItemView.extend({template:tiger.components.groupchats.flagreason,className:"flag-reason-dropdown js_flagreason",events:{submit:"submit",click:"preventPropagation","click .js_cancel":"cancel","click .js_submit":"submit"},initialize:function(){},preventPropagation:function(e){e.stopPropagation()},cancel:function(){this.trigger("flagreason:cancel")},submit:function(e){e.preventDefault();var t=this.$('input[name="reason"]:checked').val();return t?this.trigger("flagreason:submit",this,t):this.$(".js_error").removeClass("hide"),!1}});return t}),define("templates/tiger/components/forms/modals/flagreason",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(e,t,n,s){t.components.forms.modals.flagreason=function(){return`<div class="show-for-medium-down flag-reason-mobile"><ul class="sticky-modal-options"><li class="js_reason-harassment" data-reason="HARASSMENT">It's harassment</li><li class="js_reason-hate-speech" data-reason="HATE_SPEECH">It's hate speech</li><li class="js_reason-spam" data-reason="SPAM">It's spam</li></ul><footer class="row"><div class="column small-12"><input type="button" class="button tiny secondary js_cancel" tabindex="5" value="Cancel" /></div></footer></div>`},s.DEBUG&&(t.components.forms.modals.flagreason.soyTemplateName="tiger.components.forms.modals.flagreason")}),define("module/flagging/view/FlagReasonModal",["jquery","backbone.marionette","templates/tiger/components/forms/modals/flagreason"],function(e,t){"use strict";var n=t.ItemView.extend({template:tiger.components.forms.modals.flagreason,tagName:"form",events:{submit:"submit","click .js_cancel":"cancel","click .js_reason-harassment":"selectReason","click .js_reason-hate-speech":"selectReason","click .js_reason-spam":"selectReason"},cancel:function(){this.trigger("flagreason:cancel")},selectReason:function(t){var n=e(t.target).attr("data-reason");if(!n)throw new Error("Empty reason code for reason!");this.trigger("flagreason:submit",this,n)}});return n}),define("apiclient/flagging",["config","apiclient/apirequest","apiclient/gettoken"],function(e,t,n){"use strict";var s={flagPost:function(t){return t.reason?e.api.core.url+"/post/{{postId}}/flag?reason={{reason}}":e.api.core.url+"/post/{{postId}}/flag"},unflagPost:function(t){return t.reason?e.api.core.url+"/post/{{postId}}/unflag?reason={{reason}}":e.api.core.url+"/post/{{postId}}/unflag"}},o={getPosts:t.getJson(n.append(e.api.core.url+"/post/{{starterId}}/flaggedposts")),getCount:t.getJson(n.append(e.api.core.url+"/post/{{starterId}}/flaggedcount")),flagPost:t.postJson(n.append(s.flagPost)),unflagPost:t.postJson(n.append(s.unflagPost)),getBlogCount:t.getJson(n.append(e.api.core.url+"/blog/{{blogId}}/flaggedcount")),resolveFlag:t.postJson(n.append(e.api.core.url+"/post/{{postId}}/resolve")),unresolveFlag:t.postJson(n.append(e.api.core.url+"/post/{{postId}}/unresolve"))};return window.__karma__&&(o.__testonly__={urls:s}),o}),define("templates/tiger/components/groupchats/flagging-admin-link",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(e,t,n,s,o){t.components.groupchats.flaggingAdminLink=function(e){return`<div class="flagging-admin-link proxima"><a onClick="window.ga('send', 'event', 'On-Page Flagging', 'click', 'Click into moderation queue');" href="https://kinja.com/manage/`+o.$$escapeHtmlAttribute(e.blogName)+'/flagged">Moderate Flagged Replies ('+o.$$escapeHtml(e.flagCount)+")</a></div>"},s.DEBUG&&(t.components.groupchats.flaggingAdminLink.soyTemplateName="tiger.components.groupchats.flaggingAdminLink")}),define("module/flagging/ReplyFlaggingModule",["jquery","underscore","singleton/Feature","singleton/CurrentUser","singleton/Utils","singleton/WindowController","module/flagging/view/FlagReasonDropdown","module/flagging/view/FlagReasonModal","app/modal/modal.controller","apiclient/flagging","templates/tiger/components/groupchats/flagging-admin-link"],function(e,t,n,s,o,i,a,r,c,l){"use strict";var d={flaggedReplies:null,flaggedRepliesLoaded:e.Deferred(),flagCount:null,flagCountLoaded:e.Deferred(),tokenRenewed:!1,reasonDropdown:0[0],reasonModal:0[0],_loadFlaggedReplies:function(e){var t=this,n=function(n,o){t.flaggedReplies=[],o&&o.success===!0?(t.flaggedReplies=n.map(function(e){return e.postId}),t.flaggedRepliesLoaded.resolve()):o&&"InvalidSessionToken"===o.type&&d.tokenRenewed===!1?(d.tokenRenewed=!0,s.token().done(function(){d._loadFlaggedReplies(e)})):t.flaggedRepliesLoaded.reject()};l.getPosts({starterId:e}).done(n)},_loadFlagCount:function(e){var t=this,n=function(e,n){n&&n.success===!0&&(t.flagCount=Number(e)),t.flagCountLoaded.resolve()};l.getCount({starterId:e}).done(n)},_mergePostModelWithFlagInfo:function(e){var n=e.get("id");t.contains(this.flaggedReplies,n)&&e.set({allowReplies:!1,flagged:!0})},_postStatus:function(e){return 0!==e.parents(".all-threads").length?e.parents(".js_reply").hasClass("reply--unapproved")?"Pending":"Approved":"Featured"},_flagPost:function(e,s,o){var c,u,i=s.get("flagged")===!0,a=s.get("id"),r=i?"Unflag":"Flag",h=d._postStatus(e);s.get("flaggingInProgress")===!0&&t.isUndefined(d.reasonDropdown)||(s.set({flaggingInProgress:!0}),u=n.isOn("extendedflag")&&!t.isUndefined(o)&&"Flag"===r?r+" - "+o.toLowerCase():r,window.ga("send","event","On-Page Flagging",u,"Reply status: "+h),c=i?l.unflagPost({postId:a,reason:o}):l.flagPost({postId:a,reason:o}),c.done(function(e,t){0[0]!==t&&t.success===!0&&(s.set({flagged:!i,allowReplies:i,flaggingInProgress:!1}),this._syncFlaggedReplies(!i,a))}.bind(this)))},_syncFlaggedReplies:function(e,n){null!==d.flaggedReplies&&(e?d.flaggedReplies.push(n):d.flaggedReplies=t.reject(d.flaggedReplies,function(e){return e===n})),null!==d.flagCount&&(e?d.flagCount++:d.flagCount--)},_showDropdownReasonSelection:function(t,n){var s,o;d._hideReasonDropdown(),d.reasonDropdown=new a({$reply:t,model:n}),d.reasonDropdown.on("flagreason:submit",d._handlePostFlagFromDropdown),d.reasonDropdown.on("flagreason:cancel",d._hideReasonDropdown),d.reasonDropdown.render(),n.set({flaggingInProgress:!0}),d.reasonDropdown.$el.appendTo(t),s=d.reasonDropdown.$el,e(window).scrollTop()+window.innerHeight-s.height()<s.offset().top&&(o=s.offset().top-s.height(),e("body").scrollTo(o,{duration:"slow"}))},_showModalReasonSelection:function(e,t){d.reasonModal=new r({$reply:e,model:t}),d.reasonModal.on("flagreason:cancel",function(){c.close()}),d.reasonModal.on("flagreason:submit",d._handlePostFlagFromModal),c.create(d.reasonModal,{name:"flagreason",className:"reveal-modal kinja-modal sticky-modal bottom full-width"})},_handlePostFlagFromDropdown:function(e,t){var n=e.model;e.$("a,input").addClass("disabled"),n.once("change:flagged",d._hideReasonDropdown),d._flagPost(e.options.$reply,n,t)},_handlePostFlagFromModal:function(e,t){var n=e.model;e.$("a,input").addClass("disabled"),n.once("change:flagged",function(){c.close()}),d._flagPost(e.options.$reply,n,t)},_hideReasonDropdown:function(){t.isUndefined(d.reasonDropdown)||(d.reasonDropdown.options.model.set({flaggingInProgress:!1}),d.reasonDropdown.remove(),d.reasonDropdown=0[0])},API:{flaggedRepliesLoaded:function(){return d.flaggedRepliesLoaded},flagCountLoaded:function(){return d.flagCountLoaded},flaggedReplies:function(){return d.flaggedReplies},flagCount:function(){return d.flagCount},openFlagView:function(e,t){s.requireLogin("flagPost").done(function(){i.isSmall()?d._showModalReasonSelection(e,t):d._showDropdownReasonSelection(e,t)})},unflag:function(e,t){s.requireLogin("unflagPost").done(function(){d._flagPost(e.view.$el,t)})},loadFlaggedReplies:function(e){s.onAuth.done(function(){s.isLoggedIn()&&d._loadFlaggedReplies(e)})},loadFlagCount:function(e){s.onAuth.done(function(){var t=o.getKinjaMeta().blog.id;s.isLoggedIn()&&(s.isSuperuser()&&n.isOn("superuser")||s.hasRole("OWNER",t)||s.hasRole("ADMIN",t))?d._loadFlagCount(e):d.flagCountLoaded.reject()})},extendPostModel:function(e){d.flaggedRepliesLoaded.done(function(){d._mergePostModelWithFlagInfo(e)})}}};return window.__karma__&&(d.API.__testonly__=d),d.API}),define("apiclient/discussion",["underscore","config","apiclient/apirequest","apiclient/gettoken","singleton/Feature","singleton/Utils"],function(e,t,n,s,o,i){"use strict";var a,l,d,r=t.api.core.url,u=o.isOn("superuser"),c=window.parseInt(o.value("discussion_truncation")||0,10);return l={personalized:r+"/reply/{{postId}}/replies/qi/combined/userfilter/activity",nextPersonalized:r+"/reply/{{parentId}}/replies",all:r+"/reply/{{postId}}/replies",nextAll:r+"/reply/{{parentId}}/replies/flat",permalink:r+"/reply/{{postId}}/replies/qi/combined/userfilter/activity",nextPermalink:r+"/reply/{{parentId}}/replies"},a=e.mapObject(l,function(e){return u?s.append(e,s.fresh):e}),d={getPersonalizedReplies:n.getJson(a.personalized,{query:"",currentBlogId:0,refId:0,maxReturned:c||25,includedAdmins:!0,removeDismissed:!0,cache:!!o.isOn("cachecomments")&&i.shouldGetCached}),getNextPersonalizedReplies:n.getJson(a.nextPersonalized,{currentBlogId:0,startIndex:0,startTime:0,maxReturned:20,withLikeCounts:!1,cache:!!o.isOn("cachecomments")&&i.shouldGetCached}),getAllReplies:n.getJson(a.all,{currentBlogId:0,startIndex:0,maxReturned:c||10,withLikeCounts:!0,maxChildren:4,approvedChildrenOnly:!0,approvedStartersOnly:!0,cache:!!o.isOn("cachecomments")&&i.shouldGetCached}),getNextAllReplies:n.getJson(a.nextAll,{currentBlogId:0,startIndex:4,maxReturned:20,approvedChildrenOnly:!0,approvedStartersOnly:!0,cache:!!o.isOn("cachecomments")&&i.shouldGetCached()}),getPermalinkReplies:n.getJson(a.permalink,{query:"",refId:0,currentBlogId:0,maxReturned:c||25,sort:"chrono",removeDismissed:!0,cache:!!o.isOn("cachecomments")&&i.shouldGetCached}),getNextPermalinkReplies:n.getJson(a.nextPermalink,{currentBlogId:0,startIndex:0,startTime:0,maxReturned:20,withLikeCounts:!1,cache:!!o.isOn("cachecomments")&&i.shouldGetCached})}}),define("apiclient/likestate",["config","apiclient/apirequest","apiclient/gettoken"],function(e,t,n){"use strict";var s;return s={getForPosts:t.getJson(n.append(e.api.core.url+"/like/status"),{}),getForStarter:t.getJson(n.append(e.api.core.url+"/like/{{starterId}}"),{})}}),define("module/discussion/model/comment.collection",["jquery","underscore","collection/PaginationCollection","module/discussion/model/comment.model","module/flagging/ReplyFlaggingModule","singleton/CurrentBlog","singleton/CurrentUser","singleton/Utils","apiclient/discussion","apiclient/likestate"],function(e,t,n,s,o,i,a,r,c,l){"use strict";var d=n.extend({_hasFirstFetched:!1,_stepIndex:0,_stepSize:100,_incrementStep:function(e){var n=this.getDiscussionType(),t=this.getDepth();n!==d.discussionTypes.ALL?1>t?this._stepIndex=e.data.pagination.next.refId:this._stepIndex=e.data.pagination.next.startIndex:1>t?this._stepIndex=e.data.pagination.next.startIndex:this._stepIndex+=e.data.items[0].children.items.length},_checkDone:function(e){var t,n;return this.getDiscussionType()!==d.discussionTypes.ALL?!e.data.hasOwnProperty("pagination")||!e.data.pagination.hasOwnProperty("next"):this.getDepth()<1?!e.data.hasOwnProperty("pagination")||!e.data.pagination.hasOwnProperty("next"):(t=this._stepIndex+e.data.items[0].children.items.length,n=this.getApprovedOnly()?this._approvedCount:e.data.items[0].reply.replyCount,!(n>t))},_parent:null,_permalinkComment:null,_depth:0,_discussionType:"",_approvedOnly:!0,_approvedCount:0,model:s,initialize:function(e,t){this._discussionType=t.discussionType,t.hasOwnProperty("parent")&&(this._parent=t.parent),t.hasOwnProperty("permalinkComment")&&(this._permalinkComment=t.permalinkComment),t.hasOwnProperty("parentDepth")&&(this._depth=t.parentDepth+1),t.hasOwnProperty("approvedOnly")&&!t.approvedOnly&&(this._approvedOnly=!1),this._discussionType===d.discussionTypes.ALL&&this.getDepth()>0&&(this._stepIndex=4),this.listenTo(this,"sync",function(){this._hasFirstFetched=!0,this.loadLikedComments(),this.loadFlaggedComments()}),this.listenTo(this,"discussion:comment:likestatechanged",this.onCommentLikeStateChanged)},loadFlaggedCommentCount:function(){var e=this._parent.get("id");return o.flagCount()||o.loadFlagCount(e),o.flagCountLoaded()},loadFlaggedComments:function(){var e=this._parent.get("id"),n=function(e){t.each(e,function(e){this.setAttributesOnComment(this,e,{flagged:!0})},this)}.bind(this);o.flaggedRepliesLoaded().done(function(){n(o.flaggedReplies())}),o.flaggedReplies()||o.loadFlaggedReplies(e)},loadLikedComments:function(){var n=this._parent.get("id"),e=function(e){t.each(e,function(e){this.setAttributesOnComment(this,e,{liked:!0})},this)}.bind(this);a.onAuth.done(function(){a.isLoggedIn()&&this._parent.get("replyCount")>0&&(d.likedCommentIds?e(d.likedCommentIds):l.getForStarter({starterId:n},{traditional:!0}).done(function(n){var s=t.pluck(n,"objectId");d.likedCommentIds=s,e(s)}.bind(this)))}.bind(this))},onCommentLikeStateChanged:function(e,n){d.likedCommentIds&&("like"===n?d.likedCommentIds.push(e):d.likedCommentIds=t.reject(d.likedCommentIds,function(t){return t===e}))},setAttributesOnComment:function(e,n,s){t.each(e.models,function(e){n===e.get("id")?e.set(s):e._commentCollection&&e._commentCollection.models.length>0&&this.setAttributesOnComment(e._commentCollection,n,s)},this)},getFullListOfIds:function(e){var n=[];return t.each(e.models,function(e){n.push(e.get("id")),e._commentCollection&&e._commentCollection.models.length>0&&(n=n.concat(this.getFullListOfIds(e._commentCollection)))},this),n},sync:function(e,t,n){var s=this.getApprovedOnly(),o=this.getDiscussionType(),l=r.getKinjaMeta().postAuthorBlogName,a=this._permalinkComment;return i.id||require(["module/Raven"],function(e){e.captureMessage("currentBlogId is weird",{extra:{currentBlog:i,discussionType:o,depth:this._depth}})}),o===d.discussionTypes.PERSONALIZED?this._depth>0?c.getNextPersonalizedReplies({parentId:this._parent.get("id"),currentBlogId:i.id,startIndex:this.getStepIndex()},n):c.getPersonalizedReplies({query:l,postId:this._parent.get("id"),currentBlogId:i.id,refId:this.getStepIndex()},n):o===d.discussionTypes.ALL?this._depth>0?c.getNextAllReplies({parentId:this._parent.get("id"),currentBlogId:i.id,startIndex:this._stepIndex,maxReturned:this._stepSize,approvedOnly:s},n):c.getAllReplies({postId:this._parent.get("id"),currentBlogId:i.id,startIndex:this.getStepIndex(),approvedChildrenOnly:s,approvedStartersOnly:s},n):this.getDiscussionType()===d.discussionTypes.PERMALINK?this._depth>0?c.getNextPermalinkReplies({parentId:this._parent.get("id"),currentBlogId:i.id,startIndex:this.getStepIndex()},n):c.getPermalinkReplies({postId:this._parent.get("id"),refId:this.getStepIndex()||(a?a.get("id"):0),query:r.getKinjaMeta().postAuthorBlogName,currentBlogId:i.id},n):null},parse:function(e){var i,c,a=[],o=this.getDepth(),n=this.getDiscussionType(),r=d.discussionTypes;return i=function(e,i,r,c){var l,u,h;s.addDiscussionId(e,{discussionType:n}),1>o&&(e._surfaced=!0),t.each(i,function(e){s.addDiscussionId(e,{discussionType:n}),1>o&&(e._surfaced=!0)}),l=new s(e),u=new d(i,{parent:l,parentDepth:o,discussionType:n,approvedOnly:this.getApprovedOnly()}),c&&(u._approvedCount=c),l._commentCollection=u,r&&(h=this.getApprovedOnly()&&"undefined"!=typeof c?c:e.replyCount,h>4?(l._commentCollection._doneStepping=!1,l._commentCollection._stepIndex=4,l._commentCollection&&l._commentCollection.length&&(l._commentCollection._stepIndex=l._commentCollection.length)):(l._commentCollection._doneStepping=!0,l._commentCollection._stepIndex=l._commentCollection.length)),a.push(l)},n===r.PERSONALIZED||n===r.PERMALINK?1>o?t.each(e.data.items,function(e){if(e.length){var n=t.countBy(e,"parentId");e=t.map(e,function(e){var t=e.id;return e.hasOwnProperty("qiMeta")&&(e.replyCount=e.qiMeta.filteredDirectReplies.length),n.hasOwnProperty(t)&&(e.replyCount-=n[t]),e}),i.call(this,t.first(e),t.rest(e))}}.bind(this)):(c=t.pluck(this._parent.collection.models,"id"),t.each(e.data.items,function(e){-1===c.indexOf(e.reply.id)&&i.call(this,e.reply,e.children.items)}.bind(this))):n===r.ALL&&(1>o?t.each(e.data.items,function(e){i.call(this,e.reply,e.children.items,!0,e.approvedCount)}.bind(this)):a=t.map(e.data.items[0].children.items,function(e){return s.addDiscussionId(e,{discussionType:n})})),this._checkDone(e)?(this._doneStepping=!0,this.trigger("pagination:done")):(this._incrementStep(e),this._doneStepping=!1),a},getParent:function(){return this._parent},getDiscussionType:function(){return this._discussionType},getDepth:function(){return this._depth},getSurfacedCommentLength:function(){return this.filter(function(e){return e.get("_surfaced")}).length},getApprovedOnly:function(){return this.getDiscussionType()===d.discussionTypes.PERSONALIZED?!e.cookie("KinjaNSFWCookie"):this._approvedOnly}},{discussionTypes:{PERSONALIZED:"QiReplyList",ALL:"ReplyList",PERMALINK:"PermalinkQiReplyList"},likedCommentIds:null});return d}),define("module/discussion/discussion.channel",["backbone","underscore"],function(e,t){"use strict";return t.extend({},e.Events)}),define("gawkerlib/analytics/analytics_config_prod",[],function(){"use strict";var e={rootUrl:"http://kinja.com/api/analytics/",rootUrlWoProtocol:"//kinja.com/api/analytics/"};return e}),!function(){function e(e){this.message=e}var t="undefined"!=typeof exports?exports:this,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e.prototype=new Error,e.prototype.name="InvalidCharacterError",t.btoa||(t.btoa=function(t){for(var o,i,a=String(t),s=0,r=n,c="";a.charAt(0|s)||(r="=",s%1);c+=r.charAt(63&o>>8-s%1*8)){if(i=a.charCodeAt(s+=.75),i>255)throw new e("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");o=o<<8|i}return c}),t.atob||(t.atob=function(t){if(o=String(t).replace(/=+$/,""),o.length%4==1)throw new e("'atob' failed: The string to be decoded is not correctly encoded.");for(var s,o,i,a=0,c=0,r="";s=o.charAt(c++);~s&&(i=a%4?64*i+s:s,a++%4)?r+=String.fromCharCode(255&i>>(-2*a&6)):0)s=n.indexOf(s);return r})}(),define("lib/base64.min",function(){}),define("module/KinjaAnalytics",["jquery","gawkerlib/analytics/analytics_config_prod","lib/base64.min"],function(e,t){"use strict";var n={session:{},context:{},setContext:function(e,t,n){this.context.blogId=e,this.context.contextType=t,this.context.id=n},createPayload:function(e,t,n,s,o,i,a,r){var c={blogId:e,eventType:t,targetType:n,targetId:s,contextType:o,contextId:i,eventAttributes:a,eventAttributesExtended:r};return c},pushEvent:function(e,t,n,s,o){var i=this.createPayload(this.context.blogId?String(this.context.blogId):null,e,t,n?String(n):null,this.context.contextType,this.context.id?String(this.context.id):null,s,o);this.writeEvent(i)},setSession:function(e){return!!("string"==typeof e.agid&&"string"==typeof e.asid&&e.ping)&&(this.session.globalId=e.agid,this.session.sessionId=e.asid,this.session.ping=e.ping,!0)},getEventMeta:function(){var e={context:this.context,session:this.session};return e},writeEvent:function(n){var s=btoa(JSON.stringify(n)),o=t.rootUrlWoProtocol,i=Math.floor(1e3*Math.random()+1),a=o+"t/event.js?e="+s+"&cb="+i,r=this;e.ajax(a,{type:"GET",success:function(e){r.setSession(e.data)},xhrFields:{withCredentials:!0},crossDomain:!0})}};return n}),define("app/post/common/post.layout",["underscore","backbone.marionette","singleton/CurrentUser","singleton/Utils","singleton/Feature","module/KinjaAnalytics"],function(e,t,n,s,o,i){"use strict";var a=t.Layout.extend(e.extend({regions:{post:".post"},ui:{likeButton:".js_like",likeIcon:".js_like_icon",likeCountPlaceholder:".js_like_count",replyButton:".js_reply-to-post",metaContainer:".meta-container",metaTools:".js_meta-tools"},triggers:{"click @ui.likeButton":"posttools:like","click @ui.replyButton":"posttools:reply"},events:{approval:"_removePendingStyling","click @ui.likeIcon":"onRecommendTracking"},modelEvents:{"change:liked":"_updateLikeIconClasses","posttools:post:likeCount:updated":"_updateLikeCount"},updateUserState:function(){n.onAuth.done(function(){n.isLoggedIn()?this._updateLikeIconClasses():this._removeLikeIconClass()}.bind(this)),n.onLoggedIn.done(this._updateLikeIconClasses.bind(this))},togglePostToolsVisibility:function(e){o.isOn("newstream")?this.ui.metaTools.toggleClass("hide",e):this.ui.metaContainer.toggleClass("without-dropdown",e)},onRecommendTracking:function(e){var t="groupChat"===e.currentTarget.parentElement.getAttribute("data-analytics-target");s.getKinjaMeta().pageType!==s.pageTypes.permalink||t||i.pushEvent("RECOMMENDATION","POST",this.model.id,{uiElement:e.currentTarget.getAttribute("data-analytics-target")})},_removePendingStyling:function(t,n){var s=this.$el.closest(".js_branch-list");e.each(n.approvedReplyIDs,function(e){s.find("#reply_"+e).removeClass("reply--unapproved")})},_updateLikeIconClasses:function(){this.ui.likeIcon.toggleClass("active",this.model.get("liked"))},_removeLikeIconClass:function(){this.ui.likeIcon.removeClass("active")},_updateLikeCount:function(){var e=parseInt(this.ui.likeButton.data("likecount"),10)||0,t=e>0,e=this.model.get("liked")?e+1:t?e-1:0;this.ui.likeButton.data("likecount",e),this.ui.likeCountPlaceholder.text(e||"")}}));return a}),define("app/post/mixins/post.userPermissionsHelper",["singleton/Feature","singleton/CurrentUser","singleton/CurrentBlog"],function(e,t,n){"use strict";return{canEditPost:function(n){var a=15,r=function(e){var t=new Date(e+60*a*1e3),n=new Date;return t>n},s=t.isLoggedIn(),o=t.id===n.get("authorId"),c=t.hasRole("OWNER",n.get("defaultBlogId")),l=t.hasRole("ADMIN",n.get("defaultBlogId")),i=n.has("parentId"),d=s&&(o||c||l)&&!i,u=s&&i&&o&&r(n.get("publishTimeMillis"));return t.isSuperuser()&&e.isOn("superuser")||d||u},canDeletePost:function(e){var n=t.isLoggedIn(),s=t.id===e.get("authorId"),o=t.hasRole("OWNER",e.get("defaultBlogId")),i=e.has("parentId");return n&&(s||o)&&!i},canInviteToPostManually:function(n){return e.isOn("invitetoken")&&n.get("authorId")===t.id},canPromote:function(){return t.hasPermission("SALES")||t.isSuperuser()&&e.isOn("superuser")},canDismissPost:function(s){var o=t.hasRole("ADMIN",n.id)||t.hasRole("ADMIN",s.get("defaultBlogId")),i=t.id===s.get("authorId"),a=t.id===s.get("parentAuthorId"),r=s.has("parentId");return r&&(t.isSuperuser()&&e.isOn("superuser")||!i&&(o||a))},canUnshareRepostedPost:function(){return t.hasRole("ADMIN",n.id)},canBlock:function(e){return this.userIsOwner(e)||this.userIsAdmin(e)||this.userIsSuper()},canSharePost:function(){return t.isLoggedIn()},userIsAuthor:function(e){return t.hasRole("AUTHOR",e.get("defaultBlogId"))&&t.id!==e.get("authorId")},userIsOwner:function(e){return t.hasRole("OWNER",e.get("defaultBlogId"))&&t.id!==e.get("authorId")},userIsAdmin:function(e){return t.hasRole("ADMIN",e.get("defaultBlogId"))&&t.id!==e.get("authorId")},userIsSuper:function(){return t.isSuperuser()&&e.isOn("superuser")}}}),define("app/post/mixins/post.userPermissions",["underscore","app/post/mixins/post.userPermissionsHelper"],function(e,t){"use strict";var n=["canEditPost","canDeletePost","canInviteToPostManually","canPromote","canDismissPost","canUnshareRepostedPost","canBlock","canSharePost","userIsAuthor","userIsOwner","userIsAdmin","userIsSuper"];return e.reduce(n,function(n,s){return n[s]=e.wrap(t[s],function(e){return e.call(this,this.model)}),n},{})}),define("app/post/mixins/post.confirmationPrompt",["jquery","singleton/Renderer"],function(e,t){"use strict";var n={_confirmationPrompt:function(n,s){return window.confirm(e(t.renderTemplate(n,s||{})).text())}};return n}),define("app/post/common/post.menuitemview",["backbone.marionette"],function(e){"use strict";var t=e.ItemView.extend({_show:function(){this.$el.removeClass("hide")},_hide:function(){this.$el.addClass("hide")},_isDisabled:function(){return!1},_canShow:function(){throw new Error("method _canShow not implemented!")},onRender:function(){this._canShow()?(this._show(),this._isDisabled()?this.$el.addClass("disabled"):this.$el.removeClass("disabled")):this._hide()}});return t}),define("app/post/posttools/view/posttools.menuitemview",["underscore","app/post/mixins/post.userPermissions","app/post/mixins/post.confirmationPrompt","app/post/common/post.menuitemview"],function(e,t,n,s){"use strict";var o=s.extend(e.extend({},t,n,{_canShow:function(){var t=this,n=function(e){return t[e]};return e.chain(this.permissions).map(n).invoke("call",this).all().value()},render:function(){return this.isClosed=!1,this.triggerMethod("before:render",this),this.triggerMethod("item:before:render",this),this.bindUIElements(),this.triggerMethod("render",this),this.triggerMethod("item:rendered",this),this}}));return o}),define("app/post/posttools/view/posttools.editview",["app/post/posttools/view/posttools.menuitemview","singleton/Feature","singleton/Utils"],function(e,t,n){"use strict";var s=e.extend({permissions:["canEditPost"],onRender:function(){var s=t.isOn("editor_own_page_test")?window.location.search:"",o=this.$el.find("a");e.prototype.onRender.call(this,arguments),o.attr("href","//"+n.getKinjaHost()+"/write/"+this.model.id+s)}});return s}),define("app/post/posttools/view/posttools.editreplyview",["app/post/posttools/view/posttools.menuitemview"],function(e){"use strict";var t=e.extend({permissions:["canEditPost"]});return t}),define("app/post/posttools/view/posttools.deleteview",["app/post/posttools/view/posttools.menuitemview"],function(e){"use strict";var t=e.extend({permissions:["canDeletePost"],triggers:{click:"posttools:delete"}});return t}),define("apiclient/invite",["config","apiclient/apirequest","apiclient/gettoken"],function(e,t,n){"use strict";return{addInvite:t.postJson(n.append(e.api.core.url+"/invite")),requestInviteToken:t.postJson(n.append(e.api.core.url+"/invite/create?postId={{postId}}")),approveInvitedCommenter:t.postJson(e.api.core.url+"/invite/approve")}}),define("templates/tiger/components/invites/modals",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(e,t,n,s,o){t.components.invites.modals.inviteToPostManually=function(e){return'<form class="invite-to-post-form js_invite-to-post-form"><div class="row"><div class="columns"><input type="url" class="mbn js_invite-manually-field" value="'+o.$$escapeHtmlAttribute(e.permalink)+"?invite="+o.$$escapeHtmlAttribute(e.inviteUid)+'" autofocus /></div></div></form>'},s.DEBUG&&(t.components.invites.modals.inviteToPostManually.soyTemplateName="tiger.components.invites.modals.inviteToPostManually")}),define("view/forms/invite/InviteToPostManuallyModalView",["backbone.marionette","singleton/EventDispatcher","templates/tiger/components/invites/modals"],function(e,t){"use strict";var n=e.ItemView.extend({id:"modal-invite-to-post-manually",template:tiger.components.invites.modals.inviteToPostManually,ui:{inviteToPostManuallyField:"#js_invite-to-post-manually-field"},initialize:function(){t.on("modal:login:close",this.close,this)}});return n}),define("app/invites/behaviors/invites.token.posttools",["backbone.marionette","apiclient/invite","app/modal/modal.controller","view/forms/invite/InviteToPostManuallyModalView"],function(e,t,n,s){"use strict";var o=e.Behavior.extend({events:{click:"onInviteModalToPostManuallyOpen"},onInviteModalToPostManuallyOpen:function(e){e.preventDefault(),t.requestInviteToken({postId:this.view.model.id}).done(function(e){var t=n.instantiate(s,{templateData:{permalink:this.view.model.get("permalink"),inviteUid:e.inviteUid}});n.create(t,{name:"invite",className:"reveal-modal kinja-modal small proxima"})}.bind(this))}});return o}),define("app/post/posttools/view/posttools.invitemanuallyview",["app/post/posttools/view/posttools.menuitemview","app/invites/behaviors/invites.token.posttools"],function(e,t){"use strict";var n=e.extend({permissions:["canInviteToPostManually"],behaviors:{InvitesTokenPostTools:{behaviorClass:t}}});return n}),define("app/post/posttools/view/posttools.dismissview",["app/post/posttools/view/posttools.menuitemview","singleton/CurrentUser","singleton/Utils"],function(e,t,n){"use strict";var s=e.extend({permissions:["canDismissPost"],ui:{dismissButton:"a.dismiss",undismissButton:"a.undismiss"},triggers:{"click @ui.dismissButton":"posttools:dismiss","click @ui.undismissButton":"posttools:undismiss"},modelEvents:{"change:actionState":"_finishRender"},_finishRender:function(){this._setDismissState(),e.prototype.onRender.call(this)},_setDismissState:function(){var e=this.model.get("actionState"),t=this.model.get("defaultBlogId"),e=e?e[t]:"";"dismiss"===e?(this.$el.removeClass(".js_dismiss").addClass("js_undismiss"),this.ui.dismissButton.addClass("hide"),this.ui.undismissButton.removeClass("hide")):(this.$el.removeClass(".js_undismiss").addClass("js_dismiss"),this.ui.undismissButton.addClass("hide"),this.ui.dismissButton.removeClass("hide"))},onRender:function(){var e,o,s=this;"permalink"===n.getKinjaMeta().pageType?(e=parseInt(n.getKinjaMeta().postId||0,10),o=parseInt(n.getKinjaMeta().starterId||0,10),e!==o&&e===this.model.id?t.onAuth.always(function(){t.isLoggedIn()?s.triggerMethod("posttools:getDismissState",{model:s.model}):s._finishRender()}):this._finishRender()):this._finishRender()}});return s}),define("app/post/posttools/view/posttools.promoteview",["app/post/posttools/view/posttools.menuitemview","singleton/Utils"],function(e,t){"use strict";var n=e.extend({permissions:["canPromote"],triggers:{click:"posttools:promote"},onPosttoolsOpened:function(){var e=this.model&&parseInt(t.getKinjaMeta().postId,10)===this.model.get("sharedPostId");e&&this.$el.addClass("hide")}});return n}),define("app/post/posttools/view/posttools.blockview",["app/post/posttools/view/posttools.menuitemview","singleton/CurrentUser"],function(e,t){"use strict";var n=e.extend({permissions:["canBlock"],events:{click:"_blockBlog"},modelEvents:{"posttools:blockStatusUpdated":"_finishRender"},collectionEvents:{"posttools:block posttools:unblock sync":"_checkBlockStatus"},_checkBlockStatus:function(){this.triggerMethod("posttools:checkBlockStatus",{model:this.model,collection:this.collection})},_blockBlog:function(e){e.preventDefault(),this.triggerMethod("posttools:block",{model:this.model,collection:this.collection,targetBlogName:this._getTargetBlogName(),targetAuthorName:this._getTargetAuthorName()}),this.$el.siblings(".js_unfollowforblog").addClass("hide"),this.$el.siblings(".js_followforblog").removeClass("hide"),this.$el.siblings(".js_unfollowforuser").addClass("hide"),this.$el.siblings(".js_followforuser").removeClass("hide")},_correctBlockText:function(e){var n=this.$el.find("span"),s=n.text(),t=e?"Unblock":"Block",t=s.replace(/Unblock|Block/,t);n.text(t)},_finishRender:function(t){this._correctBlockText(t),e.prototype.onRender.call(this)},_getTargetBlogName:function(){return this.$el.data("targetblogname")},_getTargetAuthorName:function(){return this.$el.data("targetauthorname")},onRender:function(){var e=this;t.onAuth.always(function(){e._canShow()?e._checkBlockStatus():e._hide()})}});return n}),define("app/post/posttools/view/posttools.hideview",["app/post/posttools/view/posttools.menuitemview"],function(e){"use strict";var t=e.extend({permissions:["userIsSuper"],triggers:{click:"posttools:hide"}});return t}),define("app/post/posttools/view/posttools.kinjashareview",["app/post/posttools/view/posttools.menuitemview","singleton/Utils"],function(e,t){"use strict";var n=e.extend({permissions:[],events:{click:"onKinjaShareClick"},onKinjaShareClick:function(){var e=parseInt(t.getKinjaMeta().postId,10)===this.model.get("sharedPostId"),n=this.model.get("isStarter");this.trigger("posttools:kinjaShare",this.model,{showReframe:!e&&n})}});return n}),define("app/post/posttools/view/posttools.kinjaunshareview",["app/post/posttools/view/posttools.menuitemview"],function(e){"use strict";var t=e.extend({permissions:["canSharePost","canUnshareRepostedPost"],triggers:{click:"posttools:undorepost"}});return t}),define("app/post/posttools/view/posttools.externalshareview",["jquery","app/post/posttools/view/posttools.menuitemview"],function(e,t){"use strict";var n=t.extend({permissions:[],ui:{sharePostButton:".js_share-post-item"},triggers:{"click @ui.sharePostButton":"posttools:externalShare"},onRender:function(){var t=function(t){return e("<div/>").html(t).text()},n=function(e){return e?e.replace(/&#(\d+);/g,function(e,t){return String.fromCharCode(t)}):""},s=this.model.get("headline")||this.model.get("first100Characters")||this.model.get("compact"),o=this.ui.sharePostButton.attr("href");this.ui.sharePostButton.attr("href",o.replace("POST_TITLE",encodeURIComponent(t(n(s)))))}});return n}),define("app/post/posttools/view/posttools.flagview",["app/post/posttools/view/posttools.menuitemview","module/flagging/ReplyFlaggingModule"],function(e,t){"use strict";var n=e.extend({modelEvents:{"change:flagged":"_flaggedChanged","change:flaggingInProgress":"_flaggedChanged"},permissions:[],events:{click:"_onFlagClicked"},_flaggedChanged:function(){this.render()},_canShow:function(){return this.model.get("flagged")!==!0},_isDisabled:function(){return this.model.get("flaggingInProgress")===!0},_onFlagClicked:function(e){e.preventDefault();var n=this.$el.parents(".js_reply");t.openFlagView(n,this.model)}});return n}),define("app/post/posttools/view/posttools.unflagview",["app/post/posttools/view/posttools.menuitemview"],function(e){"use strict";var t=e.extend({modelEvents:{"change:flagged":"_flaggedChanged","change:flaggingInProgress":"_flaggedChanged"},permissions:[],triggers:{click:"posttools:unflag"},_flaggedChanged:function(){this.render()},_canShow:function(){return this.model.get("flagged")===!0},_isDisabled:function(){return this.model.get("flaggingInProgress")===!0}});return t}),define("app/post/posttools/view/reposttools.unscheduleview",["app/post/posttools/view/posttools.menuitemview"],function(e){"use strict";return e.extend({permissions:["canSharePost"],triggers:{click:"reposttools:unschedule"}})}),define("app/post/posttools/view/posttools.pupilview",["jquery","underscore","app/post/posttools/view/posttools.menuitemview"],function(e,t,n){"use strict";var s=n.extend({permissions:["canPromote"],triggers:{click:"posttools:pupil"}});return s}),define("templates/tiger/components/post/meta/post-dropdown",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(e,t,n,s,o){t.components.post.meta.postDropdown=function(e,n,s){var r="",c=e.post.defaultBlogId!=(null==e.blog?null:e.blog.id)&&"POSTACTION"==(null==e.post.meta?null:e.post.meta.typ),i=null!=(null==e.blog?null:e.blog.name)?null==e.blog?null:e.blog.name:e.post.defaultBlogName,a=null!=(null==e.blog?null:e.blog.displayName)?null==e.blog?null:e.blog.displayName:i;return r+='<ul id="dropdown-'+o.$$escapeHtmlAttribute(e.post.id)+'" class="f-dropdown proxima js_post-dropdown js_follow-controls js_user-follow-controls whitelisted-links" data-postid="'+o.$$escapeHtmlAttribute(e.post.id)+'" data-starterid="'+o.$$escapeHtmlAttribute(e.post.starterId)+'" data-authorid="'+o.$$escapeHtmlAttribute(e.post.author.id)+'" data-blogid="'+o.$$escapeHtmlAttribute(e.post.authorBlogId)+'" data-sourceblogid="'+o.$$escapeHtmlAttribute(null==e.blog?null:e.blog.id)+'" data-dropdown-content>'+("reply"==e.mode?'<li class="js_edit-reply hover-icon hide readonly-hide"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">'+t.icons.actions.write(null,null,s)+"Edit</a></li>":'<li class="js_edit-post hover-icon hide readonly-hide"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">'+t.icons.actions.write(null,null,s)+"Edit</a></li>")+(c?'<li class="js_kinja-unshare hover-icon hide readonly-hide"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">'+t.icons.essential.externalLink(null,null,s)+"Unshare</a></li>":'<li class="js_delete-post hover-icon hide readonly-hide"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">'+t.icons.essential.close(null,null,s)+"Delete</a></li>")+("DRAFT"!=e.post.status?t.components.invites.menuItems.invitePostDropdownItems(null,null,s):"")+("reply"==e.mode&&"profilepage"!=e.pageType?`<li data-analytics-target="groupChat" class="js_followforuser hover-icon readonly-hide" onclick="window.ga('send', 'event', 'Group Chats', 'click', 'Drop down - follow user click');"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">`+t.icons.essential.add(null,null,s)+"Follow "+o.$$escapeHtml(e.post.authorBlogName)+'</a></li><li class="js_unfollowforuser hover-icon hide readonly-hide"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">'+t.icons.essential.checkmark(null,null,s)+"Unfollow "+o.$$escapeHtml(e.post.authorBlogName)+"</a></li>"+("private"!=e.pageType&&"dashboard"!=e.pageType?'<li class="js_followforblog js_approveforblog hover-icon hide readonly-hide"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">'+(s.features.approvemessage?t.icons.essential.add(null,null,s)+"Approve "+o.$$escapeHtml(e.post.authorBlogName)+" on "+o.$$escapeHtml(a):t.icons.essential.add(null,null,s)+"Follow "+o.$$escapeHtml(e.post.authorBlogName)+" for "+o.$$escapeHtml(i))+'</a></li><li class="js_unfollowforblog js_unapproveforblog hover-icon hide readonly-hide"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">'+(s.features.approvemessage?t.icons.essential.checkmark(null,null,s)+"Remove "+o.$$escapeHtml(e.post.authorBlogName)+" from "+o.$$escapeHtml(a)+" approve list":t.icons.essential.checkmark(null,null,s)+"Unfollow "+o.$$escapeHtml(e.post.authorBlogName)+" for "+o.$$escapeHtml(i))+"</a></li>":""):"DRAFT"!=e.post.status?'<li class="js_promote hover-icon hide readonly-hide"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">'+t.icons.essential.starCircle(null,null,s)+"Promote</a></li>":"")+("DRAFT"!=e.post.status&&"dashboard"!=e.pageType?`<li class="js_dismiss hover-icon hide readonly-hide"><a href="#" class="dismiss icon--svg u-darkened--onhover u-prepended" rel="nofollow" onclick="window.ga('send', 'event', 'Group Chats', 'click', 'Dismiss click');">`+t.icons.actions.userRemove(null,null,s)+`Dismiss</a><a href="#" class="undismiss icon--svg u-darkened--onhover u-prepended" rel="nofollow" onclick="window.ga('send', 'event', 'Group Chats', 'click', 'Undismiss click');">`+t.icons.actions.userRemove(null,null,s)+'Undismiss</a></li><li class="js_block hover-icon hide disabled readonly-hide" data-blogid="'+o.$$escapeHtmlAttribute(e.post.defaultBlogId)+'" data-targetblogid="'+o.$$escapeHtmlAttribute(e.post.authorBlogId)+'" data-targetblogname="'+o.$$escapeHtmlAttribute(i)+'" data-targetauthorname="'+o.$$escapeHtmlAttribute(e.post.author.displayName)+'"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">'+t.icons.actions.disabled(null,null,s)+"<span>Block for "+o.$$escapeHtml(i)+'</span></a></li><li class="js_hide-post hover-icon hide readonly-hide"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">'+t.icons.actions.disabled(null,null,s)+"Hide</a></li>":"")+("permalink"==e.pageType&&"DRAFT"!=e.post.status?("reply"==e.mode?'<li class="js_flag-post hover-icon readonly-hide"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">'+t.icons.actions.flag(null,null,s)+'Flag</a></li><li class="js_unflag-post unflag-post hover-icon readonly-hide"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">'+t.icons.actions.flag(null,null,s)+"Unflag</a></li>":s.features.pupil_rating?'<li class="js_pupil-rules-block"><a class="js_pupil-rules hover-icon icon--svg u-darkened--onhover u-prepended" href="#" rel="nofollow">'+t.icons.actions.writePaper(null,null,s)+"Open Pupil Rules</a></li>":"")+'<li class="js_kinja-share-block readonly-hide"><a class="js_kinja-share hover-icon icon--svg u-darkened--onhover u-prepended" href="#" rel="nofollow">'+t.icons.essential.externalLink(null,null,s)+'Share to Kinja</a></li><li class="js_go-to-permalink"><a class="hover-icon icon--svg u-darkened--onhover u-prepended" href="'+o.$$escapeHtmlAttribute(o.$$filterNormalizeUri(e.post.permalink))+`" onclick="window.ga('send', 'event', 'Group Chats', 'click', 'Drop down - Go to permalink click');">`+t.icons.essential.link(null,null,s)+"Go to permalink</a></li>":"")+("dashboard"==e.pageType&&"reply"==e.mode&&"DRAFT"!=e.post.status?'<li class="js_block readonly-hide" data-blogid="'+o.$$escapeHtmlAttribute(e.post.defaultBlogId)+'" data-targetblogid="'+o.$$escapeHtmlAttribute(e.post.authorBlogId)+'" data-targetblogname="'+o.$$escapeHtmlAttribute(i)+'" data-targetauthorname="'+o.$$escapeHtmlAttribute(e.post.author.displayName)+`"><a href="#" rel="nofollow" onclick="window.ga('send', 'event', 'Group Chats', 'click', 'Block User click');" class="icon--svg u-darkened--onhover u-prepended">`+t.icons.essential.close(null,null,s)+"Block user for blog</a></li>":"")+"</ul>"},s.DEBUG&&(t.components.post.meta.postDropdown.soyTemplateName="tiger.components.post.meta.postDropdown"),t.components.post.meta.postDropdownTrigger=function(e,n,s){return'<a href="#" target="_self" class="post-dropdown-trigger js_post-menu-toggler icon--svg u-highlighted--onhover" data-dropdown="dropdown-'+o.$$escapeHtmlAttribute(e.post.id)+`" onclick="window.ga('send', 'event', 'Group Chats', 'click', 'Drop down click');">`+(s.features.newstream?t.icons.essential.toolsGiant(null,null,s):t.icons.essential.chevronBottom(null,null,s))+"</a>"},s.DEBUG&&(t.components.post.meta.postDropdownTrigger.soyTemplateName="tiger.components.post.meta.postDropdownTrigger")}),define("app/post/posttools/posttools.menuview",["jquery","underscore","backbone","backbone.marionette","singleton/CurrentUser","singleton/CurrentBlog","singleton/EventDispatcher","singleton/Utils","app/post/mixins/post.userPermissions","app/post/posttools/view/posttools.editview","app/post/posttools/view/posttools.editreplyview","app/post/posttools/view/posttools.deleteview","app/post/posttools/view/posttools.invitemanuallyview","app/post/posttools/view/posttools.dismissview","app/post/posttools/view/posttools.promoteview","app/post/posttools/view/posttools.blockview","app/post/posttools/view/posttools.hideview","app/post/posttools/view/posttools.kinjashareview","app/post/posttools/view/posttools.kinjaunshareview","app/post/posttools/view/posttools.externalshareview","app/post/posttools/view/posttools.flagview","app/post/posttools/view/posttools.unflagview","app/post/posttools/view/reposttools.unscheduleview","app/post/posttools/view/posttools.pupilview","templates/tiger/components/post/meta/post-dropdown"],function(e,t,n,s,o,i,a,r,c,l,d,u,h,m,f,p,g,v,b,j,y,_,w,O){"use strict";var x=["profilepage","dashboard","manageblog"],C=s.ItemView.extend(t.extend({},c,{menuItemViewClasses:{".js_pupil-rules":O,".js_-post":l,".js_edit-post":l,".js_edit-reply":-1===t.indexOf(x,r.getKinjaMeta().pageType)?d:l,".js_delete-post":u,".js_invite-to-post-manually":h,".js_dismiss":m,".js_promote":f,".js_block":p,".js_hide-post":g,".js_kinja-share":v,".js_kinja-unshare":b,".js_external-share":j,".js_flag-post":y,".js_unflag-post":_,".js_unschedule-repost":w},events:{"requested.fndtn.dropdown .js_post-menu-toggler":"onPosttoolsRequested"},triggers:{"opened.fndtn.dropdown .js_post-dropdown":"posttools:opened"},menuItemViews:[],permissions:["userIsSuper","canEditPost","canPromote","canDismissPost","canSharePost"],initialize:function(e){a.on("blog:block:success"+this.model.id,this.render,this),this.blockedBlogCollection=e.blockedBlogCollection},_instantiateMenuItemViewClasses:function(e){return e=e||this.$el,Object.keys(this.menuItemViewClasses).reduce(function(n,s){var o=e.find(s),i=t.partial(this._createMenuItemClass.bind(this),s);return o.length?n.concat(t.map(o,i)):n}.bind(this),[])},_createMenuItemClass:function(t,n){var o=this.menuItemViewClasses[t],s={el:e(n),model:this.model};return".js_block"===t&&(s.collection=this.blockedBlogCollection),new o(s)},_bindEvents:function(){o.onAuthStateChange(this._refreshMenu.bind(this))},_refreshMenu:function(){var t="permalink"===r.getKinjaMeta().pageType,e=this,n=function(){return e.$("li:not(.hide)").length};e._renderMenuItems(),e.trigger("posttools:menuview:togglehidden",!t&&!n())},_renderMenuItems:function(){this.menuItemViews.call("render")},_captureMenuItemEvents:function(){this.menuItemViews.call("on","all",this.trigger,this)},_adjustMenuHeight:function(){var n,t=this.$(".js_post-dropdown"),s=e(window.document).height(),o=this.$el.offset().top,i=s-o-t.height();0>i&&(n=s-o,t.height(n+"px"),t.addClass("scroll"))},onPosttoolsOpened:function(){t.isEmpty(this.menuItemViews)?this.listenToOnce(this,"posttools:content:render",this.onPosttoolsOpened):(this.menuItemViews.call("triggerMethod","posttools:opened"),this._adjustMenuHeight())},onPosttoolsRequested:function(e,t){var n=s.Renderer.render(tiger.components.post.meta.postDropdown,{post:this.model.toJSON(),mode:"reply",pageType:r.getKinjaMeta().pageType,blog:i});t.resolve(n),this.onContentRender()},render:function(){var e="permalink"===r.getKinjaMeta().pageType;return this.onContentRender(),e&&this.trigger("posttools:menuview:togglehidden",!1),this},onContentRender:function(){var e;this.menuItemViews.length||(e=this._instantiateMenuItemViewClasses(),this.menuItemViews=new n.ChildViewContainer(e),this._captureMenuItemEvents()),this._renderMenuItems(),this._bindEvents(),this.trigger("posttools:content:render")}}));return C}),define("templates/tiger/components/groupchats/unapproved-warning",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(e,t,n,s){t.components.groupchats.unapprovedWarning=function(e){return e=e||{},'<div class="js_toggle-pending unapproved-filter"><div class="filtered-view js_toggle-block"><div class="alert-container">'+(e.noReplies?"There are no approved replies for this post. To see additional replies that are pending approval, click Show Pending. Warning: These may contain graphic material.":"The following replies are approved. To see additional replies that are pending approval, click Show Pending. Warning: These may contain graphic material.")+`</div><div class="button-container"><a href="#" class="secondary js_pending-reply-switch" onclick="window.ga('send', 'event', 'Group Chats', 'click', 'Show Pending Toggle');">Show pending</a></div></div><div class="unapproved-view js_toggle-block hide"><div class="alert-container">Warning: Replies that are pending approval may contain graphic material. Please proceed with caution.</div><div class="button-container"><a href="#" class="js_pending-reply-switch">Hide pending</a></div></div></div>`},s.DEBUG&&(t.components.groupchats.unapprovedWarning.soyTemplateName="tiger.components.groupchats.unapprovedWarning"),t.components.groupchats.unapprovedWarningThread=function(){return'<div class="js_toggle-pending unapproved-filter unapproved-filter--thread"><div class="filtered-view js_toggle-block"><div class="alert-container">The following replies are approved. Click to show additional replies that are pending approval. Warning: These may contain graphic material.</div><div class="button-container"><a href="#" class="js_pending-reply-thread-switch">Show replies</a></div><div class="close-button-container"><a href="#" class="js_pending-close close-button">×</a></div></div></div>'},s.DEBUG&&(t.components.groupchats.unapprovedWarningThread.soyTemplateName="tiger.components.groupchats.unapprovedWarningThread"),t.components.groupchats.unapprovedAnnotationWarning=function(){return'<div class="js_toggle-pending unapproved-filter"><div class="filtered-view js_toggle-block"><div class="alert-container">The following reply is unapproved. Warning: It may contain graphic material.</div><div class="button-container"><a href="#" class="js_pending-reply-thread-switch">Show reply</a></div></div></div>'},s.DEBUG&&(t.components.groupchats.unapprovedAnnotationWarning.soyTemplateName="tiger.components.groupchats.unapprovedAnnotationWarning")}),define("module/discussion/view/warning.view",["backbone.marionette","templates/tiger/components/groupchats/unapproved-warning"],function(e){"use strict";var t=e.ItemView.extend({ui:{toggleBlocks:".js_toggle-block"},getTemplate:function(){var n=t.warningTypes,e=function(){};switch(this.options.warningType){case n.THREAD:e=tiger.components.groupchats.unapprovedWarningThread;break;case n.COMPLETE:e=tiger.components.groupchats.unapprovedWarning}return e},serializeData:function(){return{noReplies:this.options.noReplies}},toggleFilter:function(){this.ui.toggleBlocks.toggleClass("hide")}},{warningTypes:{THREAD:"thread",COMPLETE:"complete"}});return t}),define("view/ImageLoader",["jquery","underscore","singleton/EventDispatcher","view/BaseView","singleton/Feature","lib/waypoints","lib/jquery.browser.mobile"],function(e,t,n,s,o){"use strict";var r=e(document),a=e(window),c={initialLookaheadFactor:.8,lookaheadFactor:2.6,containerClass:"lazy-image"},i="loaded",l=s.extend({$allWrappers:e(),$allImages:e(),_watchedImages:[],viewportHeight:0,scrollTop:0,initialize:function(e){this.options=t.defaults(e||{},c),t.bindAll(this,"loadIfVisible","handleScroll","handleScrollNew"),this.registerImages(this.$el),this.addScrollEvents(),n.on("rendered.postlist.reply",function(e){this.registerImages(e.el)}.bind(this))},registerImages:function(n){var s=this.options.containerClass,o=n.find("."+s),i=o.find("img, iframe");this.$allWrappers=this.$allWrappers.add(o),this.$allImages=this.$allImages.add(i),this._watchedImages=this._watchedImages.concat(t.map(i,function(t){var n=e(t);return[n,n.outerHeight(),n.offset().top]})),this.$allImages.each(function(t,n){var o=e(n);o.data("wrapper",o.closest("."+s))}),this.trigger("images:registered")},addScrollEvents:function(){var n=t.bind(function(){this.viewportHeight=e.waypoints("viewportHeight")},this);n(),a.resize(t.debounce(n,1e3)),o.isOn("imageloader")?(a.scroll(t.throttle(t.partial(this.handleScrollNew,this.options.lookaheadFactor),500)),this.handleScrollNew(this.options.initialLookaheadFactor)):(a.scroll(t.throttle(t.partial(this.handleScroll,this.options.lookaheadFactor),500)),this.handleScroll(this.options.initialLookaheadFactor))},loadImage:function(t){var n=e(t);n.data(i)||this.waitForPlaceholder(n)},reinitializeInterchange:t.once(function(){e(document).foundation("interchange")}),updateInterchange:t.throttle(function(){this.reinitializeInterchange(),e(document).foundation("interchange","reflow")},150),_loadImage:function(e){var n,s=e.data("src"),o=e.data("lazyInterchange");this.trigger("imageLoading",{$el:e}),n=t.bind(function(){e.off("load",n).addClass("lazy-loaded"),this.trigger("imageLoaded",{$el:e}),this._watchedImages=this._watchedImages.filter(function(t){return!e.is(t[0])})},this),e.load(n).data(i,!0),s?e.attr("src",s):o?(e.attr("data-interchange",o),this.updateInterchange()):e.load()},waitForPlaceholder:function(e){var n,s="await-placeholder",o=e.data("wrapper");o.hasClass("asset-loading")?e.data(s)||(e.data(s,!0),n=t.bind(function(){e.off("load",n),this._loadImage(e)},this),e.load(n)):this._loadImage(e)},loadIfVisible:function(e,t,n){!e.data(i)&&this.inViewPort(e,t,n)&&this.loadImage(e)},loadIfVisibleNew:function(e,t,n,s){!e.data(i)&&this.inViewPortNew(e,t,n,s)&&this.loadImage(e)},inViewPort:function(e,t,n,s){var o=this.scrollTop,c=s||this.options.lookaheadFactor,i=this.viewportHeight,a=i*c,l=o+i+a,d=o-a,r=Math.round(n),u=Math.round(r+t),h=u>d,m=l>r;return h&&m},inViewPortNew:function(e,t,n,s){var o=this.scrollTop,c=s||this.options.lookaheadFactor,i=this.viewportHeight,a=i*c,l=o+i+a,d=o-a,r=Math.round(n),u=Math.round(r+t),h=u>d,m=l>r;return h&&m},handleScrollNew:function(e){this._watchedImages.length&&(this.scrollTop=window.pageYOffset||r.scrollTop(),t.each(this._watchedImages,function(t){var n=t[0],s=t[1],o=t[2];this.loadIfVisibleNew(n,s,o,e)},this))},handleScroll:function(e){this._watchedImages.length&&(this.scrollTop=window.pageYOffset||r.scrollTop(),t.each(this._watchedImages,function(t){var n=t[0],s=t[1],o=t[2];this.loadIfVisible(n,s,o,e)},this))}});return l}),define("templates/tiger/components/spinner",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(e,t,n,s){t.components.spinner.bounce=function(){return'<span class="spinner bounce"><span class="one"></span><span class="two"></span><span class="three"></span></span>'},s.DEBUG&&(t.components.spinner.bounce.soyTemplateName="tiger.components.spinner.bounce"),t.components.spinner.gifthaw=function(){return'<div class="animationContainer"><svg width="26" height="12" viewBox="0 0 26 12" version="1.1" xmlns="http://www.w3.org/2000/svg" class="loading-animation loading-animation--small grey"><circle cx="4" cy="6" r="3" class="circle-1" /><circle cx="4" cy="6" r="3" class="circle-2" /><circle cx="13" cy="6" r="3" class="circle-3" /><circle cx="22" cy="6" r="3" class="circle-4" /></svg></div>'},s.DEBUG&&(t.components.spinner.gifthaw.soyTemplateName="tiger.components.spinner.gifthaw")}),define("view/GifImageLoader",["jquery","underscore","singleton/EventDispatcher","singleton/Feature","view/ImageLoader","lib/jquery.browser.mobile","templates/tiger/components/spinner"],function(e,t,n,s,o){"use strict";var i,a={mobileGifs:!0,gifClass:"lazy-gif",thawableClass:"thawable",thawingClass:"thawing",thawedClass:"thawed"};return i=o.extend({initialize:function(e){t.extend(this.options,t.defaults(e||{},a)),this.addEvents(),this.on("images:registered",this.markImagesThawable),o.prototype.initialize.apply(this,arguments)},addEvents:function(){var o=this.options.gifClass,t=function(e){return e.data("wrapper").hasClass(o)};e.browser.mobile||(s.isOn("webm")||this.on("imageLoading",function(n){var s=n.$el,o=new Image,i=s.data("anim-src");t(s)&&e(o).attr("src",i)},this),this.on("imageLoaded",function(e){var n=e.$el;t(n)&&this.thawImage(n)},this)),n.on("thawImage",function(e){var t=e.$el;"IMG"!==t.prop("tagName")&&(t=t.find("img")),this.thawImage(t)},this)},markImagesThawable:function(){var t=this.options;e.browser.mobile&&t.mobileGifs&&this.$allWrappers.addClass(t.thawableClass)},thawImage:function(t){var n,o,i,a;s.isOn("webm")?(n=e("<video>"),a=n[0].canPlayType("video/webm")?t.data("webm-src"):t.data("mp4-src"),n.attr({autoplay:!0,controls:e.browser.mobile,loop:!0,muted:!0,src:a,poster:t.attr("src"),class:t.attr("class"),style:t.attr("style"),width:t.attr("width"),height:t.attr("height"),"data-chomp-id":t.data("chomp-id")}),n.data("wrapper",t.data("wrapper")),this.startLoadIndicator(n),t.replaceWith(n)):(o=t.data("animSrc")||t.data("assetUrl"),i=t.data("animInterchange"),this.startLoadIndicator(t),o&&t.attr("src",o),i&&(t.attr("data-interchange",i),this.updateInterchange()))},startLoadIndicator:function(t){var o=e(t),i=o.data("wrapper"),n=this.options,a=function(){i.removeClass(n.thawingClass).addClass(n.thawedClass),r.remove()},r=e(tiger.components.spinner.gifthaw()).appendTo(i);i.removeClass(n.thawableClass).addClass(n.thawingClass),o.load(a).error(a),s.isOn("webm")&&o.on("loadedmetadata",a)}})}),define("singleton/util/loadEditor",["underscore","jquery","singleton/Feature","singleton/StringUtils"],function(e,t,n,s){"use strict";function o(n,o,i){var a,r,c,l=t("head>meta[id="+o+"-css-url]");1===l.length?(a=l.attr("content"),r=0,c=function(){var t=e.find(document.styleSheets,function(e){return s.endsWith(e.href,a)});return"undefined"!=typeof t},document.createStyleSheet?document.createStyleSheet(a):t("head").append('<link rel="stylesheet" type="text/css" href="'+a+'" />'),l.remove(),require([n],function(){if(c())i.apply();else var e=window.setInterval(function(){(c()||r>99)&&(window.clearInterval(e),i.apply()),r+=1},250)})):require([n],i)}function i(){var e=t.Deferred();return n.isOn("webpack")?require(["module/MarionetteEditor","stylesheets/editor.css"],function(){require(["app/editor/editor.app"],e.resolve)}):o("module/MarionetteEditor","editor",function(){require(["app/editor/editor.app"],e.resolve)}),e.promise()}return i}),define("templates/tiger/components/groupchats/pending-image-message",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(e,t,n,s){t.components.groupchats.pendingImageMessage=function(){return'<span class="label pending-image-label">Click to Reveal</span>'},s.DEBUG&&(t.components.groupchats.pendingImageMessage.soyTemplateName="tiger.components.groupchats.pendingImageMessage")}),define("singleton/ImageBlurHelper",["jquery","backbone.marionette","templates/tiger/components/groupchats/pending-image-message"],function(e,t){"use strict";var n={addImageBlur:function(n){var s=t.Renderer.render(tiger.components.groupchats.pendingImageMessage);n.find(".img-border").length||n.find("img").wrap(e("<span>").addClass("img-border")),n.addClass("blurred"),n.find(".img-border").prepend(s.cloneNode(!0)),n.find(".magnifier.lightBox").hide()},removeImageBlur:function(t){t.stopPropagation(),t.preventDefault();var n=e(t.currentTarget);n.find("img").addClass("unblur"),n.find(".pending-image-label").remove(),n.parents(".has-media").find(".magnifier.lightBox").show()}};return n}),define("module/discussion/regionManager/discussionRegionManager",["backbone.marionette"],function(e){"use strict";var t=e.RegionManager.extend({addCommentRegion:function(t){var n=this.get("commentRegion"),s=!!n&&n.currentView;return(!s||s.confirmRemove())&&(n&&(n.reset(),n.off()),n=new e.Region({el:t}),this.addRegion("commentRegion",n)),n}});return new t}),define("app/post/posttools/controller/posttools.dismiss.controller",[],function(){"use strict";var e={API:{dismiss:function(e){e.setAction("dismiss",e.get("defaultBlogId"),{success:function(){e.trigger("posttools:post:dismissed"),e.trigger("annotation:remove")}.bind(this),error:function(e){throw new Error("PostTools.dismissPost(): "+e.reason)}})},undismiss:function(e){e.setAction("actionreset",e.get("defaultBlogId"),{success:function(){e.trigger("posttools:post:undismissed")}.bind(this),error:function(e){throw new Error("PostTools.undismissPost(): "+e.reason)}})}}};return e.API}),define("collection/blog.subscribersCollection",["config","underscore","backbone","singleton/CurrentUser"],function(e,t,n,s){"use strict";var o=n.Collection.extend({idCache:[],initialize:function(e,t){if(!t||t&&(!t.blogId||!t.type))throw new Error("Missing options for BlogSubscribersCollection");this.type=t.type,this.blogId=t.blogId,t.userId&&(this.userId=t.userId),0[0]!==t.withNames&&(this.withNames=t.withNames),this.enableShortening=t.enableShortening||!1,this.on("add remove request sync",function(){this.idCache=[]})},parse:function(e){var o=this,s=e&&e.data?e.data:null,n=[];return s&&(n=this.withNames?s.map(function(e){return t.isUndefined(e.id)&&(e.id=e.authorId?e.defaultBlogId:e.blogId),e.sourceBlogId=o.blogId,e}):s.map(function(e){return{id:e}})),this.enableShortening===!0&&n.length>1e3&&(n=n.slice(n.length-1e3,n.length),this.shortened=!0),n},sync:function(o,i,a){var r,c;switch(this.idCache=[],o){case"read":switch(c="GET",i.type){case"followed":r=this.withNames?e.api.profile.url+"/blogfollow/views/followedByWithNames?blogId="+i.blogId:e.api.profile.url+"/blogfollow/views/followedBy?blogId="+i.blogId;break;case"followers":r=e.api.profile.url+"/blogfollow/views/followersOf?blogId="+i.blogId;break;case"followedUsers":r=e.api.profile.url+"/userfollow/views/followedUsers?userId="+i.userId+"&token="+s.get("token");break;case"followedBlogs":r=e.api.profile.url+"/userfollow/views/followedBlogs?userId="+i.userId+"&token="+s.get("token");break;case"blocked":r=this.withNames?e.api.profile.url+"/blogblock/views/byBlogWithNames?blogId="+i.blogId:e.api.profile.url+"/blogblock/views/byBlog?blogId="+i.blogId;break;default:throw new Error("blog.subscribersCollection.sync(): unsupported method in sync")}break;default:throw new Error("blog.subscribersCollection.sync(): unsupported method in sync")}return n.ajax(t.extend({type:c,dataType:"json",url:r},a))},getIds:function(){var e=this.idCache.length;return e&&e===this.length?this.idCache:this.pluck("id")}});return o}),define("templates/tiger/messages/postAction",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(e,t,n,s,o){t.messages.postAction.areYouSureToDelPost=function(){return"Are you sure you want to delete this post?"},s.DEBUG&&(t.messages.postAction.areYouSureToDelPost.soyTemplateName="tiger.messages.postAction.areYouSureToDelPost"),t.messages.postAction.confirmHidePost=function(){return"Are you sure you want to hide this?"},s.DEBUG&&(t.messages.postAction.confirmHidePost.soyTemplateName="tiger.messages.postAction.confirmHidePost"),t.messages.postAction.confirmDismissPost=function(){return"Are you sure you want to dismiss this reply?"},s.DEBUG&&(t.messages.postAction.confirmDismissPost.soyTemplateName="tiger.messages.postAction.confirmDismissPost"),t.messages.postAction.confirmBlockBlog=function(e){return""+("block"==e.action?"Are you sure you want to block "+o.$$escapeHtml(e.username)+" on "+o.$$escapeHtml(e.sitename)+"?":"Are you sure you want to unblock "+o.$$escapeHtml(e.username)+" on "+o.$$escapeHtml(e.sitename)+"?")},s.DEBUG&&(t.messages.postAction.confirmBlockBlog.soyTemplateName="tiger.messages.postAction.confirmBlockBlog"),t.messages.postAction.selfBlockError=function(){return"You should not block yourself."},s.DEBUG&&(t.messages.postAction.selfBlockError.soyTemplateName="tiger.messages.postAction.selfBlockError"),t.messages.postAction.blogBockMember=function(){return"Can't block a member of the blog."},s.DEBUG&&(t.messages.postAction.blogBockMember.soyTemplateName="tiger.messages.postAction.blogBockMember"),t.messages.postAction.postReposted=function(e){return"Shared to "+o.$$escapeHtml(e.blogName)+'. <a href="'+o.$$escapeHtmlAttribute(o.$$filterNormalizeUri(e.blogUrl))+'">View &raquo;</a>'},s.DEBUG&&(t.messages.postAction.postReposted.soyTemplateName="tiger.messages.postAction.postReposted"),t.messages.postAction.postScheduledRepost=function(){return"Your post has been scheduled to publish."},s.DEBUG&&(t.messages.postAction.postScheduledRepost.soyTemplateName="tiger.messages.postAction.postScheduledRepost"),t.messages.postAction.repostRemoved=function(){return"Post successfully un-shared from this blog (it may take 1-2 minutes for it to stop displaying)"},s.DEBUG&&(t.messages.postAction.repostRemoved.soyTemplateName="tiger.messages.postAction.repostRemoved"),t.messages.postAction.unsharePost=function(){return"Removed share"},s.DEBUG&&(t.messages.postAction.unsharePost.soyTemplateName="tiger.messages.postAction.unsharePost"),t.messages.postAction.areYouSureToUnschedRepost=function(){return"Are you sure you want to unschedule this repost?"},s.DEBUG&&(t.messages.postAction.areYouSureToUnschedRepost.soyTemplateName="tiger.messages.postAction.areYouSureToUnschedRepost"),t.messages.postAction.postDeleted=function(){return"The post has been deleted successfully."},s.DEBUG&&(t.messages.postAction.postDeleted.soyTemplateName="tiger.messages.postAction.postDeleted"),t.messages.postAction.repostUnscheduled=function(){return"The repost has been unscheduled successfully."},s.DEBUG&&(t.messages.postAction.repostUnscheduled.soyTemplateName="tiger.messages.postAction.repostUnscheduled"),t.messages.postAction.postRecommended=function(){return"You recommended a post."},s.DEBUG&&(t.messages.postAction.postRecommended.soyTemplateName="tiger.messages.postAction.postRecommended"),t.messages.postAction.undoDismissMsg=function(){return"You have successfully dismissed this reply."},s.DEBUG&&(t.messages.postAction.undoDismissMsg.soyTemplateName="tiger.messages.postAction.undoDismissMsg"),t.messages.postAction.undoBlockMsg=function(e){return"You have successfully dismissed this reply and blocked "+o.$$escapeHtml(e.userName)+" from "+o.$$escapeHtml(e.blogName)},s.DEBUG&&(t.messages.postAction.undoBlockMsg.soyTemplateName="tiger.messages.postAction.undoBlockMsg"),t.messages.postAction.undoResolveMsg=function(){return"You have successfully resolved the flag on this reply."},s.DEBUG&&(t.messages.postAction.undoResolveMsg.soyTemplateName="tiger.messages.postAction.undoResolveMsg")}),define("app/post/posttools/controller/posttools.block.controller",["jquery","singleton/CurrentUser","singleton/EventDispatcher","collection/blog.subscribersCollection","templates/tiger/messages/postAction"],function(e,t,n,s){"use strict";var o={_blogsBlockedHash:{},_postIsBlocked:function(e,t){return-1!==t.indexOf(e.get("authorBlogId"))},_blockBlog:function(e,n){var i,a=n.targetBlogId,r=n.confirmation,s=n.blockedBlogCollection,l=e.get("defaultBlogId"),d=n.targetBlogName,u=n.targetAuthorName,c=n.forceAction;"undefined"!=typeof c?(i=c,t.set("forceAction",c)):i=o._postIsBlocked(e,n.blockedBlogIds)?"unblock":"block",("boolean"==typeof r&&r||r({action:i,username:u,sitename:d}))&&t.setBlogAction(i,l,a,{success:function(n){var r,o=t.get("forceAction");n?"block"===i?(s.add({id:a}),s.trigger("posttools:block"),e.trigger("posttools:block")):(r=s.findWhere({id:a}),r&&s.remove(r),s.trigger("posttools:unblock"),e.trigger("posttools:unblock")):("block"===o||"unblock"===o)&&(s.trigger("posttools:"+o),e.trigger("posttools:"+o))},error:function(e,t){var n;switch(t.code){case"BLOG_BLOCK_MEMBER":n=tiger.messages.postAction.blogBockMember;break;default:n=t?t.message:e.reason}o._showErrorMessage(n)}})},_blockedBlogsInitialized:function(t){var n;return o._blogsBlockedHash.hasOwnProperty(t)||(o._blogsBlockedHash[t]=o.API.getBlockedBlogCollection(t)),o._blogsBlockedHash[t].fetched?(n=e.Deferred(),n.resolve(o._blogsBlockedHash[t]),n):(o._blogsBlockedHash[t].fetched=!0,o._blogsBlockedHash[t].fetch())},_showErrorMessage:function(e){n.trigger("successbox:display",{message:e,warningBox:!0,dismissable:!0})},API:{block:function(t,n,s,i,a,r){var c,l=t.get("defaultBlogId"),d=t.get("authorBlogId");return l===d?(o._showErrorMessage(tiger.messages.postAction.selfBlockError),!1):void e.when(o._blockedBlogsInitialized(l)).then(function(){c={targetBlogId:d,blockedBlogIds:n.getIds(),blockedBlogCollection:n,confirmation:s,targetBlogName:i,targetAuthorName:a,forceAction:r},o._blockBlog(t,c)})},getBlockedBlogCollection:function(e){return o._blogsBlockedHash.hasOwnProperty(e)||(o._blogsBlockedHash[e]=new s([],{blogId:e,type:"blocked",withNames:!1})),o._blogsBlockedHash[e]},checkBlockStatus:function(t,n){var s=t.get("defaultBlogId");e.when(o._blockedBlogsInitialized(s)).then(function(){t.trigger("posttools:blockStatusUpdated",o._postIsBlocked(t,n.getIds()))})}}};return window.__karma__&&(o.API.__testonly__=o),o.API}),define("app/post/mixins/post.successMessage",["singleton/Renderer","singleton/EventDispatcher"],function(e,t){"use strict";var n={_displaySuccessMessage:function(n,s){t.trigger("successbox:display",{message:e.renderTemplate(n,s||{})})},_displayChannelMessage:function(n,s){t.trigger("successbox:display",{message:e.renderTemplate(n,s||{}),timeout:5e3})}};return n}),define("app/post/posttools/controller/posttools.like.controller",["jquery","underscore","singleton/CurrentUser","module/KinjaAnalytics","singleton/Utils","app/post/mixins/post.successMessage","templates/tiger/messages/postAction"],function(e,t,n,s,o,i){"use strict";var a={};return a=t.extend(a,i,{_trackRecommendation:function(e,t){var n,r=e.get("isStarter")?"Post":"Comment",i="sharingBottom"===t.$el.attr("data-analytics-target"),a="groupChat"===t.$el.parent().attr("data-analytics-target"),c="permalink"===o.getKinjaMeta().pageType;window.ga("send","event","Recommendation",r+" Recommended",e.get("permalink")),(!c||i||a)&&(o.getKinjaMeta().pageType===o.pageTypes.frontpage?n="homepage":o.getKinjaMeta().pageType===o.pageTypes.dashboard?n="dashboard":i?n="sharingBottom":a&&(n="groupChat"),s.pushEvent("RECOMMENDATION","POST",t.model.get("id"),{uiElement:n}))},_likePost:function(n,s){var o=n.get("liked")?"unlike":"like",i=n.setLike(o,{success:function(e){if("like"===o&&(a._trackRecommendation(n,s),a._displaySuccessMessage(tiger.messages.postAction.postRecommended),!n.get("isStarter")&&!n.get("approved"))){var i=t.pluck(e.response.approvalResult.approvedReplies,"postId"),r=s.model.get("id");-1!==t.indexOf(i,r)&&s.model.set({approved:!0})}},error:function(e){throw new Error("PostTools.likePost(): "+e.reason)}}),r=function(){n.trigger("posttools:post:likeCount:updated")};e.when(i).then(r)},API:{like:function(t,s){return!!e("body").hasClass("read-only")||void n.requireLogin("likePost").done(function(){a._likePost(t,s)})}}}),a.API}),define("app/post/posttools/controller/posttools.hide.controller",["config","jquery","singleton/Feature","singleton/CurrentUser","model/post/Post"],function(e,t,n,s,o){"use strict";var i={API:{hide:function(i,a){var l=i.get("id"),d=e.api.core.url+"/post/"+l+"/hide?token="+s.get("token"),r=null,c="/";s.isSuperuser()&&n.isOn("superuser")&&a()&&(i.has("parentId")&&(r=new o({id:i.get("parentId")}),c=r.has("permalink")?r.get("permalink"):"/"+r.id),t.ajax({url:d,type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){0[0]!==e.meta&&e.meta.success===!0&&window.setTimeout(function(){window.location.href=c},1e3)}}))}}};return i.API}),define("templates/tiger/components/fullscreen-spinner",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(e,t,n,s){t.components.fullscreenSpinner=function(e,n,s){return'<div class="loading-full animate"><div class="loading-message-box">'+t.components.spinner.bounce(null,null,s)+"</div></div>"},s.DEBUG&&(t.components.fullscreenSpinner.soyTemplateName="tiger.components.fullscreenSpinner")}),define("view/Spinner",["jquery","view/BaseView","templates/tiger/components/spinner","templates/tiger/components/fullscreen-spinner"],function(e,t){"use strict";var n=t.extend({visible:!0,fullscreen:!1,tagName:"div",className:"spinner-wrapper",initialize:function(e){this.visible=0[0]===e.initiallyVisible||e.initiallyVisible,this.fullscreen=0[0]!==e.fullscreen&&e.fullscreen,this.render()},render:function(){var t;return this.visible&&(t=this.fullscreen?this.soyToHtml(tiger.components.fullscreenSpinner):this.soyToHtml(tiger.components.spinner.bounce,{})),this.$el.html(t),this.fullscreen?e(this.el).find(".animate").addClass("in"):e(this.el).addClass("with-margin"),this}});return n}),define("apiclient/repost",["config","apiclient/apirequest","apiclient/gettoken"],function(e,t,n){"use strict";return{unschedule:t.postJson(n.append(e.api.core.url+"/blog/{{blogId}}/removeRepostJob/{{postId}}")),reschedule:t.postJson(n.append(e.api.core.url+"/blog/{{blogId}}/updateRepostJob/{{postId}}?repostTime={{repostTime}}"))}}),define("app/post/posttools/posttools.controller",["jquery","underscore","singleton/CurrentUser","singleton/EventDispatcher","singleton/Feature","singleton/Utils","singleton/util/loadEditor","module/KinjaAnalytics","view/BaseView","app/post/common/post.layout","app/post/mixins/post.confirmationPrompt","app/post/posttools/posttools.menuview","app/post/posttools/controller/posttools.dismiss.controller","app/post/posttools/controller/posttools.block.controller","app/post/posttools/controller/posttools.like.controller","app/post/posttools/controller/posttools.hide.controller","module/flagging/ReplyFlaggingModule","app/post/mixins/post.successMessage","app/MarionetteApp","view/Spinner","apiclient/repost","templates/tiger/messages/postAction"],function(e,t,n,s,o,i,a,r,c,l,d,u,h,m,f,p,g,v,b,j,y){"use strict";var _=t.extend({},d,v,{_openSpinnerUntil:function(n,s){s=t.defaults({},{fullscreen:!0});var o=new j(s);return o.$el.appendTo("body"),e.when(n).then(o.remove.bind(o))},_like:function(e){e.model.get("tags")&&e.model.get("tags").length&&o.isOn("channels")&&!e.model.get("liked")&&b.vent.trigger("add:channel",{channelName:e.model.get("tags")[0].name,url:e.model.get("tags")[0].urlName}),f.like(e.model,e.view)},_reply:function(){require(["module/DiscussionModule"],function(e){e.replyToStarterPost()})},_dismiss:function(e){_._confirmationPrompt(tiger.messages.postAction.confirmDismissPost)&&h.dismiss(e.model)},_undismiss:function(e){h.undismiss(e.model)},_getDismissState:function(e){e.model.getActionState()},_delete:function(e){var n,s=e.model,o=this,a="dashboard"===i.getKinjaMeta().pageType||"manageblog"===i.getKinjaMeta().pageType;_._confirmationPrompt(tiger.messages.postAction.areYouSureToDelPost)&&(s.on("destroy",function(){o._displaySuccessMessage(tiger.messages.postAction.postDeleted),n=function(){window.location=a?window.location.pathname:c.prototype.cachebuster.call(c.prototype,"/")},t.delay(n,2e3)}),s.destroy({wait:!0}))},_unscheduleRepost:function(e){var n=this,s=e.view.el.getAttribute("data-postid"),o=e.view.el.getAttribute("data-blogid"),a=function(){window.location="private"===i.getKinjaMeta().pageType?window.location.pathname:c.prototype.cachebuster.call(c.prototype,"/")},r=function(){n._displaySuccessMessage(tiger.messages.postAction.repostUnscheduled),t.delay(a,2e3)};_._confirmationPrompt(tiger.messages.postAction.areYouSureToUnschedRepost)&&y.unschedule({postId:s,blogId:o}).done(r)},_promote:function(e){var t=e.model.id,s=n.hasPermission("SALES")||n.isSuperUser(),o=window.location.port?"http://kinja.dev:9000":"http://kinja.com";s&&(window.location.href=o+"/dfp/promotions/"+t)},_checkBlockStatus:function(e){m.checkBlockStatus(e.model,e.collection)},_postIsBlocked:function(e,t){return-1!==t.indexOf(e.get("authorBlogId"))},_block:function(e){var t=function(e){return _._confirmationPrompt(tiger.messages.postAction.confirmBlockBlog,e)};m.block(e.model,e.collection,t,e.targetBlogName,e.targetAuthorName)},_hide:function(e){var t=function(){return _._confirmationPrompt(tiger.messages.postAction.confirmHidePost)};p.hide(e.model,t)},_unflag:function(e){g.unflag(e,e.model)},_kinjaShare:function(e){var t;n.requireLogin("kinjaSharePost").done(function(){t=function(){return a().then(function(t){t.sharePost(e)})},e.has("original")?this._openSpinnerUntil(t()):this._openSpinnerUntil(e.fetch({success:t,preview:"PUBLISHED"!==e.get("status")}).then(t)),r.pushEvent("SHARE","POST",e.get("id"),{uiElement:"dropdown"})}.bind(this))},_externalShare:function(e){var n=e.view.$(".js_share-post-item"),o=n.attr("href"),i={twitter:"toolbar=0,status=0,width=480,height=360",facebook:"toolbar=0,status=0,width=480,height=360",tumblr:"toolbar=0,status=0,width=450,height=430"},s=t.intersection(n.attr("class").split(/\s+/),["twitter","facebook","tumblr"])[0];window.open(o,"share"+s,i[s])},_repost:function(e,t){var o="repost",i=this,s=n.get("membership").find(function(e){return e.get("blogId")===parseInt(t,10)});e.setAction(o,t,{success:function(){i._displaySuccessMessage(tiger.messages.postAction.postReposted,{blogName:s.get("blog").displayName,blogUrl:"http://"+s.get("blog").canonicalHost})},error:function(e){throw new Error("PostTools.repostPost(): "+e.reason)}})},_undoRepost:function(e){var t="actionreset",n=e.targetBlogId,s=e.model,o=this;s.setAction(t,n,{success:function(){o._displaySuccessMessage(tiger.messages.postAction.repostRemoved)},error:function(e){throw new Error("PostTools.undoRepost(): "+e.reason)}})},_openPupilModal:function(){var t=e.Deferred();return require(["app/pupil/PupilController"],function(e){e.show().then(t.resolve.bind(t))}.bind(this)),this._openSpinnerUntil(t)},_bindEvents:function(e,t){e.on("posttools:like",this._like.bind(this)),e.on("posttools:reply",this._reply.bind(this)),t.on("posttools:dismiss",this._dismiss.bind(this)),t.on("posttools:undismiss",this._undismiss.bind(this)),t.on("posttools:getDismissState",this._getDismissState.bind(this)),t.on("posttools:delete",this._delete.bind(this)),t.on("posttools:promote",this._promote.bind(this)),t.on("posttools:block",this._block.bind(this)),t.on("posttools:checkBlockStatus",this._checkBlockStatus.bind(this)),t.on("posttools:hide",this._hide.bind(this)),t.on("posttools:unflag",this._unflag.bind(this)),t.on("posttools:kinjaShare",this._kinjaShare.bind(this)),t.on("posttools:externalShare",this._externalShare.bind(this)),t.on("posttools:repost",this._repost.bind(this)),t.on("posttools:undorepost",this._undoRepost.bind(this)),t.on("close",function(){n.off(null,null,t),s.off(null,null,t),t.model.off(null,null,t)}),t.on("posttools:menuview:togglehidden",function(t){e.togglePostToolsVisibility(t)}),t.on("reposttools:unschedule",this._unscheduleRepost.bind(this)),t.on("posttools:pupil",this._openPupilModal.bind(this))},API:{startPostTools:function(e,t){var r="undefined"!=typeof t.get("defaultBlogId")?t.get("defaultBlogId"):i.getKinjaMeta().blog.id,o=new u({el:e.find(".js_post-dropdown-ct"),model:t,blockedBlogCollection:m.getBlockedBlogCollection(r)}),a=new l({el:e,model:t});a.post.attachView(o),a.bindUIElements(),a.updateUserState(),_._bindEvents(a,o),s.on("posttools:close:"+t.get("id"),function(){o.close()}),n.onAuth.done(o.render.bind(o))},closePostTools:function(e){s.trigger("posttools:close:"+e)},bindEvents:function(e,t){_._bindEvents(e,t)}}});return _.API}),define("templates/tiger/icons/essential/definitions",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(e,t,n,s){t.icons.essential.definitions=function(){return'<svg id="svggroup--essential" class="hide"><symbol id="iconset-search" viewBox="0 0 15 15"><path d="M9.5 8C11.433 8 13 6.433 13 4.5S11.433 1 9.5 1 6 2.567 6 4.5 7.567 8 9.5 8zm-3.233-.975c.196-.195.518-.19.708 0 .195.195.19.517 0 .708l-4.95 4.95c-.195.194-.517.19-.707 0-.195-.196-.19-.518 0-.708l4.95-4.95zM9.5 9C7.015 9 5 6.985 5 4.5S7.015 0 9.5 0 14 2.015 14 4.5 11.985 9 9.5 9z" /></symbol><symbol id="iconset-add" viewBox="0 0 18 18"><path d="M9 2.494C9 2.226 8.776 2 8.5 2c-.268 0-.5.22-.5.494V8H2.494C2.226 8 2 8.224 2 8.5c0 .268.22.5.494.5H8v5.506c0 .268.224.494.5.494.268 0 .5-.22.5-.494V9h5.506c.268 0 .494-.224.494-.5 0-.268-.22-.5-.494-.5H9V2.494z" /></symbol><symbol id="iconset-add--small" viewBox="0 0 10 10"><path d="M6 1.007C6 .45 5.552 0 5 0c-.556 0-1 .45-1 1.007V4H1.007C.45 4 0 4.448 0 5c0 .556.45 1 1.007 1H4v2.993C4 9.55 4.448 10 5 10c.556 0 1-.45 1-1.007V6h2.993C9.55 6 10 5.552 10 5c0-.556-.45-1-1.007-1H6V1.007z"></path></symbol><symbol id="iconset-site-default" viewBox="0 0 18 18"><path d="M9 16.158c3.953 0 7.158-3.205 7.158-7.158 0-3.953-3.205-7.158-7.158-7.158-3.953 0-7.158 3.205-7.158 7.158 0 3.953 3.205 7.158 7.158 7.158zM9 17c-4.418 0-8-3.582-8-8s3.582-8 8-8 8 3.582 8 8-3.582 8-8 8z"/><path d="M9 16.158c1.97 0 3.79-3.143 3.79-7.158 0-4.015-1.82-7.158-3.79-7.158S5.21 4.985 5.21 9c0 4.015 1.82 7.158 3.79 7.158zM9 17c-2.558 0-4.632-3.582-4.632-8S6.442 1 9 1s4.632 3.582 4.632 8S11.558 17 9 17z"/><path d="M2.742 4.674c1.69.883 3.947 1.383 6.345 1.383 2.396 0 4.65-.5 6.34-1.38l-.39-.746c-1.564.82-3.684 1.29-5.95 1.29-2.27 0-4.39-.47-5.955-1.28l-.39.746zm.39 9.403c1.564-.817 3.686-1.288 5.955-1.288 2.266 0 4.386.47 5.95 1.28l.39-.75c-1.69-.88-3.944-1.38-6.34-1.38-2.398 0-4.654.5-6.345 1.38l.39.744z"/><path d="M8.58 8.58H1.083v.84H8.58v7.496h.84V9.42h7.496v-.84H9.42V1.083h-.84V8.58z" /></symbol><symbol id="iconset-zoom-in" viewBox="0 0 18 18"><path d="M9 4.494C9 4.226 9.224 4 9.5 4c.268 0 .5.22.5.494V7h2.506c.268 0 .494.224.494.5 0 .268-.22.5-.494.5H10v2.506c0 .268-.224.494-.5.494-.268 0-.5-.22-.5-.494V8H6.494C6.226 8 6 7.776 6 7.5c0-.268.22-.5.494-.5H9V4.494zM9.5 13C6.462 13 4 10.538 4 7.5S6.462 2 9.5 2 15 4.462 15 7.5 12.538 13 9.5 13zm-4.877-1.36l-3.48 3.51c-.194.194-.188.514 0 .703.196.195.51.196.704.002l3.48-3.51c-.304-.275-.416-.34-.704-.706zM9.5 14c3.59 0 6.5-2.91 6.5-6.5S13.09 1 9.5 1 3 3.91 3 7.5 5.91 14 9.5 14z" /></symbol><symbol id="iconset-star" viewBox="0 0 18 18"><path d="M9.005 13.115L4.083 16.88l1.895-6.07-4.943-3.563 6.094.014L9 1.01l1.866 6.25 6.093-.01-4.93 3.563 1.89 6.07z" /></symbol><symbol id="iconset-star--giant" viewBox="0 0 24 24"><path d="M12 17.8l-7.053 4.908 2.488-8.225-6.848-5.19 8.592-.176L12 1l2.82 8.117 8.593.175-6.848 5.19 2.488 8.226z" /></symbol><symbol id="iconset-star-circle" viewBox="0 0 18 18"><path d="M9 17c4.418 0 8-3.582 8-8s-3.582-8-8-8-8 3.582-8 8 3.582 8 8 8zM9 3.7c.093 0 .185.06.208.158l1.146 3.39 3.413.085c.104 0 .185.073.22.17.034.097 0 .207-.08.267l-2.72 2.175.972 3.44c.03.096 0 .206-.09.266-.05.04-.097.05-.14.05-.05 0-.09-.02-.13-.05L9 11.61l-2.81 2.04c-.036.038-.082.05-.13.05-.045 0-.09-.012-.138-.05-.07-.06-.104-.17-.08-.266l.97-3.44L4.095 7.77c-.08-.06-.115-.17-.08-.267.034-.097.127-.17.22-.17l3.412-.085 1.134-3.39c.04-.098.13-.158.22-.158z" /></symbol><symbol id="iconset-chevron-right" viewBox="0 0 18 18"><path d="M6.165 3.874c-.217-.204-.22-.53-.008-.73.206-.192.56-.195.776.008l5.902 5.48c.11.102.165.236.165.37-.002.126-.055.262-.165.365l-5.902 5.478c-.217.204-.564.207-.776.007-.206-.193-.21-.525.008-.728L11.69 9 6.165 3.873z" /></symbol><symbol id="iconset-chevron-right--small" viewBox="0 0 10 10"><path d="M7.782 4.497L3.272.207c-.287-.274-.763-.278-1.054 0-.292.277-.29.724.002 1L6.205 5 2.22 8.79c-.288.273-.292.726-.002 1.002.293.28.763.276 1.054 0l4.51-4.29C7.926 5.363 8 5.18 8 5c.002-.183-.072-.364-.218-.503z" /></symbol><symbol id="iconset-flame" viewBox="0 0 18 18"><path d="M3.923 10.89c0 2.678 2.447 5.17 5.077 5.17s5.077-2.492 5.077-5.17c0-1.752-.618-3.036-1.977-4.664-1.196-1.433-1.154-3.453-1.093-3.453-.356-.04-2.164 2.918-2.49 5.764-.507 1.5-2.29 1.018-2.543-.126-.245-.62-.296-1.97-.296-2.47 0-.5-1.755 2.72-1.755 4.95zm2.962-2.617c.25.344.63.345.72.077.185-2.933 2.015-5.63 2.643-6.247.78-.766 1.7-1.444 1.984-.915.072.135-.047.438-.167.826-.267.863-.412 2.224.738 3.602C13.883 6.912 15 8.516 15 10.89c0 3.2-2.86 6.11-6 6.11s-6-2.912-6-6.11c0-2.018 1.45-5.456 2.972-6.798l.198-.17c.233-.197.806-.146.715.164-.837 2.85 0 4.187 0 4.187z" /></symbol><symbol id="iconset-flame--giant" viewBox="0 0 24 24"><path d="M9.004 10.954c.353.496.89.497 1.02.112.262-4.217 2.854-8.093 3.743-8.98C14.872.984 16.177.01 16.577.77c.103.194-.065.63-.235 1.187-.378 1.242-.583 3.198 1.046 5.18 1.532 1.86 3.112 4.166 3.112 7.58 0 4.597-4.052 8.783-8.5 8.783s-8.5-4.186-8.5-8.782c0-3.652 2.056-7.844 4.21-9.773l.28-.243c.33-.285 1.143-.212 1.014.234-1.186 4.096 0 6.018 0 6.018z" /></symbol><symbol id="iconset-logo-kinja" viewBox="0 0 18 18"><path d="M2.898 8.293c.746.24 1.423.978 1.734 1.495.31.517 2.246 3.78 2.905 4.916.726 1.253 1.743 1.294 2.308 1.294h4.125s-3.023-5.378-3.943-6.846c-.622-.994-1.452-1.11-2.374-1.11H2.1C2.093 8.042 3 7.065 5 7c2-.065 5.284.006 6.64 0 1.354-.006 2.046-.727 2.33-1.195.284-.468 2.03-3.8 2.03-3.8S8.793 1.995 6.992 2c-1.21.006-1.734.647-2.197 1.41l-2.792 4.6c-.01.017.007.07.017.098 0 0 .35.018.878.186z" /><</symbol><symbol id="iconset-bubble" viewBox="0 0 18 18"><path d="M6.292 13.952l.34-.503.577.1c.43.07.86.11 1.29.11 3.65 0 6.56-2.65 6.56-5.84 0-3.186-2.91-5.836-6.57-5.836-3.657 0-6.566 2.65-6.566 5.836 0 1.918 1.054 3.7 2.83 4.84l.437.256c0 .18-.375 2.06-.57 2.54-.054.132 1.12-.71 1.66-1.51zm-2.01-.426C2.3 12.254 1 10.182 1 7.832 1 4.06 4.358 1 8.5 1 12.642 1 16 4.06 16 7.832c0 3.774-3.36 6.833-7.5 6.833-.495 0-.978-.047-1.447-.13-.32.473-2.45 2.172-3.165 2.4-.714.226-.823-.164-.51-.713.313-.548.903-1.95.903-2.696z" /></symbol><symbol id="iconset-bubble--giant" viewBox="0 0 24 24"><path d="M6.094 18.506C3.324 16.678 1.5 13.7 1.5 10.32 1.5 4.9 6.2.5 12 .5s10.5 4.398 10.5 9.82c0 5.425-4.702 9.823-10.5 9.823-.694 0-1.37-.067-2.025-.187-.45.68-3.432 3.123-4.432 3.45-1 .326-1.15-.235-.713-1.024.438-.788 1.264-2.802 1.264-3.876z" /></symbol><symbol id="iconset-checkmark" viewBox="0 0 18 18"><path d="M14.855 5.87c.192-.195.195-.523 0-.722-.19-.194-.51-.2-.706 0l-7.418 7.62-2.88-2.978c-.19-.195-.515-.2-.71-.002-.19.194-.194.525.003.726L6.38 13.85c.095.1.224.15.353.15.128 0 .257-.047.355-.147l7.767-7.982z" /></symbol><symbol id="iconset-checkmark--small" viewBox="0 0 10 10"><path d="M.292 5.078c-.39.4-.388 1.044-.002 1.442l2.038 2.15c.313.344 1.125.526 1.703 0L9.71 2.746c.39-.402.388-1.046 0-1.445-.39-.402-1.014-.4-1.4 0l-5.11 5.39L1.69 5.075C1.31 4.683.68 4.68.293 5.078z"></path></symbol><symbol id="iconset-close" viewBox="0 0 18 18"><path d="M1.737 1.12c-.16-.158-.44-.164-.61.006-.165.165-.172.443-.005.61L7.885 8.5l-6.763 6.764c-.167.167-.16.445.005.61.17.17.45.164.61.005L8.5 9.11l6.763 6.764c.16.158.44.164.61-.006.165-.164.172-.442.005-.61L9.115 8.5l6.763-6.764c.167-.167.16-.445-.005-.61-.17-.17-.45-.164-.61-.005L8.5 7.89 1.737 1.12z" /></symbol><symbol id="iconset-close--small" viewBox="0 0 10 10"><path d="M2.884 1.47c-.394-.394-1.03-.395-1.42-.005-.392.393-.387 1.026.006 1.42L3.586 5 1.47 7.116c-.394.394-.395 1.03-.005 1.42.393.392 1.026.387 1.42-.006L5 6.414 7.116 8.53c.394.394 1.03.395 1.42.005.392-.393.387-1.026-.006-1.42L6.414 5 8.53 2.884c.394-.394.395-1.03.005-1.42-.393-.392-1.026-.387-1.42.006L5 3.586 2.884 1.47z" /></symbol><symbol id="iconset-facebook" viewBox="0 0 18 18"><path d="M7.003 17l-.006-7H4l.006-3h2.997V4.995C7.003 2.408 8.457 1 10.808 1c1.126 0 1.91.082 2.192.12v2.877h-1.447c-1.278 0-1.526.597-1.526 1.472V7h2.866l-.403 3h-2.47l.007 7H7.003z" /></symbol><symbol id="iconset-twitter" viewBox="0 0 18 18"><path d="M12.077 2c-1.812 0-3.282 1.582-3.282 3.534 0 .277.03.547.085.806-2.728-.148-5.147-1.555-6.766-3.693-.283.522-.445 1.13-.445 1.777 0 1.226.58 2.308 1.46 2.942-.54-.02-1.05-.178-1.49-.443v.045c0 1.712 1.13 3.14 2.63 3.465-.28.08-.57.124-.87.124-.21 0-.418-.022-.62-.063.418 1.404 1.63 2.426 3.067 2.455-1.125.94-2.54 1.51-4.078 1.51-.267 0-.528-.02-.785-.05 1.46 1 3.185 1.59 5.04 1.59 6.037 0 9.34-5.39 9.34-10.06 0-.153-.005-.306-.01-.457.64-.5 1.197-1.12 1.637-1.83-.59.28-1.22.47-1.885.557.677-.437 1.198-1.13 1.443-1.955-.633.405-1.336.7-2.084.858C13.88 2.43 13.028 2 12.08 2" /></symbol><symbol id="iconset-googleplus" viewBox="0 0 18 18"><path d="M13.657 13.42c0 .914-.4 1.74-1.202 2.475-.4.354-.916.62-1.545.796-.573.208-1.245.31-2.017.31-1.402 0-2.575-.264-3.52-.795C4.457 15.645 4 14.938 4 14.085c0-.62.2-1.18.6-1.68.43-.59 1.002-1.033 1.718-1.327.658-.324 1.46-.487 2.403-.487.03 0 .798-.15.827-.15-.458-.382-.653-.57-.653-1.04 0-.355.043-.665.214-.93h-.472c-1.058 0-1.903-.574-2.618-1.28-.686-.708-1.03-1.56-1.03-2.565 0-.972.43-1.812 1.288-2.52C7.106 1.37 8.09 1 9.236 1H14l-1.073.796h-1.502c.486.236.872.604 1.16 1.105.284.59.428 1.166.428 1.725 0 1.032-.472 1.9-1.416 2.608-.373.295-.63.546-.773.752-.115.147-.172.383-.172.707 0 .325.444.84 1.33 1.548.573.413 1.002.87 1.288 1.37.258.472.387 1.076.387 1.812zM11.31 4.483c-.145-.705-.46-1.29-.95-1.75-.487-.488-1.06-.73-1.72-.73-.604-.025-1.077.18-1.422.62-.373.46-.517 1.057-.43 1.787.143.73.473 1.337.99 1.824.517.51 1.076.766 1.68.766.66 0 1.162-.243 1.506-.73.373-.486.488-1.082.345-1.787zm.153 10.713c.55-.38.826-.862.826-1.445 0-1.7-2.757-2.05-3.06-2.05-.88 0-1.667.19-2.356.573-.69.403-1.033.873-1.033 1.41 0 .54.304 1.01.91 1.413.58.403 1.295.605 2.15.605 1.13 0 1.983-.167 2.56-.503z" fill-rule="evenodd"/></symbol><symbol id="iconset-external-link" viewBox="0 0 18 18"><path d="M3.006 17C1.898 17 1 16.103 1 14.994V5.006C1 3.898 1.897 3 3.006 3H5.5c.276 0 .5.224.5.5s-.224.5-.5.5H3.006C2.45 4 2 4.45 2 5.006v9.988C2 15.55 2.45 16 3.006 16h9.988C13.55 16 14 15.55 14 14.994V11.5c0-.276.224-.5.5-.5s.5.224.5.5v3.494C15 16.102 14.103 17 12.994 17H3.006zM10 1.5c0-.276.228-.5.51-.5h5.98c.51 0 .51.5.51.51v5.98c0 .282-.232.51-.5.51-.276 0-.5-.228-.5-.51V2.75l-8.095 8.1c-.206.204-.548.197-.75-.004-.207-.207-.205-.545-.002-.748L15.247 2H10.51c-.282 0-.51-.232-.51-.5z" /></symbol><symbol id="iconset-link" viewBox="0 0 18 18"><path d="M8.72 13.36l-2.044 2.017c-.954.952-2.418.797-3.05.083L2.53 14.18c-.942-.93-.59-2.446 0-3.072.96-1.017 3.698-3.656 3.698-3.656.952-.975 2.245-1.038 3.27 0 1.023 1.038.97.997.97.997.262.26.64.21.835 0 .195-.22.16-.58-.102-.85l-.94-.93c-1.31-1.35-3.322-1.3-4.61 0l-3.68 3.75c-1.28 1.26-1.28 3.38 0 4.68l.92.93c.627.63 1.45.96 2.337.96.887 0 1.71-.335 2.334-.966L9.4 14.17c.263-.266.263-.555 0-.82-.263-.266-.673 0-.673 0zm.56-8.72l2.044-2.017c.954-.952 2.418-.797 3.05-.083l1.095 1.28c.94.93.59 2.446 0 3.072-.96 1.017-3.7 3.656-3.7 3.656-.95.975-2.25 1.038-3.27 0s-.97-.997-.97-.997c-.26-.26-.64-.21-.84 0-.2.22-.16.58.1.85l.944.93c1.31 1.35 3.327 1.3 4.61 0l3.68-3.75c1.284-1.26 1.284-3.38 0-4.68l-.92-.93c-.62-.63-1.443-.96-2.33-.96-.888 0-1.71.334-2.335.965L8.6 3.825c-.262.266-.262.555 0 .82.264.266.674 0 .674 0z" /></symbol><symbol id="iconset-image" viewBox="0 0 18 18"><path d="M1 2.994v12.012c0 .548.446.994.995.994h14.01c.55 0 .995-.445.995-.994V2.994c0-.548-.446-.994-.995-.994H1.995C1.445 2 1 2.445 1 2.994zm-1 0C0 1.894.893 1 1.995 1h14.01C17.107 1 18 1.895 18 2.994v12.012c0 1.1-.893 1.994-1.995 1.994H1.995C.893 17 0 16.105 0 15.006V2.994z"/><path d="M1.38 15.804L5.807 8.24l-.86.007 3.682 6.068c.17.288.573.324.8.073l2.5-2.82-.74.01 4.514 4.832c.188.202.504.213.706.024.203-.19.213-.505.025-.707l-4.515-4.83c-.2-.216-.543-.212-.74.008l-2.5 2.82.8.07L5.8 7.728c-.197-.324-.67-.32-.86.007L.51 15.298c-.137.24-.057.545.18.684.24.14.546.06.685-.178zM12 9c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zm0 1c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3z"/></symbol><symbol id="iconset-burner" viewBox="0 0 18 18"><path d="M14.24 10.837c-.39.175-.853.28-1.387.28-.27 0-.593-.044-.955-.126-.344-.07-.713-.19-1.093-.32-.284-.1-1.218-.51-1.31-.54-.158-.06-.32-.093-.488-.093-.175 0-.336.038-.493.096-.092.035-1.035.444-1.32.545-.38.136-.748.247-1.093.326-.36.083-.68.127-.95.127-.53 0-.99-.103-1.39-.28-.22-.1-.55-.353-.65-.46-.17-.18-.34-.39-.502-.634-.38-.57-.635-1.22-.712-1.934l-.006.14c.268-1.33 1.078-2.07 2.03-2.07 1.53 0 2.884.31 4.662 1.284 0 0 .266.147.41.147.146 0 .43-.143.43-.143 1.78-.974 3.137-1.282 4.666-1.282.95 0 1.762.74 2.038 2.057l-.002-.14c-.076.72-.33 1.364-.71 1.94-.162.24-.335.453-.507.633-.1.105-.43.36-.657.46zm1.907-.61c.453-.684.76-1.463.853-2.33l-.007-.137C16.635 6.053 15.48 5 14.083 5c-1.672 0-3.175.34-5.093 1.393C7.092 5.34 5.59 5 3.916 5c-1.397 0-2.55 1.053-2.91 2.76L1 7.897c.093.867.4 1.646.853 2.33.33.498.664.846.9 1.036.114.1.332.24.64.38.503.223 1.09.357 1.754.357.346 0 .732-.052 1.154-.15.39-.086.79-.207 1.2-.354.31-.108.6-.223.87-.34.16-.068.6-.248.647-.248.045 0 .474.18.636.25.27.115.56.23.865.338.41.147.813.268 1.195.355.42.1.805.15 1.15.15.666 0 1.25-.13 1.755-.35.31-.14.528-.28.65-.39.228-.18.56-.53.89-1.03zm-9.99-2.604c-.155-.077-.316-.133-.483-.17-.53-.118-1.078-.037-1.605.164-.22.08-.38.164-.48.223l-.24.146.03.28c.07.623.45 1.266 1.22 1.502.34.11.77.117 1.27.05.3-.044.63-.115.95-.206.19-.053.373-.11.54-.167.1-.034.174-.062.22-.078l.735-.285-.628-.477c-.07-.052-.2-.145-.394-.273-.315-.21-.69-.444-1.13-.696l-.02-.013zm.243 1.19s-.447.1-.654.13c-.374.05-.68.046-.878-.017-.367-.114-.48-.485-.48-.485s.76-.2 1.093-.12c.1.02.92.5.92.5zm5.42-1.177c-.437.252-.813.485-1.128.696-.192.128-.322.22-.39.273l-.63.477.74.285c.042.016.117.044.218.078.167.057.35.114.542.167.33.09.652.162.96.205.493.068.92.06 1.27-.05.762-.235 1.146-.88 1.214-1.502l.03-.28-.24-.145c-.1-.06-.263-.142-.475-.223-.52-.2-1.07-.282-1.6-.164-.16.037-.32.093-.48.17l-.02.013zm.7.68c.333-.075 1.09.125 1.09.125s-.11.38-.475.49c-.202.07-.507.07-.88.02-.265-.032-.64-.15-.64-.15s.808-.45.904-.472z" /></symbol><symbol id="spinner" viewBox="0 0 37 12" stroke="#aaa" fill="none"><circle cx="6" cy="6" r="4"><animate attributeName="r" begin="0s" dur="0.65s" values="0;4" calcMode="spline" keySplines="0.51 0 0.21 0.9" repeatCount="indefinite"/><animate attributeName="stroke-opacity" begin="0s" dur="0.65s" values="0;1" calcMode="spline" keySplines="0.51 0 0.21 0.9" repeatCount="indefinite"/></circle><circle cx="6" cy="6" r="4"><animate attributeName="cx" begin="0s" dur="0.65s" values="6;19" calcMode="spline" keySplines="0.51 0 0.21 0.9" repeatCount="indefinite"/></circle><circle cx="19" cy="6" r="4"><animate attributeName="cx" begin="0s" dur="0.65s" values="19;32" calcMode="spline" keySplines="0.51 0 0.21 0.9" repeatCount="indefinite"/></circle><circle cx="32" cy="6" r="4"><animate attributeName="r" begin="0s" dur="0.65s" values="4;0" calcMode="spline" keySplines="0.51 0 0.21 0.9" repeatCount="indefinite"/><animate attributeName="stroke-opacity" begin="0s" dur="0.65s" values="1;0" calcMode="spline" keySplines="0.51 0 0.21 0.9" repeatCount="indefinite"/></circle></symbol><symbol id="iconset-tools--giant" viewBox="0 0 24 24"><path d="M12 5.5c1.38 0 2.5-1.12 2.5-2.5S13.38.5 12 .5 9.5 1.62 9.5 3s1.12 2.5 2.5 2.5zm0 18c1.38 0 2.5-1.12 2.5-2.5s-1.12-2.5-2.5-2.5-2.5 1.12-2.5 2.5 1.12 2.5 2.5 2.5zm0-9c1.38 0 2.5-1.12 2.5-2.5S13.38 9.5 12 9.5 9.5 10.62 9.5 12s1.12 2.5 2.5 2.5z" /></symbol></svg>'},s.DEBUG&&(t.icons.essential.definitions.soyTemplateName="tiger.icons.essential.definitions")}),define("templates/tiger/icons/essential/usage",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(e,t,n,s){t.icons.essential.search=function(){return'<svg class="svg-icon svg-search"><use xlink:href="#iconset-search" /></svg>'},s.DEBUG&&(t.icons.essential.search.soyTemplateName="tiger.icons.essential.search"),t.icons.essential.add=function(){return'<svg class="svg-icon svg-add"><use xlink:href="#iconset-add" /></svg>'},s.DEBUG&&(t.icons.essential.add.soyTemplateName="tiger.icons.essential.add"),t.icons.essential.adDMSall=function(){return'<svg class="svg-icon small svg-add--small"><use xlink:href="#iconset-add--small" /></svg>'},s.DEBUG&&(t.icons.essential.adDMSall.soyTemplateName="tiger.icons.essential.adDMSall"),t.icons.essential.siteDefault=function(){return'<svg class="svg-icon svg-site-default"><use xlink:href="#iconset-site-default" /></svg>'},s.DEBUG&&(t.icons.essential.siteDefault.soyTemplateName="tiger.icons.essential.siteDefault"),t.icons.essential.zoomIn=function(){return'<svg class="svg-icon svg-zoom-in"><use xlink:href="#iconset-zoom-in" /></svg>'},s.DEBUG&&(t.icons.essential.zoomIn.soyTemplateName="tiger.icons.essential.zoomIn"),t.icons.essential.star=function(){return'<svg class="svg-icon svg-star"><use xlink:href="#iconset-star" /></svg>'},s.DEBUG&&(t.icons.essential.star.soyTemplateName="tiger.icons.essential.star"),t.icons.essential.starGiant=function(){return'<svg class="svg-icon giant stroked svg-star--giant"><use xlink:href="#iconset-star--giant" /></svg>'},s.DEBUG&&(t.icons.essential.starGiant.soyTemplateName="tiger.icons.essential.starGiant"),t.icons.essential.starCircle=function(){return'<svg class="svg-icon svg-star-circle"><use xlink:href="#iconset-star-circle" /></svg>'},s.DEBUG&&(t.icons.essential.starCircle.soyTemplateName="tiger.icons.essential.starCircle"),t.icons.essential.chevronRight=function(){return'<svg class="svg-icon svg-chevron chevron--right"><use xlink:href="#iconset-chevron-right" /></svg>'},s.DEBUG&&(t.icons.essential.chevronRight.soyTemplateName="tiger.icons.essential.chevronRight"),t.icons.essential.chevronRightSmall=function(){return'<svg class="svg-icon small svg-chevron--small chevron--right"><use xlink:href="#iconset-chevron-right--small" /></svg>'},s.DEBUG&&(t.icons.essential.chevronRightSmall.soyTemplateName="tiger.icons.essential.chevronRightSmall"),t.icons.essential.chevronBottom=function(){return'<svg class="svg-icon svg-chevron chevron--bottom"><use xlink:href="#iconset-chevron-right" /></svg>'},s.DEBUG&&(t.icons.essential.chevronBottom.soyTemplateName="tiger.icons.essential.chevronBottom"),t.icons.essential.chevronBottomSmall=function(){return'<svg class="svg-icon small svg-chevron--small chevron--bottom"><use xlink:href="#iconset-chevron-right--small" /></svg>'},s.DEBUG&&(t.icons.essential.chevronBottomSmall.soyTemplateName="tiger.icons.essential.chevronBottomSmall"),t.icons.essential.chevronLeft=function(){return'<svg class="svg-icon svg-chevron chevron--left"><use xlink:href="#iconset-chevron-right" /></svg>'},s.DEBUG&&(t.icons.essential.chevronLeft.soyTemplateName="tiger.icons.essential.chevronLeft"),t.icons.essential.chevronLeftSmall=function(){return'<svg class="svg-icon small svg-chevron--small chevron--left"><use xlink:href="#iconset-chevron-right--small" /></svg>'},s.DEBUG&&(t.icons.essential.chevronLeftSmall.soyTemplateName="tiger.icons.essential.chevronLeftSmall"),t.icons.essential.chevronTop=function(){return'<svg class="svg-icon svg-chevron chevron--top"><use xlink:href="#iconset-chevron-right" /></svg>'},s.DEBUG&&(t.icons.essential.chevronTop.soyTemplateName="tiger.icons.essential.chevronTop"),t.icons.essential.chevronTopSmall=function(){return'<svg class="svg-icon small svg-chevron--small chevron--top"><use xlink:href="#iconset-chevron-right--small" /></svg>'},s.DEBUG&&(t.icons.essential.chevronTopSmall.soyTemplateName="tiger.icons.essential.chevronTopSmall"),t.icons.essential.flame=function(){return'<svg class="svg-icon svg-flame"><use xlink:href="#iconset-flame" /></svg>'},s.DEBUG&&(t.icons.essential.flame.soyTemplateName="tiger.icons.essential.flame"),t.icons.essential.flameGiant=function(){return'<svg class="svg-icon giant stroked svg-flame--giant"><use xlink:href="#iconset-flame--giant" /></svg>'},s.DEBUG&&(t.icons.essential.flameGiant.soyTemplateName="tiger.icons.essential.flameGiant"),t.icons.essential.kinja=function(){return'<svg class="svg-icon svg-logo-kinja"><use xlink:href="#iconset-logo-kinja" /></svg>'},s.DEBUG&&(t.icons.essential.kinja.soyTemplateName="tiger.icons.essential.kinja"),t.icons.essential.bubble=function(){return'<svg class="svg-icon svg-bubble"><use xlink:href="#iconset-bubble" /></svg>'},s.DEBUG&&(t.icons.essential.bubble.soyTemplateName="tiger.icons.essential.bubble"),t.icons.essential.bubbleGiant=function(){return'<svg class="svg-icon giant stroked svg-bubble--giant"><use xlink:href="#iconset-bubble--giant" /></svg>'},s.DEBUG&&(t.icons.essential.bubbleGiant.soyTemplateName="tiger.icons.essential.bubbleGiant"),t.icons.essential.checkmark=function(){return'<svg class="svg-icon svg-checkmark"><use xlink:href="#iconset-checkmark" /></svg>'},s.DEBUG&&(t.icons.essential.checkmark.soyTemplateName="tiger.icons.essential.checkmark"),t.icons.essential.checkmarkSmall=function(){return'<svg class="svg-icon small svg-checkmark--small"><use xlink:href="#iconset-checkmark--small" /></svg>'},s.DEBUG&&(t.icons.essential.checkmarkSmall.soyTemplateName="tiger.icons.essential.checkmarkSmall"),t.icons.essential.close=function(){return'<svg class="svg-icon svg-close"><use xlink:href="#iconset-close" /></svg>'},s.DEBUG&&(t.icons.essential.close.soyTemplateName="tiger.icons.essential.close"),t.icons.essential.closeSmall=function(){return'<svg class="svg-icon small svg-close--small"><use xlink:href="#iconset-close--small" /></svg>'},s.DEBUG&&(t.icons.essential.closeSmall.soyTemplateName="tiger.icons.essential.closeSmall"),t.icons.essential.facebook=function(){return'<svg class="svg-icon svg-facebook"><use xlink:href="#iconset-facebook" /></svg>'},s.DEBUG&&(t.icons.essential.facebook.soyTemplateName="tiger.icons.essential.facebook"),t.icons.essential.twitter=function(){return'<svg class="svg-icon svg-twitter"><use xlink:href="#iconset-twitter" /></svg>'},s.DEBUG&&(t.icons.essential.twitter.soyTemplateName="tiger.icons.essential.twitter"),t.icons.essential.googleplus=function(){return'<svg class="svg-icon svg-googleplus"><use xlink:href="#iconset-googleplus" /></svg>'},s.DEBUG&&(t.icons.essential.googleplus.soyTemplateName="tiger.icons.essential.googleplus"),t.icons.essential.externalLink=function(){return'<svg class="svg-icon svg-external-link"><use xlink:href="#iconset-external-link" /></svg>'},s.DEBUG&&(t.icons.essential.externalLink.soyTemplateName="tiger.icons.essential.externalLink"),t.icons.essential.burner=function(){return'<svg class="svg-icon svg-burner"><use xlink:href="#iconset-burner" /></svg>'},s.DEBUG&&(t.icons.essential.burner.soyTemplateName="tiger.icons.essential.burner"),t.icons.essential.link=function(){return'<svg class="svg-icon svg-link"><use xlink:href="#iconset-link" /></svg>'},s.DEBUG&&(t.icons.essential.link.soyTemplateName="tiger.icons.essential.link"),t.icons.essential.image=function(){return'<svg class="svg-icon svg-image"><use xlink:href="#iconset-image" /></svg>'},s.DEBUG&&(t.icons.essential.image.soyTemplateName="tiger.icons.essential.image"),t.icons.essential.spinner=function(){return'<svg class="svg-icon svg-image"><use xlink:href="#spinner" /></svg>'},s.DEBUG&&(t.icons.essential.spinner.soyTemplateName="tiger.icons.essential.spinner"),t.icons.essential.toolsGiant=function(){return'<svg class="svg-icon giant stroked svg-tools--giant"><use xlink:href="#iconset-tools--giant" /></svg>'},s.DEBUG&&(t.icons.essential.toolsGiant.soyTemplateName="tiger.icons.essential.toolsGiant"),t.icons.essential.facebook__C17=function(){return'<svg class="svg-icon svg-facebook"><use xlink:href="#iconset-facebook" /></svg>'},s.DEBUG&&(t.icons.essential.facebook__C17.soyTemplateName="tiger.icons.essential.facebook__C17"),t.icons.essential.twitter__C17=function(){return'<svg class="svg-icon svg-twitter"><use xlink:href="#iconset-twitter" /></svg>'},s.DEBUG&&(t.icons.essential.twitter__C17.soyTemplateName="tiger.icons.essential.twitter__C17"),t.icons.essential.googleplus__C17=function(){return'<svg class="svg-icon svg-googleplus"><use xlink:href="#iconset-googleplus" /></svg>'},s.DEBUG&&(t.icons.essential.googleplus__C17.soyTemplateName="tiger.icons.essential.googleplus__C17"),t.icons.essential.chevronBottomSmall__C17=function(){return'<svg class="svg-icon small svg-chevron--small chevron--bottom"><use xlink:href="#iconset-chevron-right--small" /></svg>'},s.DEBUG&&(t.icons.essential.chevronBottomSmall__C17.soyTemplateName="tiger.icons.essential.chevronBottomSmall__C17"),t.icons.essential.closeSmall__C17=function(){return'<svg class="svg-icon small svg-close--small"><use xlink:href="#iconset-close--small" /></svg>'},s.DEBUG&&(t.icons.essential.closeSmall__C17.soyTemplateName="tiger.icons.essential.closeSmall__C17")}),define("module/EssentialIconModule",["jquery","templates/tiger/icons/essential/definitions","templates/tiger/icons/essential/usage"],function(e){"use strict";var t=e("#svggroup--essential");t&&t.length||e("#js_svg-definitions").append(e.trim(tiger.icons.essential.definitions()))}),define("lib/amd-wrapped/jquery.lightbox-0.5",["jquery"],function(e){e.fn.lightBox=function(t){function f(){return g(this,b),!1}function g(s,o){var i,r,a=e(s).siblings("span").find("img");if(e("embed, object, select").css({visibility:"hidden"}),p(),t.imageArray.length=0,t.activeImage=0,1==o.length)t.imageArray.push(new Array(a.attr("data-original-src"),s.getAttribute("title")));else for(i=0;i<o.length;i++)r=o.eq(i).siblings("span").find("img"),t.imageArray.push(new Array(r.attr("data-original-src"),o[i].getAttribute("title")));for(;t.imageArray[t.activeImage][0]!=a.attr("data-original-src");)t.activeImage++;n()}function p(){e("body").append('<div id="jquery-overlay"></div><div id="jquery-lightbox"><div id="lightbox-container-image-data-box"><div id="lightbox-container-image-data"><div id="lightbox-image-details"><span id="lightbox-image-details-caption"></span><span id="lightbox-image-details-currentNumber" class="proxima"></span></div><div id="lightbox-secNav"><a href="#" id="lightbox-secNav-btnClose" class="icon--svg svg-icon--white u-giant u-full--onhover"><svg class="svg-icon svg-close"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#iconset-close"></use></svg></a></div></div></div><div id="lightbox-container-image-box"><div id="lightbox-container-image"><img id="lightbox-image"><a href="#" id="lightbox-nav-btnPrev"></a><a href="#" id="lightbox-nav-btnNext"></a></div></div></div>');var o,n=a();e("#jquery-overlay").css({backgroundColor:t.overlayBgColor,opacity:t.overlayOpacity,width:n[0],height:n[1]}).fadeIn(),o=i(),e("#jquery-lightbox").css({top:o[1]+n[3]/10,left:o[0]}).show(),e("#jquery-overlay,#jquery-lightbox").click(function(){s()}),e("#lightbox-loading-link,#lightbox-secNav-btnClose").click(function(){return s(),!1}),e(window).resize(function(){var n,t=a();e("#jquery-overlay").css({width:t[0],height:t[1]}),n=i(),e("#jquery-lightbox").css({top:n[1]+t[3]/10,left:n[0]})})}function n(){t.fixedNavigation?e("#lightbox-image,#lightbox-container-image-data-box,#lightbox-image-details-currentNumber").hide():e("#lightbox-image,#lightbox-nav,#lightbox-nav-btnPrev,#lightbox-nav-btnNext,#lightbox-container-image-data-box,#lightbox-image-details-currentNumber").hide();var n=new Image;n.onload=function(){e("#lightbox-image").attr("src",t.imageArray[t.activeImage][0]),r(n.width,n.height),n.onload=function(){}},n.src=t.imageArray[t.activeImage][0],t.activeImage>-1}function r(n,s){e("#lightbox-container-image-box").hide();var a=e("#lightbox-container-image-box").width(),r=e("#lightbox-container-image-box").height(),o=n+2*t.containerBorderSize,i=s+2*t.containerBorderSize,c=a-o,l=r-i;e("#lightbox-container-image-box").css({width:o,height:i}),u(),0==c&&0==l&&v(e.browser.msie?250:100),e("#lightbox-container-image-data-box").css({width:n+20})}function u(){e("#lightbox-image").fadeIn(function(){c(),l(),e("#lightbox-container-image-box").show()}),m()}function c(){e("#lightbox-container-image-data-box").slideDown("fast"),e("#lightbox-image-details-caption").hide(),t.imageArray[t.activeImage][1]&&e("#lightbox-image-details-caption").html(t.imageArray[t.activeImage][1]).show(),t.imageArray.length>1}function l(){0!=t.activeImage?t.fixedNavigation?e("#lightbox-nav-btnPrev").unbind().html('<span class="button-box"><span class="icon icon-white icon-chevron-left"></span></span>').bind("click",function(){return t.activeImage=t.activeImage-1,n(),!1}):e("#lightbox-nav-btnPrev").unbind().hover(function(){e(this).html('<span class="button-box"><span class="icon icon-white icon-chevron-left"></span></span>')},function(){e(this).html("")}).show().bind("click",function(){return t.activeImage=t.activeImage-1,n(),!1}):e("#lightbox-nav-btnPrev").html(""),t.activeImage!=t.imageArray.length-1?t.fixedNavigation?e("#lightbox-nav-btnNext").unbind().html('<span class="button-box"><span class="icon icon-white icon-chevron-right"></span></span>').bind("click",function(){return t.activeImage=t.activeImage+1,n(),!1}):e("#lightbox-nav-btnNext").unbind().hover(function(){e(this).html('<span class="button-box"><span class="icon icon-white icon-chevron-right"></span></span>')},function(){e(this).html("")}).show().bind("click",function(){return t.activeImage=t.activeImage+1,n(),!1}):(e("#lightbox-nav-btnNext").unbind(),e("#lightbox-nav-btnNext").html("")),d()}function d(){e(document).keydown(function(e){h(e)})}function o(){e(document).unbind()}function h(e){e==null?(keycode=event.keyCode,escapeKey=27):(keycode=e.keyCode,escapeKey=e.DOM_VK_ESCAPE||27),key=String.fromCharCode(keycode).toLowerCase(),(key==t.keyToClose||"x"==key||keycode==escapeKey)&&s(),(key==t.keyToPrev||37==keycode)&&0!=t.activeImage&&(t.activeImage=t.activeImage-1,n(),o()),(key==t.keyToNext||39==keycode)&&t.activeImage!=t.imageArray.length-1&&(t.activeImage=t.activeImage+1,n(),o())}function m(){t.imageArray.length-1>t.activeImage&&(objNext=new Image,objNext.src=t.imageArray[t.activeImage+1][0]),t.activeImage>0&&(objPrev=new Image,objPrev.src=t.imageArray[t.activeImage-1][0])}function s(){e("#jquery-lightbox").remove(),e("#jquery-overlay").fadeOut(function(){e("#jquery-overlay").remove()}),e("embed, object, select").css({visibility:"visible"})}function a(){var e,t,n,s;return window.innerHeight&&window.scrollMaxY?(n=window.innerWidth+window.scrollMaxX,s=window.innerHeight+window.scrollMaxY):document.body.scrollHeight>document.body.offsetHeight?(n=document.body.scrollWidth,s=document.body.scrollHeight):(n=document.body.offsetWidth,s=document.body.offsetHeight),self.innerHeight?(e=document.documentElement.clientWidth?document.documentElement.clientWidth:self.innerWidth,t=self.innerHeight):document.documentElement&&document.documentElement.clientHeight?(e=document.documentElement.clientWidth,t=document.documentElement.clientHeight):document.body&&(e=document.body.clientWidth,t=document.body.clientHeight),t>s?pageHeight=t:pageHeight=s,e>n?pageWidth=n:pageWidth=e,arrayPageSize=new Array(pageWidth,pageHeight,e,t),arrayPageSize}function i(){var e,t;return self.pageYOffset?(t=self.pageYOffset,e=self.pageXOffset):document.documentElement&&document.documentElement.scrollTop?(t=document.documentElement.scrollTop,e=document.documentElement.scrollLeft):document.body&&(t=document.body.scrollTop,e=document.body.scrollLeft),arrayPageScroll=new Array(e,t),arrayPageScroll}function v(e){var n=new Date,t=null;do t=new Date;while(e>t-n)}t=e.extend({overlayBgColor:"#000",overlayOpacity:.85,fixedNavigation:!1,containerBorderSize:10,containerResizeSpeed:400,txtImage:"Image",txtOf:" / ",keyToClose:"c",keyToPrev:"p",keyToNext:"n",imageArray:[],activeImage:0},t);var b=this;return this.unbind("click").click(f)}}),define("gawkerlib/lightboxer",["jquery","underscore","singleton/Utils","module/EssentialIconModule","lib/amd-wrapped/jquery.lightbox-0.5","templates/tiger/icons/essential/usage"],function(e,t,n){"use strict";function s(s){var i=s.find(".lightBoxWrapper .img-border img"),o=s.find(".lightBox");t.each(i,function(t){var s=e(t);s.attr("data-original-src",n.imageUrl(s.data("chomp-id"),"original",s.data("format")))}),o.find(".icon-search-plus").replaceWith(e.trim(tiger.icons.essential.zoomIn())),o.removeClass("hide").lightBox()}return s}),define("templates/tiger/components/discussion/comment",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(e,t,n,s,o){t.components.discussion.comment=function(e,n,s){if(r="",c=(s.features.superuser,e.reply.authorStats&&e.reply.authorStats.contributors.length?e.reply.authorStats.contributors.length:1,((null==s.replyData?null:s.replyData.query)==e.reply.author.screenName||!(null==s.replyData?null:s.replyData.query))&&(e.reply.approved||(null==e.reply.qiMeta?null:e.reply.qiMeta.dynamicApproved)),""),e.reply.blogs)for(var a,r,c,l=e.reply.blogs,d=l.length,i=0;d>i;i++)a=l[i],c+=a.id==e.reply.author.defaultBlogId?o.$$escapeHtml(a.canonicalHost):"";return r+='<article id="reply_'+o.$$escapeHtmlAttribute(e.reply.id)+'" class="reply reply--depth-'+o.$$escapeHtmlAttribute(e.depth)+" js_reply"+(e.reply.approved?"":" reply--unapproved")+(e.reply.flagged?" reply--flagged":"")+'" data-id="'+o.$$escapeHtmlAttribute(e.reply.id)+'" data-parentid="'+o.$$escapeHtmlAttribute(e.reply.parentId)+'" data-authorname="'+o.$$escapeHtmlAttribute(e.reply.authorBlogName)+'">'+t.components.discussion.replyHeader(e,null,s)+'<div class="reply__content js_reply-content post-content blurable whitelisted-links">'+("IMAGE"==(null==e.reply.annotation?null:e.reply.annotation.annotationType)?`<div class="image-annotation--reply" style="background-image: url('`+o.$$escapeHtmlAttribute(o.$$filterNormalizeUri(e.reply.annotation.imageUrl))+"'); background-position: "+o.$$escapeHtmlAttribute(o.$$filterCssValue(e.reply.annotation.x))+"% "+o.$$escapeHtmlAttribute(o.$$filterCssValue(e.reply.annotation.y))+'%;"></div>':"")+("TEXT"==(null==e.reply.annotation?null:e.reply.annotation.annotationType)?'<blockquote class="text-annotation--reply" style=""><span class="icon--svg mrs">'+t.icons.actions.quote(null,null,s)+"</span>"+(e.reply.annotation.annotationShortText?'<div class="js_annotation-long text-annotation--reply__content--long hide">'+o.$$filterNoAutoescape(e.reply.annotation.annotationText)+'</div><div class="js_annotation-short text-annotation--reply__content--short">'+o.$$filterNoAutoescape(e.reply.annotation.annotationShortText)+' <a href="'+o.$$escapeHtmlAttribute(o.$$filterNormalizeUri(e.reply.permalink))+'" class="js_annotation-expand">Show all</a></div>':o.$$filterNoAutoescape(e.reply.annotation.annotationText))+"</blockquote>":"")+o.$$filterNoAutoescape(e.reply.display)+"</div>"+t.components.discussion.replySidebar(e,null,s)+t.components.discussion.replyTools(e,null,s)+'<div class="js_reply-flagged reply__flagged-indicator">Flagged</div></article><div class="js_region--warning"></div><div class="js_editor-placeholder"></div><div class="js_region--children"></div>'},s.DEBUG&&(t.components.discussion.comment.soyTemplateName="tiger.components.discussion.comment"),t.components.discussion.replyHeader=function(e,n,s){var a,i="",r="avt-small";return i+='<header class="reply__header without-dropdown js_author" data-authorid="'+o.$$escapeHtmlAttribute(e.reply.author.id)+'" data-blogid="'+o.$$escapeHtmlAttribute(e.reply.author.defaultBlogId)+'">',a="gif"==e.reply.author.avatar.format?"jpg":e.reply.author.avatar.format,i+=t.components.discussion.replyAvatarDisplay({url:"//kinja.com/"+e.reply.author.screenName,avatar:window.kinja.imageUrl(e.reply.author.avatar.id,r,a),nofollow:e.reply.isPromoted},null,s)+(s.features.hide_pending_replies&&!e.reply.approved?'<span class="reply__pending-label">Pending approval</span>':"")+t.components.discussion.replyByline(e,null,s)+'<div class="reply__publish-time">'+t.components.discussion.replyPublishTime(e,null,s)+'</div><div class="post-dropdown-ct js_post-dropdown-ct'+("permalink"==e.pageType?" js_post-dropdown-ct-sticky":"")+'">'+t.components.post.meta.postDropdownTrigger({post:e.reply},null,s)+"</div></header>"},s.DEBUG&&(t.components.discussion.replyHeader.soyTemplateName="tiger.components.discussion.replyHeader"),t.components.discussion.replySidebar=function(e,n,s){return'<div class="reply__sidebar"><a href="#" class="js_like reply__recommend readonly-hide icon--svg u-undecorated u-darkened--onhover js_like_icon" title="Recommend">'+(s.features.newstream?t.icons.essential.starGiant(null,null,s):t.icons.essential.star(null,null,s))+(e.reply.likes&&e.reply.likes>0?'<span class="like-count js_like_count">'+o.$$escapeHtml(e.reply.likes)+"</span>":"")+"</a></div>"},s.DEBUG&&(t.components.discussion.replySidebar.soyTemplateName="tiger.components.discussion.replySidebar"),t.components.discussion.replyByline=function(e,n,s){var i='<span class="reply__byline"><a href="//kinja.com/'+o.$$escapeHtmlAttribute(e.reply.author.screenName)+'" target="_self" '+(e.reply.isPromoted?'rel="nofollow"':"")+` class="fn url" onclick="window.ga('send', 'event', 'byline', 'click', 'permalink');">`+o.$$escapeHtml(e.reply.author.displayName)+"</a>",a=(null==s.replyData?null:s.replyData.atUser)==e.reply.authorBlogName;return i+=(a?"<span>, Host</span>":"")+((null==e.reply.replyMeta?null:null==e.reply.replyMeta.parentAuthor?null:e.reply.replyMeta.parentAuthor.displayName)?'<span class="reply__to-author"><span class="icon--svg u-downsized">'+t.icons.essential.chevronRight(null,null,s)+"</span>"+((null==e.reply.replyMeta?null:e.reply.replyMeta.showParentByline)&&""!=(null==e.reply.replyMeta?null:e.reply.replyMeta.parentByline)?o.$$escapeHtml(window.kinja.stripHtmlTags(e.reply.replyMeta.parentByline,"")):o.$$escapeHtml(e.reply.replyMeta.parentAuthor.displayName))+"</span>":"")+"</span>"},s.DEBUG&&(t.components.discussion.replyByline.soyTemplateName="tiger.components.discussion.replyByline"),t.components.discussion.replyAvatarDisplay=function(e,n,s){return'<a href="'+(e.url&&"http://"!=e.url?o.$$escapeHtmlAttribute(o.$$filterNormalizeUri(e.url)):"javascript:void(0)")+'"'+(e.nofollow?' rel="nofollow"':"")+' class="avatar avatar-container"><span class="icon--svg">'+t.icons.essential.checkmarkSmall(null,null,s)+'</span><span class="img-border'+(e.avatar?"":" hide")+'"><img src="'+(e.avatar?o.$$escapeHtmlAttribute(o.$$filterNormalizeUri(e.avatar)):"")+'" /></span><span class="avatar-default'+(e.avatar?" hide":"")+'"></span></a>'},s.DEBUG&&(t.components.discussion.replyAvatarDisplay.soyTemplateName="tiger.components.discussion.replyAvatarDisplay"),t.components.discussion.replyPublishTime=function(e){return'<a href="'+o.$$escapeHtmlAttribute(o.$$filterNormalizeUri(e.reply.permalink))+'" target="_self"><span class="published updated">'+o.$$escapeHtml(e.reply.publishTime.Mddyyhmma)+"</span></a>"},s.DEBUG&&(t.components.discussion.replyPublishTime.soyTemplateName="tiger.components.discussion.replyPublishTime"),t.components.discussion.replyTools=function(e,n,s){var a="",i=e.reply.replyCount?e.reply.replyCount:0;return a+='<div class="reply__tools js_reply-tools '+(e.reply.flagged?"hide":"")+'" data-analytics-target="groupChat">'+t.icons.discussion.replyRight(null,null,s)+'<a href="#" class="js_reply-to-selected-post reply__link readonly-hide" data-id="'+o.$$escapeHtmlAttribute(e.reply.id)+`" title="Reply" onclick="window.ga('send', 'event', 'Group Chats', 'click', 'Reply button click');">Reply</a>`+("ReplyList"!=e.discussionType&&e.reply._surfaced&&i&&e.depth<2?'<a href="#" class="js_toggle-descendants reply__count icon--svg u-undecorated u-darkened--onhover" data-id="'+o.$$escapeHtmlAttribute(e.reply.id)+'" title="Show replies"><span>'+o.$$escapeHtml(i)+"</span> replies</a>":"")+"</div>"},s.DEBUG&&(t.components.discussion.replyTools.soyTemplateName="tiger.components.discussion.replyTools")}),define("templates/tiger/components/post/meta/post-meta-container",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(e,t,n,s){t.components.post.meta.postMetaContainer=function(e,n,s){return'<div class="meta-container without-dropdown">'+("permalink"==e.pageType?t.components.post.meta.metaAvatar(e,null,s):t.components.post.meta.meta(e,null,s))+(e.forSharedPost?"":'<div class="post-dropdown-ct js_post-dropdown-ct'+("permalink"!=e.pageType||e.mode?"":" js_post-dropdown-ct-sticky")+'">'+t.components.post.meta.postDropdown(e,null,s)+t.components.post.meta.postDropdownTrigger(e,null,s)+"</div>")+"</div>"},s.DEBUG&&(t.components.post.meta.postMetaContainer.soyTemplateName="tiger.components.post.meta.postMetaContainer")}),define("templates/tiger/components/post/meta/meta-avatar",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(e,t,n,s,o){t.components.post.meta.metaAvatar=function(e,n,s){for(var a,l="",r="",c=e.post.blogs,d=c.length,i=0;d>i;i++)a=c[i],r+=a.id==e.post.author.defaultBlogId?o.$$escapeHtml(a.canonicalHost):"";return l+='<div class="meta-avatar js_author" data-authorid="'+o.$$escapeHtmlAttribute(e.post.author.id)+'" data-blogid="'+o.$$escapeHtmlAttribute(e.post.author.defaultBlogId)+'">'+("reply"!=e.mode?t.components.post.meta.postInfo(e,null,s):"")+'<div class="floated-container img-30">'+t.components.post.meta.avatarContainer({post:e.post,canonicalHost:r},null,s)+'<div class="txt">'+(s.features.hide_pending_replies&&!e.post.approved?'<span class="pending-label">Pending approval</span>':"")+(e.forSharedPost?"Original post by":"")+t.components.post.meta.topByline({post:e.post,mode:""+o.$$escapeHtml(e.mode?e.mode:"post"),forSharedPost:e.forSharedPost,contributors:e.contributors,blog:e.blog},null,s)+'<div class="second-line post-meta">'+(e.post.sponsored||e.post.isBillboardPost||e.post.isPromoted?t.components.post.meta.promotedByline(e,null,s):"")+(e.post.tags&&e.post.tags[0]&&!e.forSharedPost?"Filed to: "+t.components.post.tag({tag:e.post.tags[0],hasDropdown:e.post.tags.length>1,tagClasses:"first-tag"},null,s)+(e.post.tags.length>1?t.components.post.tagList({tags:e.post.tags},null,s):""):"")+(0==e.showDate||e.forSharedPost?"":t.components.post.meta.publishTime(e,null,s))+"</div></div></div></div>"},s.DEBUG&&(t.components.post.meta.metaAvatar.soyTemplateName="tiger.components.post.meta.metaAvatar")}),define("templates/tiger/components/post/meta/formatted-time",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(e,t,n,s){t.components.post.meta.relativeTime=function(e,n,s){return""+t.messages.time.relativeTime({type:e.time.relative.type,amount:e.time.relative.amount,hmma:e.time.hmma,day:e.time.day,Mddyyhmma:e.time.Mddyyhmma,timestamp:e.time.timestamp},null,s)},s.DEBUG&&(t.components.post.meta.relativeTime.soyTemplateName="tiger.components.post.meta.relativeTime")}),define("templates/tiger/components/invites/menu-items",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(e,t,n,s){t.components.invites.menuItems.invitePostDropdownItems=function(e,n,s){return'<li class="js_invite-to-post-manually hover-icon hide"><a href="#" rel="nofollow" class="icon--svg">'+t.icons.places.mail(null,null,s)+"Invite manually</a></li>"},s.DEBUG&&(t.components.invites.menuItems.invitePostDropdownItems.soyTemplateName="tiger.components.invites.menuItems.invitePostDropdownItems")}),define("module/discussion/view/comment.layout",["jquery","underscore","module/discussion/model/comment.collection","module/discussion/discussion.channel","app/post/common/post.layout","app/post/posttools/posttools.menuview","module/discussion/view/warning.view","view/GifImageLoader","singleton/Utils","singleton/util/loadEditor","singleton/CurrentBlog","singleton/CurrentUser","singleton/ImageBlurHelper","module/discussion/regionManager/discussionRegionManager","app/post/posttools/posttools.controller","app/post/posttools/controller/posttools.block.controller","singleton/EventDispatcher","gawkerlib/lightboxer","templates/tiger/components/discussion/comment","templates/tiger/components/post/meta/post-meta-container","templates/tiger/components/post/meta/post-dropdown","templates/tiger/components/post/meta/meta-avatar","templates/tiger/components/post/meta/formatted-time","templates/tiger/components/invites/menu-items"],function(e,t,n,s,o,i,a,r,c,l,d,u,h,m,f,p,g,v){"use strict";var j,b="KinjaNSFWCookie";return j=o.extend({_updateLikeCount:function(){var e=window.parseInt(this.ui.likeCountPlaceholder.text(),10)||0,t=e>0,e=this.model.get("liked")?e+1:t?e-1:0;this.ui.likeCountPlaceholder.text(e||"")},_expanded:!1,_gifImageLoader:null,_renderDeferred:e.Deferred(),_commentListView:null,tagName:"li",className:function(){var e=this.model,t=e.collection.getDiscussionType(),s=e.getChildren(),o=t===n.discussionTypes.ALL&&s.hasMore();return["commentlist__item","commentlist__item--depth-"+e.collection.getDepth(),e.get("_surfaced")?"surfaced":"",o?"commentlist__item--expandable":""].join(" ")},template:tiger.components.discussion.comment,regions:{warningRegion:".js_region--warning:first",childrenRegion:".js_region--children"},ui:t.extend({},o.prototype.ui,{replyContent:".js_reply-content",replyTools:".js_reply-tools",replyFlag:".js_reply-flagged",editorPlaceholder:".js_editor-placeholder",replyButton:".js_reply-to-selected-post",editReply:".js_edit-reply",reply:".js_reply",replyBubbleIcon:".js_bubble-icon"}),events:t.extend({},o.prototype.events,{"click @ui.replyButton":"onClickReplyTo","click @ui.replyContent, .js_toggle-descendants":"onClickReplyContent","click .js_pending-reply-thread-switch":"onClickPendingSwitch","click .js_pending-close:first":"onClickPendingClose","click .blurred .img-border":"onClickImageBlur","click @ui.editReply":"onClickEditReply","click .lazy-gif.thawable":"onClickThawImage"}),modelEvents:t.extend({},o.prototype.modelEvents,{"change:liked":"onChangeLiked","change:approved":"onChangeApproved","change:display":"onChangeDisplay","change:flagged":"onChangeFlagged","posttools:post:dismissed":"onDismissed"}),initialize:function(){},onClickReplyTo:function(){var e,o=m.addCommentRegion(this.ui.editorPlaceholder),n=this.model;return this.listenToOnce(o,"editor:post:save",function(o,i){e=t.extend(o.toJSON(),{_surfaced:!0,_viaEditor:!0}),n._commentCollection.unshift(e),s.trigger("newComment",{comment:e}),i&&i.length&&n.set("approved",!0)}),l().then(function(e){e.createComment(n)}),!1},serializeData:function(){var n,e=this.model.collection,t=c.getKinjaMeta();return n={reply:this.model.attributes,pageType:t.pageType,discussionType:e.getDiscussionType(),depth:e.getDepth(),starterAuthor:t.post.authorScreenName}},renderBlurs:function(){var t=this.$(".post-content .has-media:not(.blurred)");t.each(function(t,n){h.addImageBlur(e(n))})},renderPostTools:function(){this.postToolsMenuView=new i({el:this.$(".js_post-dropdown-ct").eq(0),model:this.model,blockedBlogCollection:p.getBlockedBlogCollection(d.id)}),f.bindEvents(this,this.postToolsMenuView),this.postToolsMenuView.on("posttools:content:render",this.renderFollowUnfollowForBlog.bind(this)),this.$(".without-dropdown").removeClass("without-dropdown")},renderFollowUnfollowForBlog:function(){u.onAuth.done(function(){var e=u.hasRole("OWNER",d.id)||u.hasRole("ADMIN",d.id)||u.hasRole("AUTHOR",d.id),t=u.hasRole("OWNER",d.id)||u.hasRole("ADMIN",d.id)||u.isSuperuser();(e||u.isSuperuser())&&d.getFollowedBlogIds().done(function(e){var t=this.postToolsMenuView.$(".js_follow-controls"),n=this.postToolsMenuView.$(".js_followforblog"),s=this.postToolsMenuView.$(".js_unfollowforblog"),i=t.data("sourceblogid"),o=t.data("blogid");i!==o&&(-1!==e.indexOf(o)?(s.removeClass("hide"),n.addClass("hide")):(n.removeClass("hide"),s.addClass("hide")))}.bind(this)),t&&this.postToolsMenuView.trigger("posttools:checkBlockStatus",{model:this.postToolsMenuView.model,collection:this.postToolsMenuView.blockedBlogCollection})}.bind(this))},onRender:function(){var e=this.model._commentCollection;e&&e.getSurfacedCommentLength()&&this.ui.reply.addClass("expanded"),this.renderMediaEmbeds(),this.model.get("approved")||this.renderBlurs(),this.renderPostTools(),this.showChildrenView(),this.listenTo(g,"followforblog",function(e){e.id===this.model.id&&this.model.set("approved",!0)}),this._renderDeferred.resolve()},onClickReplyContent:function(t){var s=this.model,o=s.collection,i=o.getDiscussionType(),a=s.get("replyCount");return c.clickedOnLink(t)?0[0]:!!(this.model.get("_surfaced")&&i!==n.discussionTypes.ALL&&a)&&(e.cookie(b)||this._expanded?(this._toggleDescendants(),!1):(this.showWarning(),!1))},onClickEditReply:function(){var e,n=m.addCommentRegion(this.ui.editorPlaceholder),s=this.model;return this.listenToOnce(n,"editor:post:save",function(n){e=t.extend(n.toJSON(),{_surfaced:!0}),this.model.set({display:e.display})}),l().then(function(e){e.editComment(s.get("id"))}),!1},onClickPendingSwitch:function(){return e.cookie(b,!0),this._toggleDescendants(),!1},onClickPendingClose:function(){return this.warningRegion.reset(),!1},onClickImageBlur:function(e){return h.removeImageBlur(e),!1},onClickThawImage:function(t){t.preventDefault(),g.trigger("thawImage",{$el:e(t.target)})},onChangeLiked:function(){this._renderDeferred.done(function(){this.ui.likeIcon.toggleClass("active",this.model.get("liked"))}.bind(this))},onChangeApproved:function(){this._renderDeferred.done(function(){this.ui.reply.toggleClass("reply--unapproved",!this.model.get("approved"))}.bind(this))},onChangeDisplay:function(){this._renderDeferred.done(function(){this.ui.replyContent.html(this.model.get("display"))}.bind(this))},onChangeFlagged:function(){this._renderDeferred.done(function(){var e=this.model.get("flagged");this.ui.reply.toggleClass("reply--flagged",e)}.bind(this))},onDismissed:function(){this.$el.fadeOut()},_toggleDescendants:function(){var e=this.getChildrenView();this.hideWarning(),this._expanded?(e.hideNestedChildren(),this.ui.reply.removeClass("expanded"),this.ui.replyBubbleIcon.removeClass("icon-bubble-round-x").addClass("icon-bubble-round")):(e.showNestedChildren(),this.ui.reply.addClass("expanded"),this.ui.replyBubbleIcon.removeClass("icon-bubble-round").addClass("icon-bubble-round-x")),this._expanded=!this._expanded},showWarning:function(){this.warningRegion.show(new a({warningType:a.warningTypes.THREAD}))},hideWarning:function(){this.warningRegion.reset("hide")},getChildrenView:function(){if(!this._commentListView){var e=require("module/discussion/view/commentList.view"),t=this.model.getChildren();this._commentListView=new e({collection:t})}return this._commentListView},showChildrenView:function(){this.childrenRegion.show(this.getChildrenView())},renderMediaEmbeds:function(){this._gifImageLoader=new r({el:this.el}),v(this.$el)}},{slideAnimationTime:200})}),define("templates/tiger/components/discussion/comment-list",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(e,t,n,s,o){t.components.discussion.commentList=function(e,n,s){var a="",i="commentlist--depth-"+o.$$escapeHtml(e.depth);return a+=("ReplyList"==e.discussionType?'<div class="js_commentlist-wrap--surface"><ul data-analytics-target="groupChat" class="commentlist commentlist--surface js_commentlist--surface '+o.$$escapeHtmlAttribute(i)+'"></ul></div><div class="js_commentlist-wrap--nested" style="display: none"><ul class="commentlist commentlist--nested js_commentlist--nested '+o.$$escapeHtmlAttribute(i)+'"></ul></div>'+(e.depth<2?t.components.discussion.replyFooter(null,null,s):""):'<div class="js_commentlist-wrap--nested" style="display: none"><ul class="commentlist commentlist--nested js_commentlist--nested '+o.$$escapeHtmlAttribute(i)+'"></ul>'+t.components.discussion.replyFooter(null,null,s)+'</div><div class="js_commentlist-wrap--surface"><ul class="commentlist commentlist--surface js_commentlist--surface '+o.$$escapeHtmlAttribute(i)+'"></ul></div>')+(e.depth<1?'<footer class="commentlist__pagination js_commentlist__pagination hide"><a class="js_button--pagination button--pagination icon--svg u-full">Load more'+t.icons.essential.chevronBottomSmall(null,null,s)+'</a></footer><div class="js_spinner-wrap spinner-wrap hide row">'+t.components.spinner.bounce(null,null,s)+"</div>":"")},s.DEBUG&&(t.components.discussion.commentList.soyTemplateName="tiger.components.discussion.commentList"),t.components.discussion.replyFooter=function(e,n,s){return'<footer class="reply-footer-bar js_reply-footer-bar"><a class="discussion__button js_discussion__button js_load-more-replies icon--svg u-full hide">Show more replies'+t.icons.essential.chevronBottomSmall(null,null,s)+'</a><a class="discussion__button js_discussion__button js_load-all-replies icon--svg u-full hide">Show more replies in this thread'+t.icons.essential.chevronBottomSmall(null,null,s)+'</a><a class="discussion__button js_discussion__button js_close-replies icon--svg u-full hide">Collapse replies'+t.icons.essential.chevronTopSmall(null,null,s)+"</a></footer>"},s.DEBUG&&(t.components.discussion.replyFooter.soyTemplateName="tiger.components.discussion.replyFooter")}),define("module/discussion/view/commentList.view",["jquery","backbone.marionette","module/discussion/model/comment.collection","module/discussion/view/comment.layout","singleton/WindowController","templates/tiger/components/discussion/comment-list"],function(e,t,n,s,o){"use strict";var i=t.CompositeView.extend({_expanded:!1,className:function(){return"commentlist-wrap "+this.collection.getDiscussionType().toLowerCase()},itemView:s,template:tiger.components.discussion.commentList,ui:{surfaceList:".js_commentlist--surface",surfaceListWrap:".js_commentlist-wrap--surface",nestedList:".js_commentlist--nested",nestedListWrap:".js_commentlist-wrap--nested",repliesFooter:".js_reply-footer-bar",discussionButtons:".js_discussion__button",loadAllRepliesButton:".js_load-all-replies",loadMoreRepliesButton:".js_load-more-replies",closeRepliesButton:".js_close-replies",paginationContainer:".js_commentlist__pagination",paginationButton:".js_button--pagination",spinner:".js_spinner-wrap"},events:{"click @ui.loadAllRepliesButton":"onClickLoadAllReplies","click @ui.loadMoreRepliesButton":"onClickLoadMoreReplies","click @ui.closeRepliesButton":"onClickCloseReplies","click @ui.paginationButton":"onClickPaginationButton"},collectionEvents:{sync:"onCollectionSync"},serializeData:function(){var e=this.collection;return{depth:e.getDepth(),discussionType:e.getDiscussionType()}},onRender:function(){var e=this.collection,t=e.getDepth();e.hasMore()&&(t>0&&this._toggleButtons(),0===t&&this.showPaginationButton())},appendHtml:function(e,t){var n=t.$el,s=this.collection.getApprovedOnly(),o=t.model.get("_viaEditor")||!1;o?this.ui.surfaceList.prepend(n):(!s||s&&t.model.get("approved"))&&(t.model.get("_surfaced")?this.ui.surfaceList.append(n):this.ui.nestedList.append(n))},_toggleButtons:function(e){var t=this.ui.closeRepliesButton,n=this.ui.loadAllRepliesButton,s=this.ui.loadMoreRepliesButton;this.ui.discussionButtons.addClass("hide"),e?(n.addClass("hide"),t.removeClass("hide"),this.collection.hasMore()&&s.removeClass("hide")):(t.addClass("hide"),s.addClass("hide"),n.removeClass("hide"))},showNestedChildren:function(){var e=this.collection,t=function(){this.ui.nestedListWrap.slideDown(i.slideAnimationTime),this._toggleButtons(!0),this._expanded=!0,this.$el.addClass("expanded")}.bind(this),n=function(){this.listenToOnce(e,"sync",t),e.fetch({remove:!1})}.bind(this);this._expanded?e.hasMore()&&n():e.length&&e.length-e.getSurfacedCommentLength()?t():n()},hideNestedChildren:function(){this.ui.nestedListWrap.slideUp(i.slideAnimationTime),this._toggleButtons(),this._expanded=!1,this.$el.removeClass("expanded"),this.collection.getDiscussionType()===n.discussionTypes.ALL&&e.scrollTo(this.ui.surfaceList,i.slideAnimationTime)},onClickLoadAllReplies:function(){return this.showNestedChildren(),!1},onClickLoadMoreReplies:function(){return this.showNestedChildren(),!1},onClickCloseReplies:function(){return this.hideNestedChildren(),!1},onClickPaginationButton:function(){this.showSpinner(),this.hidePaginationButton(),this.collection.fetch({remove:!1})},onCollectionSync:function(){var t=this.collection;t.hasMore()&&e(this.ui.repliesFooter).length&&this._toggleButtons(),0===t.getDepth()&&(this.hideSpinner(),t.hasMore()?this.showPaginationButton():this.hidePaginationButton())},initializeWaypoint:function(){var e=this.$(".js_spinner-wrap");e.removeClass("hide"),o.registerWaypoint(e,"100%",function(){this._onWaypointReached()}.bind(this))},teardownWaypoint:function(){o.teardownWaypoint(this.$(".js_spinner-wrap"))},_onWaypointReached:function(){var e=this.$(".js_spinner-wrap");o.teardownWaypoint(e),this.collection.fetch({remove:!1}),this.listenToOnce(this.collection,"sync",function(){e.detach(),this.collection.hasMore()&&(this.$el.append(e),this.initializeWaypoint())})},showPaginationButton:function(){this.ui.paginationButton.removeClass("hide"),this.ui.paginationContainer.removeClass("hide")},hidePaginationButton:function(){this.ui.paginationContainer.addClass("hide"),this.ui.paginationButton.addClass("hide")},showSpinner:function(){this.$el.append(this.ui.spinner.removeClass("hide"))},hideSpinner:function(){this.ui.spinner.detach()}},{slideAnimationTime:200});return i}),define("templates/tiger/messages",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(e,t,n,s){t.messages.areYouSureToDisconnect=function(){return"Are you sure you want to disconnect this account?"},s.DEBUG&&(t.messages.areYouSureToDisconnect.soyTemplateName="tiger.messages.areYouSureToDisconnect"),t.messages.settingsSaved=function(){return"Settings saved successfully."},s.DEBUG&&(t.messages.settingsSaved.soyTemplateName="tiger.messages.settingsSaved"),t.messages.confirmationEmail=function(){return"Confirmation email has been sent."},s.DEBUG&&(t.messages.confirmationEmail.soyTemplateName="tiger.messages.confirmationEmail"),t.messages.blogPropertySaved=function(){return"Blog property saved successfully."},s.DEBUG&&(t.messages.blogPropertySaved.soyTemplateName="tiger.messages.blogPropertySaved"),t.messages.blogPropertyCreated=function(){return"Blog property created successfully."},s.DEBUG&&(t.messages.blogPropertyCreated.soyTemplateName="tiger.messages.blogPropertyCreated"),t.messages.blogPropertyDeleted=function(){return"Blog property deleted successfully."},s.DEBUG&&(t.messages.blogPropertyDeleted.soyTemplateName="tiger.messages.blogPropertyDeleted"),t.messages.ownerSet=function(){return"New owner has been set."},s.DEBUG&&(t.messages.ownerSet.soyTemplateName="tiger.messages.ownerSet"),t.messages.cannotDisconnectLoginAccount=function(){return"You cannot disconnect your login account from Kinja. Please switch your login account, save, and try again."},s.DEBUG&&(t.messages.cannotDisconnectLoginAccount.soyTemplateName="tiger.messages.cannotDisconnectLoginAccount"),t.messages.repliesDisabled=function(e,n,s){return'<div class="twelve columns end mbx"><div class="reply-create media"><div class="img mrm icon--svg">'+t.icons.discussion.bubbleClose(null,null,s)+'</div><div class="bd proxima"><span class="msg text-small text-light">This discussion is closed</span></div></div></div>'},s.DEBUG&&(t.messages.repliesDisabled.soyTemplateName="tiger.messages.repliesDisabled"),t.messages.imageUploadError=function(){return"Image upload error."},s.DEBUG&&(t.messages.imageUploadError.soyTemplateName="tiger.messages.imageUploadError"),t.messages.assetRecommended=function(){return"Media recommended."},s.DEBUG&&(t.messages.assetRecommended.soyTemplateName="tiger.messages.assetRecommended"),t.messages.assetUnrecommended=function(){return"Removed media recommendation."},s.DEBUG&&(t.messages.assetUnrecommended.soyTemplateName="tiger.messages.assetUnrecommended"),t.messages.amazonBestSellerReport=function(){return"<p><small>If the blog list is omitted, all blogs will be taken into account. If the limit is set to 0, no limit is set.</small></p>"},s.DEBUG&&(t.messages.amazonBestSellerReport.soyTemplateName="tiger.messages.amazonBestSellerReport"),t.messages.amazonTagReport=function(){return"<p><small>Beware: If the checkbox above is unchecked, Amazon statistics and posts will both be filtered by the date picker. This means that earnings and orders for posts which were published earlier will <strong>not</strong> be shown here.</small></p>"},s.DEBUG&&(t.messages.amazonTagReport.soyTemplateName="tiger.messages.amazonTagReport")}),define("module/discussion/view/loading.view",["backbone.marionette","templates/tiger/components/spinner","templates/tiger/messages"],function(e){"use strict";var t=e.ItemView.extend({template:tiger.components.spinner.bounce});return t}),define("view/behaviors/googleAnalytics.behavior",["jquery","underscore","backbone.marionette","singleton/Utils"],function(e,t,n,s){"use strict";var o=n.Behavior.extend({events:{"click [data-ga]:not(form)":"onGAClick","submit form[data-ga]":"onGASubmit"},onGAClick:function(t){var n,o=e(t.currentTarget),s=o.closest("a[href]").eq(0);return this.logGAEvent(t),s.length&&(n=s.attr("href"),!/^((http|https):)?\/\//.test(n)||"_blank"===s.attr("target")||t.shiftKey||t.ctrlKey||t.metaKey||(t.preventDefault(),window.setTimeout(function(){window.location.href=n},500))),!0},onGASubmit:function(t){var n=e(t.currentTarget),s=n.attr("action"),o=n.serialize();this.logGAEvent(t),t.preventDefault(),window.setTimeout(function(){window.location.href=s+"?"+o},500)},logGAEvent:function(n){var a=e(n.currentTarget),s=a.attr("data-ga").replace(/[[\]]/g,"").split(/\s*,\s*/g),s=s.map(function(e){return t.contains(o.validKeys,e)?o.replacePlaceholder(e):e}),i=["send","event"].concat(s);window.ga.apply(this,i)}},{validKeys:["js_pageType","js_pageUrl"],replacePlaceholder:function(e){var t=s.getKinjaMeta();switch(e=e.replace(/js_/g,"")){case"pageType":return t.pageType;case"pageUrl":return window.location.url;default:return""}}});return o}),define("templates/tiger/components/discussion/applet",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(e,t,n,s,o){t.components.discussion.applet=function(e,n,s){var a="",i=""+(e.replyCount>1?"View all "+o.$$escapeHtml(e.replyCount)+" replies":"View all replies");return a+='<ul class="reply-filters js_reply-filters-container hide"><li class="js_permalink-replies reply-filter reply-filter--permalink js_groupchats__filter sitecolored--hover hide"><a class="tab-author"><span class="js_author-name">'+o.$$escapeHtml(window.kinja.stripHtmlTags(e.permalinkByline,""))+'</span>’s Discussions</a><div class="reply-filter__active-marker icon--svg">'+t.icons.essential.chevronBottom(null,null,s)+'</div></li><li class="js_personalized reply-filter reply-filter--personalized js_groupchats__filter sitecolored--hover hide"><a class="tab-author" data-ga="[Group Chats, click, Author Chat click]"><span class="js_author-name">'+o.$$escapeHtml(window.kinja.stripHtmlTags(e.byline,""))+'</span>’s Discussions</a><div class="reply-filter__active-marker icon--svg">'+t.icons.essential.chevronBottom(null,null,s)+'</div></li><li  class="js_allview reply-filter reply-filter--all js_groupchats__filter sitecolored--hover"><a data-ga="[Group Chats, click, All Replies click, __DEFAULT]" title="'+o.$$escapeHtmlAttribute(i)+'">All replies</a><div class="reply-filter__active-marker icon--svg">'+t.icons.essential.chevronBottom(null,null,s)+'</div></li></ul><div class="js_editor-placeholder js_reply-form-container"></div><div class="js_region--warning"></div><div class="js_flagging-admin-placeholder"></div><div class="js_content-region"></div><div class="js_replycol js_ad300-companion"><div class="js_reply-loading-progress reply-spinner hide">'+t.components.spinner.bounce(null,null,s)+'</div><div class="js_load-more"></div><div class="reply-views js_reply-views hide"><a class="js_author-view-footer js_groupchats__filter personalized icon--svg u-full commentlist__filter-button hide" data-ga="[Group Chats, click, Popular Chat click]">View '+o.$$escapeHtml(e.byline)+"'s discussions"+t.icons.essential.chevronBottomSmall(null,null,s)+'</a><a class="js_allview-footer js_groupchats__filter allview icon--svg u-full commentlist__filter-button hide" data-ga="[Group Chats, click, All Replies click, __DEFAULT]">'+o.$$escapeHtml(i)+t.icons.essential.chevronBottomSmall(null,null,s)+"<a></div></div>"},s.DEBUG&&(t.components.discussion.applet.soyTemplateName="tiger.components.discussion.applet")}),define("module/DiscussionModule",["jquery","underscore","backbone.marionette","model/post/Post","module/discussion/model/comment.collection","module/discussion/model/comment.model","module/discussion/view/commentList.view","module/discussion/view/warning.view","module/discussion/view/loading.view","module/discussion/discussion.channel","module/flagging/ReplyFlaggingModule","view/behaviors/googleAnalytics.behavior","module/discussion/regionManager/discussionRegionManager","singleton/Utils","singleton/Feature","singleton/util/loadEditor","templates/tiger/components/discussion/applet","templates/tiger/components/groupchats/flagging-admin-link"],function(e,t,n,s,o,i,a,r,c,l,d,u,h,m,f,p){"use strict";var g,v,b,j,y,_;return y=new s(m.getKinjaMeta().post),v=new i(y.attributes),g={personalized:{collection:new o([],{parent:v,discussionType:o.discussionTypes.PERSONALIZED,approvedOnly:!0}),onFacetShow:function(){}},allApproved:{collection:new o([],{parent:v,discussionType:o.discussionTypes.ALL,approvedOnly:!0}),onFacetShow:function(){this.warningRegion.show(new r({warningType:r.warningTypes.COMPLETE,noReplies:0===b.collection.length})),b.collection.loadFlaggedCommentCount().done(function(){var e=d.flagCount(),t={flagCount:e,blogName:m.getKinjaMeta().blog.name},s=n.Renderer.render(tiger.components.groupchats.flaggingAdminLink,t);e>0&&this.ui.flaggingAdminPlaceholder.append(s)}.bind(this))}},allUnapproved:{collection:new o([],{parent:v,discussionType:o.discussionTypes.ALL,approvedOnly:!1}),onFacetShow:function(){var e=new r({warningType:r.warningTypes.COMPLETE,noReplies:0===b.collection.length});this.warningRegion.show(e),e.toggleFilter()}}},new(_=n.Layout.extend({showFacet:function(e,t){var s,n=e.collection;b=e,f.isOn("delaydiscussion")&&this.contentRegion.show(new c),this.toggleFooterLinks(),s=function(){this.contentRegion.show(new a({collection:b.collection})),b.onFacetShow.call(this),this.toggleFooterLinks()}.bind(this),t&&(this.warningRegion.reset(),this.ui.flaggingAdminPlaceholder.html(""),n.length||n._hasFirstFetched?s():(n.fetch(),this.contentRegion.reset(),this.listenToOnce(n,"sync",s)))},regions:{contentRegion:".js_content-region",warningRegion:".js_region--warning:first"},ui:{replyFilterContainer:".js_reply-filters-container",filterButtons:".js_groupchats__filter",personalizedRepliesButton:".js_personalized",allRepliesButton:".js_allview",permalinkRepliesButton:".js_permalink-replies",disabledReplies:".js_disabled-replies",spinner:".js_loading-layer",editorPlaceholder:".js_editor-placeholder",flaggingAdminPlaceholder:".js_flagging-admin-placeholder",footerButtonsContainer:".js_reply-views",authorViewFooter:".js_author-view-footer",allViewFooter:".js_allview-footer"},events:{"click @ui.filterButtons":"onClickFilter","click .js_pending-reply-switch":"onClickPendingSwitch"},behaviors:{GoogleAnalyticsBehavior:{behaviorClass:u}},template:tiger.components.discussion.applet,className:"replies-wrapper",initialize:function(){var n=m.getKinjaMeta(),t=n.postId;m.isCommentPermalinkPage()&&(j=new i({id:t}),g.permalink={collection:new o([],{discussionType:o.discussionTypes.PERMALINK,parent:v,permalinkComment:j,approvedOnly:!1}),onFacetShow:function(){var n=this.$el.find(".reply[data-id="+t+"]").addClass("anchor");n.length&&e.scrollTo(n,250,{offset:-20})}}),this.listenTo(this.contentRegion,"close",function(){this.contentRegion.show(new c)}),this.listenTo(this.contentRegion,"show",function(e){var t=e.collection;t&&this.$el.parent().css({"min-height":this.$el.outerHeight()})})},_initializeFallbacks:function(){var t,e=[g.allApproved];j?(e.unshift(g.permalink),this.ui.personalizedRepliesButton.remove()):(e.unshift(g.personalized),this.ui.permalinkRepliesButton.remove()),(t=function(){var s,n=e.shift();n&&(s=n.collection,this.listenToOnce(s,"sync",function(){this.showFacet(n,!0),s.hasMore()||s.length?(n.$button.removeClass("hide").addClass("active"),this.ui.replyFilterContainer.removeClass("hide")):(n.$button.remove(),n.$footerButton.remove(),t())}),s.fetch({reset:!0}))}.bind(this))()},replyToStarterPost:function(){var e,n=h.addCommentRegion(this.ui.editorPlaceholder);this.listenToOnce(n,"editor:post:save",function(n){e=t.extend(n.toJSON(),{_surfaced:!0,_viaEditor:!0}),this.contentRegion.currentView.collection.unshift(e),l.trigger("newComment",{comment:e})}),p().then(function(e){e.createComment(v)})},onClickFilter:function(t){var n,o,s=t.currentTarget.className;if(t.preventDefault(),-1===s.indexOf("active")){if(this.contentRegion.currentView.teardownWaypoint(),-1!==s.indexOf("personalized"))n=g.personalized;else if(-1!==s.indexOf("allview"))n=g.allApproved;else{if(-1===s.indexOf("permalink-replies"))return;n=g.permalink}o=n.collection,this.ui.filterButtons.removeClass("active"),n.$button.addClass("active"),e.scrollTo(this.$el,250,{offset:-100}),this.showFacet(n,!0)}},onClickPendingSwitch:function(t){var n,o,s=b.collection;return t.preventDefault(),s===g.allApproved.collection?n=g.allUnapproved:s===g.allUnapproved.collection&&(n=g.allApproved),o=n.collection,this.showFacet(n,!0),e.scrollTo(this.$el,250,{offset:-50}),!1},onRender:function(){t.extend(g.personalized,{$button:this.ui.personalizedRepliesButton,$footerButton:this.ui.authorViewFooter}),t.extend(g.allApproved,{$button:this.ui.allRepliesButton,$footerButton:this.ui.allViewFooter}),t.extend(g.permalink,{$button:this.ui.permalinkRepliesButton,$footerButton:this.ui.allViewFooter}),this._initializeFallbacks(),this.listenToOnce(this.contentRegion,"show",function(){this.listenToOnce(g.personalized.collection,"pagination:done",this.toggleFooterLinks).listenToOnce(g.allApproved.collection,"pagination:done",this.toggleFooterLinks).listenToOnce(g.allUnapproved.collection,"pagination:done",this.toggleFooterLinks),g.permalink&&this.listenToOnce(g.permalink.collection,"pagination:done",this.toggleFooterLinks)})},toggleFooterLinks:function(){var e=b.collection,t=e._hasFirstFetched&&!e.hasMore();this.ui.footerButtonsContainer.addClass("hide"),this.ui.allViewFooter.addClass("hide"),this.ui.authorViewFooter.addClass("hide"),t&&e.length&&(this.ui.footerButtonsContainer.removeClass("hide"),e.getDiscussionType()===o.discussionTypes.ALL?this.ui.authorViewFooter.removeClass("hide"):this.ui.allViewFooter.removeClass("hide"))},serializeData:function(){var e=v.get("byline")||v.get("author").displayName;return{byline:e,permalinkByline:e,permalink:v.get("permalink"),replyCount:v.get("replyCount")}}}))})