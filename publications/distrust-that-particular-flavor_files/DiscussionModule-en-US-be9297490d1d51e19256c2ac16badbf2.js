if("undefined"==typeof tiger)var tiger={};"undefined"==typeof tiger.components&&(tiger.components={}),"undefined"==typeof tiger.components.discussion&&(tiger.components.discussion={}),"undefined"==typeof tiger.components.forms&&(tiger.components.forms={}),"undefined"==typeof tiger.components.forms.modals&&(tiger.components.forms.modals={}),"undefined"==typeof tiger.components.groupchats&&(tiger.components.groupchats={}),"undefined"==typeof tiger.components.invites&&(tiger.components.invites={}),"undefined"==typeof tiger.components.invites.menuItems&&(tiger.components.invites.menuItems={}),"undefined"==typeof tiger.components.invites.modals&&(tiger.components.invites.modals={}),"undefined"==typeof tiger.components.post&&(tiger.components.post={}),"undefined"==typeof tiger.components.post.meta&&(tiger.components.post.meta={}),"undefined"==typeof tiger.components.spinner&&(tiger.components.spinner={}),"undefined"==typeof tiger.icons&&(tiger.icons={}),"undefined"==typeof tiger.icons.essential&&(tiger.icons.essential={}),"undefined"==typeof tiger.messages&&(tiger.messages={}),"undefined"==typeof tiger.messages.postAction&&(tiger.messages.postAction={}),define("apiclient/post",["config","apiclient/apirequest","apiclient/gettoken","singleton/Feature"],function(o,t,e,n){"use strict";var i,s=n.isOn("postsecuretoken")?o.api.core.secureUrl+"/post":o.api.core.url+"/post";return i={create:t.postJson(e.append(s+"/add",n.isOn("postsecuretoken")?e.secure:e.fresh,!0)),read:t.getJson(e.append(s+"/preview/{{id}}",n.isOn("postsecuretoken")?e.secure:e.fresh)),update:t.postJson(e.append(s+"/{{id}}/update",n.isOn("postsecuretoken")?e.secure:e.fresh,!0)),delete:t.postJson(e.append(s+"/{{id}}/delete",n.isOn("postsecuretoken")?e.secure:e.fresh,!0)),generatePostJson:function(o){return t.postJson(e.append(s+o,n.isOn("postsecuretoken")?e.secure:e.fresh,!0))},socialStats:t.getJson(o.api.core.url+"/dfp/post/{{id}}/stats")}}),define("model/post/Post",["config","jquery","backbone","underscore","singleton/CurrentUser","singleton/Utils","apiclient/gettoken","apiclient/post"],function(a,e,o,t,i,u,c,d){"use strict";var n=e("<div />"),l=function(e){var s,t=e.getHours(),n=e.getMinutes(),o=e.getMonth()+1+"/"+e.getDate()+"/"+e.getFullYear();return 10>t&&(t="0"+t),10>n&&(n="0"+n),s=t+":"+n,{MdyHm:[o,s].join(" ")}},s={dateTimeFormat:/^\d{1,2}\/\d{1,2}\/\d{4} \d{1,2}:\d{2}$/,chompImgType:/img\.gawkerassets\.com\/img\/(\w+)\/[\w-]+\./g},r=o.Model.extend({constructor:function(e){window.__postModelStorage=window.__postModelStorage||{};var t,s,n=window.__postModelStorage,i=void 0!==e&&void 0!==e.id&&void 0!==n,a={};if(i&&void 0!==n[e.id]){for(t in e)e.hasOwnProperty(t)&&null!==e[t]&&(a[t]=e[t]);return s=n[e.id],s.set(a),s}o.Model.prototype.constructor.apply(this,arguments),i&&(n[e.id]=this)},initialize:function(){s=e.extend(s,{mediaInPost:new RegExp("<("+this.mediaTags.join("|")+")","gim")})},storeInMemory:function(){var e=window.__postModelStorage||{},t=void 0!==this.id&&void 0!==e;return t&&void 0!==e[this.id]?e[this.id].set(this.attributes):e[this.id]=this,this},mediaTags:["img","embed","object","iframe","video","audio","canvas"],defaults:{promoteState:{},publishTime:l(new Date),blogs:new o.Collection,liked:!1},validationRules:{PUBLISHTIME_IS_REQUIRED:function(e){var t=!0;return"SCHEDULED"!==e.status||e.publishTimeMillis||(t=!1),t},POST_CONTENT_IS_REQUIRED:function(t){var o=!0,i=t.headline&&e.trim(n.html(t.headline)),a=t.original&&e.trim(n.html(t.original).text()),r=t.original&&(s.mediaInPost.test(t.original)||n.html(t.original).find("img").length),c=t.hasFile||t.files&&t.files.length;return i||a||r||c||(o=!1),o},POST_CONTENT_CANNOT_CONTAIN_BAD_CONTENT:function(t){var e=!0,s=["form"].join("");return n.html(t.original).find(s).length&&(e=!1),e}},savePipeline:e.Deferred().resolve(),publishTime:function(e){return l(e)},sync:function(r,n,s){var o,i,a,l,u,h;if("create"!==r&&(void 0===n.id||null===n.id))throw new Error("Post.sync(): Model undefined");switch(n.attributes.meta={},"undefined"!=typeof n.attributes.status&&(n.attributes.meta.status=n.attributes.status),"undefined"!=typeof n.attributes.allowReplies&&(n.attributes.meta.allowReplies=n.attributes.allowReplies),"undefined"!=typeof n.attributes.showByline&&(n.attributes.meta.showByline=n.attributes.showByline),"undefined"!=typeof n.attributes.byline&&(n.attributes.meta.byline=n.attributes.byline),"undefined"!=typeof n.attributes.properties&&(n.attributes.meta.properties=n.attributes.properties),r){case"create":i="POST",a=n.has("parentId")&&""!==n.get("parentId")?"/api/core/post/"+n.get("parentId")+"/jsonReplyWithApproval":"/api/core/post/add",u=JSON.stringify(n);break;case"read":i="GET",a=void 0!==s.preview&&s.preview===!0?"/api/core/post/preview/"+n.id:void 0!==s.showcase&&s.showcase===!0?"/api/core/post/showcase/"+n.id:"/api/core/post/"+n.id;break;case"update":i="POST",a="/api/core/post/"+n.id+"/update",u=JSON.stringify(n);break;case"delete":i="POST",a="/api/core/post/"+n.id+"/delete"}return l={type:i,dataType:"json",contentType:"application/json",url:a,data:u||null},o=e.Deferred(),h=o.promise(),c.secure().done(function(i){l.url=l.url+"?token="+i,"delete"===r?d[r]({id:n.id},s).done(o.resolve).fail(o.reject):e.ajax(t.extend(l,s)).done(o.resolve).fail(o.reject)}),h},parse:function(t){if(void 0===t)throw new Error("Post.parse(): no response to parse");var e={};return e=t.data?t.data:t,void 0!==e.id&&null!==e.id&&(e.id=parseInt(e.id,10)),e.tagDescriptions=e.tags.map(function(e){return e.description}),e.images&&e.images.length&&(e.images=[]),e},toFormData:function(){var n=["id","headline","original","tags","publishTimeMillis","publishTimeZone","status","blogId","defaultBlogId","annotation.annotationType","annotation.imageUrl","annotation.imageChompId","annotation.imageWidth","annotation.imageHeight","annotation.x","annotation.y","annotation.annotationText","annotation.annotationTextHash","allowReplies","sponsored","showByline","byline","salesAvatar","salesAvatarMap","share","properties","shareBlogId","sharedPostId","images","parentId","adZone"],e=["status","allowReplies","showByline","byline","properties"],s=function(s){var n=s[0],o=s[1];return-1!==t.indexOf(e,n)&&(n="meta."+n),[n,o]},o=t.pick(this.toJSON(),t.union(n,t.map(e,function(e){return"meta."+e}))),i=t.object(t.pairs(o).map(s));return i},getUrl:function(){return void 0!==this.get("permalink")?this.get("permalink"):"/"+this.id},getActionState:function(){var t=e.Deferred();return this.has("actionState")?t.resolve():this.getPostInfo().done(function(){t.resolve()}),t.promise()},getPostInfo:function(t){var n,s=this,o=parseInt(this.id,10);if(!i.isLoggedIn())throw new Error("Post.getPostInfo(): user not logged in");return t=t||{},t.success=t.success||function(){},n=[a.api.core.url,"/post/",o,"/actionstatus?token=",i.get("token")].join(""),e.ajax({type:"GET",dataType:"jsonp",jsonp:"jsonp",url:n,success:function(e){200===e.meta.status&&(s.setActionState(e.data),t.success.call(s))}})},isPublished:function(){return"PUBLISHED"===this.get("status")},setAction:function(e,t,n){var s,o={};if(!e||"repost"!==e&&"dismiss"!==e&&"actionreset"!==e)throw new Error("Post:setAction(): Invalid post action: "+e);if(!t)throw new Error("Post:setAction(): Invalid blogId: "+t);return s="repost"===e?a.api.core.url+"/post/"+this.id+"/"+e+"/"+t:"/ajax/post/"+this.id+"/"+e+"/"+t,"repost"===e&&n.publishTimeMillis&&(o.repostTime=n.publishTimeMillis),this.setLikeOrAction(n,e,s,o)},setLikeOrAction:function(t,a,r,s){var n,o,l,d;return t=t||{},s=s||{},t.success=t.success||function(){},t.error=t.error||function(){},i.isLoggedIn()||t.error.call(this,{reason:"user"}),o=e.Deferred(),d=o.promise(),n=this,c.fresh().done(function(i){s.token=i,l="repost"===a?{url:r+"?"+e.param(s),type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:"{}"}:{url:r+"?"+e.param(s),type:"POST"},e.ajax(l).done(function(e){void 0!==e.meta?"repost"===a||"dismiss"===a||"actionreset"===a?(n.setActionState(e.data),t.success.call(n,{response:e.data})):(n.setLikeState(e.data),t.success.call(n,{response:e.data})):t.error.call(n,{reason:"action error"}),o.resolve()}).fail(function(e){t.error.call(this,e.responseJSON,e.status,e.statusText),o.reject(e.responseJSON,e.status,e.statusText)})}),d},setActionState:function(n){var e={};t.each(n,function(t){e[t.blogId]=t.relation.toLowerCase()},this),this.set({actionState:e})},setLike:function(e,s){var n,o=["like","unlike"];if(!e||!t.contains(o,e))throw new Error("Post:setLike(): Invalid post action: "+e);return"like"===e&&(e+="AndApprove"),n="likeAndApprove"!==e?["/api/core/post",this.id,e].join("/"):["/ajax/post",this.id,e].join("/"),this.setLikeOrAction(s,e,n)},setLikeState:function(n){var e=n||{},t=e.like||e;void 0!==t.objectId&&t.objectId===this.get("id")?this.set({liked:!0}):this.set({liked:!1})},prepareAnnotations:function(){if(this.has("annotation")){var t=this.get("annotation"),n=e().text(t.annotationText),s=170;void 0===t.annotationShortText&&n.length>s&&(t.annotationShortText=u.cut(n,s))}return this},parseFromDom:function(e){var t=JSON.parse(decodeURIComponent(e.data("model")));return new r(t)},replaceImagesWithOriginal:function(){var e=this.get("display");return this.set("display",e.replace(s.chompImgType,"img.gawkerassets.com/img/$1/original.")),this},validate:function(){var e=[],n=this.toJSON();return n.mode&&t.each(this.validationRules,function(t,s){t(n)||e.push({error:"CLIENT_VALIDATION_ERROR",reason:s})},this),!!e.length&&e},getShareOptionsForUser:function(o){var i=e.Deferred(),n=[],a=[],r=[],s=o.get("defaultBlogId"),c=!1;return this.getActionState().done(function(){t.each(this.get("actionState"),function(e,t){"repost"===e&&n.push(parseInt(t,10))}),c=-1!==t.indexOf(n,s),o.get("membership").each(function(e){e.get("blogId")===s||"ENABLED"!==e.get("blog").status&&"SPAM"!==e.get("blog").status||(-1!==t.indexOf(n,e.get("blog").id)?r.push({name:e.get("blog").displayName,id:e.get("blog").id}):a.push({name:e.get("blog").displayName,id:e.get("blog").id}))},this),i.resolve({repostedTo:n,repostedToPersonal:c,personalBlogId:s,blogsUndo:r,blogsRepost:a})}.bind(this)),i.promise()}});return r}),define("collection/PaginationCollection",["backbone"],function(e){"use strict";var t=e.Collection.extend({_stepIndex:0,_stepSize:10,_doneStepping:!1,constructor:function(t,n){t=t||[],n=n||{},e.Collection.prototype.constructor.call(this,t,n)},_incrementStep:function(){this._stepIndex+=this._stepSize},_checkDone:function(t){var e=this.parse(t);return!e||!e.length},getStepIndex:function(){return this._stepIndex},getStepSize:function(){return this._stepSize},hasMore:function(){return!this._doneStepping},disablePagination:function(){this._doneStepping=!0}});return t}),define("module/discussion/model/comment.model",["underscore","backbone","model/post/Post"],function(n,s,e){"use strict";var t=e.extend({initialize:function(){e.prototype.initialize.call(this),this.on("change:approved",this.approveAncestors)},setLike:function(t,s){var n=e.prototype.setLike.call(this,t,s);return("like"===t||"unlike"===t)&&n.done(function(){this.trigger("discussion:comment:likestatechanged",this.get("id"),t)}.bind(this)),n},parse:function(e){return e=e||{},t.addDiscussionId(e,{commentModel:this})},constructor:function(e,t){s.Model.prototype.constructor.call(this,e,t),this.cid=e._discussionId},_commentCollection:null,getChildren:function(){if(!this._commentCollection){var t=require("module/discussion/model/comment.collection"),e=this.collection;this._commentCollection=new t([],{parent:this,approvedOnly:e.getApprovedOnly(),parentDepth:e.getDepth(),discussionType:e.getDiscussionType()})}return this._commentCollection},getParent:function(){var e=function(n,s){var t,o;return(o=n.findWhere({id:s}))||(t=n.getParent(),t&&t.collection?e(t.collection,s):null)};return this.collection&&this.get("parentId")?e(this.collection,this.get("parentId")):null},approveAncestors:function(){for(var e=this.getParent();e;)e.set("approved",!0),e=e.getParent()}},{addDiscussionId:function(o,t){var e,s;return t.hasOwnProperty("discussionType")?s=t.discussionType:t.hasOwnProperty("commentModel")&&(e=t.commentModel,e.collection?s=e.collection.getDiscussionType():e._parent&&e._parent.collection&&(s=e._parent.collection.getDiscussionType())),n.extend(o,{_discussionId:s+"_"+o.id})}});return t}),define("templates/tiger/components/groupchats/flagreason",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(n,e,s,t){e.components.groupchats.flagreason=function(n,s,t){return'<form><label class="reason-head">Why are you flagging this?<a class="icon" href="http://help.gawker.com/customer/portal/articles/1726140-what-is-flagging-?b_id=5895" target="_blank">'+e.icons.actions.information(null,null,t)+'</a></label><div class="row radio-cont"><div class="column small-12 js_error hide proxima"><small class="warningmessage">Please select a reason</small></div><div class="columns small-12"><label><input type="radio" name="reason" value="HARASSMENT">It\'s harassment</label></div></div><div class="row radio-cont"><div class="columns small-12"><label><input type="radio" name="reason" value="HATE_SPEECH">It\'s hate speech</label></div></div><div class="row radio-cont"><div class="columns small-12"><label><input type="radio" name="reason" value="SPAM">It\'s spam</label></div></div><div class="flag-reason-ctas"><a class="button secondary tiny cancel js_cancel">Cancel</a><a class="button primary tiny submit js_submit">Save</a></div></form>'},t.DEBUG&&(e.components.groupchats.flagreason.soyTemplateName="tiger.components.groupchats.flagreason")}),define("module/flagging/view/FlagReasonDropdown",["backbone.marionette","templates/tiger/components/groupchats/flagreason"],function(e){"use strict";var t=e.ItemView.extend({template:tiger.components.groupchats.flagreason,className:"flag-reason-dropdown js_flagreason",events:{submit:"submit",click:"preventPropagation","click .js_cancel":"cancel","click .js_submit":"submit"},initialize:function(){},preventPropagation:function(e){e.stopPropagation()},cancel:function(){this.trigger("flagreason:cancel")},submit:function(t){t.preventDefault();var e=this.$('input[name="reason"]:checked').val();return e?this.trigger("flagreason:submit",this,e):this.$(".js_error").removeClass("hide"),!1}});return t}),define("templates/tiger/components/forms/modals/flagreason",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(n,e,s,t){e.components.forms.modals.flagreason=function(){return'<div class="show-for-medium-down flag-reason-mobile"><ul class="sticky-modal-options"><li class="js_reason-harassment" data-reason="HARASSMENT">It\'s harassment</li><li class="js_reason-hate-speech" data-reason="HATE_SPEECH">It\'s hate speech</li><li class="js_reason-spam" data-reason="SPAM">It\'s spam</li></ul><footer class="row"><div class="column small-12"><input type="button" class="button tiny secondary js_cancel" tabindex="5" value="Cancel" /></div></footer></div>'},t.DEBUG&&(e.components.forms.modals.flagreason.soyTemplateName="tiger.components.forms.modals.flagreason")}),define("module/flagging/view/FlagReasonModal",["jquery","backbone.marionette","templates/tiger/components/forms/modals/flagreason"],function(e,t){"use strict";var n=t.ItemView.extend({template:tiger.components.forms.modals.flagreason,tagName:"form",events:{submit:"submit","click .js_cancel":"cancel","click .js_reason-harassment":"selectReason","click .js_reason-hate-speech":"selectReason","click .js_reason-spam":"selectReason"},cancel:function(){this.trigger("flagreason:cancel")},selectReason:function(n){var t=e(n.target).attr("data-reason");if(!t)throw new Error("Empty reason code for reason!");this.trigger("flagreason:submit",this,t)}});return n}),define("apiclient/flagging",["config","apiclient/apirequest","apiclient/gettoken"],function(e,t,n){"use strict";var s={flagPost:function(t){return t.reason?e.api.core.url+"/post/{{postId}}/flag?reason={{reason}}":e.api.core.url+"/post/{{postId}}/flag"},unflagPost:function(t){return t.reason?e.api.core.url+"/post/{{postId}}/unflag?reason={{reason}}":e.api.core.url+"/post/{{postId}}/unflag"}},o={getPosts:t.getJson(n.append(e.api.core.url+"/post/{{starterId}}/flaggedposts")),getCount:t.getJson(n.append(e.api.core.url+"/post/{{starterId}}/flaggedcount")),flagPost:t.postJson(n.append(s.flagPost)),unflagPost:t.postJson(n.append(s.unflagPost)),getBlogCount:t.getJson(n.append(e.api.core.url+"/blog/{{blogId}}/flaggedcount")),resolveFlag:t.postJson(n.append(e.api.core.url+"/post/{{postId}}/resolve")),unresolveFlag:t.postJson(n.append(e.api.core.url+"/post/{{postId}}/unresolve"))};return window.__karma__&&(o.__testonly__={urls:s}),o}),define("templates/tiger/components/groupchats/flagging-admin-link",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(s,e,o,n,t){e.components.groupchats.flaggingAdminLink=function(e){return"<div class=\"flagging-admin-link proxima\"><a onClick=\"window.ga('send', 'event', 'On-Page Flagging', 'click', 'Click into moderation queue');\" href=\"https://kinja.com/manage/"+t.$$escapeHtmlAttribute(e.blogName)+'/flagged">Moderate Flagged Replies ('+t.$$escapeHtml(e.flagCount)+")</a></div>"},n.DEBUG&&(e.components.groupchats.flaggingAdminLink.soyTemplateName="tiger.components.groupchats.flaggingAdminLink")}),define("module/flagging/ReplyFlaggingModule",["jquery","underscore","singleton/Feature","singleton/CurrentUser","singleton/Utils","singleton/WindowController","module/flagging/view/FlagReasonDropdown","module/flagging/view/FlagReasonModal","app/modal/modal.controller","apiclient/flagging","templates/tiger/components/groupchats/flagging-admin-link"],function(s,n,a,t,d,r,c,l,i,o){"use strict";var e={flaggedReplies:null,flaggedRepliesLoaded:s.Deferred(),flagCount:null,flagCountLoaded:s.Deferred(),tokenRenewed:!1,reasonDropdown:void 0,reasonModal:void 0,_loadFlaggedReplies:function(s){var n=this,i=function(i,o){n.flaggedReplies=[],o&&o.success===!0?(n.flaggedReplies=i.map(function(e){return e.postId}),n.flaggedRepliesLoaded.resolve()):o&&"InvalidSessionToken"===o.type&&e.tokenRenewed===!1?(e.tokenRenewed=!0,t.token().done(function(){e._loadFlaggedReplies(s)})):n.flaggedRepliesLoaded.reject()};o.getPosts({starterId:s}).done(i)},_loadFlagCount:function(t){var e=this,n=function(n,t){t&&t.success===!0&&(e.flagCount=Number(n)),e.flagCountLoaded.resolve()};o.getCount({starterId:t}).done(n)},_mergePostModelWithFlagInfo:function(e){var t=e.get("id");n.contains(this.flaggedReplies,t)&&e.set({allowReplies:!1,flagged:!0})},_postStatus:function(e){return 0!==e.parents(".all-threads").length?e.parents(".js_reply").hasClass("reply--unapproved")?"Pending":"Approved":"Featured"},_flagPost:function(u,t,i){var l,d,s=t.get("flagged")===!0,r=t.get("id"),c=s?"Unflag":"Flag",h=e._postStatus(u);t.get("flaggingInProgress")===!0&&n.isUndefined(e.reasonDropdown)||(t.set({flaggingInProgress:!0}),d=a.isOn("extendedflag")&&!n.isUndefined(i)&&"Flag"===c?c+" - "+i.toLowerCase():c,window.ga("send","event","On-Page Flagging",d,"Reply status: "+h),l=s?o.unflagPost({postId:r,reason:i}):o.flagPost({postId:r,reason:i}),l.done(function(n,e){void 0!==e&&e.success===!0&&(t.set({flagged:!s,allowReplies:s,flaggingInProgress:!1}),this._syncFlaggedReplies(!s,r))}.bind(this)))},_syncFlaggedReplies:function(t,s){null!==e.flaggedReplies&&(t?e.flaggedReplies.push(s):e.flaggedReplies=n.reject(e.flaggedReplies,function(e){return e===s})),null!==e.flagCount&&(t?e.flagCount++:e.flagCount--)},_showDropdownReasonSelection:function(n,o){var t,i;e._hideReasonDropdown(),e.reasonDropdown=new c({$reply:n,model:o}),e.reasonDropdown.on("flagreason:submit",e._handlePostFlagFromDropdown),e.reasonDropdown.on("flagreason:cancel",e._hideReasonDropdown),e.reasonDropdown.render(),o.set({flaggingInProgress:!0}),e.reasonDropdown.$el.appendTo(n),t=e.reasonDropdown.$el,s(window).scrollTop()+window.innerHeight-t.height()<t.offset().top&&(i=t.offset().top-t.height(),s("body").scrollTo(i,{duration:"slow"}))},_showModalReasonSelection:function(t,n){e.reasonModal=new l({$reply:t,model:n}),e.reasonModal.on("flagreason:cancel",function(){i.close()}),e.reasonModal.on("flagreason:submit",e._handlePostFlagFromModal),i.create(e.reasonModal,{name:"flagreason",className:"reveal-modal kinja-modal sticky-modal bottom full-width"})},_handlePostFlagFromDropdown:function(t,s){var n=t.model;t.$("a,input").addClass("disabled"),n.once("change:flagged",e._hideReasonDropdown),e._flagPost(t.options.$reply,n,s)},_handlePostFlagFromModal:function(t,s){var n=t.model;t.$("a,input").addClass("disabled"),n.once("change:flagged",function(){i.close()}),e._flagPost(t.options.$reply,n,s)},_hideReasonDropdown:function(){n.isUndefined(e.reasonDropdown)||(e.reasonDropdown.options.model.set({flaggingInProgress:!1}),e.reasonDropdown.remove(),e.reasonDropdown=void 0)},API:{flaggedRepliesLoaded:function(){return e.flaggedRepliesLoaded},flagCountLoaded:function(){return e.flagCountLoaded},flaggedReplies:function(){return e.flaggedReplies},flagCount:function(){return e.flagCount},openFlagView:function(n,s){t.requireLogin("flagPost").done(function(){r.isSmall()?e._showModalReasonSelection(n,s):e._showDropdownReasonSelection(n,s)})},unflag:function(n,s){t.requireLogin("unflagPost").done(function(){e._flagPost(n.view.$el,s)})},loadFlaggedReplies:function(n){t.onAuth.done(function(){t.isLoggedIn()&&e._loadFlaggedReplies(n)})},loadFlagCount:function(n){t.onAuth.done(function(){var s=d.getKinjaMeta().blog.id;t.isLoggedIn()&&(t.isSuperuser()&&a.isOn("superuser")||t.hasRole("OWNER",s)||t.hasRole("ADMIN",s))?e._loadFlagCount(n):e.flagCountLoaded.reject()})},extendPostModel:function(t){e.flaggedRepliesLoaded.done(function(){e._mergePostModelWithFlagInfo(t)})}}};return window.__karma__&&(e.API.__testonly__=e),e.API}),define("apiclient/discussion",["underscore","config","apiclient/apirequest","apiclient/gettoken","singleton/Feature","singleton/Utils"],function(c,d,o,r,e,s){"use strict";var t,a,l,n=d.api.core.url,u=e.isOn("superuser"),i=window.parseInt(e.value("discussion_truncation")||0,10);return a={personalized:n+"/reply/{{postId}}/replies/qi/combined/userfilter/activity",nextPersonalized:n+"/reply/{{parentId}}/replies",all:n+"/reply/{{postId}}/replies",nextAll:n+"/reply/{{parentId}}/replies/flat",permalink:n+"/reply/{{postId}}/replies/qi/combined/userfilter/activity",nextPermalink:n+"/reply/{{parentId}}/replies"},t=c.mapObject(a,function(e){return u?r.append(e,r.fresh):e}),l={getPersonalizedReplies:o.getJson(t.personalized,{query:"",currentBlogId:0,refId:0,maxReturned:i||25,includedAdmins:!0,removeDismissed:!0,cache:!!e.isOn("cachecomments")&&s.shouldGetCached}),getNextPersonalizedReplies:o.getJson(t.nextPersonalized,{currentBlogId:0,startIndex:0,startTime:0,maxReturned:20,withLikeCounts:!1,cache:!!e.isOn("cachecomments")&&s.shouldGetCached}),getAllReplies:o.getJson(t.all,{currentBlogId:0,startIndex:0,maxReturned:i||10,withLikeCounts:!0,maxChildren:4,approvedChildrenOnly:!0,approvedStartersOnly:!0,cache:!!e.isOn("cachecomments")&&s.shouldGetCached}),getNextAllReplies:o.getJson(t.nextAll,{currentBlogId:0,startIndex:4,maxReturned:20,approvedChildrenOnly:!0,approvedStartersOnly:!0,cache:!!e.isOn("cachecomments")&&s.shouldGetCached()}),getPermalinkReplies:o.getJson(t.permalink,{query:"",refId:0,currentBlogId:0,maxReturned:i||25,sort:"chrono",removeDismissed:!0,cache:!!e.isOn("cachecomments")&&s.shouldGetCached}),getNextPermalinkReplies:o.getJson(t.nextPermalink,{currentBlogId:0,startIndex:0,startTime:0,maxReturned:20,withLikeCounts:!1,cache:!!e.isOn("cachecomments")&&s.shouldGetCached})}}),define("apiclient/likestate",["config","apiclient/apirequest","apiclient/gettoken"],function(e,t,n){"use strict";var s;return s={getForPosts:t.getJson(n.append(e.api.core.url+"/like/status"),{}),getForStarter:t.getJson(n.append(e.api.core.url+"/like/{{starterId}}"),{})}}),define("module/discussion/model/comment.collection",["jquery","underscore","collection/PaginationCollection","module/discussion/model/comment.model","module/flagging/ReplyFlaggingModule","singleton/CurrentBlog","singleton/CurrentUser","singleton/Utils","apiclient/discussion","apiclient/likestate"],function(c,t,l,i,s,n,a,r,o,d){"use strict";var e=l.extend({_hasFirstFetched:!1,_stepIndex:0,_stepSize:100,_incrementStep:function(t){var s=this.getDiscussionType(),n=this.getDepth();s!==e.discussionTypes.ALL?1>n?this._stepIndex=t.data.pagination.next.refId:this._stepIndex=t.data.pagination.next.startIndex:1>n?this._stepIndex=t.data.pagination.next.startIndex:this._stepIndex+=t.data.items[0].children.items.length},_checkDone:function(t){var n,s;return this.getDiscussionType()!==e.discussionTypes.ALL?!t.data.hasOwnProperty("pagination")||!t.data.pagination.hasOwnProperty("next"):this.getDepth()<1?!t.data.hasOwnProperty("pagination")||!t.data.pagination.hasOwnProperty("next"):(n=this._stepIndex+t.data.items[0].children.items.length,s=this.getApprovedOnly()?this._approvedCount:t.data.items[0].reply.replyCount,!(s>n))},_parent:null,_permalinkComment:null,_depth:0,_discussionType:"",_approvedOnly:!0,_approvedCount:0,model:i,initialize:function(n,t){this._discussionType=t.discussionType,t.hasOwnProperty("parent")&&(this._parent=t.parent),t.hasOwnProperty("permalinkComment")&&(this._permalinkComment=t.permalinkComment),t.hasOwnProperty("parentDepth")&&(this._depth=t.parentDepth+1),t.hasOwnProperty("approvedOnly")&&!t.approvedOnly&&(this._approvedOnly=!1),this._discussionType===e.discussionTypes.ALL&&this.getDepth()>0&&(this._stepIndex=4),this.listenTo(this,"sync",function(){this._hasFirstFetched=!0,this.loadLikedComments(),this.loadFlaggedComments()}),this.listenTo(this,"discussion:comment:likestatechanged",this.onCommentLikeStateChanged)},loadFlaggedCommentCount:function(){var e=this._parent.get("id");return s.flagCount()||s.loadFlagCount(e),s.flagCountLoaded()},loadFlaggedComments:function(){var e=this._parent.get("id"),n=function(e){t.each(e,function(e){this.setAttributesOnComment(this,e,{flagged:!0})},this)}.bind(this);s.flaggedRepliesLoaded().done(function(){n(s.flaggedReplies())}),s.flaggedReplies()||s.loadFlaggedReplies(e)},loadLikedComments:function(){var s=this._parent.get("id"),n=function(e){t.each(e,function(e){this.setAttributesOnComment(this,e,{liked:!0})},this)}.bind(this);a.onAuth.done(function(){a.isLoggedIn()&&this._parent.get("replyCount")>0&&(e.likedCommentIds?n(e.likedCommentIds):d.getForStarter({starterId:s},{traditional:!0}).done(function(o){var s=t.pluck(o,"objectId");e.likedCommentIds=s,n(s)}.bind(this)))}.bind(this))},onCommentLikeStateChanged:function(n,s){e.likedCommentIds&&("like"===s?e.likedCommentIds.push(n):e.likedCommentIds=t.reject(e.likedCommentIds,function(e){return e===n}))},setAttributesOnComment:function(s,e,n){t.each(s.models,function(t){e===t.get("id")?t.set(n):t._commentCollection&&t._commentCollection.models.length>0&&this.setAttributesOnComment(t._commentCollection,e,n)},this)},getFullListOfIds:function(n){var e=[];return t.each(n.models,function(t){e.push(t.get("id")),t._commentCollection&&t._commentCollection.models.length>0&&(e=e.concat(this.getFullListOfIds(t._commentCollection)))},this),e},sync:function(d,l,t){var s=this.getApprovedOnly(),i=this.getDiscussionType(),c=r.getKinjaMeta().postAuthorBlogName,a=this._permalinkComment;return n.id||require(["module/Raven"],function(e){e.captureMessage("currentBlogId is weird",{extra:{currentBlog:n,discussionType:i,depth:this._depth}})}),i===e.discussionTypes.PERSONALIZED?this._depth>0?o.getNextPersonalizedReplies({parentId:this._parent.get("id"),currentBlogId:n.id,startIndex:this.getStepIndex()},t):o.getPersonalizedReplies({query:c,postId:this._parent.get("id"),currentBlogId:n.id,refId:this.getStepIndex()},t):i===e.discussionTypes.ALL?this._depth>0?o.getNextAllReplies({parentId:this._parent.get("id"),currentBlogId:n.id,startIndex:this._stepIndex,maxReturned:this._stepSize,approvedOnly:s},t):o.getAllReplies({postId:this._parent.get("id"),currentBlogId:n.id,startIndex:this.getStepIndex(),approvedChildrenOnly:s,approvedStartersOnly:s},t):this.getDiscussionType()===e.discussionTypes.PERMALINK?this._depth>0?o.getNextPermalinkReplies({parentId:this._parent.get("id"),currentBlogId:n.id,startIndex:this.getStepIndex()},t):o.getPermalinkReplies({postId:this._parent.get("id"),refId:this.getStepIndex()||(a?a.get("id"):0),query:r.getKinjaMeta().postAuthorBlogName,currentBlogId:n.id},t):null},parse:function(s){var a,l,r=[],o=this.getDepth(),n=this.getDiscussionType(),c=e.discussionTypes;return a=function(a,d,h,c){var s,l,u;i.addDiscussionId(a,{discussionType:n}),1>o&&(a._surfaced=!0),t.each(d,function(e){i.addDiscussionId(e,{discussionType:n}),1>o&&(e._surfaced=!0)}),s=new i(a),l=new e(d,{parent:s,parentDepth:o,discussionType:n,approvedOnly:this.getApprovedOnly()}),c&&(l._approvedCount=c),s._commentCollection=l,h&&(u=this.getApprovedOnly()&&"undefined"!=typeof c?c:a.replyCount,u>4?(s._commentCollection._doneStepping=!1,s._commentCollection._stepIndex=4,s._commentCollection&&s._commentCollection.length&&(s._commentCollection._stepIndex=s._commentCollection.length)):(s._commentCollection._doneStepping=!0,s._commentCollection._stepIndex=s._commentCollection.length)),r.push(s)},n===c.PERSONALIZED||n===c.PERMALINK?1>o?t.each(s.data.items,function(e){if(e.length){var n=t.countBy(e,"parentId");e=t.map(e,function(e){var t=e.id;return e.hasOwnProperty("qiMeta")&&(e.replyCount=e.qiMeta.filteredDirectReplies.length),n.hasOwnProperty(t)&&(e.replyCount-=n[t]),e}),a.call(this,t.first(e),t.rest(e))}}.bind(this)):(l=t.pluck(this._parent.collection.models,"id"),t.each(s.data.items,function(e){-1===l.indexOf(e.reply.id)&&a.call(this,e.reply,e.children.items)}.bind(this))):n===c.ALL&&(1>o?t.each(s.data.items,function(e){a.call(this,e.reply,e.children.items,!0,e.approvedCount)}.bind(this)):r=t.map(s.data.items[0].children.items,function(e){return i.addDiscussionId(e,{discussionType:n})})),this._checkDone(s)?(this._doneStepping=!0,this.trigger("pagination:done")):(this._incrementStep(s),this._doneStepping=!1),r},getParent:function(){return this._parent},getDiscussionType:function(){return this._discussionType},getDepth:function(){return this._depth},getSurfacedCommentLength:function(){return this.filter(function(e){return e.get("_surfaced")}).length},getApprovedOnly:function(){return this.getDiscussionType()===e.discussionTypes.PERSONALIZED?!c.cookie("KinjaNSFWCookie"):this._approvedOnly}},{discussionTypes:{PERSONALIZED:"QiReplyList",ALL:"ReplyList",PERMALINK:"PermalinkQiReplyList"},likedCommentIds:null});return e}),define("module/discussion/discussion.channel",["backbone","underscore"],function(e,t){"use strict";return t.extend({},e.Events)}),define("gawkerlib/analytics/analytics_config_prod",[],function(){"use strict";var e={rootUrl:"http://kinja.com/api/analytics/",rootUrlWoProtocol:"//kinja.com/api/analytics/"};return e}),!function(){function e(e){this.message=e}var t="undefined"!=typeof exports?exports:this,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e.prototype=new Error,e.prototype.name="InvalidCharacterError",t.btoa||(t.btoa=function(c){for(var s,o,a=String(c),t=0,r=n,i="";a.charAt(0|t)||(r="=",t%1);i+=r.charAt(63&s>>8-t%1*8)){if(o=a.charCodeAt(t+=.75),o>255)throw new e("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");s=s<<8|o}return i}),t.atob||(t.atob=function(c){if(s=String(c).replace(/=+$/,""),s.length%4==1)throw new e("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,s,o,i=0,r=0,a="";t=s.charAt(r++);~t&&(o=i%4?64*o+t:t,i++%4)?a+=String.fromCharCode(255&o>>(-2*i&6)):0)t=n.indexOf(t);return a})}(),define("lib/base64.min",function(){}),define("module/KinjaAnalytics",["jquery","gawkerlib/analytics/analytics_config_prod","lib/base64.min"],function(e,t){"use strict";var n={session:{},context:{},setContext:function(e,t,n){this.context.blogId=e,this.context.contextType=t,this.context.id=n},createPayload:function(e,t,n,s,o,i,a,r){var c={blogId:e,eventType:t,targetType:n,targetId:s,contextType:o,contextId:i,eventAttributes:a,eventAttributesExtended:r};return c},pushEvent:function(t,n,e,s,o){var i=this.createPayload(this.context.blogId?String(this.context.blogId):null,t,n,e?String(e):null,this.context.contextType,this.context.id?String(this.context.id):null,s,o);this.writeEvent(i)},setSession:function(e){return!!("string"==typeof e.agid&&"string"==typeof e.asid&&e.ping)&&(this.session.globalId=e.agid,this.session.sessionId=e.asid,this.session.ping=e.ping,!0)},getEventMeta:function(){var e={context:this.context,session:this.session};return e},writeEvent:function(n){var s=btoa(JSON.stringify(n)),o=t.rootUrlWoProtocol,i=Math.floor(1e3*Math.random()+1),a=o+"t/event.js?e="+s+"&cb="+i,r=this;e.ajax(a,{type:"GET",success:function(e){r.setSession(e.data)},xhrFields:{withCredentials:!0},crossDomain:!0})}};return n}),define("app/post/common/post.layout",["underscore","backbone.marionette","singleton/CurrentUser","singleton/Utils","singleton/Feature","module/KinjaAnalytics"],function(t,s,e,n,o,i){"use strict";var a=s.Layout.extend(t.extend({regions:{post:".post"},ui:{likeButton:".js_like",likeIcon:".js_like_icon",likeCountPlaceholder:".js_like_count",replyButton:".js_reply-to-post",metaContainer:".meta-container",metaTools:".js_meta-tools"},triggers:{"click @ui.likeButton":"posttools:like","click @ui.replyButton":"posttools:reply"},events:{approval:"_removePendingStyling","click @ui.likeIcon":"onRecommendTracking"},modelEvents:{"change:liked":"_updateLikeIconClasses","posttools:post:likeCount:updated":"_updateLikeCount"},updateUserState:function(){e.onAuth.done(function(){e.isLoggedIn()?this._updateLikeIconClasses():this._removeLikeIconClass()}.bind(this)),e.onLoggedIn.done(this._updateLikeIconClasses.bind(this))},togglePostToolsVisibility:function(e){o.isOn("newstream")?this.ui.metaTools.toggleClass("hide",e):this.ui.metaContainer.toggleClass("without-dropdown",e)},onRecommendTracking:function(e){var t="groupChat"===e.currentTarget.parentElement.getAttribute("data-analytics-target");n.getKinjaMeta().pageType!==n.pageTypes.permalink||t||i.pushEvent("RECOMMENDATION","POST",this.model.id,{uiElement:e.currentTarget.getAttribute("data-analytics-target")})},_removePendingStyling:function(s,e){var n=this.$el.closest(".js_branch-list");t.each(e.approvedReplyIDs,function(e){n.find("#reply_"+e).removeClass("reply--unapproved")})},_updateLikeIconClasses:function(){this.ui.likeIcon.toggleClass("active",this.model.get("liked"))},_removeLikeIconClass:function(){this.ui.likeIcon.removeClass("active")},_updateLikeCount:function(){var e=parseInt(this.ui.likeButton.data("likecount"),10)||0,t=e>0,e=this.model.get("liked")?e+1:t?e-1:0;this.ui.likeButton.data("likecount",e),this.ui.likeCountPlaceholder.text(e||"")}}));return a}),define("app/post/mixins/post.userPermissionsHelper",["singleton/Feature","singleton/CurrentUser","singleton/CurrentBlog"],function(t,e,n){"use strict";return{canEditPost:function(n){var l=15,a=function(e){var t=new Date(e+60*l*1e3),n=new Date;return t>n},o=e.isLoggedIn(),i=e.id===n.get("authorId"),r=e.hasRole("OWNER",n.get("defaultBlogId")),c=e.hasRole("ADMIN",n.get("defaultBlogId")),s=n.has("parentId"),d=o&&(i||r||c)&&!s,u=o&&s&&i&&a(n.get("publishTimeMillis"));return e.isSuperuser()&&t.isOn("superuser")||d||u},canDeletePost:function(t){var n=e.isLoggedIn(),s=e.id===t.get("authorId"),o=e.hasRole("OWNER",t.get("defaultBlogId")),i=t.has("parentId");return n&&(s||o)&&!i},canInviteToPostManually:function(n){return t.isOn("invitetoken")&&n.get("authorId")===e.id},canPromote:function(){return e.hasPermission("SALES")||e.isSuperuser()&&t.isOn("superuser")},canDismissPost:function(s){var o=e.hasRole("ADMIN",n.id)||e.hasRole("ADMIN",s.get("defaultBlogId")),i=e.id===s.get("authorId"),a=e.id===s.get("parentAuthorId"),r=s.has("parentId");return r&&(e.isSuperuser()&&t.isOn("superuser")||!i&&(o||a))},canUnshareRepostedPost:function(){return e.hasRole("ADMIN",n.id)},canBlock:function(e){return this.userIsOwner(e)||this.userIsAdmin(e)||this.userIsSuper()},canSharePost:function(){return e.isLoggedIn()},userIsAuthor:function(t){return e.hasRole("AUTHOR",t.get("defaultBlogId"))&&e.id!==t.get("authorId")},userIsOwner:function(t){return e.hasRole("OWNER",t.get("defaultBlogId"))&&e.id!==t.get("authorId")},userIsAdmin:function(t){return e.hasRole("ADMIN",t.get("defaultBlogId"))&&e.id!==t.get("authorId")},userIsSuper:function(){return e.isSuperuser()&&t.isOn("superuser")}}}),define("app/post/mixins/post.userPermissions",["underscore","app/post/mixins/post.userPermissionsHelper"],function(e,t){"use strict";var n=["canEditPost","canDeletePost","canInviteToPostManually","canPromote","canDismissPost","canUnshareRepostedPost","canBlock","canSharePost","userIsAuthor","userIsOwner","userIsAdmin","userIsSuper"];return e.reduce(n,function(n,s){return n[s]=e.wrap(t[s],function(e){return e.call(this,this.model)}),n},{})}),define("app/post/mixins/post.confirmationPrompt",["jquery","singleton/Renderer"],function(e,t){"use strict";var n={_confirmationPrompt:function(n,s){return window.confirm(e(t.renderTemplate(n,s||{})).text())}};return n}),define("app/post/common/post.menuitemview",["backbone.marionette"],function(e){"use strict";var t=e.ItemView.extend({_show:function(){this.$el.removeClass("hide")},_hide:function(){this.$el.addClass("hide")},_isDisabled:function(){return!1},_canShow:function(){throw new Error("method _canShow not implemented!")},onRender:function(){this._canShow()?(this._show(),this._isDisabled()?this.$el.addClass("disabled"):this.$el.removeClass("disabled")):this._hide()}});return t}),define("app/post/posttools/view/posttools.menuitemview",["underscore","app/post/mixins/post.userPermissions","app/post/mixins/post.confirmationPrompt","app/post/common/post.menuitemview"],function(e,t,n,s){"use strict";var o=s.extend(e.extend({},t,n,{_canShow:function(){var t=this,n=function(e){return t[e]};return e.chain(this.permissions).map(n).invoke("call",this).all().value()},render:function(){return this.isClosed=!1,this.triggerMethod("before:render",this),this.triggerMethod("item:before:render",this),this.bindUIElements(),this.triggerMethod("render",this),this.triggerMethod("item:rendered",this),this}}));return o}),define("app/post/posttools/view/posttools.editview",["app/post/posttools/view/posttools.menuitemview","singleton/Feature","singleton/Utils"],function(e,t,n){"use strict";var s=e.extend({permissions:["canEditPost"],onRender:function(){var s=t.isOn("editor_own_page_test")?window.location.search:"",o=this.$el.find("a");e.prototype.onRender.call(this,arguments),o.attr("href","//"+n.getKinjaHost()+"/write/"+this.model.id+s)}});return s}),define("app/post/posttools/view/posttools.editreplyview",["app/post/posttools/view/posttools.menuitemview"],function(e){"use strict";var t=e.extend({permissions:["canEditPost"]});return t}),define("app/post/posttools/view/posttools.deleteview",["app/post/posttools/view/posttools.menuitemview"],function(e){"use strict";var t=e.extend({permissions:["canDeletePost"],triggers:{click:"posttools:delete"}});return t}),define("apiclient/invite",["config","apiclient/apirequest","apiclient/gettoken"],function(e,t,n){"use strict";return{addInvite:t.postJson(n.append(e.api.core.url+"/invite")),requestInviteToken:t.postJson(n.append(e.api.core.url+"/invite/create?postId={{postId}}")),approveInvitedCommenter:t.postJson(e.api.core.url+"/invite/approve")}}),define("templates/tiger/components/invites/modals",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(s,e,o,n,t){e.components.invites.modals.inviteToPostManually=function(e){return'<form class="invite-to-post-form js_invite-to-post-form"><div class="row"><div class="columns"><input type="url" class="mbn js_invite-manually-field" value="'+t.$$escapeHtmlAttribute(e.permalink)+"?invite="+t.$$escapeHtmlAttribute(e.inviteUid)+'" autofocus /></div></div></form>'},n.DEBUG&&(e.components.invites.modals.inviteToPostManually.soyTemplateName="tiger.components.invites.modals.inviteToPostManually")}),define("view/forms/invite/InviteToPostManuallyModalView",["backbone.marionette","singleton/EventDispatcher","templates/tiger/components/invites/modals"],function(e,t){"use strict";var n=e.ItemView.extend({id:"modal-invite-to-post-manually",template:tiger.components.invites.modals.inviteToPostManually,ui:{inviteToPostManuallyField:"#js_invite-to-post-manually-field"},initialize:function(){t.on("modal:login:close",this.close,this)}});return n}),define("app/invites/behaviors/invites.token.posttools",["backbone.marionette","apiclient/invite","app/modal/modal.controller","view/forms/invite/InviteToPostManuallyModalView"],function(t,n,e,s){"use strict";var o=t.Behavior.extend({events:{click:"onInviteModalToPostManuallyOpen"},onInviteModalToPostManuallyOpen:function(t){t.preventDefault(),n.requestInviteToken({postId:this.view.model.id}).done(function(t){var n=e.instantiate(s,{templateData:{permalink:this.view.model.get("permalink"),inviteUid:t.inviteUid}});e.create(n,{name:"invite",className:"reveal-modal kinja-modal small proxima"})}.bind(this))}});return o}),define("app/post/posttools/view/posttools.invitemanuallyview",["app/post/posttools/view/posttools.menuitemview","app/invites/behaviors/invites.token.posttools"],function(e,t){"use strict";var n=e.extend({permissions:["canInviteToPostManually"],behaviors:{InvitesTokenPostTools:{behaviorClass:t}}});return n}),define("app/post/posttools/view/posttools.dismissview",["app/post/posttools/view/posttools.menuitemview","singleton/CurrentUser","singleton/Utils"],function(t,n,e){"use strict";var s=t.extend({permissions:["canDismissPost"],ui:{dismissButton:"a.dismiss",undismissButton:"a.undismiss"},triggers:{"click @ui.dismissButton":"posttools:dismiss","click @ui.undismissButton":"posttools:undismiss"},modelEvents:{"change:actionState":"_finishRender"},_finishRender:function(){this._setDismissState(),t.prototype.onRender.call(this)},_setDismissState:function(){var e=this.model.get("actionState"),t=this.model.get("defaultBlogId"),e=e?e[t]:"";"dismiss"===e?(this.$el.removeClass(".js_dismiss").addClass("js_undismiss"),this.ui.dismissButton.addClass("hide"),this.ui.undismissButton.removeClass("hide")):(this.$el.removeClass(".js_undismiss").addClass("js_dismiss"),this.ui.undismissButton.addClass("hide"),this.ui.dismissButton.removeClass("hide"))},onRender:function(){var t,o,s=this;"permalink"===e.getKinjaMeta().pageType?(t=parseInt(e.getKinjaMeta().postId||0,10),o=parseInt(e.getKinjaMeta().starterId||0,10),t!==o&&t===this.model.id?n.onAuth.always(function(){n.isLoggedIn()?s.triggerMethod("posttools:getDismissState",{model:s.model}):s._finishRender()}):this._finishRender()):this._finishRender()}});return s}),define("app/post/posttools/view/posttools.promoteview",["app/post/posttools/view/posttools.menuitemview","singleton/Utils"],function(e,t){"use strict";var n=e.extend({permissions:["canPromote"],triggers:{click:"posttools:promote"},onPosttoolsOpened:function(){var e=this.model&&parseInt(t.getKinjaMeta().postId,10)===this.model.get("sharedPostId");e&&this.$el.addClass("hide")}});return n}),define("app/post/posttools/view/posttools.blockview",["app/post/posttools/view/posttools.menuitemview","singleton/CurrentUser"],function(e,t){"use strict";var n=e.extend({permissions:["canBlock"],events:{click:"_blockBlog"},modelEvents:{"posttools:blockStatusUpdated":"_finishRender"},collectionEvents:{"posttools:block posttools:unblock sync":"_checkBlockStatus"},_checkBlockStatus:function(){this.triggerMethod("posttools:checkBlockStatus",{model:this.model,collection:this.collection})},_blockBlog:function(e){e.preventDefault(),this.triggerMethod("posttools:block",{model:this.model,collection:this.collection,targetBlogName:this._getTargetBlogName(),targetAuthorName:this._getTargetAuthorName()}),this.$el.siblings(".js_unfollowforblog").addClass("hide"),this.$el.siblings(".js_followforblog").removeClass("hide"),this.$el.siblings(".js_unfollowforuser").addClass("hide"),this.$el.siblings(".js_followforuser").removeClass("hide")},_correctBlockText:function(n){var t=this.$el.find("span"),s=t.text(),e=n?"Unblock":"Block",e=s.replace(/Unblock|Block/,e);t.text(e)},_finishRender:function(t){this._correctBlockText(t),e.prototype.onRender.call(this)},_getTargetBlogName:function(){return this.$el.data("targetblogname")},_getTargetAuthorName:function(){return this.$el.data("targetauthorname")},onRender:function(){var e=this;t.onAuth.always(function(){e._canShow()?e._checkBlockStatus():e._hide()})}});return n}),define("app/post/posttools/view/posttools.hideview",["app/post/posttools/view/posttools.menuitemview"],function(e){"use strict";var t=e.extend({permissions:["userIsSuper"],triggers:{click:"posttools:hide"}});return t}),define("app/post/posttools/view/posttools.kinjashareview",["app/post/posttools/view/posttools.menuitemview","singleton/Utils"],function(e,t){"use strict";var n=e.extend({permissions:[],events:{click:"onKinjaShareClick"},onKinjaShareClick:function(){var e=parseInt(t.getKinjaMeta().postId,10)===this.model.get("sharedPostId"),n=this.model.get("isStarter");this.trigger("posttools:kinjaShare",this.model,{showReframe:!e&&n})}});return n}),define("app/post/posttools/view/posttools.kinjaunshareview",["app/post/posttools/view/posttools.menuitemview"],function(e){"use strict";var t=e.extend({permissions:["canSharePost","canUnshareRepostedPost"],triggers:{click:"posttools:undorepost"}});return t}),define("app/post/posttools/view/posttools.externalshareview",["jquery","app/post/posttools/view/posttools.menuitemview"],function(e,t){"use strict";var n=t.extend({permissions:[],ui:{sharePostButton:".js_share-post-item"},triggers:{"click @ui.sharePostButton":"posttools:externalShare"},onRender:function(){var t=function(t){return e("<div/>").html(t).text()},n=function(e){return e?e.replace(/&#(\d+);/g,function(t,e){return String.fromCharCode(e)}):""},s=this.model.get("headline")||this.model.get("first100Characters")||this.model.get("compact"),o=this.ui.sharePostButton.attr("href");this.ui.sharePostButton.attr("href",o.replace("POST_TITLE",encodeURIComponent(t(n(s)))))}});return n}),define("app/post/posttools/view/posttools.flagview",["app/post/posttools/view/posttools.menuitemview","module/flagging/ReplyFlaggingModule"],function(e,t){"use strict";var n=e.extend({modelEvents:{"change:flagged":"_flaggedChanged","change:flaggingInProgress":"_flaggedChanged"},permissions:[],events:{click:"_onFlagClicked"},_flaggedChanged:function(){this.render()},_canShow:function(){return this.model.get("flagged")!==!0},_isDisabled:function(){return this.model.get("flaggingInProgress")===!0},_onFlagClicked:function(e){e.preventDefault();var n=this.$el.parents(".js_reply");t.openFlagView(n,this.model)}});return n}),define("app/post/posttools/view/posttools.unflagview",["app/post/posttools/view/posttools.menuitemview"],function(e){"use strict";var t=e.extend({modelEvents:{"change:flagged":"_flaggedChanged","change:flaggingInProgress":"_flaggedChanged"},permissions:[],triggers:{click:"posttools:unflag"},_flaggedChanged:function(){this.render()},_canShow:function(){return this.model.get("flagged")===!0},_isDisabled:function(){return this.model.get("flaggingInProgress")===!0}});return t}),define("app/post/posttools/view/reposttools.unscheduleview",["app/post/posttools/view/posttools.menuitemview"],function(e){"use strict";return e.extend({permissions:["canSharePost"],triggers:{click:"reposttools:unschedule"}})}),define("app/post/posttools/view/posttools.pupilview",["jquery","underscore","app/post/posttools/view/posttools.menuitemview"],function(n,s,e){"use strict";var t=e.extend({permissions:["canPromote"],triggers:{click:"posttools:pupil"}});return t}),define("templates/tiger/components/post/meta/post-dropdown",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(s,e,o,n,t){e.components.post.meta.postDropdown=function(n,c,s){var a="",r=n.post.defaultBlogId!=(null==n.blog?null:n.blog.id)&&"POSTACTION"==(null==n.post.meta?null:n.post.meta.typ),o=null!=(null==n.blog?null:n.blog.name)?null==n.blog?null:n.blog.name:n.post.defaultBlogName,i=null!=(null==n.blog?null:n.blog.displayName)?null==n.blog?null:n.blog.displayName:o;return a+='<ul id="dropdown-'+t.$$escapeHtmlAttribute(n.post.id)+'" class="f-dropdown proxima js_post-dropdown js_follow-controls js_user-follow-controls whitelisted-links" data-postid="'+t.$$escapeHtmlAttribute(n.post.id)+'" data-starterid="'+t.$$escapeHtmlAttribute(n.post.starterId)+'" data-authorid="'+t.$$escapeHtmlAttribute(n.post.author.id)+'" data-blogid="'+t.$$escapeHtmlAttribute(n.post.authorBlogId)+'" data-sourceblogid="'+t.$$escapeHtmlAttribute(null==n.blog?null:n.blog.id)+'" data-dropdown-content>'+("reply"==n.mode?'<li class="js_edit-reply hover-icon hide readonly-hide"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">'+e.icons.actions.write(null,null,s)+"Edit</a></li>":'<li class="js_edit-post hover-icon hide readonly-hide"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">'+e.icons.actions.write(null,null,s)+"Edit</a></li>")+(r?'<li class="js_kinja-unshare hover-icon hide readonly-hide"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">'+e.icons.essential.externalLink(null,null,s)+"Unshare</a></li>":'<li class="js_delete-post hover-icon hide readonly-hide"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">'+e.icons.essential.close(null,null,s)+"Delete</a></li>")+("DRAFT"!=n.post.status?e.components.invites.menuItems.invitePostDropdownItems(null,null,s):"")+("reply"==n.mode&&"profilepage"!=n.pageType?'<li data-analytics-target="groupChat" class="js_followforuser hover-icon readonly-hide" onclick="window.ga(\'send\', \'event\', \'Group Chats\', \'click\', \'Drop down - follow user click\');"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">'+e.icons.essential.add(null,null,s)+"Follow "+t.$$escapeHtml(n.post.authorBlogName)+'</a></li><li class="js_unfollowforuser hover-icon hide readonly-hide"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">'+e.icons.essential.checkmark(null,null,s)+"Unfollow "+t.$$escapeHtml(n.post.authorBlogName)+"</a></li>"+("private"!=n.pageType&&"dashboard"!=n.pageType?'<li class="js_followforblog js_approveforblog hover-icon hide readonly-hide"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">'+(s.features.approvemessage?e.icons.essential.add(null,null,s)+"Approve "+t.$$escapeHtml(n.post.authorBlogName)+" on "+t.$$escapeHtml(i):e.icons.essential.add(null,null,s)+"Follow "+t.$$escapeHtml(n.post.authorBlogName)+" for "+t.$$escapeHtml(o))+'</a></li><li class="js_unfollowforblog js_unapproveforblog hover-icon hide readonly-hide"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">'+(s.features.approvemessage?e.icons.essential.checkmark(null,null,s)+"Remove "+t.$$escapeHtml(n.post.authorBlogName)+" from "+t.$$escapeHtml(i)+" approve list":e.icons.essential.checkmark(null,null,s)+"Unfollow "+t.$$escapeHtml(n.post.authorBlogName)+" for "+t.$$escapeHtml(o))+"</a></li>":""):"DRAFT"!=n.post.status?'<li class="js_promote hover-icon hide readonly-hide"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">'+e.icons.essential.starCircle(null,null,s)+"Promote</a></li>":"")+("DRAFT"!=n.post.status&&"dashboard"!=n.pageType?"<li class=\"js_dismiss hover-icon hide readonly-hide\"><a href=\"#\" class=\"dismiss icon--svg u-darkened--onhover u-prepended\" rel=\"nofollow\" onclick=\"window.ga('send', 'event', 'Group Chats', 'click', 'Dismiss click');\">"+e.icons.actions.userRemove(null,null,s)+"Dismiss</a><a href=\"#\" class=\"undismiss icon--svg u-darkened--onhover u-prepended\" rel=\"nofollow\" onclick=\"window.ga('send', 'event', 'Group Chats', 'click', 'Undismiss click');\">"+e.icons.actions.userRemove(null,null,s)+'Undismiss</a></li><li class="js_block hover-icon hide disabled readonly-hide" data-blogid="'+t.$$escapeHtmlAttribute(n.post.defaultBlogId)+'" data-targetblogid="'+t.$$escapeHtmlAttribute(n.post.authorBlogId)+'" data-targetblogname="'+t.$$escapeHtmlAttribute(o)+'" data-targetauthorname="'+t.$$escapeHtmlAttribute(n.post.author.displayName)+'"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">'+e.icons.actions.disabled(null,null,s)+"<span>Block for "+t.$$escapeHtml(o)+'</span></a></li><li class="js_hide-post hover-icon hide readonly-hide"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">'+e.icons.actions.disabled(null,null,s)+"Hide</a></li>":"")+("permalink"==n.pageType&&"DRAFT"!=n.post.status?("reply"==n.mode?'<li class="js_flag-post hover-icon readonly-hide"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">'+e.icons.actions.flag(null,null,s)+'Flag</a></li><li class="js_unflag-post unflag-post hover-icon readonly-hide"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">'+e.icons.actions.flag(null,null,s)+"Unflag</a></li>":s.features.pupil_rating?'<li class="js_pupil-rules-block"><a class="js_pupil-rules hover-icon icon--svg u-darkened--onhover u-prepended" href="#" rel="nofollow">'+e.icons.actions.writePaper(null,null,s)+"Open Pupil Rules</a></li>":"")+'<li class="js_kinja-share-block readonly-hide"><a class="js_kinja-share hover-icon icon--svg u-darkened--onhover u-prepended" href="#" rel="nofollow">'+e.icons.essential.externalLink(null,null,s)+'Share to Kinja</a></li><li class="js_go-to-permalink"><a class="hover-icon icon--svg u-darkened--onhover u-prepended" href="'+t.$$escapeHtmlAttribute(t.$$filterNormalizeUri(n.post.permalink))+"\" onclick=\"window.ga('send', 'event', 'Group Chats', 'click', 'Drop down - Go to permalink click');\">"+e.icons.essential.link(null,null,s)+"Go to permalink</a></li>":"")+("dashboard"==n.pageType&&"reply"==n.mode&&"DRAFT"!=n.post.status?'<li class="js_block readonly-hide" data-blogid="'+t.$$escapeHtmlAttribute(n.post.defaultBlogId)+'" data-targetblogid="'+t.$$escapeHtmlAttribute(n.post.authorBlogId)+'" data-targetblogname="'+t.$$escapeHtmlAttribute(o)+'" data-targetauthorname="'+t.$$escapeHtmlAttribute(n.post.author.displayName)+"\"><a href=\"#\" rel=\"nofollow\" onclick=\"window.ga('send', 'event', 'Group Chats', 'click', 'Block User click');\" class=\"icon--svg u-darkened--onhover u-prepended\">"+e.icons.essential.close(null,null,s)+"Block user for blog</a></li>":"")+"</ul>"},n.DEBUG&&(e.components.post.meta.postDropdown.soyTemplateName="tiger.components.post.meta.postDropdown"),e.components.post.meta.postDropdownTrigger=function(s,o,n){return'<a href="#" target="_self" class="post-dropdown-trigger js_post-menu-toggler icon--svg u-highlighted--onhover" data-dropdown="dropdown-'+t.$$escapeHtmlAttribute(s.post.id)+"\" onclick=\"window.ga('send', 'event', 'Group Chats', 'click', 'Drop down click');\">"+(n.features.newstream?e.icons.essential.toolsGiant(null,null,n):e.icons.essential.chevronBottom(null,null,n))+"</a>"},n.DEBUG&&(e.components.post.meta.postDropdownTrigger.soyTemplateName="tiger.components.post.meta.postDropdownTrigger")}),define("app/post/posttools/posttools.menuview",["jquery","underscore","backbone","backbone.marionette","singleton/CurrentUser","singleton/CurrentBlog","singleton/EventDispatcher","singleton/Utils","app/post/mixins/post.userPermissions","app/post/posttools/view/posttools.editview","app/post/posttools/view/posttools.editreplyview","app/post/posttools/view/posttools.deleteview","app/post/posttools/view/posttools.invitemanuallyview","app/post/posttools/view/posttools.dismissview","app/post/posttools/view/posttools.promoteview","app/post/posttools/view/posttools.blockview","app/post/posttools/view/posttools.hideview","app/post/posttools/view/posttools.kinjashareview","app/post/posttools/view/posttools.kinjaunshareview","app/post/posttools/view/posttools.externalshareview","app/post/posttools/view/posttools.flagview","app/post/posttools/view/posttools.unflagview","app/post/posttools/view/reposttools.unscheduleview","app/post/posttools/view/posttools.pupilview","templates/tiger/components/post/meta/post-dropdown"],function(s,e,m,o,l,r,a,t,c,n,d,u,h,i,f,p,g,v,b,j,y,_,w,O){"use strict";var x=["profilepage","dashboard","manageblog"],C=o.ItemView.extend(e.extend({},c,{menuItemViewClasses:{".js_pupil-rules":O,".js_-post":n,".js_edit-post":n,".js_edit-reply":-1===e.indexOf(x,t.getKinjaMeta().pageType)?d:n,".js_delete-post":u,".js_invite-to-post-manually":h,".js_dismiss":i,".js_promote":f,".js_block":p,".js_hide-post":g,".js_kinja-share":v,".js_kinja-unshare":b,".js_external-share":j,".js_flag-post":y,".js_unflag-post":_,".js_unschedule-repost":w},events:{"requested.fndtn.dropdown .js_post-menu-toggler":"onPosttoolsRequested"},triggers:{"opened.fndtn.dropdown .js_post-dropdown":"posttools:opened"},menuItemViews:[],permissions:["userIsSuper","canEditPost","canPromote","canDismissPost","canSharePost"],initialize:function(e){a.on("blog:block:success"+this.model.id,this.render,this),this.blockedBlogCollection=e.blockedBlogCollection},_instantiateMenuItemViewClasses:function(t){return t=t||this.$el,Object.keys(this.menuItemViewClasses).reduce(function(n,s){var o=t.find(s),i=e.partial(this._createMenuItemClass.bind(this),s);return o.length?n.concat(e.map(o,i)):n}.bind(this),[])},_createMenuItemClass:function(e,n){var o=this.menuItemViewClasses[e],t={el:s(n),model:this.model};return".js_block"===e&&(t.collection=this.blockedBlogCollection),new o(t)},_bindEvents:function(){l.onAuthStateChange(this._refreshMenu.bind(this))},_refreshMenu:function(){var n="permalink"===t.getKinjaMeta().pageType,e=this,s=function(){return e.$("li:not(.hide)").length};e._renderMenuItems(),e.trigger("posttools:menuview:togglehidden",!n&&!s())},_renderMenuItems:function(){this.menuItemViews.call("render")},_captureMenuItemEvents:function(){this.menuItemViews.call("on","all",this.trigger,this)},_adjustMenuHeight:function(){var t,e=this.$(".js_post-dropdown"),n=s(window.document).height(),o=this.$el.offset().top,i=n-o-e.height();0>i&&(t=n-o,e.height(t+"px"),e.addClass("scroll"))},onPosttoolsOpened:function(){e.isEmpty(this.menuItemViews)?this.listenToOnce(this,"posttools:content:render",this.onPosttoolsOpened):(this.menuItemViews.call("triggerMethod","posttools:opened"),this._adjustMenuHeight())},onPosttoolsRequested:function(s,e){var n=o.Renderer.render(tiger.components.post.meta.postDropdown,{post:this.model.toJSON(),mode:"reply",pageType:t.getKinjaMeta().pageType,blog:r});e.resolve(n),this.onContentRender()},render:function(){var e="permalink"===t.getKinjaMeta().pageType;return this.onContentRender(),e&&this.trigger("posttools:menuview:togglehidden",!1),this},onContentRender:function(){var e;this.menuItemViews.length||(e=this._instantiateMenuItemViewClasses(),this.menuItemViews=new m.ChildViewContainer(e),this._captureMenuItemEvents()),this._renderMenuItems(),this._bindEvents(),this.trigger("posttools:content:render")}}));return C}),define("templates/tiger/components/groupchats/unapproved-warning",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(n,e,s,t){e.components.groupchats.unapprovedWarning=function(e){return e=e||{},'<div class="js_toggle-pending unapproved-filter"><div class="filtered-view js_toggle-block"><div class="alert-container">'+(e.noReplies?"There are no approved replies for this post. To see additional replies that are pending approval, click Show Pending. Warning: These may contain graphic material.":"The following replies are approved. To see additional replies that are pending approval, click Show Pending. Warning: These may contain graphic material.")+'</div><div class="button-container"><a href="#" class="secondary js_pending-reply-switch" onclick="window.ga(\'send\', \'event\', \'Group Chats\', \'click\', \'Show Pending Toggle\');">Show pending</a></div></div><div class="unapproved-view js_toggle-block hide"><div class="alert-container">Warning: Replies that are pending approval may contain graphic material. Please proceed with caution.</div><div class="button-container"><a href="#" class="js_pending-reply-switch">Hide pending</a></div></div></div>'},t.DEBUG&&(e.components.groupchats.unapprovedWarning.soyTemplateName="tiger.components.groupchats.unapprovedWarning"),e.components.groupchats.unapprovedWarningThread=function(){return'<div class="js_toggle-pending unapproved-filter unapproved-filter--thread"><div class="filtered-view js_toggle-block"><div class="alert-container">The following replies are approved. Click to show additional replies that are pending approval. Warning: These may contain graphic material.</div><div class="button-container"><a href="#" class="js_pending-reply-thread-switch">Show replies</a></div><div class="close-button-container"><a href="#" class="js_pending-close close-button"></a></div></div></div>'},t.DEBUG&&(e.components.groupchats.unapprovedWarningThread.soyTemplateName="tiger.components.groupchats.unapprovedWarningThread"),e.components.groupchats.unapprovedAnnotationWarning=function(){return'<div class="js_toggle-pending unapproved-filter"><div class="filtered-view js_toggle-block"><div class="alert-container">The following reply is unapproved. Warning: It may contain graphic material.</div><div class="button-container"><a href="#" class="js_pending-reply-thread-switch">Show reply</a></div></div></div>'},t.DEBUG&&(e.components.groupchats.unapprovedAnnotationWarning.soyTemplateName="tiger.components.groupchats.unapprovedAnnotationWarning")}),define("module/discussion/view/warning.view",["backbone.marionette","templates/tiger/components/groupchats/unapproved-warning"],function(t){"use strict";var e=t.ItemView.extend({ui:{toggleBlocks:".js_toggle-block"},getTemplate:function(){var n=e.warningTypes,t=function(){};switch(this.options.warningType){case n.THREAD:t=tiger.components.groupchats.unapprovedWarningThread;break;case n.COMPLETE:t=tiger.components.groupchats.unapprovedWarning}return t},serializeData:function(){return{noReplies:this.options.noReplies}},toggleFilter:function(){this.ui.toggleBlocks.toggleClass("hide")}},{warningTypes:{THREAD:"thread",COMPLETE:"complete"}});return e}),define("view/ImageLoader",["jquery","underscore","singleton/EventDispatcher","view/BaseView","singleton/Feature","lib/waypoints","lib/jquery.browser.mobile"],function(t,e,c,i,a){"use strict";var o=t(document),s=t(window),r={initialLookaheadFactor:.8,lookaheadFactor:2.6,containerClass:"lazy-image"},n="loaded",l=i.extend({$allWrappers:t(),$allImages:t(),_watchedImages:[],viewportHeight:0,scrollTop:0,initialize:function(t){this.options=e.defaults(t||{},r),e.bindAll(this,"loadIfVisible","handleScroll","handleScrollNew"),this.registerImages(this.$el),this.addScrollEvents(),c.on("rendered.postlist.reply",function(e){this.registerImages(e.el)}.bind(this))},registerImages:function(i){var n=this.options.containerClass,s=i.find("."+n),o=s.find("img, iframe");this.$allWrappers=this.$allWrappers.add(s),this.$allImages=this.$allImages.add(o),this._watchedImages=this._watchedImages.concat(e.map(o,function(n){var e=t(n);return[e,e.outerHeight(),e.offset().top]})),this.$allImages.each(function(o,s){var e=t(s);e.data("wrapper",e.closest("."+n))}),this.trigger("images:registered")},addScrollEvents:function(){var n=e.bind(function(){this.viewportHeight=t.waypoints("viewportHeight")},this);n(),s.resize(e.debounce(n,1e3)),a.isOn("imageloader")?(s.scroll(e.throttle(e.partial(this.handleScrollNew,this.options.lookaheadFactor),500)),this.handleScrollNew(this.options.initialLookaheadFactor)):(s.scroll(e.throttle(e.partial(this.handleScroll,this.options.lookaheadFactor),500)),this.handleScroll(this.options.initialLookaheadFactor))},loadImage:function(s){var e=t(s);e.data(n)||this.waitForPlaceholder(e)},reinitializeInterchange:e.once(function(){t(document).foundation("interchange")}),updateInterchange:e.throttle(function(){this.reinitializeInterchange(),t(document).foundation("interchange","reflow")},150),_loadImage:function(t){var s,o=t.data("src"),i=t.data("lazyInterchange");this.trigger("imageLoading",{$el:t}),s=e.bind(function(){t.off("load",s).addClass("lazy-loaded"),this.trigger("imageLoaded",{$el:t}),this._watchedImages=this._watchedImages.filter(function(e){return!t.is(e[0])})},this),t.load(s).data(n,!0),o?t.attr("src",o):i?(t.attr("data-interchange",i),this.updateInterchange()):t.load()},waitForPlaceholder:function(t){var n,s="await-placeholder",o=t.data("wrapper");o.hasClass("asset-loading")?t.data(s)||(t.data(s,!0),n=e.bind(function(){t.off("load",n),this._loadImage(t)},this),t.load(n)):this._loadImage(t)},loadIfVisible:function(e,t,s){!e.data(n)&&this.inViewPort(e,t,s)&&this.loadImage(e)},loadIfVisibleNew:function(e,t,s,o){!e.data(n)&&this.inViewPortNew(e,t,s,o)&&this.loadImage(e)},inViewPort:function(m,d,r,a){var e=this.scrollTop,i=a||this.options.lookaheadFactor,s=this.viewportHeight,n=s*i,c=e+s+n,l=e-n,t=Math.round(r),u=Math.round(t+d),h=u>l,o=c>t;return h&&o},inViewPortNew:function(m,d,r,a){var e=this.scrollTop,i=a||this.options.lookaheadFactor,s=this.viewportHeight,n=s*i,c=e+s+n,l=e-n,t=Math.round(r),u=Math.round(t+d),h=u>l,o=c>t;return h&&o},handleScrollNew:function(t){this._watchedImages.length&&(this.scrollTop=window.pageYOffset||o.scrollTop(),e.each(this._watchedImages,function(e){var n=e[0],s=e[1],o=e[2];this.loadIfVisibleNew(n,s,o,t)},this))},handleScroll:function(t){this._watchedImages.length&&(this.scrollTop=window.pageYOffset||o.scrollTop(),e.each(this._watchedImages,function(e){var n=e[0],s=e[1],o=e[2];this.loadIfVisible(n,s,o,t)},this))}});return l}),define("templates/tiger/components/spinner",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(n,e,s,t){e.components.spinner.bounce=function(){return'<span class="spinner bounce"><span class="one"></span><span class="two"></span><span class="three"></span></span>'},t.DEBUG&&(e.components.spinner.bounce.soyTemplateName="tiger.components.spinner.bounce"),e.components.spinner.gifthaw=function(){return'<div class="animationContainer"><svg width="26" height="12" viewBox="0 0 26 12" version="1.1" xmlns="http://www.w3.org/2000/svg" class="loading-animation loading-animation--small grey"><circle cx="4" cy="6" r="3" class="circle-1" /><circle cx="4" cy="6" r="3" class="circle-2" /><circle cx="13" cy="6" r="3" class="circle-3" /><circle cx="22" cy="6" r="3" class="circle-4" /></svg></div>'},t.DEBUG&&(e.components.spinner.gifthaw.soyTemplateName="tiger.components.spinner.gifthaw")}),define("view/GifImageLoader",["jquery","underscore","singleton/EventDispatcher","singleton/Feature","view/ImageLoader","lib/jquery.browser.mobile","templates/tiger/components/spinner"],function(e,n,o,t,s){"use strict";var i,a={mobileGifs:!0,gifClass:"lazy-gif",thawableClass:"thawable",thawingClass:"thawing",thawedClass:"thawed"};return i=s.extend({initialize:function(e){n.extend(this.options,n.defaults(e||{},a)),this.addEvents(),this.on("images:registered",this.markImagesThawable),s.prototype.initialize.apply(this,arguments)},addEvents:function(){var s=this.options.gifClass,n=function(e){return e.data("wrapper").hasClass(s)};e.browser.mobile||(t.isOn("webm")||this.on("imageLoading",function(s){var t=s.$el,o=new Image,i=t.data("anim-src");n(t)&&e(o).attr("src",i)},this),this.on("imageLoaded",function(t){var e=t.$el;n(e)&&this.thawImage(e)},this)),o.on("thawImage",function(t){var e=t.$el;"IMG"!==e.prop("tagName")&&(e=e.find("img")),this.thawImage(e)},this)},markImagesThawable:function(){var t=this.options;e.browser.mobile&&t.mobileGifs&&this.$allWrappers.addClass(t.thawableClass)},thawImage:function(n){var s,o,i,a;t.isOn("webm")?(s=e("<video>"),a=s[0].canPlayType("video/webm")?n.data("webm-src"):n.data("mp4-src"),s.attr({autoplay:!0,controls:e.browser.mobile,loop:!0,muted:!0,src:a,poster:n.attr("src"),class:n.attr("class"),style:n.attr("style"),width:n.attr("width"),height:n.attr("height"),"data-chomp-id":n.data("chomp-id")}),s.data("wrapper",n.data("wrapper")),this.startLoadIndicator(s),n.replaceWith(s)):(o=n.data("animSrc")||n.data("assetUrl"),i=n.data("animInterchange"),this.startLoadIndicator(n),o&&n.attr("src",o),i&&(n.attr("data-interchange",i),this.updateInterchange()))},startLoadIndicator:function(a){var s=e(a),o=s.data("wrapper"),n=this.options,i=function(){o.removeClass(n.thawingClass).addClass(n.thawedClass),r.remove()},r=e(tiger.components.spinner.gifthaw()).appendTo(o);o.removeClass(n.thawableClass).addClass(n.thawingClass),s.load(i).error(i),t.isOn("webm")&&s.on("loadedmetadata",i)}})}),define("singleton/util/loadEditor",["underscore","jquery","singleton/Feature","singleton/StringUtils"],function(t,e,n,s){"use strict";function o(c,l,i){var n,a,r,o=e("head>meta[id="+l+"-css-url]");1===o.length?(n=o.attr("content"),a=0,r=function(){var e=t.find(document.styleSheets,function(e){return s.endsWith(e.href,n)});return"undefined"!=typeof e},document.createStyleSheet?document.createStyleSheet(n):e("head").append('<link rel="stylesheet" type="text/css" href="'+n+'" />'),o.remove(),require([c],function(){if(r())i.apply();else var e=window.setInterval(function(){(r()||a>99)&&(window.clearInterval(e),i.apply()),a+=1},250)})):require([c],i)}function i(){var t=e.Deferred();return n.isOn("webpack")?require(["module/MarionetteEditor","stylesheets/editor.css"],function(){require(["app/editor/editor.app"],t.resolve)}):o("module/MarionetteEditor","editor",function(){require(["app/editor/editor.app"],t.resolve)}),t.promise()}return i}),define("templates/tiger/components/groupchats/pending-image-message",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(n,e,s,t){e.components.groupchats.pendingImageMessage=function(){return'<span class="label pending-image-label">Click to Reveal</span>'},t.DEBUG&&(e.components.groupchats.pendingImageMessage.soyTemplateName="tiger.components.groupchats.pendingImageMessage")}),define("singleton/ImageBlurHelper",["jquery","backbone.marionette","templates/tiger/components/groupchats/pending-image-message"],function(e,t){"use strict";var n={addImageBlur:function(n){var s=t.Renderer.render(tiger.components.groupchats.pendingImageMessage);n.find(".img-border").length||n.find("img").wrap(e("<span>").addClass("img-border")),n.addClass("blurred"),n.find(".img-border").prepend(s.cloneNode(!0)),n.find(".magnifier.lightBox").hide()},removeImageBlur:function(t){t.stopPropagation(),t.preventDefault();var n=e(t.currentTarget);n.find("img").addClass("unblur"),n.find(".pending-image-label").remove(),n.parents(".has-media").find(".magnifier.lightBox").show()}};return n}),define("module/discussion/regionManager/discussionRegionManager",["backbone.marionette"],function(e){"use strict";var t=e.RegionManager.extend({addCommentRegion:function(s){var t=this.get("commentRegion"),n=!!t&&t.currentView;return(!n||n.confirmRemove())&&(t&&(t.reset(),t.off()),t=new e.Region({el:s}),this.addRegion("commentRegion",t)),t}});return new t}),define("app/post/posttools/controller/posttools.dismiss.controller",[],function(){"use strict";var e={API:{dismiss:function(e){e.setAction("dismiss",e.get("defaultBlogId"),{success:function(){e.trigger("posttools:post:dismissed"),e.trigger("annotation:remove")}.bind(this),error:function(e){throw new Error("PostTools.dismissPost(): "+e.reason)}})},undismiss:function(e){e.setAction("actionreset",e.get("defaultBlogId"),{success:function(){e.trigger("posttools:post:undismissed")}.bind(this),error:function(e){throw new Error("PostTools.undismissPost(): "+e.reason)}})}}};return e.API}),define("collection/blog.subscribersCollection",["config","underscore","backbone","singleton/CurrentUser"],function(e,t,n,s){"use strict";var o=n.Collection.extend({idCache:[],initialize:function(t,e){if(!e||e&&(!e.blogId||!e.type))throw new Error("Missing options for BlogSubscribersCollection");this.type=e.type,this.blogId=e.blogId,e.userId&&(this.userId=e.userId),void 0!==e.withNames&&(this.withNames=e.withNames),this.enableShortening=e.enableShortening||!1,this.on("add remove request sync",function(){this.idCache=[]})},parse:function(n){var o=this,s=n&&n.data?n.data:null,e=[];return s&&(e=this.withNames?s.map(function(e){return t.isUndefined(e.id)&&(e.id=e.authorId?e.defaultBlogId:e.blogId),e.sourceBlogId=o.blogId,e}):s.map(function(e){return{id:e}})),this.enableShortening===!0&&e.length>1e3&&(e=e.slice(e.length-1e3,e.length),this.shortened=!0),e},sync:function(r,o,c){var i,a;switch(this.idCache=[],r){case"read":switch(a="GET",o.type){case"followed":i=this.withNames?e.api.profile.url+"/blogfollow/views/followedByWithNames?blogId="+o.blogId:e.api.profile.url+"/blogfollow/views/followedBy?blogId="+o.blogId;break;case"followers":i=e.api.profile.url+"/blogfollow/views/followersOf?blogId="+o.blogId;break;case"followedUsers":i=e.api.profile.url+"/userfollow/views/followedUsers?userId="+o.userId+"&token="+s.get("token");break;case"followedBlogs":i=e.api.profile.url+"/userfollow/views/followedBlogs?userId="+o.userId+"&token="+s.get("token");break;case"blocked":i=this.withNames?e.api.profile.url+"/blogblock/views/byBlogWithNames?blogId="+o.blogId:e.api.profile.url+"/blogblock/views/byBlog?blogId="+o.blogId;break;default:throw new Error("blog.subscribersCollection.sync(): unsupported method in sync")}break;default:throw new Error("blog.subscribersCollection.sync(): unsupported method in sync")}return n.ajax(t.extend({type:a,dataType:"json",url:i},c))},getIds:function(){var e=this.idCache.length;return e&&e===this.length?this.idCache:this.pluck("id")}});return o}),define("templates/tiger/messages/postAction",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(s,e,o,t,n){e.messages.postAction.areYouSureToDelPost=function(){return"Are you sure you want to delete this post?"},t.DEBUG&&(e.messages.postAction.areYouSureToDelPost.soyTemplateName="tiger.messages.postAction.areYouSureToDelPost"),e.messages.postAction.confirmHidePost=function(){return"Are you sure you want to hide this?"},t.DEBUG&&(e.messages.postAction.confirmHidePost.soyTemplateName="tiger.messages.postAction.confirmHidePost"),e.messages.postAction.confirmDismissPost=function(){return"Are you sure you want to dismiss this reply?"},t.DEBUG&&(e.messages.postAction.confirmDismissPost.soyTemplateName="tiger.messages.postAction.confirmDismissPost"),e.messages.postAction.confirmBlockBlog=function(e){return""+("block"==e.action?"Are you sure you want to block "+n.$$escapeHtml(e.username)+" on "+n.$$escapeHtml(e.sitename)+"?":"Are you sure you want to unblock "+n.$$escapeHtml(e.username)+" on "+n.$$escapeHtml(e.sitename)+"?")},t.DEBUG&&(e.messages.postAction.confirmBlockBlog.soyTemplateName="tiger.messages.postAction.confirmBlockBlog"),e.messages.postAction.selfBlockError=function(){return"You should not block yourself."},t.DEBUG&&(e.messages.postAction.selfBlockError.soyTemplateName="tiger.messages.postAction.selfBlockError"),e.messages.postAction.blogBockMember=function(){return"Can't block a member of the blog."},t.DEBUG&&(e.messages.postAction.blogBockMember.soyTemplateName="tiger.messages.postAction.blogBockMember"),e.messages.postAction.postReposted=function(e){return"Shared to "+n.$$escapeHtml(e.blogName)+'. <a href="'+n.$$escapeHtmlAttribute(n.$$filterNormalizeUri(e.blogUrl))+'">View &raquo;</a>'},t.DEBUG&&(e.messages.postAction.postReposted.soyTemplateName="tiger.messages.postAction.postReposted"),e.messages.postAction.postScheduledRepost=function(){return"Your post has been scheduled to publish."},t.DEBUG&&(e.messages.postAction.postScheduledRepost.soyTemplateName="tiger.messages.postAction.postScheduledRepost"),e.messages.postAction.repostRemoved=function(){return"Post successfully un-shared from this blog (it may take 1-2 minutes for it to stop displaying)"},t.DEBUG&&(e.messages.postAction.repostRemoved.soyTemplateName="tiger.messages.postAction.repostRemoved"),e.messages.postAction.unsharePost=function(){return"Removed share"},t.DEBUG&&(e.messages.postAction.unsharePost.soyTemplateName="tiger.messages.postAction.unsharePost"),e.messages.postAction.areYouSureToUnschedRepost=function(){return"Are you sure you want to unschedule this repost?"},t.DEBUG&&(e.messages.postAction.areYouSureToUnschedRepost.soyTemplateName="tiger.messages.postAction.areYouSureToUnschedRepost"),e.messages.postAction.postDeleted=function(){return"The post has been deleted successfully."},t.DEBUG&&(e.messages.postAction.postDeleted.soyTemplateName="tiger.messages.postAction.postDeleted"),e.messages.postAction.repostUnscheduled=function(){return"The repost has been unscheduled successfully."},t.DEBUG&&(e.messages.postAction.repostUnscheduled.soyTemplateName="tiger.messages.postAction.repostUnscheduled"),e.messages.postAction.postRecommended=function(){return"You recommended a post."},t.DEBUG&&(e.messages.postAction.postRecommended.soyTemplateName="tiger.messages.postAction.postRecommended"),e.messages.postAction.undoDismissMsg=function(){return"You have successfully dismissed this reply."},t.DEBUG&&(e.messages.postAction.undoDismissMsg.soyTemplateName="tiger.messages.postAction.undoDismissMsg"),e.messages.postAction.undoBlockMsg=function(e){return"You have successfully dismissed this reply and blocked "+n.$$escapeHtml(e.userName)+" from "+n.$$escapeHtml(e.blogName)},t.DEBUG&&(e.messages.postAction.undoBlockMsg.soyTemplateName="tiger.messages.postAction.undoBlockMsg"),e.messages.postAction.undoResolveMsg=function(){return"You have successfully resolved the flag on this reply."},t.DEBUG&&(e.messages.postAction.undoResolveMsg.soyTemplateName="tiger.messages.postAction.undoResolveMsg")}),define("app/post/posttools/controller/posttools.block.controller",["jquery","singleton/CurrentUser","singleton/EventDispatcher","collection/blog.subscribersCollection","templates/tiger/messages/postAction"],function(t,n,s,o){"use strict";var e={_blogsBlockedHash:{},_postIsBlocked:function(e,t){return-1!==t.indexOf(e.get("authorBlogId"))},_blockBlog:function(o,t){var i,a=t.targetBlogId,r=t.confirmation,s=t.blockedBlogCollection,l=o.get("defaultBlogId"),d=t.targetBlogName,u=t.targetAuthorName,c=t.forceAction;"undefined"!=typeof c?(i=c,n.set("forceAction",c)):i=e._postIsBlocked(o,t.blockedBlogIds)?"unblock":"block",("boolean"==typeof r&&r||r({action:i,username:u,sitename:d}))&&n.setBlogAction(i,l,a,{success:function(r){var t,e=n.get("forceAction");r?"block"===i?(s.add({id:a}),s.trigger("posttools:block"),o.trigger("posttools:block")):(t=s.findWhere({id:a}),t&&s.remove(t),s.trigger("posttools:unblock"),o.trigger("posttools:unblock")):("block"===e||"unblock"===e)&&(s.trigger("posttools:"+e),o.trigger("posttools:"+e))},error:function(s,t){var n;switch(t.code){case"BLOG_BLOCK_MEMBER":n=tiger.messages.postAction.blogBockMember;break;default:n=t?t.message:s.reason}e._showErrorMessage(n)}})},_blockedBlogsInitialized:function(n){var s;return e._blogsBlockedHash.hasOwnProperty(n)||(e._blogsBlockedHash[n]=e.API.getBlockedBlogCollection(n)),e._blogsBlockedHash[n].fetched?(s=t.Deferred(),s.resolve(e._blogsBlockedHash[n]),s):(e._blogsBlockedHash[n].fetched=!0,e._blogsBlockedHash[n].fetch())},_showErrorMessage:function(e){s.trigger("successbox:display",{message:e,warningBox:!0,dismissable:!0})},API:{block:function(n,s,d,r,c,l){var i,a=n.get("defaultBlogId"),o=n.get("authorBlogId");return a===o?(e._showErrorMessage(tiger.messages.postAction.selfBlockError),!1):void t.when(e._blockedBlogsInitialized(a)).then(function(){i={targetBlogId:o,blockedBlogIds:s.getIds(),blockedBlogCollection:s,confirmation:d,targetBlogName:r,targetAuthorName:c,forceAction:l},e._blockBlog(n,i)})},getBlockedBlogCollection:function(t){return e._blogsBlockedHash.hasOwnProperty(t)||(e._blogsBlockedHash[t]=new o([],{blogId:t,type:"blocked",withNames:!1})),e._blogsBlockedHash[t]},checkBlockStatus:function(n,s){var o=n.get("defaultBlogId");t.when(e._blockedBlogsInitialized(o)).then(function(){n.trigger("posttools:blockStatusUpdated",e._postIsBlocked(n,s.getIds()))})}}};return window.__karma__&&(e.API.__testonly__=e),e.API}),define("app/post/mixins/post.successMessage",["singleton/Renderer","singleton/EventDispatcher"],function(e,t){"use strict";var n={_displaySuccessMessage:function(n,s){t.trigger("successbox:display",{message:e.renderTemplate(n,s||{})})},_displayChannelMessage:function(n,s){t.trigger("successbox:display",{message:e.renderTemplate(n,s||{}),timeout:5e3})}};return n}),define("app/post/posttools/controller/posttools.like.controller",["jquery","underscore","singleton/CurrentUser","module/KinjaAnalytics","singleton/Utils","app/post/mixins/post.successMessage","templates/tiger/messages/postAction"],function(s,n,o,i,t,a){"use strict";var e={};return e=n.extend(e,a,{_trackRecommendation:function(s,n){var e,r=s.get("isStarter")?"Post":"Comment",o="sharingBottom"===n.$el.attr("data-analytics-target"),a="groupChat"===n.$el.parent().attr("data-analytics-target"),c="permalink"===t.getKinjaMeta().pageType;window.ga("send","event","Recommendation",r+" Recommended",s.get("permalink")),(!c||o||a)&&(t.getKinjaMeta().pageType===t.pageTypes.frontpage?e="homepage":t.getKinjaMeta().pageType===t.pageTypes.dashboard?e="dashboard":o?e="sharingBottom":a&&(e="groupChat"),i.pushEvent("RECOMMENDATION","POST",n.model.get("id"),{uiElement:e}))},_likePost:function(t,o){var i=t.get("liked")?"unlike":"like",a=t.setLike(i,{success:function(s){if("like"===i&&(e._trackRecommendation(t,o),e._displaySuccessMessage(tiger.messages.postAction.postRecommended),!t.get("isStarter")&&!t.get("approved"))){var a=n.pluck(s.response.approvalResult.approvedReplies,"postId"),r=o.model.get("id");-1!==n.indexOf(a,r)&&o.model.set({approved:!0})}},error:function(e){throw new Error("PostTools.likePost(): "+e.reason)}}),r=function(){t.trigger("posttools:post:likeCount:updated")};s.when(a).then(r)},API:{like:function(t,n){return!!s("body").hasClass("read-only")||void o.requireLogin("likePost").done(function(){e._likePost(t,n)})}}}),e.API}),define("app/post/posttools/controller/posttools.hide.controller",["config","jquery","singleton/Feature","singleton/CurrentUser","model/post/Post"],function(t,n,s,e,o){"use strict";var i={API:{hide:function(a,c){var l=a.get("id"),d=t.api.core.url+"/post/"+l+"/hide?token="+e.get("token"),i=null,r="/";e.isSuperuser()&&s.isOn("superuser")&&c()&&(a.has("parentId")&&(i=new o({id:a.get("parentId")}),r=i.has("permalink")?i.get("permalink"):"/"+i.id),n.ajax({url:d,type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){void 0!==e.meta&&e.meta.success===!0&&window.setTimeout(function(){window.location.href=r},1e3)}}))}}};return i.API}),define("templates/tiger/components/fullscreen-spinner",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(n,e,s,t){e.components.fullscreenSpinner=function(n,s,t){return'<div class="loading-full animate"><div class="loading-message-box">'+e.components.spinner.bounce(null,null,t)+"</div></div>"},t.DEBUG&&(e.components.fullscreenSpinner.soyTemplateName="tiger.components.fullscreenSpinner")}),define("view/Spinner",["jquery","view/BaseView","templates/tiger/components/spinner","templates/tiger/components/fullscreen-spinner"],function(e,t){"use strict";var n=t.extend({visible:!0,fullscreen:!1,tagName:"div",className:"spinner-wrapper",initialize:function(e){this.visible=void 0===e.initiallyVisible||e.initiallyVisible,this.fullscreen=void 0!==e.fullscreen&&e.fullscreen,this.render()},render:function(){var t;return this.visible&&(t=this.fullscreen?this.soyToHtml(tiger.components.fullscreenSpinner):this.soyToHtml(tiger.components.spinner.bounce,{})),this.$el.html(t),this.fullscreen?e(this.el).find(".animate").addClass("in"):e(this.el).addClass("with-margin"),this}});return n}),define("apiclient/repost",["config","apiclient/apirequest","apiclient/gettoken"],function(e,t,n){"use strict";return{unschedule:t.postJson(n.append(e.api.core.url+"/blog/{{blogId}}/removeRepostJob/{{postId}}")),reschedule:t.postJson(n.append(e.api.core.url+"/blog/{{blogId}}/updateRepostJob/{{postId}}?repostTime={{repostTime}}"))}}),define("app/post/posttools/posttools.controller",["jquery","underscore","singleton/CurrentUser","singleton/EventDispatcher","singleton/Feature","singleton/Utils","singleton/util/loadEditor","module/KinjaAnalytics","view/BaseView","app/post/common/post.layout","app/post/mixins/post.confirmationPrompt","app/post/posttools/posttools.menuview","app/post/posttools/controller/posttools.dismiss.controller","app/post/posttools/controller/posttools.block.controller","app/post/posttools/controller/posttools.like.controller","app/post/posttools/controller/posttools.hide.controller","module/flagging/ReplyFlaggingModule","app/post/mixins/post.successMessage","app/MarionetteApp","view/Spinner","apiclient/repost","templates/tiger/messages/postAction"],function(c,n,t,i,m,o,h,u,s,l,d,_,r,a,f,p,g,v,b,j,y){"use strict";var e=n.extend({},d,v,{_openSpinnerUntil:function(s,t){t=n.defaults({},{fullscreen:!0});var e=new j(t);return e.$el.appendTo("body"),c.when(s).then(e.remove.bind(e))},_like:function(e){e.model.get("tags")&&e.model.get("tags").length&&m.isOn("channels")&&!e.model.get("liked")&&b.vent.trigger("add:channel",{channelName:e.model.get("tags")[0].name,url:e.model.get("tags")[0].urlName}),f.like(e.model,e.view)},_reply:function(){require(["module/DiscussionModule"],function(e){e.replyToStarterPost()})},_dismiss:function(t){e._confirmationPrompt(tiger.messages.postAction.confirmDismissPost)&&r.dismiss(t.model)},_undismiss:function(e){r.undismiss(e.model)},_getDismissState:function(e){e.model.getActionState()},_delete:function(a){var t,i=a.model,r=this,c="dashboard"===o.getKinjaMeta().pageType||"manageblog"===o.getKinjaMeta().pageType;e._confirmationPrompt(tiger.messages.postAction.areYouSureToDelPost)&&(i.on("destroy",function(){r._displaySuccessMessage(tiger.messages.postAction.postDeleted),t=function(){window.location=c?window.location.pathname:s.prototype.cachebuster.call(s.prototype,"/")},n.delay(t,2e3)}),i.destroy({wait:!0}))},_unscheduleRepost:function(t){var i=this,a=t.view.el.getAttribute("data-postid"),r=t.view.el.getAttribute("data-blogid"),c=function(){window.location="private"===o.getKinjaMeta().pageType?window.location.pathname:s.prototype.cachebuster.call(s.prototype,"/")},l=function(){i._displaySuccessMessage(tiger.messages.postAction.repostUnscheduled),n.delay(c,2e3)};e._confirmationPrompt(tiger.messages.postAction.areYouSureToUnschedRepost)&&y.unschedule({postId:a,blogId:r}).done(l)},_promote:function(e){var n=e.model.id,s=t.hasPermission("SALES")||t.isSuperUser(),o=window.location.port?"http://kinja.dev:9000":"http://kinja.com";s&&(window.location.href=o+"/dfp/promotions/"+n)},_checkBlockStatus:function(e){a.checkBlockStatus(e.model,e.collection)},_postIsBlocked:function(e,t){return-1!==t.indexOf(e.get("authorBlogId"))},_block:function(t){var n=function(t){return e._confirmationPrompt(tiger.messages.postAction.confirmBlockBlog,t)};a.block(t.model,t.collection,n,t.targetBlogName,t.targetAuthorName)},_hide:function(t){var n=function(){return e._confirmationPrompt(tiger.messages.postAction.confirmHidePost)};p.hide(t.model,n)},_unflag:function(e){g.unflag(e,e.model)},_kinjaShare:function(e){var n;t.requireLogin("kinjaSharePost").done(function(){n=function(){return h().then(function(t){t.sharePost(e)})},e.has("original")?this._openSpinnerUntil(n()):this._openSpinnerUntil(e.fetch({success:n,preview:"PUBLISHED"!==e.get("status")}).then(n)),u.pushEvent("SHARE","POST",e.get("id"),{uiElement:"dropdown"})}.bind(this))},_externalShare:function(s){var e=s.view.$(".js_share-post-item"),o=e.attr("href"),i={twitter:"toolbar=0,status=0,width=480,height=360",facebook:"toolbar=0,status=0,width=480,height=360",tumblr:"toolbar=0,status=0,width=450,height=430"},t=n.intersection(e.attr("class").split(/\s+/),["twitter","facebook","tumblr"])[0];window.open(o,"share"+t,i[t])},_repost:function(s,e){var o="repost",i=this,n=t.get("membership").find(function(t){return t.get("blogId")===parseInt(e,10)});s.setAction(o,e,{success:function(){i._displaySuccessMessage(tiger.messages.postAction.postReposted,{blogName:n.get("blog").displayName,blogUrl:"http://"+n.get("blog").canonicalHost})},error:function(e){throw new Error("PostTools.repostPost(): "+e.reason)}})},_undoRepost:function(e){var t="actionreset",n=e.targetBlogId,s=e.model,o=this;s.setAction(t,n,{success:function(){o._displaySuccessMessage(tiger.messages.postAction.repostRemoved)},error:function(e){throw new Error("PostTools.undoRepost(): "+e.reason)}})},_openPupilModal:function(){var e=c.Deferred();return require(["app/pupil/PupilController"],function(t){t.show().then(e.resolve.bind(e))}.bind(this)),this._openSpinnerUntil(e)},_bindEvents:function(n,e){n.on("posttools:like",this._like.bind(this)),n.on("posttools:reply",this._reply.bind(this)),e.on("posttools:dismiss",this._dismiss.bind(this)),e.on("posttools:undismiss",this._undismiss.bind(this)),e.on("posttools:getDismissState",this._getDismissState.bind(this)),e.on("posttools:delete",this._delete.bind(this)),e.on("posttools:promote",this._promote.bind(this)),e.on("posttools:block",this._block.bind(this)),e.on("posttools:checkBlockStatus",this._checkBlockStatus.bind(this)),e.on("posttools:hide",this._hide.bind(this)),e.on("posttools:unflag",this._unflag.bind(this)),e.on("posttools:kinjaShare",this._kinjaShare.bind(this)),e.on("posttools:externalShare",this._externalShare.bind(this)),e.on("posttools:repost",this._repost.bind(this)),e.on("posttools:undorepost",this._undoRepost.bind(this)),e.on("close",function(){t.off(null,null,e),i.off(null,null,e),e.model.off(null,null,e)}),e.on("posttools:menuview:togglehidden",function(e){n.togglePostToolsVisibility(e)}),e.on("reposttools:unschedule",this._unscheduleRepost.bind(this)),e.on("posttools:pupil",this._openPupilModal.bind(this))},API:{startPostTools:function(c,n){var d="undefined"!=typeof n.get("defaultBlogId")?n.get("defaultBlogId"):o.getKinjaMeta().blog.id,s=new _({el:c.find(".js_post-dropdown-ct"),model:n,blockedBlogCollection:a.getBlockedBlogCollection(d)}),r=new l({el:c,model:n});r.post.attachView(s),r.bindUIElements(),r.updateUserState(),e._bindEvents(r,s),i.on("posttools:close:"+n.get("id"),function(){s.close()}),t.onAuth.done(s.render.bind(s))},closePostTools:function(e){i.trigger("posttools:close:"+e)},bindEvents:function(t,n){e._bindEvents(t,n)}}});return e.API}),define("templates/tiger/icons/essential/definitions",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(n,e,s,t){e.icons.essential.definitions=function(){return'<svg id="svggroup--essential" class="hide"><symbol id="iconset-search" viewBox="0 0 15 15"><path d="M9.5 8C11.433 8 13 6.433 13 4.5S11.433 1 9.5 1 6 2.567 6 4.5 7.567 8 9.5 8zm-3.233-.975c.196-.195.518-.19.708 0 .195.195.19.517 0 .708l-4.95 4.95c-.195.194-.517.19-.707 0-.195-.196-.19-.518 0-.708l4.95-4.95zM9.5 9C7.015 9 5 6.985 5 4.5S7.015 0 9.5 0 14 2.015 14 4.5 11.985 9 9.5 9z" /></symbol><symbol id="iconset-add" viewBox="0 0 18 18"><path d="M9 2.494C9 2.226 8.776 2 8.5 2c-.268 0-.5.22-.5.494V8H2.494C2.226 8 2 8.224 2 8.5c0 .268.22.5.494.5H8v5.506c0 .268.224.494.5.494.268 0 .5-.22.5-.494V9h5.506c.268 0 .494-.224.494-.5 0-.268-.22-.5-.494-.5H9V2.494z" /></symbol><symbol id="iconset-add--small" viewBox="0 0 10 10"><path d="M6 1.007C6 .45 5.552 0 5 0c-.556 0-1 .45-1 1.007V4H1.007C.45 4 0 4.448 0 5c0 .556.45 1 1.007 1H4v2.993C4 9.55 4.448 10 5 10c.556 0 1-.45 1-1.007V6h2.993C9.55 6 10 5.552 10 5c0-.556-.45-1-1.007-1H6V1.007z"></path></symbol><symbol id="iconset-site-default" viewBox="0 0 18 18"><path d="M9 16.158c3.953 0 7.158-3.205 7.158-7.158 0-3.953-3.205-7.158-7.158-7.158-3.953 0-7.158 3.205-7.158 7.158 0 3.953 3.205 7.158 7.158 7.158zM9 17c-4.418 0-8-3.582-8-8s3.582-8 8-8 8 3.582 8 8-3.582 8-8 8z"/><path d="M9 16.158c1.97 0 3.79-3.143 3.79-7.158 0-4.015-1.82-7.158-3.79-7.158S5.21 4.985 5.21 9c0 4.015 1.82 7.158 3.79 7.158zM9 17c-2.558 0-4.632-3.582-4.632-8S6.442 1 9 1s4.632 3.582 4.632 8S11.558 17 9 17z"/><path d="M2.742 4.674c1.69.883 3.947 1.383 6.345 1.383 2.396 0 4.65-.5 6.34-1.38l-.39-.746c-1.564.82-3.684 1.29-5.95 1.29-2.27 0-4.39-.47-5.955-1.28l-.39.746zm.39 9.403c1.564-.817 3.686-1.288 5.955-1.288 2.266 0 4.386.47 5.95 1.28l.39-.75c-1.69-.88-3.944-1.38-6.34-1.38-2.398 0-4.654.5-6.345 1.38l.39.744z"/><path d="M8.58 8.58H1.083v.84H8.58v7.496h.84V9.42h7.496v-.84H9.42V1.083h-.84V8.58z" /></symbol><symbol id="iconset-zoom-in" viewBox="0 0 18 18"><path d="M9 4.494C9 4.226 9.224 4 9.5 4c.268 0 .5.22.5.494V7h2.506c.268 0 .494.224.494.5 0 .268-.22.5-.494.5H10v2.506c0 .268-.224.494-.5.494-.268 0-.5-.22-.5-.494V8H6.494C6.226 8 6 7.776 6 7.5c0-.268.22-.5.494-.5H9V4.494zM9.5 13C6.462 13 4 10.538 4 7.5S6.462 2 9.5 2 15 4.462 15 7.5 12.538 13 9.5 13zm-4.877-1.36l-3.48 3.51c-.194.194-.188.514 0 .703.196.195.51.196.704.002l3.48-3.51c-.304-.275-.416-.34-.704-.706zM9.5 14c3.59 0 6.5-2.91 6.5-6.5S13.09 1 9.5 1 3 3.91 3 7.5 5.91 14 9.5 14z" /></symbol><symbol id="iconset-star" viewBox="0 0 18 18"><path d="M9.005 13.115L4.083 16.88l1.895-6.07-4.943-3.563 6.094.014L9 1.01l1.866 6.25 6.093-.01-4.93 3.563 1.89 6.07z" /></symbol><symbol id="iconset-star--giant" viewBox="0 0 24 24"><path d="M12 17.8l-7.053 4.908 2.488-8.225-6.848-5.19 8.592-.176L12 1l2.82 8.117 8.593.175-6.848 5.19 2.488 8.226z" /></symbol><symbol id="iconset-star-circle" viewBox="0 0 18 18"><path d="M9 17c4.418 0 8-3.582 8-8s-3.582-8-8-8-8 3.582-8 8 3.582 8 8 8zM9 3.7c.093 0 .185.06.208.158l1.146 3.39 3.413.085c.104 0 .185.073.22.17.034.097 0 .207-.08.267l-2.72 2.175.972 3.44c.03.096 0 .206-.09.266-.05.04-.097.05-.14.05-.05 0-.09-.02-.13-.05L9 11.61l-2.81 2.04c-.036.038-.082.05-.13.05-.045 0-.09-.012-.138-.05-.07-.06-.104-.17-.08-.266l.97-3.44L4.095 7.77c-.08-.06-.115-.17-.08-.267.034-.097.127-.17.22-.17l3.412-.085 1.134-3.39c.04-.098.13-.158.22-.158z" /></symbol><symbol id="iconset-chevron-right" viewBox="0 0 18 18"><path d="M6.165 3.874c-.217-.204-.22-.53-.008-.73.206-.192.56-.195.776.008l5.902 5.48c.11.102.165.236.165.37-.002.126-.055.262-.165.365l-5.902 5.478c-.217.204-.564.207-.776.007-.206-.193-.21-.525.008-.728L11.69 9 6.165 3.873z" /></symbol><symbol id="iconset-chevron-right--small" viewBox="0 0 10 10"><path d="M7.782 4.497L3.272.207c-.287-.274-.763-.278-1.054 0-.292.277-.29.724.002 1L6.205 5 2.22 8.79c-.288.273-.292.726-.002 1.002.293.28.763.276 1.054 0l4.51-4.29C7.926 5.363 8 5.18 8 5c.002-.183-.072-.364-.218-.503z" /></symbol><symbol id="iconset-flame" viewBox="0 0 18 18"><path d="M3.923 10.89c0 2.678 2.447 5.17 5.077 5.17s5.077-2.492 5.077-5.17c0-1.752-.618-3.036-1.977-4.664-1.196-1.433-1.154-3.453-1.093-3.453-.356-.04-2.164 2.918-2.49 5.764-.507 1.5-2.29 1.018-2.543-.126-.245-.62-.296-1.97-.296-2.47 0-.5-1.755 2.72-1.755 4.95zm2.962-2.617c.25.344.63.345.72.077.185-2.933 2.015-5.63 2.643-6.247.78-.766 1.7-1.444 1.984-.915.072.135-.047.438-.167.826-.267.863-.412 2.224.738 3.602C13.883 6.912 15 8.516 15 10.89c0 3.2-2.86 6.11-6 6.11s-6-2.912-6-6.11c0-2.018 1.45-5.456 2.972-6.798l.198-.17c.233-.197.806-.146.715.164-.837 2.85 0 4.187 0 4.187z" /></symbol><symbol id="iconset-flame--giant" viewBox="0 0 24 24"><path d="M9.004 10.954c.353.496.89.497 1.02.112.262-4.217 2.854-8.093 3.743-8.98C14.872.984 16.177.01 16.577.77c.103.194-.065.63-.235 1.187-.378 1.242-.583 3.198 1.046 5.18 1.532 1.86 3.112 4.166 3.112 7.58 0 4.597-4.052 8.783-8.5 8.783s-8.5-4.186-8.5-8.782c0-3.652 2.056-7.844 4.21-9.773l.28-.243c.33-.285 1.143-.212 1.014.234-1.186 4.096 0 6.018 0 6.018z" /></symbol><symbol id="iconset-logo-kinja" viewBox="0 0 18 18"><path d="M2.898 8.293c.746.24 1.423.978 1.734 1.495.31.517 2.246 3.78 2.905 4.916.726 1.253 1.743 1.294 2.308 1.294h4.125s-3.023-5.378-3.943-6.846c-.622-.994-1.452-1.11-2.374-1.11H2.1C2.093 8.042 3 7.065 5 7c2-.065 5.284.006 6.64 0 1.354-.006 2.046-.727 2.33-1.195.284-.468 2.03-3.8 2.03-3.8S8.793 1.995 6.992 2c-1.21.006-1.734.647-2.197 1.41l-2.792 4.6c-.01.017.007.07.017.098 0 0 .35.018.878.186z" /><</symbol><symbol id="iconset-bubble" viewBox="0 0 18 18"><path d="M6.292 13.952l.34-.503.577.1c.43.07.86.11 1.29.11 3.65 0 6.56-2.65 6.56-5.84 0-3.186-2.91-5.836-6.57-5.836-3.657 0-6.566 2.65-6.566 5.836 0 1.918 1.054 3.7 2.83 4.84l.437.256c0 .18-.375 2.06-.57 2.54-.054.132 1.12-.71 1.66-1.51zm-2.01-.426C2.3 12.254 1 10.182 1 7.832 1 4.06 4.358 1 8.5 1 12.642 1 16 4.06 16 7.832c0 3.774-3.36 6.833-7.5 6.833-.495 0-.978-.047-1.447-.13-.32.473-2.45 2.172-3.165 2.4-.714.226-.823-.164-.51-.713.313-.548.903-1.95.903-2.696z" /></symbol><symbol id="iconset-bubble--giant" viewBox="0 0 24 24"><path d="M6.094 18.506C3.324 16.678 1.5 13.7 1.5 10.32 1.5 4.9 6.2.5 12 .5s10.5 4.398 10.5 9.82c0 5.425-4.702 9.823-10.5 9.823-.694 0-1.37-.067-2.025-.187-.45.68-3.432 3.123-4.432 3.45-1 .326-1.15-.235-.713-1.024.438-.788 1.264-2.802 1.264-3.876z" /></symbol><symbol id="iconset-checkmark" viewBox="0 0 18 18"><path d="M14.855 5.87c.192-.195.195-.523 0-.722-.19-.194-.51-.2-.706 0l-7.418 7.62-2.88-2.978c-.19-.195-.515-.2-.71-.002-.19.194-.194.525.003.726L6.38 13.85c.095.1.224.15.353.15.128 0 .257-.047.355-.147l7.767-7.982z" /></symbol><symbol id="iconset-checkmark--small" viewBox="0 0 10 10"><path d="M.292 5.078c-.39.4-.388 1.044-.002 1.442l2.038 2.15c.313.344 1.125.526 1.703 0L9.71 2.746c.39-.402.388-1.046 0-1.445-.39-.402-1.014-.4-1.4 0l-5.11 5.39L1.69 5.075C1.31 4.683.68 4.68.293 5.078z"></path></symbol><symbol id="iconset-close" viewBox="0 0 18 18"><path d="M1.737 1.12c-.16-.158-.44-.164-.61.006-.165.165-.172.443-.005.61L7.885 8.5l-6.763 6.764c-.167.167-.16.445.005.61.17.17.45.164.61.005L8.5 9.11l6.763 6.764c.16.158.44.164.61-.006.165-.164.172-.442.005-.61L9.115 8.5l6.763-6.764c.167-.167.16-.445-.005-.61-.17-.17-.45-.164-.61-.005L8.5 7.89 1.737 1.12z" /></symbol><symbol id="iconset-close--small" viewBox="0 0 10 10"><path d="M2.884 1.47c-.394-.394-1.03-.395-1.42-.005-.392.393-.387 1.026.006 1.42L3.586 5 1.47 7.116c-.394.394-.395 1.03-.005 1.42.393.392 1.026.387 1.42-.006L5 6.414 7.116 8.53c.394.394 1.03.395 1.42.005.392-.393.387-1.026-.006-1.42L6.414 5 8.53 2.884c.394-.394.395-1.03.005-1.42-.393-.392-1.026-.387-1.42.006L5 3.586 2.884 1.47z" /></symbol><symbol id="iconset-facebook" viewBox="0 0 18 18"><path d="M7.003 17l-.006-7H4l.006-3h2.997V4.995C7.003 2.408 8.457 1 10.808 1c1.126 0 1.91.082 2.192.12v2.877h-1.447c-1.278 0-1.526.597-1.526 1.472V7h2.866l-.403 3h-2.47l.007 7H7.003z" /></symbol><symbol id="iconset-twitter" viewBox="0 0 18 18"><path d="M12.077 2c-1.812 0-3.282 1.582-3.282 3.534 0 .277.03.547.085.806-2.728-.148-5.147-1.555-6.766-3.693-.283.522-.445 1.13-.445 1.777 0 1.226.58 2.308 1.46 2.942-.54-.02-1.05-.178-1.49-.443v.045c0 1.712 1.13 3.14 2.63 3.465-.28.08-.57.124-.87.124-.21 0-.418-.022-.62-.063.418 1.404 1.63 2.426 3.067 2.455-1.125.94-2.54 1.51-4.078 1.51-.267 0-.528-.02-.785-.05 1.46 1 3.185 1.59 5.04 1.59 6.037 0 9.34-5.39 9.34-10.06 0-.153-.005-.306-.01-.457.64-.5 1.197-1.12 1.637-1.83-.59.28-1.22.47-1.885.557.677-.437 1.198-1.13 1.443-1.955-.633.405-1.336.7-2.084.858C13.88 2.43 13.028 2 12.08 2" /></symbol><symbol id="iconset-googleplus" viewBox="0 0 18 18"><path d="M13.657 13.42c0 .914-.4 1.74-1.202 2.475-.4.354-.916.62-1.545.796-.573.208-1.245.31-2.017.31-1.402 0-2.575-.264-3.52-.795C4.457 15.645 4 14.938 4 14.085c0-.62.2-1.18.6-1.68.43-.59 1.002-1.033 1.718-1.327.658-.324 1.46-.487 2.403-.487.03 0 .798-.15.827-.15-.458-.382-.653-.57-.653-1.04 0-.355.043-.665.214-.93h-.472c-1.058 0-1.903-.574-2.618-1.28-.686-.708-1.03-1.56-1.03-2.565 0-.972.43-1.812 1.288-2.52C7.106 1.37 8.09 1 9.236 1H14l-1.073.796h-1.502c.486.236.872.604 1.16 1.105.284.59.428 1.166.428 1.725 0 1.032-.472 1.9-1.416 2.608-.373.295-.63.546-.773.752-.115.147-.172.383-.172.707 0 .325.444.84 1.33 1.548.573.413 1.002.87 1.288 1.37.258.472.387 1.076.387 1.812zM11.31 4.483c-.145-.705-.46-1.29-.95-1.75-.487-.488-1.06-.73-1.72-.73-.604-.025-1.077.18-1.422.62-.373.46-.517 1.057-.43 1.787.143.73.473 1.337.99 1.824.517.51 1.076.766 1.68.766.66 0 1.162-.243 1.506-.73.373-.486.488-1.082.345-1.787zm.153 10.713c.55-.38.826-.862.826-1.445 0-1.7-2.757-2.05-3.06-2.05-.88 0-1.667.19-2.356.573-.69.403-1.033.873-1.033 1.41 0 .54.304 1.01.91 1.413.58.403 1.295.605 2.15.605 1.13 0 1.983-.167 2.56-.503z" fill-rule="evenodd"/></symbol><symbol id="iconset-external-link" viewBox="0 0 18 18"><path d="M3.006 17C1.898 17 1 16.103 1 14.994V5.006C1 3.898 1.897 3 3.006 3H5.5c.276 0 .5.224.5.5s-.224.5-.5.5H3.006C2.45 4 2 4.45 2 5.006v9.988C2 15.55 2.45 16 3.006 16h9.988C13.55 16 14 15.55 14 14.994V11.5c0-.276.224-.5.5-.5s.5.224.5.5v3.494C15 16.102 14.103 17 12.994 17H3.006zM10 1.5c0-.276.228-.5.51-.5h5.98c.51 0 .51.5.51.51v5.98c0 .282-.232.51-.5.51-.276 0-.5-.228-.5-.51V2.75l-8.095 8.1c-.206.204-.548.197-.75-.004-.207-.207-.205-.545-.002-.748L15.247 2H10.51c-.282 0-.51-.232-.51-.5z" /></symbol><symbol id="iconset-link" viewBox="0 0 18 18"><path d="M8.72 13.36l-2.044 2.017c-.954.952-2.418.797-3.05.083L2.53 14.18c-.942-.93-.59-2.446 0-3.072.96-1.017 3.698-3.656 3.698-3.656.952-.975 2.245-1.038 3.27 0 1.023 1.038.97.997.97.997.262.26.64.21.835 0 .195-.22.16-.58-.102-.85l-.94-.93c-1.31-1.35-3.322-1.3-4.61 0l-3.68 3.75c-1.28 1.26-1.28 3.38 0 4.68l.92.93c.627.63 1.45.96 2.337.96.887 0 1.71-.335 2.334-.966L9.4 14.17c.263-.266.263-.555 0-.82-.263-.266-.673 0-.673 0zm.56-8.72l2.044-2.017c.954-.952 2.418-.797 3.05-.083l1.095 1.28c.94.93.59 2.446 0 3.072-.96 1.017-3.7 3.656-3.7 3.656-.95.975-2.25 1.038-3.27 0s-.97-.997-.97-.997c-.26-.26-.64-.21-.84 0-.2.22-.16.58.1.85l.944.93c1.31 1.35 3.327 1.3 4.61 0l3.68-3.75c1.284-1.26 1.284-3.38 0-4.68l-.92-.93c-.62-.63-1.443-.96-2.33-.96-.888 0-1.71.334-2.335.965L8.6 3.825c-.262.266-.262.555 0 .82.264.266.674 0 .674 0z" /></symbol><symbol id="iconset-image" viewBox="0 0 18 18"><path d="M1 2.994v12.012c0 .548.446.994.995.994h14.01c.55 0 .995-.445.995-.994V2.994c0-.548-.446-.994-.995-.994H1.995C1.445 2 1 2.445 1 2.994zm-1 0C0 1.894.893 1 1.995 1h14.01C17.107 1 18 1.895 18 2.994v12.012c0 1.1-.893 1.994-1.995 1.994H1.995C.893 17 0 16.105 0 15.006V2.994z"/><path d="M1.38 15.804L5.807 8.24l-.86.007 3.682 6.068c.17.288.573.324.8.073l2.5-2.82-.74.01 4.514 4.832c.188.202.504.213.706.024.203-.19.213-.505.025-.707l-4.515-4.83c-.2-.216-.543-.212-.74.008l-2.5 2.82.8.07L5.8 7.728c-.197-.324-.67-.32-.86.007L.51 15.298c-.137.24-.057.545.18.684.24.14.546.06.685-.178zM12 9c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zm0 1c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3z"/></symbol><symbol id="iconset-burner" viewBox="0 0 18 18"><path d="M14.24 10.837c-.39.175-.853.28-1.387.28-.27 0-.593-.044-.955-.126-.344-.07-.713-.19-1.093-.32-.284-.1-1.218-.51-1.31-.54-.158-.06-.32-.093-.488-.093-.175 0-.336.038-.493.096-.092.035-1.035.444-1.32.545-.38.136-.748.247-1.093.326-.36.083-.68.127-.95.127-.53 0-.99-.103-1.39-.28-.22-.1-.55-.353-.65-.46-.17-.18-.34-.39-.502-.634-.38-.57-.635-1.22-.712-1.934l-.006.14c.268-1.33 1.078-2.07 2.03-2.07 1.53 0 2.884.31 4.662 1.284 0 0 .266.147.41.147.146 0 .43-.143.43-.143 1.78-.974 3.137-1.282 4.666-1.282.95 0 1.762.74 2.038 2.057l-.002-.14c-.076.72-.33 1.364-.71 1.94-.162.24-.335.453-.507.633-.1.105-.43.36-.657.46zm1.907-.61c.453-.684.76-1.463.853-2.33l-.007-.137C16.635 6.053 15.48 5 14.083 5c-1.672 0-3.175.34-5.093 1.393C7.092 5.34 5.59 5 3.916 5c-1.397 0-2.55 1.053-2.91 2.76L1 7.897c.093.867.4 1.646.853 2.33.33.498.664.846.9 1.036.114.1.332.24.64.38.503.223 1.09.357 1.754.357.346 0 .732-.052 1.154-.15.39-.086.79-.207 1.2-.354.31-.108.6-.223.87-.34.16-.068.6-.248.647-.248.045 0 .474.18.636.25.27.115.56.23.865.338.41.147.813.268 1.195.355.42.1.805.15 1.15.15.666 0 1.25-.13 1.755-.35.31-.14.528-.28.65-.39.228-.18.56-.53.89-1.03zm-9.99-2.604c-.155-.077-.316-.133-.483-.17-.53-.118-1.078-.037-1.605.164-.22.08-.38.164-.48.223l-.24.146.03.28c.07.623.45 1.266 1.22 1.502.34.11.77.117 1.27.05.3-.044.63-.115.95-.206.19-.053.373-.11.54-.167.1-.034.174-.062.22-.078l.735-.285-.628-.477c-.07-.052-.2-.145-.394-.273-.315-.21-.69-.444-1.13-.696l-.02-.013zm.243 1.19s-.447.1-.654.13c-.374.05-.68.046-.878-.017-.367-.114-.48-.485-.48-.485s.76-.2 1.093-.12c.1.02.92.5.92.5zm5.42-1.177c-.437.252-.813.485-1.128.696-.192.128-.322.22-.39.273l-.63.477.74.285c.042.016.117.044.218.078.167.057.35.114.542.167.33.09.652.162.96.205.493.068.92.06 1.27-.05.762-.235 1.146-.88 1.214-1.502l.03-.28-.24-.145c-.1-.06-.263-.142-.475-.223-.52-.2-1.07-.282-1.6-.164-.16.037-.32.093-.48.17l-.02.013zm.7.68c.333-.075 1.09.125 1.09.125s-.11.38-.475.49c-.202.07-.507.07-.88.02-.265-.032-.64-.15-.64-.15s.808-.45.904-.472z" /></symbol><symbol id="spinner" viewBox="0 0 37 12" stroke="#aaa" fill="none"><circle cx="6" cy="6" r="4"><animate attributeName="r" begin="0s" dur="0.65s" values="0;4" calcMode="spline" keySplines="0.51 0 0.21 0.9" repeatCount="indefinite"/><animate attributeName="stroke-opacity" begin="0s" dur="0.65s" values="0;1" calcMode="spline" keySplines="0.51 0 0.21 0.9" repeatCount="indefinite"/></circle><circle cx="6" cy="6" r="4"><animate attributeName="cx" begin="0s" dur="0.65s" values="6;19" calcMode="spline" keySplines="0.51 0 0.21 0.9" repeatCount="indefinite"/></circle><circle cx="19" cy="6" r="4"><animate attributeName="cx" begin="0s" dur="0.65s" values="19;32" calcMode="spline" keySplines="0.51 0 0.21 0.9" repeatCount="indefinite"/></circle><circle cx="32" cy="6" r="4"><animate attributeName="r" begin="0s" dur="0.65s" values="4;0" calcMode="spline" keySplines="0.51 0 0.21 0.9" repeatCount="indefinite"/><animate attributeName="stroke-opacity" begin="0s" dur="0.65s" values="1;0" calcMode="spline" keySplines="0.51 0 0.21 0.9" repeatCount="indefinite"/></circle></symbol><symbol id="iconset-tools--giant" viewBox="0 0 24 24"><path d="M12 5.5c1.38 0 2.5-1.12 2.5-2.5S13.38.5 12 .5 9.5 1.62 9.5 3s1.12 2.5 2.5 2.5zm0 18c1.38 0 2.5-1.12 2.5-2.5s-1.12-2.5-2.5-2.5-2.5 1.12-2.5 2.5 1.12 2.5 2.5 2.5zm0-9c1.38 0 2.5-1.12 2.5-2.5S13.38 9.5 12 9.5 9.5 10.62 9.5 12s1.12 2.5 2.5 2.5z" /></symbol></svg>'},t.DEBUG&&(e.icons.essential.definitions.soyTemplateName="tiger.icons.essential.definitions")}),define("templates/tiger/icons/essential/usage",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(n,e,s,t){e.icons.essential.search=function(){return'<svg class="svg-icon svg-search"><use xlink:href="#iconset-search" /></svg>'},t.DEBUG&&(e.icons.essential.search.soyTemplateName="tiger.icons.essential.search"),e.icons.essential.add=function(){return'<svg class="svg-icon svg-add"><use xlink:href="#iconset-add" /></svg>'},t.DEBUG&&(e.icons.essential.add.soyTemplateName="tiger.icons.essential.add"),e.icons.essential.adDMSall=function(){return'<svg class="svg-icon small svg-add--small"><use xlink:href="#iconset-add--small" /></svg>'},t.DEBUG&&(e.icons.essential.adDMSall.soyTemplateName="tiger.icons.essential.adDMSall"),e.icons.essential.siteDefault=function(){return'<svg class="svg-icon svg-site-default"><use xlink:href="#iconset-site-default" /></svg>'},t.DEBUG&&(e.icons.essential.siteDefault.soyTemplateName="tiger.icons.essential.siteDefault"),e.icons.essential.zoomIn=function(){return'<svg class="svg-icon svg-zoom-in"><use xlink:href="#iconset-zoom-in" /></svg>'},t.DEBUG&&(e.icons.essential.zoomIn.soyTemplateName="tiger.icons.essential.zoomIn"),e.icons.essential.star=function(){return'<svg class="svg-icon svg-star"><use xlink:href="#iconset-star" /></svg>'},t.DEBUG&&(e.icons.essential.star.soyTemplateName="tiger.icons.essential.star"),e.icons.essential.starGiant=function(){return'<svg class="svg-icon giant stroked svg-star--giant"><use xlink:href="#iconset-star--giant" /></svg>'},t.DEBUG&&(e.icons.essential.starGiant.soyTemplateName="tiger.icons.essential.starGiant"),e.icons.essential.starCircle=function(){return'<svg class="svg-icon svg-star-circle"><use xlink:href="#iconset-star-circle" /></svg>'},t.DEBUG&&(e.icons.essential.starCircle.soyTemplateName="tiger.icons.essential.starCircle"),e.icons.essential.chevronRight=function(){return'<svg class="svg-icon svg-chevron chevron--right"><use xlink:href="#iconset-chevron-right" /></svg>'},t.DEBUG&&(e.icons.essential.chevronRight.soyTemplateName="tiger.icons.essential.chevronRight"),e.icons.essential.chevronRightSmall=function(){return'<svg class="svg-icon small svg-chevron--small chevron--right"><use xlink:href="#iconset-chevron-right--small" /></svg>'},t.DEBUG&&(e.icons.essential.chevronRightSmall.soyTemplateName="tiger.icons.essential.chevronRightSmall"),e.icons.essential.chevronBottom=function(){return'<svg class="svg-icon svg-chevron chevron--bottom"><use xlink:href="#iconset-chevron-right" /></svg>'},t.DEBUG&&(e.icons.essential.chevronBottom.soyTemplateName="tiger.icons.essential.chevronBottom"),e.icons.essential.chevronBottomSmall=function(){return'<svg class="svg-icon small svg-chevron--small chevron--bottom"><use xlink:href="#iconset-chevron-right--small" /></svg>'},t.DEBUG&&(e.icons.essential.chevronBottomSmall.soyTemplateName="tiger.icons.essential.chevronBottomSmall"),e.icons.essential.chevronLeft=function(){return'<svg class="svg-icon svg-chevron chevron--left"><use xlink:href="#iconset-chevron-right" /></svg>'},t.DEBUG&&(e.icons.essential.chevronLeft.soyTemplateName="tiger.icons.essential.chevronLeft"),e.icons.essential.chevronLeftSmall=function(){return'<svg class="svg-icon small svg-chevron--small chevron--left"><use xlink:href="#iconset-chevron-right--small" /></svg>'},t.DEBUG&&(e.icons.essential.chevronLeftSmall.soyTemplateName="tiger.icons.essential.chevronLeftSmall"),e.icons.essential.chevronTop=function(){return'<svg class="svg-icon svg-chevron chevron--top"><use xlink:href="#iconset-chevron-right" /></svg>'},t.DEBUG&&(e.icons.essential.chevronTop.soyTemplateName="tiger.icons.essential.chevronTop"),e.icons.essential.chevronTopSmall=function(){return'<svg class="svg-icon small svg-chevron--small chevron--top"><use xlink:href="#iconset-chevron-right--small" /></svg>'},t.DEBUG&&(e.icons.essential.chevronTopSmall.soyTemplateName="tiger.icons.essential.chevronTopSmall"),e.icons.essential.flame=function(){return'<svg class="svg-icon svg-flame"><use xlink:href="#iconset-flame" /></svg>'},t.DEBUG&&(e.icons.essential.flame.soyTemplateName="tiger.icons.essential.flame"),e.icons.essential.flameGiant=function(){return'<svg class="svg-icon giant stroked svg-flame--giant"><use xlink:href="#iconset-flame--giant" /></svg>'},t.DEBUG&&(e.icons.essential.flameGiant.soyTemplateName="tiger.icons.essential.flameGiant"),e.icons.essential.kinja=function(){return'<svg class="svg-icon svg-logo-kinja"><use xlink:href="#iconset-logo-kinja" /></svg>'},t.DEBUG&&(e.icons.essential.kinja.soyTemplateName="tiger.icons.essential.kinja"),e.icons.essential.bubble=function(){return'<svg class="svg-icon svg-bubble"><use xlink:href="#iconset-bubble" /></svg>'},t.DEBUG&&(e.icons.essential.bubble.soyTemplateName="tiger.icons.essential.bubble"),e.icons.essential.bubbleGiant=function(){return'<svg class="svg-icon giant stroked svg-bubble--giant"><use xlink:href="#iconset-bubble--giant" /></svg>'},t.DEBUG&&(e.icons.essential.bubbleGiant.soyTemplateName="tiger.icons.essential.bubbleGiant"),e.icons.essential.checkmark=function(){return'<svg class="svg-icon svg-checkmark"><use xlink:href="#iconset-checkmark" /></svg>'},t.DEBUG&&(e.icons.essential.checkmark.soyTemplateName="tiger.icons.essential.checkmark"),e.icons.essential.checkmarkSmall=function(){return'<svg class="svg-icon small svg-checkmark--small"><use xlink:href="#iconset-checkmark--small" /></svg>'},t.DEBUG&&(e.icons.essential.checkmarkSmall.soyTemplateName="tiger.icons.essential.checkmarkSmall"),e.icons.essential.close=function(){return'<svg class="svg-icon svg-close"><use xlink:href="#iconset-close" /></svg>'},t.DEBUG&&(e.icons.essential.close.soyTemplateName="tiger.icons.essential.close"),e.icons.essential.closeSmall=function(){return'<svg class="svg-icon small svg-close--small"><use xlink:href="#iconset-close--small" /></svg>'},t.DEBUG&&(e.icons.essential.closeSmall.soyTemplateName="tiger.icons.essential.closeSmall"),e.icons.essential.facebook=function(){return'<svg class="svg-icon svg-facebook"><use xlink:href="#iconset-facebook" /></svg>'},t.DEBUG&&(e.icons.essential.facebook.soyTemplateName="tiger.icons.essential.facebook"),e.icons.essential.twitter=function(){return'<svg class="svg-icon svg-twitter"><use xlink:href="#iconset-twitter" /></svg>'},t.DEBUG&&(e.icons.essential.twitter.soyTemplateName="tiger.icons.essential.twitter"),e.icons.essential.googleplus=function(){return'<svg class="svg-icon svg-googleplus"><use xlink:href="#iconset-googleplus" /></svg>'},t.DEBUG&&(e.icons.essential.googleplus.soyTemplateName="tiger.icons.essential.googleplus"),e.icons.essential.externalLink=function(){return'<svg class="svg-icon svg-external-link"><use xlink:href="#iconset-external-link" /></svg>'},t.DEBUG&&(e.icons.essential.externalLink.soyTemplateName="tiger.icons.essential.externalLink"),e.icons.essential.burner=function(){return'<svg class="svg-icon svg-burner"><use xlink:href="#iconset-burner" /></svg>'},t.DEBUG&&(e.icons.essential.burner.soyTemplateName="tiger.icons.essential.burner"),e.icons.essential.link=function(){return'<svg class="svg-icon svg-link"><use xlink:href="#iconset-link" /></svg>'},t.DEBUG&&(e.icons.essential.link.soyTemplateName="tiger.icons.essential.link"),e.icons.essential.image=function(){return'<svg class="svg-icon svg-image"><use xlink:href="#iconset-image" /></svg>'},t.DEBUG&&(e.icons.essential.image.soyTemplateName="tiger.icons.essential.image"),e.icons.essential.spinner=function(){return'<svg class="svg-icon svg-image"><use xlink:href="#spinner" /></svg>'},t.DEBUG&&(e.icons.essential.spinner.soyTemplateName="tiger.icons.essential.spinner"),e.icons.essential.toolsGiant=function(){return'<svg class="svg-icon giant stroked svg-tools--giant"><use xlink:href="#iconset-tools--giant" /></svg>'},t.DEBUG&&(e.icons.essential.toolsGiant.soyTemplateName="tiger.icons.essential.toolsGiant"),e.icons.essential.facebook__C17=function(){return'<svg class="svg-icon svg-facebook"><use xlink:href="#iconset-facebook" /></svg>'},t.DEBUG&&(e.icons.essential.facebook__C17.soyTemplateName="tiger.icons.essential.facebook__C17"),e.icons.essential.twitter__C17=function(){return'<svg class="svg-icon svg-twitter"><use xlink:href="#iconset-twitter" /></svg>'},t.DEBUG&&(e.icons.essential.twitter__C17.soyTemplateName="tiger.icons.essential.twitter__C17"),e.icons.essential.googleplus__C17=function(){return'<svg class="svg-icon svg-googleplus"><use xlink:href="#iconset-googleplus" /></svg>'},t.DEBUG&&(e.icons.essential.googleplus__C17.soyTemplateName="tiger.icons.essential.googleplus__C17"),e.icons.essential.chevronBottomSmall__C17=function(){return'<svg class="svg-icon small svg-chevron--small chevron--bottom"><use xlink:href="#iconset-chevron-right--small" /></svg>'},t.DEBUG&&(e.icons.essential.chevronBottomSmall__C17.soyTemplateName="tiger.icons.essential.chevronBottomSmall__C17"),e.icons.essential.closeSmall__C17=function(){return'<svg class="svg-icon small svg-close--small"><use xlink:href="#iconset-close--small" /></svg>'},t.DEBUG&&(e.icons.essential.closeSmall__C17.soyTemplateName="tiger.icons.essential.closeSmall__C17")}),define("module/EssentialIconModule",["jquery","templates/tiger/icons/essential/definitions","templates/tiger/icons/essential/usage"],function(e){"use strict";var t=e("#svggroup--essential");t&&t.length||e("#js_svg-definitions").append(e.trim(tiger.icons.essential.definitions()))}),define("lib/amd-wrapped/jquery.lightbox-0.5",["jquery"],function(e){e.fn.lightBox=function(t){function g(){return p(this,b),!1}function p(i,o){var s,r,a=e(i).siblings("span").find("img");if(e("embed, object, select").css({visibility:"hidden"}),f(),t.imageArray.length=0,t.activeImage=0,1==o.length)t.imageArray.push(new Array(a.attr("data-original-src"),i.getAttribute("title")));else for(s=0;s<o.length;s++)r=o.eq(s).siblings("span").find("img"),t.imageArray.push(new Array(r.attr("data-original-src"),o[s].getAttribute("title")));for(;t.imageArray[t.activeImage][0]!=a.attr("data-original-src");)t.activeImage++;n()}function f(){e("body").append('<div id="jquery-overlay"></div><div id="jquery-lightbox"><div id="lightbox-container-image-data-box"><div id="lightbox-container-image-data"><div id="lightbox-image-details"><span id="lightbox-image-details-caption"></span><span id="lightbox-image-details-currentNumber" class="proxima"></span></div><div id="lightbox-secNav"><a href="#" id="lightbox-secNav-btnClose" class="icon--svg svg-icon--white u-giant u-full--onhover"><svg class="svg-icon svg-close"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#iconset-close"></use></svg></a></div></div></div><div id="lightbox-container-image-box"><div id="lightbox-container-image"><img id="lightbox-image"><a href="#" id="lightbox-nav-btnPrev"></a><a href="#" id="lightbox-nav-btnNext"></a></div></div></div>');var a,n=i();e("#jquery-overlay").css({backgroundColor:t.overlayBgColor,opacity:t.overlayOpacity,width:n[0],height:n[1]}).fadeIn(),a=o(),e("#jquery-lightbox").css({top:a[1]+n[3]/10,left:a[0]}).show(),e("#jquery-overlay,#jquery-lightbox").click(function(){s()}),e("#lightbox-loading-link,#lightbox-secNav-btnClose").click(function(){return s(),!1}),e(window).resize(function(){var n,t=i();e("#jquery-overlay").css({width:t[0],height:t[1]}),n=o(),e("#jquery-lightbox").css({top:n[1]+t[3]/10,left:n[0]})})}function n(){t.fixedNavigation?e("#lightbox-image,#lightbox-container-image-data-box,#lightbox-image-details-currentNumber").hide():e("#lightbox-image,#lightbox-nav,#lightbox-nav-btnPrev,#lightbox-nav-btnNext,#lightbox-container-image-data-box,#lightbox-image-details-currentNumber").hide();var n=new Image;n.onload=function(){e("#lightbox-image").attr("src",t.imageArray[t.activeImage][0]),u(n.width,n.height),n.onload=function(){}},n.src=t.imageArray[t.activeImage][0],t.activeImage>-1}function u(n,i){e("#lightbox-container-image-box").hide();var a=e("#lightbox-container-image-box").width(),r=e("#lightbox-container-image-box").height(),s=n+2*t.containerBorderSize,o=i+2*t.containerBorderSize,c=a-s,l=r-o;e("#lightbox-container-image-box").css({width:s,height:o}),d(),0==c&&0==l&&v(e.browser.msie?250:100),e("#lightbox-container-image-data-box").css({width:n+20})}function d(){e("#lightbox-image").fadeIn(function(){c(),l(),e("#lightbox-container-image-box").show()}),m()}function c(){e("#lightbox-container-image-data-box").slideDown("fast"),e("#lightbox-image-details-caption").hide(),t.imageArray[t.activeImage][1]&&e("#lightbox-image-details-caption").html(t.imageArray[t.activeImage][1]).show(),t.imageArray.length>1}function l(){0!=t.activeImage?t.fixedNavigation?e("#lightbox-nav-btnPrev").unbind().html('<span class="button-box"><span class="icon icon-white icon-chevron-left"></span></span>').bind("click",function(){return t.activeImage=t.activeImage-1,n(),!1}):e("#lightbox-nav-btnPrev").unbind().hover(function(){e(this).html('<span class="button-box"><span class="icon icon-white icon-chevron-left"></span></span>')},function(){e(this).html("")}).show().bind("click",function(){return t.activeImage=t.activeImage-1,n(),!1}):e("#lightbox-nav-btnPrev").html(""),t.activeImage!=t.imageArray.length-1?t.fixedNavigation?e("#lightbox-nav-btnNext").unbind().html('<span class="button-box"><span class="icon icon-white icon-chevron-right"></span></span>').bind("click",function(){return t.activeImage=t.activeImage+1,n(),!1}):e("#lightbox-nav-btnNext").unbind().hover(function(){e(this).html('<span class="button-box"><span class="icon icon-white icon-chevron-right"></span></span>')},function(){e(this).html("")}).show().bind("click",function(){return t.activeImage=t.activeImage+1,n(),!1}):(e("#lightbox-nav-btnNext").unbind(),e("#lightbox-nav-btnNext").html("")),r()}function r(){e(document).keydown(function(e){h(e)})}function a(){e(document).unbind()}function h(e){null==e?(keycode=event.keyCode,escapeKey=27):(keycode=e.keyCode,escapeKey=e.DOM_VK_ESCAPE||27),key=String.fromCharCode(keycode).toLowerCase(),(key==t.keyToClose||"x"==key||keycode==escapeKey)&&s(),(key==t.keyToPrev||37==keycode)&&0!=t.activeImage&&(t.activeImage=t.activeImage-1,n(),a()),(key==t.keyToNext||39==keycode)&&t.activeImage!=t.imageArray.length-1&&(t.activeImage=t.activeImage+1,n(),a())}function m(){t.imageArray.length-1>t.activeImage&&(objNext=new Image,objNext.src=t.imageArray[t.activeImage+1][0]),t.activeImage>0&&(objPrev=new Image,objPrev.src=t.imageArray[t.activeImage-1][0])}function s(){e("#jquery-lightbox").remove(),e("#jquery-overlay").fadeOut(function(){e("#jquery-overlay").remove()}),e("embed, object, select").css({visibility:"visible"})}function i(){var e,t,n,s;return window.innerHeight&&window.scrollMaxY?(n=window.innerWidth+window.scrollMaxX,s=window.innerHeight+window.scrollMaxY):document.body.scrollHeight>document.body.offsetHeight?(n=document.body.scrollWidth,s=document.body.scrollHeight):(n=document.body.offsetWidth,s=document.body.offsetHeight),self.innerHeight?(e=document.documentElement.clientWidth?document.documentElement.clientWidth:self.innerWidth,t=self.innerHeight):document.documentElement&&document.documentElement.clientHeight?(e=document.documentElement.clientWidth,t=document.documentElement.clientHeight):document.body&&(e=document.body.clientWidth,t=document.body.clientHeight),t>s?pageHeight=t:pageHeight=s,e>n?pageWidth=n:pageWidth=e,arrayPageSize=new Array(pageWidth,pageHeight,e,t),arrayPageSize}function o(){var e,t;return self.pageYOffset?(t=self.pageYOffset,e=self.pageXOffset):document.documentElement&&document.documentElement.scrollTop?(t=document.documentElement.scrollTop,e=document.documentElement.scrollLeft):document.body&&(t=document.body.scrollTop,e=document.body.scrollLeft),arrayPageScroll=new Array(e,t),arrayPageScroll}function v(t){var n=new Date,e=null;do e=new Date;while(t>e-n)}t=e.extend({overlayBgColor:"#000",overlayOpacity:.85,fixedNavigation:!1,containerBorderSize:10,containerResizeSpeed:400,txtImage:"Image",txtOf:" / ",keyToClose:"c",keyToPrev:"p",keyToNext:"n",imageArray:[],activeImage:0},t);var b=this;return this.unbind("click").click(g)}}),define("gawkerlib/lightboxer",["jquery","underscore","singleton/Utils","module/EssentialIconModule","lib/amd-wrapped/jquery.lightbox-0.5","templates/tiger/icons/essential/usage"],function(e,t,n){"use strict";function s(s){var i=s.find(".lightBoxWrapper .img-border img"),o=s.find(".lightBox");t.each(i,function(s){var t=e(s);t.attr("data-original-src",n.imageUrl(t.data("chomp-id"),"original",t.data("format")))}),o.find(".icon-search-plus").replaceWith(e.trim(tiger.icons.essential.zoomIn())),o.removeClass("hide").lightBox()}return s}),define("templates/tiger/components/discussion/comment",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(s,t,o,n,e){t.components.discussion.comment=function(n,d,s){if(a="",r=(s.features.superuser,n.reply.authorStats&&n.reply.authorStats.contributors.length?n.reply.authorStats.contributors.length:1,((null==s.replyData?null:s.replyData.query)==n.reply.author.screenName||!(null==s.replyData?null:s.replyData.query))&&(n.reply.approved||(null==n.reply.qiMeta?null:n.reply.qiMeta.dynamicApproved)),""),n.reply.blogs)for(var i,a,r,c=n.reply.blogs,l=c.length,o=0;l>o;o++)i=c[o],r+=i.id==n.reply.author.defaultBlogId?e.$$escapeHtml(i.canonicalHost):"";return a+='<article id="reply_'+e.$$escapeHtmlAttribute(n.reply.id)+'" class="reply reply--depth-'+e.$$escapeHtmlAttribute(n.depth)+" js_reply"+(n.reply.approved?"":" reply--unapproved")+(n.reply.flagged?" reply--flagged":"")+'" data-id="'+e.$$escapeHtmlAttribute(n.reply.id)+'" data-parentid="'+e.$$escapeHtmlAttribute(n.reply.parentId)+'" data-authorname="'+e.$$escapeHtmlAttribute(n.reply.authorBlogName)+'">'+t.components.discussion.replyHeader(n,null,s)+'<div class="reply__content js_reply-content post-content blurable whitelisted-links">'+("IMAGE"==(null==n.reply.annotation?null:n.reply.annotation.annotationType)?'<div class="image-annotation--reply" style="background-image: url(\''+e.$$escapeHtmlAttribute(e.$$filterNormalizeUri(n.reply.annotation.imageUrl))+"'); background-position: "+e.$$escapeHtmlAttribute(e.$$filterCssValue(n.reply.annotation.x))+"% "+e.$$escapeHtmlAttribute(e.$$filterCssValue(n.reply.annotation.y))+'%;"></div>':"")+("TEXT"==(null==n.reply.annotation?null:n.reply.annotation.annotationType)?'<blockquote class="text-annotation--reply" style=""><span class="icon--svg mrs">'+t.icons.actions.quote(null,null,s)+"</span>"+(n.reply.annotation.annotationShortText?'<div class="js_annotation-long text-annotation--reply__content--long hide">'+e.$$filterNoAutoescape(n.reply.annotation.annotationText)+'</div><div class="js_annotation-short text-annotation--reply__content--short">'+e.$$filterNoAutoescape(n.reply.annotation.annotationShortText)+' <a href="'+e.$$escapeHtmlAttribute(e.$$filterNormalizeUri(n.reply.permalink))+'" class="js_annotation-expand">Show all</a></div>':e.$$filterNoAutoescape(n.reply.annotation.annotationText))+"</blockquote>":"")+e.$$filterNoAutoescape(n.reply.display)+"</div>"+t.components.discussion.replySidebar(n,null,s)+t.components.discussion.replyTools(n,null,s)+'<div class="js_reply-flagged reply__flagged-indicator">Flagged</div></article><div class="js_region--warning"></div><div class="js_editor-placeholder"></div><div class="js_region--children"></div>'},n.DEBUG&&(t.components.discussion.comment.soyTemplateName="tiger.components.discussion.comment"),t.components.discussion.replyHeader=function(n,r,s){var i,o="",a="avt-small";return o+='<header class="reply__header without-dropdown js_author" data-authorid="'+e.$$escapeHtmlAttribute(n.reply.author.id)+'" data-blogid="'+e.$$escapeHtmlAttribute(n.reply.author.defaultBlogId)+'">',i="gif"==n.reply.author.avatar.format?"jpg":n.reply.author.avatar.format,o+=t.components.discussion.replyAvatarDisplay({url:"//kinja.com/"+n.reply.author.screenName,avatar:window.kinja.imageUrl(n.reply.author.avatar.id,a,i),nofollow:n.reply.isPromoted},null,s)+(s.features.hide_pending_replies&&!n.reply.approved?'<span class="reply__pending-label">Pending approval</span>':"")+t.components.discussion.replyByline(n,null,s)+'<div class="reply__publish-time">'+t.components.discussion.replyPublishTime(n,null,s)+'</div><div class="post-dropdown-ct js_post-dropdown-ct'+("permalink"==n.pageType?" js_post-dropdown-ct-sticky":"")+'">'+t.components.post.meta.postDropdownTrigger({post:n.reply},null,s)+"</div></header>"},n.DEBUG&&(t.components.discussion.replyHeader.soyTemplateName="tiger.components.discussion.replyHeader"),t.components.discussion.replySidebar=function(n,o,s){return'<div class="reply__sidebar"><a href="#" class="js_like reply__recommend readonly-hide icon--svg u-undecorated u-darkened--onhover js_like_icon" title="Recommend">'+(s.features.newstream?t.icons.essential.starGiant(null,null,s):t.icons.essential.star(null,null,s))+(n.reply.likes&&n.reply.likes>0?'<span class="like-count js_like_count">'+e.$$escapeHtml(n.reply.likes)+"</span>":"")+"</a></div>"},n.DEBUG&&(t.components.discussion.replySidebar.soyTemplateName="tiger.components.discussion.replySidebar"),t.components.discussion.replyByline=function(n,a,s){var o='<span class="reply__byline"><a href="//kinja.com/'+e.$$escapeHtmlAttribute(n.reply.author.screenName)+'" target="_self" '+(n.reply.isPromoted?'rel="nofollow"':"")+" class=\"fn url\" onclick=\"window.ga('send', 'event', 'byline', 'click', 'permalink');\">"+e.$$escapeHtml(n.reply.author.displayName)+"</a>",i=(null==s.replyData?null:s.replyData.atUser)==n.reply.authorBlogName;return o+=(i?"<span>, Host</span>":"")+((null==n.reply.replyMeta?null:null==n.reply.replyMeta.parentAuthor?null:n.reply.replyMeta.parentAuthor.displayName)?'<span class="reply__to-author"><span class="icon--svg u-downsized">'+t.icons.essential.chevronRight(null,null,s)+"</span>"+((null==n.reply.replyMeta?null:n.reply.replyMeta.showParentByline)&&""!=(null==n.reply.replyMeta?null:n.reply.replyMeta.parentByline)?e.$$escapeHtml(window.kinja.stripHtmlTags(n.reply.replyMeta.parentByline,"")):e.$$escapeHtml(n.reply.replyMeta.parentAuthor.displayName))+"</span>":"")+"</span>"},n.DEBUG&&(t.components.discussion.replyByline.soyTemplateName="tiger.components.discussion.replyByline"),t.components.discussion.replyAvatarDisplay=function(n,o,s){return'<a href="'+(n.url&&"http://"!=n.url?e.$$escapeHtmlAttribute(e.$$filterNormalizeUri(n.url)):"javascript:void(0)")+'"'+(n.nofollow?' rel="nofollow"':"")+' class="avatar avatar-container"><span class="icon--svg">'+t.icons.essential.checkmarkSmall(null,null,s)+'</span><span class="img-border'+(n.avatar?"":" hide")+'"><img src="'+(n.avatar?e.$$escapeHtmlAttribute(e.$$filterNormalizeUri(n.avatar)):"")+'" /></span><span class="avatar-default'+(n.avatar?" hide":"")+'"></span></a>'},n.DEBUG&&(t.components.discussion.replyAvatarDisplay.soyTemplateName="tiger.components.discussion.replyAvatarDisplay"),t.components.discussion.replyPublishTime=function(t){return'<a href="'+e.$$escapeHtmlAttribute(e.$$filterNormalizeUri(t.reply.permalink))+'" target="_self"><span class="published updated">'+e.$$escapeHtml(t.reply.publishTime.Mddyyhmma)+"</span></a>"},n.DEBUG&&(t.components.discussion.replyPublishTime.soyTemplateName="tiger.components.discussion.replyPublishTime"),t.components.discussion.replyTools=function(n,a,o){var i="",s=n.reply.replyCount?n.reply.replyCount:0;return i+='<div class="reply__tools js_reply-tools '+(n.reply.flagged?"hide":"")+'" data-analytics-target="groupChat">'+t.icons.discussion.replyRight(null,null,o)+'<a href="#" class="js_reply-to-selected-post reply__link readonly-hide" data-id="'+e.$$escapeHtmlAttribute(n.reply.id)+"\" title=\"Reply\" onclick=\"window.ga('send', 'event', 'Group Chats', 'click', 'Reply button click');\">Reply</a>"+("ReplyList"!=n.discussionType&&n.reply._surfaced&&s&&n.depth<2?'<a href="#" class="js_toggle-descendants reply__count icon--svg u-undecorated u-darkened--onhover" data-id="'+e.$$escapeHtmlAttribute(n.reply.id)+'" title="Show replies"><span>'+e.$$escapeHtml(s)+"</span> replies</a>":"")+"</div>"},n.DEBUG&&(t.components.discussion.replyTools.soyTemplateName="tiger.components.discussion.replyTools")}),define("templates/tiger/components/post/meta/post-meta-container",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(n,e,s,t){e.components.post.meta.postMetaContainer=function(t,s,n){return'<div class="meta-container without-dropdown">'+("permalink"==t.pageType?e.components.post.meta.metaAvatar(t,null,n):e.components.post.meta.meta(t,null,n))+(t.forSharedPost?"":'<div class="post-dropdown-ct js_post-dropdown-ct'+("permalink"!=t.pageType||t.mode?"":" js_post-dropdown-ct-sticky")+'">'+e.components.post.meta.postDropdown(t,null,n)+e.components.post.meta.postDropdownTrigger(t,null,n)+"</div>")+"</div>"},t.DEBUG&&(e.components.post.meta.postMetaContainer.soyTemplateName="tiger.components.post.meta.postMetaContainer")}),define("templates/tiger/components/post/meta/meta-avatar",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(s,e,o,n,t){e.components.post.meta.metaAvatar=function(n,d,s){for(var i,c="",a="",r=n.post.blogs,l=r.length,o=0;l>o;o++)i=r[o],a+=i.id==n.post.author.defaultBlogId?t.$$escapeHtml(i.canonicalHost):"";return c+='<div class="meta-avatar js_author" data-authorid="'+t.$$escapeHtmlAttribute(n.post.author.id)+'" data-blogid="'+t.$$escapeHtmlAttribute(n.post.author.defaultBlogId)+'">'+("reply"!=n.mode?e.components.post.meta.postInfo(n,null,s):"")+'<div class="floated-container img-30">'+e.components.post.meta.avatarContainer({post:n.post,canonicalHost:a},null,s)+'<div class="txt">'+(s.features.hide_pending_replies&&!n.post.approved?'<span class="pending-label">Pending approval</span>':"")+(n.forSharedPost?"Original post by":"")+e.components.post.meta.topByline({post:n.post,mode:""+t.$$escapeHtml(n.mode?n.mode:"post"),forSharedPost:n.forSharedPost,contributors:n.contributors,blog:n.blog},null,s)+'<div class="second-line post-meta">'+(n.post.sponsored||n.post.isBillboardPost||n.post.isPromoted?e.components.post.meta.promotedByline(n,null,s):"")+(n.post.tags&&n.post.tags[0]&&!n.forSharedPost?"Filed to: "+e.components.post.tag({tag:n.post.tags[0],hasDropdown:n.post.tags.length>1,tagClasses:"first-tag"},null,s)+(n.post.tags.length>1?e.components.post.tagList({tags:n.post.tags},null,s):""):"")+(0==n.showDate||n.forSharedPost?"":e.components.post.meta.publishTime(n,null,s))+"</div></div></div></div>"},n.DEBUG&&(e.components.post.meta.metaAvatar.soyTemplateName="tiger.components.post.meta.metaAvatar")}),define("templates/tiger/components/post/meta/formatted-time",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(n,e,s,t){e.components.post.meta.relativeTime=function(t,s,n){return""+e.messages.time.relativeTime({type:t.time.relative.type,amount:t.time.relative.amount,hmma:t.time.hmma,day:t.time.day,Mddyyhmma:t.time.Mddyyhmma,timestamp:t.time.timestamp},null,n)},t.DEBUG&&(e.components.post.meta.relativeTime.soyTemplateName="tiger.components.post.meta.relativeTime")}),define("templates/tiger/components/invites/menu-items",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(n,e,s,t){e.components.invites.menuItems.invitePostDropdownItems=function(n,s,t){return'<li class="js_invite-to-post-manually hover-icon hide"><a href="#" rel="nofollow" class="icon--svg">'+e.icons.places.mail(null,null,t)+"Invite manually</a></li>"},t.DEBUG&&(e.components.invites.menuItems.invitePostDropdownItems.soyTemplateName="tiger.components.invites.menuItems.invitePostDropdownItems")}),define("module/discussion/view/comment.layout",["jquery","underscore","module/discussion/model/comment.collection","module/discussion/discussion.channel","app/post/common/post.layout","app/post/posttools/posttools.menuview","module/discussion/view/warning.view","view/GifImageLoader","singleton/Utils","singleton/util/loadEditor","singleton/CurrentBlog","singleton/CurrentUser","singleton/ImageBlurHelper","module/discussion/regionManager/discussionRegionManager","app/post/posttools/posttools.controller","app/post/posttools/controller/posttools.block.controller","singleton/EventDispatcher","gawkerlib/lightboxer","templates/tiger/components/discussion/comment","templates/tiger/components/post/meta/post-meta-container","templates/tiger/components/post/meta/post-dropdown","templates/tiger/components/post/meta/meta-avatar","templates/tiger/components/post/meta/formatted-time","templates/tiger/components/invites/menu-items"],function(s,n,d,m,o,g,a,j,c,l,t,e,u,r,f,p,i,v){"use strict";var b,h="KinjaNSFWCookie";return b=o.extend({_updateLikeCount:function(){var e=window.parseInt(this.ui.likeCountPlaceholder.text(),10)||0,t=e>0,e=this.model.get("liked")?e+1:t?e-1:0;this.ui.likeCountPlaceholder.text(e||"")},_expanded:!1,_gifImageLoader:null,_renderDeferred:s.Deferred(),_commentListView:null,tagName:"li",className:function(){var e=this.model,t=e.collection.getDiscussionType(),n=e.getChildren(),s=t===d.discussionTypes.ALL&&n.hasMore();return["commentlist__item","commentlist__item--depth-"+e.collection.getDepth(),e.get("_surfaced")?"surfaced":"",s?"commentlist__item--expandable":""].join(" ")},template:tiger.components.discussion.comment,regions:{warningRegion:".js_region--warning:first",childrenRegion:".js_region--children"},ui:n.extend({},o.prototype.ui,{replyContent:".js_reply-content",replyTools:".js_reply-tools",replyFlag:".js_reply-flagged",editorPlaceholder:".js_editor-placeholder",replyButton:".js_reply-to-selected-post",editReply:".js_edit-reply",reply:".js_reply",replyBubbleIcon:".js_bubble-icon"}),events:n.extend({},o.prototype.events,{"click @ui.replyButton":"onClickReplyTo","click @ui.replyContent, .js_toggle-descendants":"onClickReplyContent","click .js_pending-reply-thread-switch":"onClickPendingSwitch","click .js_pending-close:first":"onClickPendingClose","click .blurred .img-border":"onClickImageBlur","click @ui.editReply":"onClickEditReply","click .lazy-gif.thawable":"onClickThawImage"}),modelEvents:n.extend({},o.prototype.modelEvents,{"change:liked":"onChangeLiked","change:approved":"onChangeApproved","change:display":"onChangeDisplay","change:flagged":"onChangeFlagged","posttools:post:dismissed":"onDismissed"}),initialize:function(){},onClickReplyTo:function(){var e,s=r.addCommentRegion(this.ui.editorPlaceholder),t=this.model;return this.listenToOnce(s,"editor:post:save",function(o,s){e=n.extend(o.toJSON(),{_surfaced:!0,_viaEditor:!0}),t._commentCollection.unshift(e),m.trigger("newComment",{comment:e}),s&&s.length&&t.set("approved",!0)}),l().then(function(e){e.createComment(t)}),!1},serializeData:function(){var n,e=this.model.collection,t=c.getKinjaMeta();return n={reply:this.model.attributes,pageType:t.pageType,discussionType:e.getDiscussionType(),depth:e.getDepth(),starterAuthor:t.post.authorScreenName}},renderBlurs:function(){var e=this.$(".post-content .has-media:not(.blurred)");e.each(function(t,e){u.addImageBlur(s(e))})},renderPostTools:function(){this.postToolsMenuView=new g({el:this.$(".js_post-dropdown-ct").eq(0),model:this.model,blockedBlogCollection:p.getBlockedBlogCollection(t.id)}),f.bindEvents(this,this.postToolsMenuView),this.postToolsMenuView.on("posttools:content:render",this.renderFollowUnfollowForBlog.bind(this)),this.$(".without-dropdown").removeClass("without-dropdown")},renderFollowUnfollowForBlog:function(){e.onAuth.done(function(){var n=e.hasRole("OWNER",t.id)||e.hasRole("ADMIN",t.id)||e.hasRole("AUTHOR",t.id),s=e.hasRole("OWNER",t.id)||e.hasRole("ADMIN",t.id)||e.isSuperuser();(n||e.isSuperuser())&&t.getFollowedBlogIds().done(function(o){var e=this.postToolsMenuView.$(".js_follow-controls"),t=this.postToolsMenuView.$(".js_followforblog"),n=this.postToolsMenuView.$(".js_unfollowforblog"),i=e.data("sourceblogid"),s=e.data("blogid");i!==s&&(-1!==o.indexOf(s)?(n.removeClass("hide"),t.addClass("hide")):(t.removeClass("hide"),n.addClass("hide")))}.bind(this)),s&&this.postToolsMenuView.trigger("posttools:checkBlockStatus",{model:this.postToolsMenuView.model,collection:this.postToolsMenuView.blockedBlogCollection})}.bind(this))},onRender:function(){var e=this.model._commentCollection;e&&e.getSurfacedCommentLength()&&this.ui.reply.addClass("expanded"),this.renderMediaEmbeds(),this.model.get("approved")||this.renderBlurs(),this.renderPostTools(),this.showChildrenView(),this.listenTo(i,"followforblog",function(e){e.id===this.model.id&&this.model.set("approved",!0)}),this._renderDeferred.resolve()},onClickReplyContent:function(t){var e=this.model,n=e.collection,o=n.getDiscussionType(),i=e.get("replyCount");return c.clickedOnLink(t)?void 0:!!(this.model.get("_surfaced")&&o!==d.discussionTypes.ALL&&i)&&(s.cookie(h)||this._expanded?(this._toggleDescendants(),!1):(this.showWarning(),!1))},onClickEditReply:function(){var e,t=r.addCommentRegion(this.ui.editorPlaceholder),s=this.model;return this.listenToOnce(t,"editor:post:save",function(t){e=n.extend(t.toJSON(),{_surfaced:!0}),this.model.set({display:e.display})}),l().then(function(e){e.editComment(s.get("id"))}),!1},onClickPendingSwitch:function(){return s.cookie(h,!0),this._toggleDescendants(),!1},onClickPendingClose:function(){return this.warningRegion.reset(),!1},onClickImageBlur:function(e){return u.removeImageBlur(e),!1},onClickThawImage:function(e){e.preventDefault(),i.trigger("thawImage",{$el:s(e.target)})},onChangeLiked:function(){this._renderDeferred.done(function(){this.ui.likeIcon.toggleClass("active",this.model.get("liked"))}.bind(this))},onChangeApproved:function(){this._renderDeferred.done(function(){this.ui.reply.toggleClass("reply--unapproved",!this.model.get("approved"))}.bind(this))},onChangeDisplay:function(){this._renderDeferred.done(function(){this.ui.replyContent.html(this.model.get("display"))}.bind(this))},onChangeFlagged:function(){this._renderDeferred.done(function(){var e=this.model.get("flagged");this.ui.reply.toggleClass("reply--flagged",e)}.bind(this))},onDismissed:function(){this.$el.fadeOut()},_toggleDescendants:function(){var e=this.getChildrenView();this.hideWarning(),this._expanded?(e.hideNestedChildren(),this.ui.reply.removeClass("expanded"),this.ui.replyBubbleIcon.removeClass("icon-bubble-round-x").addClass("icon-bubble-round")):(e.showNestedChildren(),this.ui.reply.addClass("expanded"),this.ui.replyBubbleIcon.removeClass("icon-bubble-round").addClass("icon-bubble-round-x")),this._expanded=!this._expanded},showWarning:function(){this.warningRegion.show(new a({warningType:a.warningTypes.THREAD}))},hideWarning:function(){this.warningRegion.reset("hide")},getChildrenView:function(){if(!this._commentListView){var e=require("module/discussion/view/commentList.view"),t=this.model.getChildren();this._commentListView=new e({collection:t})}return this._commentListView},showChildrenView:function(){this.childrenRegion.show(this.getChildrenView())},renderMediaEmbeds:function(){this._gifImageLoader=new j({el:this.el}),v(this.$el)}},{slideAnimationTime:200})}),define("templates/tiger/components/discussion/comment-list",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(s,e,o,n,t){e.components.discussion.commentList=function(n,a,s){var i="",o="commentlist--depth-"+t.$$escapeHtml(n.depth);return i+=("ReplyList"==n.discussionType?'<div class="js_commentlist-wrap--surface"><ul data-analytics-target="groupChat" class="commentlist commentlist--surface js_commentlist--surface '+t.$$escapeHtmlAttribute(o)+'"></ul></div><div class="js_commentlist-wrap--nested" style="display: none"><ul class="commentlist commentlist--nested js_commentlist--nested '+t.$$escapeHtmlAttribute(o)+'"></ul></div>'+(n.depth<2?e.components.discussion.replyFooter(null,null,s):""):'<div class="js_commentlist-wrap--nested" style="display: none"><ul class="commentlist commentlist--nested js_commentlist--nested '+t.$$escapeHtmlAttribute(o)+'"></ul>'+e.components.discussion.replyFooter(null,null,s)+'</div><div class="js_commentlist-wrap--surface"><ul class="commentlist commentlist--surface js_commentlist--surface '+t.$$escapeHtmlAttribute(o)+'"></ul></div>')+(n.depth<1?'<footer class="commentlist__pagination js_commentlist__pagination hide"><a class="js_button--pagination button--pagination icon--svg u-full">Load more'+e.icons.essential.chevronBottomSmall(null,null,s)+'</a></footer><div class="js_spinner-wrap spinner-wrap hide row">'+e.components.spinner.bounce(null,null,s)+"</div>":"")},n.DEBUG&&(e.components.discussion.commentList.soyTemplateName="tiger.components.discussion.commentList"),e.components.discussion.replyFooter=function(n,s,t){return'<footer class="reply-footer-bar js_reply-footer-bar"><a class="discussion__button js_discussion__button js_load-more-replies icon--svg u-full hide">Show more replies'+e.icons.essential.chevronBottomSmall(null,null,t)+'</a><a class="discussion__button js_discussion__button js_load-all-replies icon--svg u-full hide">Show more replies in this thread'+e.icons.essential.chevronBottomSmall(null,null,t)+'</a><a class="discussion__button js_discussion__button js_close-replies icon--svg u-full hide">Collapse replies'+e.icons.essential.chevronTopSmall(null,null,t)+"</a></footer>"},n.DEBUG&&(e.components.discussion.replyFooter.soyTemplateName="tiger.components.discussion.replyFooter")}),define("module/discussion/view/commentList.view",["jquery","backbone.marionette","module/discussion/model/comment.collection","module/discussion/view/comment.layout","singleton/WindowController","templates/tiger/components/discussion/comment-list"],function(n,s,o,i,t){"use strict";var e=s.CompositeView.extend({_expanded:!1,className:function(){return"commentlist-wrap "+this.collection.getDiscussionType().toLowerCase()},itemView:i,template:tiger.components.discussion.commentList,ui:{surfaceList:".js_commentlist--surface",surfaceListWrap:".js_commentlist-wrap--surface",nestedList:".js_commentlist--nested",nestedListWrap:".js_commentlist-wrap--nested",repliesFooter:".js_reply-footer-bar",discussionButtons:".js_discussion__button",loadAllRepliesButton:".js_load-all-replies",loadMoreRepliesButton:".js_load-more-replies",closeRepliesButton:".js_close-replies",paginationContainer:".js_commentlist__pagination",paginationButton:".js_button--pagination",spinner:".js_spinner-wrap"},events:{"click @ui.loadAllRepliesButton":"onClickLoadAllReplies","click @ui.loadMoreRepliesButton":"onClickLoadMoreReplies","click @ui.closeRepliesButton":"onClickCloseReplies","click @ui.paginationButton":"onClickPaginationButton"},collectionEvents:{sync:"onCollectionSync"},serializeData:function(){var e=this.collection;return{depth:e.getDepth(),discussionType:e.getDiscussionType()}},onRender:function(){var e=this.collection,t=e.getDepth();e.hasMore()&&(t>0&&this._toggleButtons(),0===t&&this.showPaginationButton())},appendHtml:function(o,e){var t=e.$el,n=this.collection.getApprovedOnly(),s=e.model.get("_viaEditor")||!1;s?this.ui.surfaceList.prepend(t):(!n||n&&e.model.get("approved"))&&(e.model.get("_surfaced")?this.ui.surfaceList.append(t):this.ui.nestedList.append(t))},_toggleButtons:function(s){var e=this.ui.closeRepliesButton,t=this.ui.loadAllRepliesButton,n=this.ui.loadMoreRepliesButton;this.ui.discussionButtons.addClass("hide"),s?(t.addClass("hide"),e.removeClass("hide"),this.collection.hasMore()&&n.removeClass("hide")):(e.addClass("hide"),n.addClass("hide"),t.removeClass("hide"))},showNestedChildren:function(){var t=this.collection,n=function(){this.ui.nestedListWrap.slideDown(e.slideAnimationTime),this._toggleButtons(!0),this._expanded=!0,this.$el.addClass("expanded")}.bind(this),s=function(){this.listenToOnce(t,"sync",n),t.fetch({remove:!1})}.bind(this);this._expanded?t.hasMore()&&s():t.length&&t.length-t.getSurfacedCommentLength()?n():s()},hideNestedChildren:function(){this.ui.nestedListWrap.slideUp(e.slideAnimationTime),this._toggleButtons(),this._expanded=!1,this.$el.removeClass("expanded"),this.collection.getDiscussionType()===o.discussionTypes.ALL&&n.scrollTo(this.ui.surfaceList,e.slideAnimationTime)},onClickLoadAllReplies:function(){return this.showNestedChildren(),!1},onClickLoadMoreReplies:function(){return this.showNestedChildren(),!1},onClickCloseReplies:function(){return this.hideNestedChildren(),!1},onClickPaginationButton:function(){this.showSpinner(),this.hidePaginationButton(),this.collection.fetch({remove:!1})},onCollectionSync:function(){var e=this.collection;e.hasMore()&&n(this.ui.repliesFooter).length&&this._toggleButtons(),0===e.getDepth()&&(this.hideSpinner(),e.hasMore()?this.showPaginationButton():this.hidePaginationButton())},initializeWaypoint:function(){var e=this.$(".js_spinner-wrap");e.removeClass("hide"),t.registerWaypoint(e,"100%",function(){this._onWaypointReached()}.bind(this))},teardownWaypoint:function(){t.teardownWaypoint(this.$(".js_spinner-wrap"))},_onWaypointReached:function(){var e=this.$(".js_spinner-wrap");t.teardownWaypoint(e),this.collection.fetch({remove:!1}),this.listenToOnce(this.collection,"sync",function(){e.detach(),this.collection.hasMore()&&(this.$el.append(e),this.initializeWaypoint())})},showPaginationButton:function(){this.ui.paginationButton.removeClass("hide"),this.ui.paginationContainer.removeClass("hide")},hidePaginationButton:function(){this.ui.paginationContainer.addClass("hide"),this.ui.paginationButton.addClass("hide")},showSpinner:function(){this.$el.append(this.ui.spinner.removeClass("hide"))},hideSpinner:function(){this.ui.spinner.detach()}},{slideAnimationTime:200});return e}),define("templates/tiger/messages",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(n,e,s,t){e.messages.areYouSureToDisconnect=function(){return"Are you sure you want to disconnect this account?"},t.DEBUG&&(e.messages.areYouSureToDisconnect.soyTemplateName="tiger.messages.areYouSureToDisconnect"),e.messages.settingsSaved=function(){return"Settings saved successfully."},t.DEBUG&&(e.messages.settingsSaved.soyTemplateName="tiger.messages.settingsSaved"),e.messages.confirmationEmail=function(){return"Confirmation email has been sent."},t.DEBUG&&(e.messages.confirmationEmail.soyTemplateName="tiger.messages.confirmationEmail"),e.messages.blogPropertySaved=function(){return"Blog property saved successfully."},t.DEBUG&&(e.messages.blogPropertySaved.soyTemplateName="tiger.messages.blogPropertySaved"),e.messages.blogPropertyCreated=function(){return"Blog property created successfully."},t.DEBUG&&(e.messages.blogPropertyCreated.soyTemplateName="tiger.messages.blogPropertyCreated"),e.messages.blogPropertyDeleted=function(){return"Blog property deleted successfully."},t.DEBUG&&(e.messages.blogPropertyDeleted.soyTemplateName="tiger.messages.blogPropertyDeleted"),e.messages.ownerSet=function(){return"New owner has been set."},t.DEBUG&&(e.messages.ownerSet.soyTemplateName="tiger.messages.ownerSet"),e.messages.cannotDisconnectLoginAccount=function(){return"You cannot disconnect your login account from Kinja. Please switch your login account, save, and try again."},t.DEBUG&&(e.messages.cannotDisconnectLoginAccount.soyTemplateName="tiger.messages.cannotDisconnectLoginAccount"),e.messages.repliesDisabled=function(n,s,t){return'<div class="twelve columns end mbx"><div class="reply-create media"><div class="img mrm icon--svg">'+e.icons.discussion.bubbleClose(null,null,t)+'</div><div class="bd proxima"><span class="msg text-small text-light">This discussion is closed</span></div></div></div>'},t.DEBUG&&(e.messages.repliesDisabled.soyTemplateName="tiger.messages.repliesDisabled"),e.messages.imageUploadError=function(){return"Image upload error."},t.DEBUG&&(e.messages.imageUploadError.soyTemplateName="tiger.messages.imageUploadError"),e.messages.assetRecommended=function(){return"Media recommended."},t.DEBUG&&(e.messages.assetRecommended.soyTemplateName="tiger.messages.assetRecommended"),e.messages.assetUnrecommended=function(){return"Removed media recommendation."},t.DEBUG&&(e.messages.assetUnrecommended.soyTemplateName="tiger.messages.assetUnrecommended"),e.messages.amazonBestSellerReport=function(){return"<p><small>If the blog list is omitted, all blogs will be taken into account. If the limit is set to 0, no limit is set.</small></p>"},t.DEBUG&&(e.messages.amazonBestSellerReport.soyTemplateName="tiger.messages.amazonBestSellerReport"),e.messages.amazonTagReport=function(){return"<p><small>Beware: If the checkbox above is unchecked, Amazon statistics and posts will both be filtered by the date picker. This means that earnings and orders for posts which were published earlier will <strong>not</strong> be shown here.</small></p>"},t.DEBUG&&(e.messages.amazonTagReport.soyTemplateName="tiger.messages.amazonTagReport")}),define("module/discussion/view/loading.view",["backbone.marionette","templates/tiger/components/spinner","templates/tiger/messages"],function(e){"use strict";var t=e.ItemView.extend({template:tiger.components.spinner.bounce});return t}),define("view/behaviors/googleAnalytics.behavior",["jquery","underscore","backbone.marionette","singleton/Utils"],function(e,n,s,o){"use strict";var t=s.Behavior.extend({events:{"click [data-ga]:not(form)":"onGAClick","submit form[data-ga]":"onGASubmit"},onGAClick:function(t){var n,o=e(t.currentTarget),s=o.closest("a[href]").eq(0);return this.logGAEvent(t),s.length&&(n=s.attr("href"),!/^((http|https):)?\/\//.test(n)||"_blank"===s.attr("target")||t.shiftKey||t.ctrlKey||t.metaKey||(t.preventDefault(),window.setTimeout(function(){window.location.href=n},500))),!0},onGASubmit:function(t){var n=e(t.currentTarget),s=n.attr("action"),o=n.serialize();this.logGAEvent(t),t.preventDefault(),window.setTimeout(function(){window.location.href=s+"?"+o},500)},logGAEvent:function(o){var a=e(o.currentTarget),s=a.attr("data-ga").replace(/[[\]]/g,"").split(/\s*,\s*/g),s=s.map(function(e){return n.contains(t.validKeys,e)?t.replacePlaceholder(e):e}),i=["send","event"].concat(s);window.ga.apply(this,i)}},{validKeys:["js_pageType","js_pageUrl"],replacePlaceholder:function(e){var t=o.getKinjaMeta();switch(e=e.replace(/js_/g,"")){case"pageType":return t.pageType;case"pageUrl":return window.location.url;default:return""}}});return t}),define("templates/tiger/components/discussion/applet",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(s,e,o,n,t){e.components.discussion.applet=function(s,a,n){var i="",o=""+(s.replyCount>1?"View all "+t.$$escapeHtml(s.replyCount)+" replies":"View all replies");return i+='<ul class="reply-filters js_reply-filters-container hide"><li class="js_permalink-replies reply-filter reply-filter--permalink js_groupchats__filter sitecolored--hover hide"><a class="tab-author"><span class="js_author-name">'+t.$$escapeHtml(window.kinja.stripHtmlTags(s.permalinkByline,""))+'</span>s Discussions</a><div class="reply-filter__active-marker icon--svg">'+e.icons.essential.chevronBottom(null,null,n)+'</div></li><li class="js_personalized reply-filter reply-filter--personalized js_groupchats__filter sitecolored--hover hide"><a class="tab-author" data-ga="[Group Chats, click, Author Chat click]"><span class="js_author-name">'+t.$$escapeHtml(window.kinja.stripHtmlTags(s.byline,""))+'</span>s Discussions</a><div class="reply-filter__active-marker icon--svg">'+e.icons.essential.chevronBottom(null,null,n)+'</div></li><li  class="js_allview reply-filter reply-filter--all js_groupchats__filter sitecolored--hover"><a data-ga="[Group Chats, click, All Replies click, __DEFAULT]" title="'+t.$$escapeHtmlAttribute(o)+'">All replies</a><div class="reply-filter__active-marker icon--svg">'+e.icons.essential.chevronBottom(null,null,n)+'</div></li></ul><div class="js_editor-placeholder js_reply-form-container"></div><div class="js_region--warning"></div><div class="js_flagging-admin-placeholder"></div><div class="js_content-region"></div><div class="js_replycol js_ad300-companion"><div class="js_reply-loading-progress reply-spinner hide">'+e.components.spinner.bounce(null,null,n)+'</div><div class="js_load-more"></div><div class="reply-views js_reply-views hide"><a class="js_author-view-footer js_groupchats__filter personalized icon--svg u-full commentlist__filter-button hide" data-ga="[Group Chats, click, Popular Chat click]">View '+t.$$escapeHtml(s.byline)+"'s discussions"+e.icons.essential.chevronBottomSmall(null,null,n)+'</a><a class="js_allview-footer js_groupchats__filter allview icon--svg u-full commentlist__filter-button hide" data-ga="[Group Chats, click, All Replies click, __DEFAULT]">'+t.$$escapeHtml(o)+e.icons.essential.chevronBottomSmall(null,null,n)+"<a></div></div>"},n.DEBUG&&(e.components.discussion.applet.soyTemplateName="tiger.components.discussion.applet")}),define("module/DiscussionModule",["jquery","underscore","backbone.marionette","model/post/Post","module/discussion/model/comment.collection","module/discussion/model/comment.model","module/discussion/view/commentList.view","module/discussion/view/warning.view","module/discussion/view/loading.view","module/discussion/discussion.channel","module/flagging/ReplyFlaggingModule","view/behaviors/googleAnalytics.behavior","module/discussion/regionManager/discussionRegionManager","singleton/Utils","singleton/Feature","singleton/util/loadEditor","templates/tiger/components/discussion/applet","templates/tiger/components/groupchats/flagging-admin-link"],function(r,i,h,v,n,l,g,a,u,m,j,_,b,o,f,p){"use strict";var e,t,s,c,d,y;return d=new v(o.getKinjaMeta().post),t=new l(d.attributes),e={personalized:{collection:new n([],{parent:t,discussionType:n.discussionTypes.PERSONALIZED,approvedOnly:!0}),onFacetShow:function(){}},allApproved:{collection:new n([],{parent:t,discussionType:n.discussionTypes.ALL,approvedOnly:!0}),onFacetShow:function(){this.warningRegion.show(new a({warningType:a.warningTypes.COMPLETE,noReplies:0===s.collection.length})),s.collection.loadFlaggedCommentCount().done(function(){var e=j.flagCount(),t={flagCount:e,blogName:o.getKinjaMeta().blog.name},n=h.Renderer.render(tiger.components.groupchats.flaggingAdminLink,t);e>0&&this.ui.flaggingAdminPlaceholder.append(n)}.bind(this))}},allUnapproved:{collection:new n([],{parent:t,discussionType:n.discussionTypes.ALL,approvedOnly:!1}),onFacetShow:function(){var e=new a({warningType:a.warningTypes.COMPLETE,noReplies:0===s.collection.length});this.warningRegion.show(e),e.toggleFilter()}}},new(y=h.Layout.extend({showFacet:function(n,o){var t,e=n.collection;s=n,f.isOn("delaydiscussion")&&this.contentRegion.show(new u),this.toggleFooterLinks(),t=function(){this.contentRegion.show(new g({collection:s.collection})),s.onFacetShow.call(this),this.toggleFooterLinks()}.bind(this),o&&(this.warningRegion.reset(),this.ui.flaggingAdminPlaceholder.html(""),e.length||e._hasFirstFetched?t():(e.fetch(),this.contentRegion.reset(),this.listenToOnce(e,"sync",t)))},regions:{contentRegion:".js_content-region",warningRegion:".js_region--warning:first"},ui:{replyFilterContainer:".js_reply-filters-container",filterButtons:".js_groupchats__filter",personalizedRepliesButton:".js_personalized",allRepliesButton:".js_allview",permalinkRepliesButton:".js_permalink-replies",disabledReplies:".js_disabled-replies",spinner:".js_loading-layer",editorPlaceholder:".js_editor-placeholder",flaggingAdminPlaceholder:".js_flagging-admin-placeholder",footerButtonsContainer:".js_reply-views",authorViewFooter:".js_author-view-footer",allViewFooter:".js_allview-footer"},events:{"click @ui.filterButtons":"onClickFilter","click .js_pending-reply-switch":"onClickPendingSwitch"},behaviors:{GoogleAnalyticsBehavior:{behaviorClass:_}},template:tiger.components.discussion.applet,className:"replies-wrapper",initialize:function(){var i=o.getKinjaMeta(),s=i.postId;o.isCommentPermalinkPage()&&(c=new l({id:s}),e.permalink={collection:new n([],{discussionType:n.discussionTypes.PERMALINK,parent:t,permalinkComment:c,approvedOnly:!1}),onFacetShow:function(){var e=this.$el.find(".reply[data-id="+s+"]").addClass("anchor");e.length&&r.scrollTo(e,250,{offset:-20})}}),this.listenTo(this.contentRegion,"close",function(){this.contentRegion.show(new u)}),this.listenTo(this.contentRegion,"show",function(e){var t=e.collection;t&&this.$el.parent().css({"min-height":this.$el.outerHeight()})})},_initializeFallbacks:function(){var n,t=[e.allApproved];c?(t.unshift(e.permalink),this.ui.personalizedRepliesButton.remove()):(t.unshift(e.personalized),this.ui.permalinkRepliesButton.remove()),(n=function(){var s,e=t.shift();e&&(s=e.collection,this.listenToOnce(s,"sync",function(){this.showFacet(e,!0),s.hasMore()||s.length?(e.$button.removeClass("hide").addClass("active"),this.ui.replyFilterContainer.removeClass("hide")):(e.$button.remove(),e.$footerButton.remove(),n())}),s.fetch({reset:!0}))}.bind(this))()},replyToStarterPost:function(){var e,n=b.addCommentRegion(this.ui.editorPlaceholder);this.listenToOnce(n,"editor:post:save",function(t){e=i.extend(t.toJSON(),{_surfaced:!0,_viaEditor:!0}),this.contentRegion.currentView.collection.unshift(e),m.trigger("newComment",{comment:e})}),p().then(function(e){e.createComment(t)})},onClickFilter:function(s){var t,o,n=s.currentTarget.className;if(s.preventDefault(),-1===n.indexOf("active")){if(this.contentRegion.currentView.teardownWaypoint(),-1!==n.indexOf("personalized"))t=e.personalized;else if(-1!==n.indexOf("allview"))t=e.allApproved;else{if(-1===n.indexOf("permalink-replies"))return;t=e.permalink}o=t.collection,this.ui.filterButtons.removeClass("active"),t.$button.addClass("active"),r.scrollTo(this.$el,250,{offset:-100}),this.showFacet(t,!0)}},onClickPendingSwitch:function(o){var t,i,n=s.collection;return o.preventDefault(),n===e.allApproved.collection?t=e.allUnapproved:n===e.allUnapproved.collection&&(t=e.allApproved),i=t.collection,this.showFacet(t,!0),r.scrollTo(this.$el,250,{offset:-50}),!1},onRender:function(){i.extend(e.personalized,{$button:this.ui.personalizedRepliesButton,$footerButton:this.ui.authorViewFooter}),i.extend(e.allApproved,{$button:this.ui.allRepliesButton,$footerButton:this.ui.allViewFooter}),i.extend(e.permalink,{$button:this.ui.permalinkRepliesButton,$footerButton:this.ui.allViewFooter}),this._initializeFallbacks(),this.listenToOnce(this.contentRegion,"show",function(){this.listenToOnce(e.personalized.collection,"pagination:done",this.toggleFooterLinks).listenToOnce(e.allApproved.collection,"pagination:done",this.toggleFooterLinks).listenToOnce(e.allUnapproved.collection,"pagination:done",this.toggleFooterLinks),e.permalink&&this.listenToOnce(e.permalink.collection,"pagination:done",this.toggleFooterLinks)})},toggleFooterLinks:function(){var e=s.collection,t=e._hasFirstFetched&&!e.hasMore();this.ui.footerButtonsContainer.addClass("hide"),this.ui.allViewFooter.addClass("hide"),this.ui.authorViewFooter.addClass("hide"),t&&e.length&&(this.ui.footerButtonsContainer.removeClass("hide"),e.getDiscussionType()===n.discussionTypes.ALL?this.ui.authorViewFooter.removeClass("hide"):this.ui.allViewFooter.removeClass("hide"))},serializeData:function(){var e=t.get("byline")||t.get("author").displayName;return{byline:e,permalinkByline:e,permalink:t.get("permalink"),replyCount:t.get("replyCount")}}}))})