if("undefined"==typeof tiger)var tiger={};"undefined"==typeof tiger.components&&(tiger.components={}),"undefined"==typeof tiger.components.discussion&&(tiger.components.discussion={}),"undefined"==typeof tiger.components.forms&&(tiger.components.forms={}),"undefined"==typeof tiger.components.forms.modals&&(tiger.components.forms.modals={}),"undefined"==typeof tiger.components.groupchats&&(tiger.components.groupchats={}),"undefined"==typeof tiger.components.invites&&(tiger.components.invites={}),"undefined"==typeof tiger.components.invites.menuItems&&(tiger.components.invites.menuItems={}),"undefined"==typeof tiger.components.invites.modals&&(tiger.components.invites.modals={}),"undefined"==typeof tiger.components.post&&(tiger.components.post={}),"undefined"==typeof tiger.components.post.meta&&(tiger.components.post.meta={}),"undefined"==typeof tiger.components.spinner&&(tiger.components.spinner={}),"undefined"==typeof tiger.icons&&(tiger.icons={}),"undefined"==typeof tiger.icons.essential&&(tiger.icons.essential={}),"undefined"==typeof tiger.messages&&(tiger.messages={}),"undefined"==typeof tiger.messages.postAction&&(tiger.messages.postAction={}),define("apiclient/post",["config","apiclient/apirequest","apiclient/gettoken","singleton/Feature"],function(a,b,c,d){"use strict";var e,f=d.isOn("postsecuretoken")?a.api.core.secureUrl+"/post":a.api.core.url+"/post";return e={create:b.postJson(c.append(f+"/add",d.isOn("postsecuretoken")?c.secure:c.fresh,!0)),read:b.getJson(c.append(f+"/preview/{{id}}",d.isOn("postsecuretoken")?c.secure:c.fresh)),update:b.postJson(c.append(f+"/{{id}}/update",d.isOn("postsecuretoken")?c.secure:c.fresh,!0)),"delete":b.postJson(c.append(f+"/{{id}}/delete",d.isOn("postsecuretoken")?c.secure:c.fresh,!0)),generatePostJson:function(a){return b.postJson(c.append(f+a,d.isOn("postsecuretoken")?c.secure:c.fresh,!0))},socialStats:b.getJson(a.api.core.url+"/dfp/post/{{id}}/stats")}}),define("model/post/Post",["config","jquery","backbone","underscore","singleton/CurrentUser","singleton/Utils","apiclient/gettoken","apiclient/post"],function(a,b,c,d,e,f,g,h){"use strict";var i=b("<div />"),j=function(a){var b,c=a.getHours(),d=a.getMinutes(),e=a.getMonth()+1+"/"+a.getDate()+"/"+a.getFullYear();return 10>c&&(c="0"+c),10>d&&(d="0"+d),b=c+":"+d,{MdyHm:[e,b].join(" ")}},k={dateTimeFormat:/^\d{1,2}\/\d{1,2}\/\d{4} \d{1,2}:\d{2}$/,chompImgType:/img\.gawkerassets\.com\/img\/(\w+)\/[\w\-]+\./g},l=c.Model.extend({constructor:function(a){window.__postModelStorage=window.__postModelStorage||{};var b,d,e=window.__postModelStorage,f=void 0!==a&&void 0!==a.id&&void 0!==e,g={};if(f&&void 0!==e[a.id]){for(d in a)a.hasOwnProperty(d)&&null!==a[d]&&(g[d]=a[d]);return b=e[a.id],b.set(g),b}c.Model.prototype.constructor.apply(this,arguments),f&&(e[a.id]=this)},initialize:function(){k=b.extend(k,{mediaInPost:new RegExp("<("+this.mediaTags.join("|")+")","gim")})},storeInMemory:function(){var a=window.__postModelStorage||{},b=void 0!==this.id&&void 0!==a;return b&&void 0!==a[this.id]?a[this.id].set(this.attributes):a[this.id]=this,this},mediaTags:["img","embed","object","iframe","video","audio","canvas"],defaults:{promoteState:{},publishTime:j(new Date),blogs:new c.Collection,liked:!1},validationRules:{PUBLISHTIME_IS_REQUIRED:function(a){var b=!0;return"SCHEDULED"!==a.status||a.publishTimeMillis||(b=!1),b},POST_CONTENT_IS_REQUIRED:function(a){var c=!0,d=a.headline&&b.trim(i.html(a.headline)),e=a.original&&b.trim(i.html(a.original).text()),f=a.original&&(k.mediaInPost.test(a.original)||i.html(a.original).find("img").length),g=a.hasFile||a.files&&a.files.length;return d||e||f||g||(c=!1),c},POST_CONTENT_CANNOT_CONTAIN_BAD_CONTENT:function(a){var b=!0,c=["form"].join("");return i.html(a.original).find(c).length&&(b=!1),b}},savePipeline:b.Deferred().resolve(),publishTime:function(a){return j(a)},sync:function(a,c,e){var f,i,j,k,l,m;if("create"!==a&&(void 0===c.id||null===c.id))throw new Error("Post.sync(): Model undefined");switch(c.attributes.meta={},"undefined"!=typeof c.attributes.status&&(c.attributes.meta.status=c.attributes.status),"undefined"!=typeof c.attributes.allowReplies&&(c.attributes.meta.allowReplies=c.attributes.allowReplies),"undefined"!=typeof c.attributes.showByline&&(c.attributes.meta.showByline=c.attributes.showByline),"undefined"!=typeof c.attributes.byline&&(c.attributes.meta.byline=c.attributes.byline),"undefined"!=typeof c.attributes.properties&&(c.attributes.meta.properties=c.attributes.properties),a){case"create":f="POST",i=c.has("parentId")&&""!==c.get("parentId")?"/api/core/post/"+c.get("parentId")+"/jsonReplyWithApproval":"/api/core/post/add",j=JSON.stringify(c);break;case"read":f="GET",i=void 0!==e.preview&&e.preview===!0?"/api/core/post/preview/"+c.id:void 0!==e.showcase&&e.showcase===!0?"/api/core/post/showcase/"+c.id:"/api/core/post/"+c.id;break;case"update":f="POST",i="/api/core/post/"+c.id+"/update",j=JSON.stringify(c);break;case"delete":f="POST",i="/api/core/post/"+c.id+"/delete"}return k={type:f,dataType:"json",contentType:"application/json",url:i,data:j||null},l=b.Deferred(),m=l.promise(),g.secure().done(function(f){k.url=k.url+"?token="+f,"delete"===a?h[a]({id:c.id},e).done(l.resolve).fail(l.reject):b.ajax(d.extend(k,e)).done(l.resolve).fail(l.reject)}),m},parse:function(a){if(void 0===a)throw new Error("Post.parse(): no response to parse");var b={};return b=a.data?a.data:a,void 0!==b.id&&null!==b.id&&(b.id=parseInt(b.id,10)),b.tagDescriptions=b.tags.map(function(a){return a.description}),b.images&&b.images.length&&(b.images=[]),b},toFormData:function(){var a=["id","headline","original","tags","publishTimeMillis","publishTimeZone","status","blogId","defaultBlogId","annotation.annotationType","annotation.imageUrl","annotation.imageChompId","annotation.imageWidth","annotation.imageHeight","annotation.x","annotation.y","annotation.annotationText","annotation.annotationTextHash","allowReplies","sponsored","showByline","byline","salesAvatar","salesAvatarMap","share","properties","shareBlogId","sharedPostId","images","parentId","adZone"],b=["status","allowReplies","showByline","byline","properties"],c=function(a){var c=a[0],e=a[1];return-1!==d.indexOf(b,c)&&(c="meta."+c),[c,e]},e=d.pick(this.toJSON(),d.union(a,d.map(b,function(a){return"meta."+a}))),f=d.object(d.pairs(e).map(c));return f},getUrl:function(){return void 0!==this.get("permalink")?this.get("permalink"):"/"+this.id},getActionState:function(){var a=b.Deferred();return this.has("actionState")?a.resolve():this.getPostInfo().done(function(){a.resolve()}),a.promise()},getPostInfo:function(c){var d,f=this,g=parseInt(this.id,10);if(!e.isLoggedIn())throw new Error("Post.getPostInfo(): user not logged in");return c=c||{},c.success=c.success||function(){},d=[a.api.core.url,"/post/",g,"/actionstatus?token=",e.get("token")].join(""),b.ajax({type:"GET",dataType:"jsonp",jsonp:"jsonp",url:d,success:function(a){200===a.meta.status&&(f.setActionState(a.data),c.success.call(f))}})},isPublished:function(){return"PUBLISHED"===this.get("status")},setAction:function(b,c,d){var e,f={};if(!b||"repost"!==b&&"dismiss"!==b&&"actionreset"!==b)throw new Error("Post:setAction(): Invalid post action: "+b);if(!c)throw new Error("Post:setAction(): Invalid blogId: "+c);return e="repost"===b?a.api.core.url+"/post/"+this.id+"/"+b+"/"+c:"/ajax/post/"+this.id+"/"+b+"/"+c,"repost"===b&&d.publishTimeMillis&&(f.repostTime=d.publishTimeMillis),this.setLikeOrAction(d,b,e,f)},setLikeOrAction:function(a,c,d,f){var h,i,j,k;return a=a||{},f=f||{},a.success=a.success||function(){},a.error=a.error||function(){},e.isLoggedIn()||a.error.call(this,{reason:"user"}),i=b.Deferred(),j=i.promise(),k=this,g.fresh().done(function(e){f.token=e,h="repost"===c?{url:d+"?"+b.param(f),type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:"{}"}:{url:d+"?"+b.param(f),type:"POST"},b.ajax(h).done(function(b){void 0!==b.meta?"repost"===c||"dismiss"===c||"actionreset"===c?(k.setActionState(b.data),a.success.call(k,{response:b.data})):(k.setLikeState(b.data),a.success.call(k,{response:b.data})):a.error.call(k,{reason:"action error"}),i.resolve()}).fail(function(b){a.error.call(this,b.responseJSON,b.status,b.statusText),i.reject(b.responseJSON,b.status,b.statusText)})}),j},setActionState:function(a){var b={};d.each(a,function(a){b[a.blogId]=a.relation.toLowerCase()},this),this.set({actionState:b})},setLike:function(a,b){var c,e=["like","unlike"];if(!a||!d.contains(e,a))throw new Error("Post:setLike(): Invalid post action: "+a);return"like"===a&&(a+="AndApprove"),c="likeAndApprove"!==a?["/api/core/post",this.id,a].join("/"):["/ajax/post",this.id,a].join("/"),this.setLikeOrAction(b,a,c)},setLikeState:function(a){var b=a||{},c=b.like||b;void 0!==c.objectId&&c.objectId===this.get("id")?this.set({liked:!0}):this.set({liked:!1})},prepareAnnotations:function(){if(this.has("annotation")){var a=this.get("annotation"),c=b().text(a.annotationText),d=170;void 0===a.annotationShortText&&c.length>d&&(a.annotationShortText=f.cut(c,d))}return this},parseFromDom:function(a){var b=JSON.parse(decodeURIComponent(a.data("model")));return new l(b)},replaceImagesWithOriginal:function(){var a=this.get("display");return this.set("display",a.replace(k.chompImgType,"img.gawkerassets.com/img/$1/original.")),this},validate:function(){var a=[],b=this.toJSON();return b.mode&&d.each(this.validationRules,function(c,d){c(b)||a.push({error:"CLIENT_VALIDATION_ERROR",reason:d})},this),a.length?a:!1},getShareOptionsForUser:function(a){var c=b.Deferred(),e=[],f=[],g=[],h=a.get("defaultBlogId"),i=!1;return this.getActionState().done(function(){d.each(this.get("actionState"),function(a,b){"repost"===a&&e.push(parseInt(b,10))}),i=-1!==d.indexOf(e,h)?!0:!1,a.get("membership").each(function(a){a.get("blogId")===h||"ENABLED"!==a.get("blog").status&&"SPAM"!==a.get("blog").status||(-1!==d.indexOf(e,a.get("blog").id)?g.push({name:a.get("blog").displayName,id:a.get("blog").id}):f.push({name:a.get("blog").displayName,id:a.get("blog").id}))},this),c.resolve({repostedTo:e,repostedToPersonal:i,personalBlogId:h,blogsUndo:g,blogsRepost:f})}.bind(this)),c.promise()}});return l}),define("collection/PaginationCollection",["backbone"],function(a){"use strict";var b=a.Collection.extend({_stepIndex:0,_stepSize:10,_doneStepping:!1,constructor:function(b,c){b=b||[],c=c||{},a.Collection.prototype.constructor.call(this,b,c)},_incrementStep:function(){this._stepIndex+=this._stepSize},_checkDone:function(a){var b=this.parse(a);return b&&b.length?!1:!0},getStepIndex:function(){return this._stepIndex},getStepSize:function(){return this._stepSize},hasMore:function(){return!this._doneStepping},disablePagination:function(){this._doneStepping=!0}});return b}),define("module/discussion/model/comment.model",["underscore","backbone","model/post/Post"],function(a,b,c){"use strict";var d=c.extend({initialize:function(){c.prototype.initialize.call(this),this.on("change:approved",this.approveAncestors)},setLike:function(a,b){var d=c.prototype.setLike.call(this,a,b);return("like"===a||"unlike"===a)&&d.done(function(){this.trigger("discussion:comment:likestatechanged",this.get("id"),a)}.bind(this)),d},parse:function(a){return a=a||{},d.addDiscussionId(a,{commentModel:this})},constructor:function(a,c){b.Model.prototype.constructor.call(this,a,c),this.cid=a._discussionId},_commentCollection:null,getChildren:function(){if(!this._commentCollection){var a=require("module/discussion/model/comment.collection"),b=this.collection;this._commentCollection=new a([],{parent:this,approvedOnly:b.getApprovedOnly(),parentDepth:b.getDepth(),discussionType:b.getDiscussionType()})}return this._commentCollection},getParent:function(){var a=function(b,c){var d,e;return(d=b.findWhere({id:c}))?d:(e=b.getParent(),e&&e.collection?a(e.collection,c):null)};return this.collection&&this.get("parentId")?a(this.collection,this.get("parentId")):null},approveAncestors:function(){for(var a=this.getParent();a;)a.set("approved",!0),a=a.getParent()}},{addDiscussionId:function(b,c){var d,e;return c.hasOwnProperty("discussionType")?d=c.discussionType:c.hasOwnProperty("commentModel")&&(e=c.commentModel,e.collection?d=e.collection.getDiscussionType():e._parent&&e._parent.collection&&(d=e._parent.collection.getDiscussionType())),a.extend(b,{_discussionId:d+"_"+b.id})}});return d}),define("templates/tiger/components/groupchats/flagreason",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(a,b,c,d,e,f){b.components.groupchats.flagreason=function(a,c,d){return'<form><label class="reason-head">Why are you flagging this?<a class="icon" href="http://help.gawker.com/customer/portal/articles/1726140-what-is-flagging-?b_id=5895" target="_blank">'+b.icons.actions.information(null,null,d)+'</a></label><div class="row radio-cont"><div class="column small-12 js_error hide proxima"><small class="warningmessage">Please select a reason</small></div><div class="columns small-12"><label><input type="radio" name="reason" value="HARASSMENT">It\'s harassment</label></div></div><div class="row radio-cont"><div class="columns small-12"><label><input type="radio" name="reason" value="HATE_SPEECH">It\'s hate speech</label></div></div><div class="row radio-cont"><div class="columns small-12"><label><input type="radio" name="reason" value="SPAM">It\'s spam</label></div></div><div class="flag-reason-ctas"><a class="button secondary tiny cancel js_cancel">Cancel</a><a class="button primary tiny submit js_submit">Save</a></div></form>'},d.DEBUG&&(b.components.groupchats.flagreason.soyTemplateName="tiger.components.groupchats.flagreason")}),define("module/flagging/view/FlagReasonDropdown",["backbone.marionette","templates/tiger/components/groupchats/flagreason"],function(a){"use strict";var b=a.ItemView.extend({template:tiger.components.groupchats.flagreason,className:"flag-reason-dropdown js_flagreason",events:{submit:"submit",click:"preventPropagation","click .js_cancel":"cancel","click .js_submit":"submit"},initialize:function(){},preventPropagation:function(a){a.stopPropagation()},cancel:function(){this.trigger("flagreason:cancel")},submit:function(a){a.preventDefault();var b=this.$('input[name="reason"]:checked').val();return b?this.trigger("flagreason:submit",this,b):this.$(".js_error").removeClass("hide"),!1}});return b}),define("templates/tiger/components/forms/modals/flagreason",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(a,b,c,d,e,f){b.components.forms.modals.flagreason=function(a,b,c){return'<div class="show-for-medium-down flag-reason-mobile"><ul class="sticky-modal-options"><li class="js_reason-harassment" data-reason="HARASSMENT">It\'s harassment</li><li class="js_reason-hate-speech" data-reason="HATE_SPEECH">It\'s hate speech</li><li class="js_reason-spam" data-reason="SPAM">It\'s spam</li></ul><footer class="row"><div class="column small-12"><input type="button" class="button tiny secondary js_cancel" tabindex="5" value="Cancel" /></div></footer></div>'},d.DEBUG&&(b.components.forms.modals.flagreason.soyTemplateName="tiger.components.forms.modals.flagreason")}),define("module/flagging/view/FlagReasonModal",["jquery","backbone.marionette","templates/tiger/components/forms/modals/flagreason"],function(a,b){"use strict";var c=b.ItemView.extend({template:tiger.components.forms.modals.flagreason,tagName:"form",events:{submit:"submit","click .js_cancel":"cancel","click .js_reason-harassment":"selectReason","click .js_reason-hate-speech":"selectReason","click .js_reason-spam":"selectReason"},cancel:function(){this.trigger("flagreason:cancel")},selectReason:function(b){var c=a(b.target).attr("data-reason");if(!c)throw new Error("Empty reason code for reason!");this.trigger("flagreason:submit",this,c)}});return c}),define("apiclient/flagging",["config","apiclient/apirequest","apiclient/gettoken"],function(a,b,c){"use strict";var d={flagPost:function(b){return b.reason?a.api.core.url+"/post/{{postId}}/flag?reason={{reason}}":a.api.core.url+"/post/{{postId}}/flag"},unflagPost:function(b){return b.reason?a.api.core.url+"/post/{{postId}}/unflag?reason={{reason}}":a.api.core.url+"/post/{{postId}}/unflag"}},e={getPosts:b.getJson(c.append(a.api.core.url+"/post/{{starterId}}/flaggedposts")),getCount:b.getJson(c.append(a.api.core.url+"/post/{{starterId}}/flaggedcount")),flagPost:b.postJson(c.append(d.flagPost)),unflagPost:b.postJson(c.append(d.unflagPost)),getBlogCount:b.getJson(c.append(a.api.core.url+"/blog/{{blogId}}/flaggedcount")),resolveFlag:b.postJson(c.append(a.api.core.url+"/post/{{postId}}/resolve")),unresolveFlag:b.postJson(c.append(a.api.core.url+"/post/{{postId}}/unresolve"))};return window.__karma__&&(e.__testonly__={urls:d}),e}),define("templates/tiger/components/groupchats/flagging-admin-link",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(a,b,c,d,e,f){b.components.groupchats.flaggingAdminLink=function(a,b,c){return"<div class=\"flagging-admin-link proxima\"><a onClick=\"window.ga('send', 'event', 'On-Page Flagging', 'click', 'Click into moderation queue');\" href=\"https://kinja.com/manage/"+e.$$escapeHtmlAttribute(a.blogName)+'/flagged">Moderate Flagged Replies ('+e.$$escapeHtml(a.flagCount)+")</a></div>"},d.DEBUG&&(b.components.groupchats.flaggingAdminLink.soyTemplateName="tiger.components.groupchats.flaggingAdminLink")}),define("module/flagging/ReplyFlaggingModule",["jquery","underscore","singleton/Feature","singleton/CurrentUser","singleton/Utils","singleton/WindowController","module/flagging/view/FlagReasonDropdown","module/flagging/view/FlagReasonModal","app/modal/modal.controller","apiclient/flagging","templates/tiger/components/groupchats/flagging-admin-link"],function(a,b,c,d,e,f,g,h,i,j){"use strict";var k={flaggedReplies:null,flaggedRepliesLoaded:a.Deferred(),flagCount:null,flagCountLoaded:a.Deferred(),tokenRenewed:!1,reasonDropdown:void 0,reasonModal:void 0,_loadFlaggedReplies:function(a){var b=this,c=function(c,e){b.flaggedReplies=[],e&&e.success===!0?(b.flaggedReplies=c.map(function(a){return a.postId}),b.flaggedRepliesLoaded.resolve()):e&&"InvalidSessionToken"===e.type&&k.tokenRenewed===!1?(k.tokenRenewed=!0,d.token().done(function(){k._loadFlaggedReplies(a)})):b.flaggedRepliesLoaded.reject()};j.getPosts({starterId:a}).done(c)},_loadFlagCount:function(a){var b=this,c=function(a,c){c&&c.success===!0&&(b.flagCount=Number(a)),b.flagCountLoaded.resolve()};j.getCount({starterId:a}).done(c)},_mergePostModelWithFlagInfo:function(a){var c=a.get("id");b.contains(this.flaggedReplies,c)&&a.set({allowReplies:!1,flagged:!0})},_postStatus:function(a){return 0!==a.parents(".all-threads").length?a.parents(".js_reply").hasClass("reply--unapproved")?"Pending":"Approved":"Featured"},_flagPost:function(a,d,e){var f,g,h=d.get("flagged")===!0,i=d.get("id"),l=h?"Unflag":"Flag",m=k._postStatus(a);d.get("flaggingInProgress")===!0&&b.isUndefined(k.reasonDropdown)||(d.set({flaggingInProgress:!0}),g=c.isOn("extendedflag")&&!b.isUndefined(e)&&"Flag"===l?l+" - "+e.toLowerCase():l,window.ga("send","event","On-Page Flagging",g,"Reply status: "+m),f=h?j.unflagPost({postId:i,reason:e}):j.flagPost({postId:i,reason:e}),f.done(function(a,b){void 0!==b&&b.success===!0&&(d.set({flagged:!h,allowReplies:h,flaggingInProgress:!1}),this._syncFlaggedReplies(!h,i))}.bind(this)))},_syncFlaggedReplies:function(a,c){null!==k.flaggedReplies&&(a?k.flaggedReplies.push(c):k.flaggedReplies=b.reject(k.flaggedReplies,function(a){return a===c})),null!==k.flagCount&&(a?k.flagCount++:k.flagCount--)},_showDropdownReasonSelection:function(b,c){var d,e;k._hideReasonDropdown(),k.reasonDropdown=new g({$reply:b,model:c}),k.reasonDropdown.on("flagreason:submit",k._handlePostFlagFromDropdown),k.reasonDropdown.on("flagreason:cancel",k._hideReasonDropdown),k.reasonDropdown.render(),c.set({flaggingInProgress:!0}),k.reasonDropdown.$el.appendTo(b),d=k.reasonDropdown.$el,a(window).scrollTop()+window.innerHeight-d.height()<d.offset().top&&(e=d.offset().top-d.height(),a("body").scrollTo(e,{duration:"slow"}))},_showModalReasonSelection:function(a,b){k.reasonModal=new h({$reply:a,model:b}),k.reasonModal.on("flagreason:cancel",function(){i.close()}),k.reasonModal.on("flagreason:submit",k._handlePostFlagFromModal),i.create(k.reasonModal,{name:"flagreason",className:"reveal-modal kinja-modal sticky-modal bottom full-width"})},_handlePostFlagFromDropdown:function(a,b){var c=a.model;a.$("a,input").addClass("disabled"),c.once("change:flagged",k._hideReasonDropdown),k._flagPost(a.options.$reply,c,b)},_handlePostFlagFromModal:function(a,b){var c=a.model;a.$("a,input").addClass("disabled"),c.once("change:flagged",function(){i.close()}),k._flagPost(a.options.$reply,c,b)},_hideReasonDropdown:function(){b.isUndefined(k.reasonDropdown)||(k.reasonDropdown.options.model.set({flaggingInProgress:!1}),k.reasonDropdown.remove(),k.reasonDropdown=void 0)},API:{flaggedRepliesLoaded:function(){return k.flaggedRepliesLoaded},flagCountLoaded:function(){return k.flagCountLoaded},flaggedReplies:function(){return k.flaggedReplies},flagCount:function(){return k.flagCount},openFlagView:function(a,b){d.requireLogin("flagPost").done(function(){f.isSmall()?k._showModalReasonSelection(a,b):k._showDropdownReasonSelection(a,b)})},unflag:function(a,b){d.requireLogin("unflagPost").done(function(){k._flagPost(a.view.$el,b)})},loadFlaggedReplies:function(a){d.onAuth.done(function(){d.isLoggedIn()&&k._loadFlaggedReplies(a)})},loadFlagCount:function(a){d.onAuth.done(function(){var b=e.getKinjaMeta().blog.id;d.isLoggedIn()&&(d.isSuperuser()&&c.isOn("superuser")||d.hasRole("OWNER",b)||d.hasRole("ADMIN",b))?k._loadFlagCount(a):k.flagCountLoaded.reject()})},extendPostModel:function(a){k.flaggedRepliesLoaded.done(function(){k._mergePostModelWithFlagInfo(a)})}}};return window.__karma__&&(k.API.__testonly__=k),k.API}),define("apiclient/discussion",["underscore","config","apiclient/apirequest","apiclient/gettoken","singleton/Feature","singleton/Utils"],function(a,b,c,d,e,f){"use strict";var g,h,i,j=b.api.core.url,k=e.isOn("superuser"),l=window.parseInt(e.value("discussion_truncation")||0,10);return h={personalized:j+"/reply/{{postId}}/replies/qi/combined/userfilter/activity",nextPersonalized:j+"/reply/{{parentId}}/replies",all:j+"/reply/{{postId}}/replies",nextAll:j+"/reply/{{parentId}}/replies/flat",permalink:j+"/reply/{{postId}}/replies/qi/combined/userfilter/activity",nextPermalink:j+"/reply/{{parentId}}/replies"},i=a.mapObject(h,function(a){return k?d.append(a,d.fresh):a}),g={getPersonalizedReplies:c.getJson(i.personalized,{query:"",currentBlogId:0,refId:0,maxReturned:l||25,includedAdmins:!0,removeDismissed:!0,cache:e.isOn("cachecomments")?f.shouldGetCached:!1}),getNextPersonalizedReplies:c.getJson(i.nextPersonalized,{currentBlogId:0,startIndex:0,startTime:0,maxReturned:20,withLikeCounts:!1,cache:e.isOn("cachecomments")?f.shouldGetCached:!1}),getAllReplies:c.getJson(i.all,{currentBlogId:0,startIndex:0,maxReturned:l||10,withLikeCounts:!0,maxChildren:4,approvedChildrenOnly:!0,approvedStartersOnly:!0,cache:e.isOn("cachecomments")?f.shouldGetCached:!1}),getNextAllReplies:c.getJson(i.nextAll,{currentBlogId:0,startIndex:4,maxReturned:20,approvedChildrenOnly:!0,approvedStartersOnly:!0,cache:e.isOn("cachecomments")?f.shouldGetCached():!1}),getPermalinkReplies:c.getJson(i.permalink,{query:"",refId:0,currentBlogId:0,maxReturned:l||25,sort:"chrono",removeDismissed:!0,cache:e.isOn("cachecomments")?f.shouldGetCached:!1}),getNextPermalinkReplies:c.getJson(i.nextPermalink,{currentBlogId:0,startIndex:0,startTime:0,maxReturned:20,withLikeCounts:!1,cache:e.isOn("cachecomments")?f.shouldGetCached:!1})}}),define("apiclient/likestate",["config","apiclient/apirequest","apiclient/gettoken"],function(a,b,c){"use strict";var d;return d={getForPosts:b.getJson(c.append(a.api.core.url+"/like/status"),{}),getForStarter:b.getJson(c.append(a.api.core.url+"/like/{{starterId}}"),{})}}),define("module/discussion/model/comment.collection",["jquery","underscore","collection/PaginationCollection","module/discussion/model/comment.model","module/flagging/ReplyFlaggingModule","singleton/CurrentBlog","singleton/CurrentUser","singleton/Utils","apiclient/discussion","apiclient/likestate"],function(a,b,c,d,e,f,g,h,i,j){"use strict";var k=c.extend({_hasFirstFetched:!1,_stepIndex:0,_stepSize:100,_incrementStep:function(a){var b=this.getDiscussionType(),c=this.getDepth();b!==k.discussionTypes.ALL?1>c?this._stepIndex=a.data.pagination.next.refId:this._stepIndex=a.data.pagination.next.startIndex:1>c?this._stepIndex=a.data.pagination.next.startIndex:this._stepIndex+=a.data.items[0].children.items.length},_checkDone:function(a){var b,c;return this.getDiscussionType()!==k.discussionTypes.ALL?!(a.data.hasOwnProperty("pagination")&&a.data.pagination.hasOwnProperty("next")):this.getDepth()<1?!(a.data.hasOwnProperty("pagination")&&a.data.pagination.hasOwnProperty("next")):(b=this._stepIndex+a.data.items[0].children.items.length,c=this.getApprovedOnly()?this._approvedCount:a.data.items[0].reply.replyCount,c>b?!1:!0)},_parent:null,_permalinkComment:null,_depth:0,_discussionType:"",_approvedOnly:!0,_approvedCount:0,model:d,initialize:function(a,b){this._discussionType=b.discussionType,b.hasOwnProperty("parent")&&(this._parent=b.parent),b.hasOwnProperty("permalinkComment")&&(this._permalinkComment=b.permalinkComment),b.hasOwnProperty("parentDepth")&&(this._depth=b.parentDepth+1),b.hasOwnProperty("approvedOnly")&&!b.approvedOnly&&(this._approvedOnly=!1),this._discussionType===k.discussionTypes.ALL&&this.getDepth()>0&&(this._stepIndex=4),this.listenTo(this,"sync",function(){this._hasFirstFetched=!0,this.loadLikedComments(),this.loadFlaggedComments()}),this.listenTo(this,"discussion:comment:likestatechanged",this.onCommentLikeStateChanged)},loadFlaggedCommentCount:function(){var a=this._parent.get("id");return e.flagCount()||e.loadFlagCount(a),e.flagCountLoaded()},loadFlaggedComments:function(){var a=this._parent.get("id"),c=function(a){b.each(a,function(a){this.setAttributesOnComment(this,a,{flagged:!0})},this)}.bind(this);e.flaggedRepliesLoaded().done(function(){c(e.flaggedReplies())}),e.flaggedReplies()||e.loadFlaggedReplies(a)},loadLikedComments:function(){var a=this._parent.get("id"),c=function(a){b.each(a,function(a){this.setAttributesOnComment(this,a,{liked:!0})},this)}.bind(this);g.onAuth.done(function(){g.isLoggedIn()&&this._parent.get("replyCount")>0&&(k.likedCommentIds?c(k.likedCommentIds):j.getForStarter({starterId:a},{traditional:!0}).done(function(a){var d=b.pluck(a,"objectId");k.likedCommentIds=d,c(d)}.bind(this)))}.bind(this))},onCommentLikeStateChanged:function(a,c){k.likedCommentIds&&("like"===c?k.likedCommentIds.push(a):k.likedCommentIds=b.reject(k.likedCommentIds,function(b){return b===a}))},setAttributesOnComment:function(a,c,d){b.each(a.models,function(a){c===a.get("id")?a.set(d):a._commentCollection&&a._commentCollection.models.length>0&&this.setAttributesOnComment(a._commentCollection,c,d)},this)},getFullListOfIds:function(a){var c=[];return b.each(a.models,function(a){c.push(a.get("id")),a._commentCollection&&a._commentCollection.models.length>0&&(c=c.concat(this.getFullListOfIds(a._commentCollection)))},this),c},sync:function(a,b,c){var d=this.getApprovedOnly(),e=this.getDiscussionType(),g=h.getKinjaMeta().postAuthorBlogName,j=this._permalinkComment;return f.id||require(["module/Raven"],function(Raven){Raven.captureMessage("currentBlogId is weird",{extra:{currentBlog:f,discussionType:e,depth:this._depth}})}),e===k.discussionTypes.PERSONALIZED?this._depth>0?i.getNextPersonalizedReplies({parentId:this._parent.get("id"),currentBlogId:f.id,startIndex:this.getStepIndex()},c):i.getPersonalizedReplies({query:g,postId:this._parent.get("id"),currentBlogId:f.id,refId:this.getStepIndex()},c):e===k.discussionTypes.ALL?this._depth>0?i.getNextAllReplies({parentId:this._parent.get("id"),currentBlogId:f.id,startIndex:this._stepIndex,maxReturned:this._stepSize,approvedOnly:d},c):i.getAllReplies({postId:this._parent.get("id"),currentBlogId:f.id,startIndex:this.getStepIndex(),approvedChildrenOnly:d,approvedStartersOnly:d},c):this.getDiscussionType()===k.discussionTypes.PERMALINK?this._depth>0?i.getNextPermalinkReplies({parentId:this._parent.get("id"),currentBlogId:f.id,startIndex:this.getStepIndex()},c):i.getPermalinkReplies({postId:this._parent.get("id"),refId:this.getStepIndex()||(j?j.get("id"):0),query:h.getKinjaMeta().postAuthorBlogName,currentBlogId:f.id},c):null},parse:function(a){var c,e,f=[],g=this.getDepth(),h=this.getDiscussionType(),i=k.discussionTypes;return e=function(a,c,e,i){var j,l,m;d.addDiscussionId(a,{discussionType:h}),1>g&&(a._surfaced=!0),b.each(c,function(a){d.addDiscussionId(a,{discussionType:h}),1>g&&(a._surfaced=!0)}),j=new d(a),m=new k(c,{parent:j,parentDepth:g,discussionType:h,approvedOnly:this.getApprovedOnly()}),i&&(m._approvedCount=i),j._commentCollection=m,e&&(l=this.getApprovedOnly()&&"undefined"!=typeof i?i:a.replyCount,l>4?(j._commentCollection._doneStepping=!1,j._commentCollection._stepIndex=4,j._commentCollection&&j._commentCollection.length&&(j._commentCollection._stepIndex=j._commentCollection.length)):(j._commentCollection._doneStepping=!0,j._commentCollection._stepIndex=j._commentCollection.length)),f.push(j)},h===i.PERSONALIZED||h===i.PERMALINK?1>g?b.each(a.data.items,function(a){if(a.length){var c=b.countBy(a,"parentId");a=b.map(a,function(a){var b=a.id;return a.hasOwnProperty("qiMeta")&&(a.replyCount=a.qiMeta.filteredDirectReplies.length),c.hasOwnProperty(b)&&(a.replyCount-=c[b]),a}),e.call(this,b.first(a),b.rest(a))}}.bind(this)):(c=b.pluck(this._parent.collection.models,"id"),b.each(a.data.items,function(a){-1===c.indexOf(a.reply.id)&&e.call(this,a.reply,a.children.items)}.bind(this))):h===i.ALL&&(1>g?b.each(a.data.items,function(a){e.call(this,a.reply,a.children.items,!0,a.approvedCount)}.bind(this)):f=b.map(a.data.items[0].children.items,function(a){return d.addDiscussionId(a,{discussionType:h})})),this._checkDone(a)?(this._doneStepping=!0,this.trigger("pagination:done")):(this._incrementStep(a),this._doneStepping=!1),f},getParent:function(){return this._parent},getDiscussionType:function(){return this._discussionType},getDepth:function(){return this._depth},getSurfacedCommentLength:function(){return this.filter(function(a){return a.get("_surfaced")}).length},getApprovedOnly:function(){return this.getDiscussionType()===k.discussionTypes.PERSONALIZED?!a.cookie("KinjaNSFWCookie"):this._approvedOnly}},{discussionTypes:{PERSONALIZED:"QiReplyList",ALL:"ReplyList",PERMALINK:"PermalinkQiReplyList"},likedCommentIds:null});return k}),define("module/discussion/discussion.channel",["backbone","underscore"],function(a,b){"use strict";return b.extend({},a.Events)}),define("gawkerlib/analytics/analytics_config_prod",[],function(){"use strict";var a={rootUrl:"http://kinja.com/api/analytics/",rootUrlWoProtocol:"//kinja.com/api/analytics/"};return a}),!function(){function a(a){this.message=a}var b="undefined"!=typeof exports?exports:this,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a.prototype=new Error,a.prototype.name="InvalidCharacterError",b.btoa||(b.btoa=function(b){for(var d,e,f=String(b),g=0,h=c,i="";f.charAt(0|g)||(h="=",g%1);i+=h.charAt(63&d>>8-g%1*8)){if(e=f.charCodeAt(g+=.75),e>255)throw new a("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");d=d<<8|e}return i}),b.atob||(b.atob=function(b){var d=String(b).replace(/=+$/,"");if(d.length%4==1)throw new a("'atob' failed: The string to be decoded is not correctly encoded.");for(var e,f,g=0,h=0,i="";f=d.charAt(h++);~f&&(e=g%4?64*e+f:f,g++%4)?i+=String.fromCharCode(255&e>>(-2*g&6)):0)f=c.indexOf(f);return i})}(),define("lib/base64.min",function(){}),define("module/KinjaAnalytics",["jquery","gawkerlib/analytics/analytics_config_prod","lib/base64.min"],function(a,b){"use strict";var c={
session:{},context:{},setContext:function(a,b,c){this.context.blogId=a,this.context.contextType=b,this.context.id=c},createPayload:function(a,b,c,d,e,f,g,h){var i={blogId:a,eventType:b,targetType:c,targetId:d,contextType:e,contextId:f,eventAttributes:g,eventAttributesExtended:h};return i},pushEvent:function(a,b,c,d,e){var f=this.createPayload(this.context.blogId?String(this.context.blogId):null,a,b,c?String(c):null,this.context.contextType,this.context.id?String(this.context.id):null,d,e);this.writeEvent(f)},setSession:function(a){return"string"==typeof a.agid&&"string"==typeof a.asid&&a.ping?(this.session.globalId=a.agid,this.session.sessionId=a.asid,this.session.ping=a.ping,!0):!1},getEventMeta:function(){var a={context:this.context,session:this.session};return a},writeEvent:function(c){var d=btoa(JSON.stringify(c)),e=b.rootUrlWoProtocol,f=Math.floor(1e3*Math.random()+1),g=e+"t/event.js?e="+d+"&cb="+f,h=this;a.ajax(g,{type:"GET",success:function(a){h.setSession(a.data)},xhrFields:{withCredentials:!0},crossDomain:!0})}};return c}),define("app/post/common/post.layout",["underscore","backbone.marionette","singleton/CurrentUser","singleton/Utils","singleton/Feature","module/KinjaAnalytics"],function(a,b,c,d,e,f){"use strict";var g=b.Layout.extend(a.extend({regions:{post:".post"},ui:{likeButton:".js_like",likeIcon:".js_like_icon",likeCountPlaceholder:".js_like_count",replyButton:".js_reply-to-post",metaContainer:".meta-container",metaTools:".js_meta-tools"},triggers:{"click @ui.likeButton":"posttools:like","click @ui.replyButton":"posttools:reply"},events:{approval:"_removePendingStyling","click @ui.likeIcon":"onRecommendTracking"},modelEvents:{"change:liked":"_updateLikeIconClasses","posttools:post:likeCount:updated":"_updateLikeCount"},updateUserState:function(){c.onAuth.done(function(){c.isLoggedIn()?this._updateLikeIconClasses():this._removeLikeIconClass()}.bind(this)),c.onLoggedIn.done(this._updateLikeIconClasses.bind(this))},togglePostToolsVisibility:function(a){e.isOn("newstream")?this.ui.metaTools.toggleClass("hide",a):this.ui.metaContainer.toggleClass("without-dropdown",a)},onRecommendTracking:function(a){var b="groupChat"===a.currentTarget.parentElement.getAttribute("data-analytics-target");d.getKinjaMeta().pageType!==d.pageTypes.permalink||b||f.pushEvent("RECOMMENDATION","POST",this.model.id,{uiElement:a.currentTarget.getAttribute("data-analytics-target")})},_removePendingStyling:function(b,c){var d=this.$el.closest(".js_branch-list");a.each(c.approvedReplyIDs,function(a){d.find("#reply_"+a).removeClass("reply--unapproved")})},_updateLikeIconClasses:function(){this.ui.likeIcon.toggleClass("active",this.model.get("liked"))},_removeLikeIconClass:function(){this.ui.likeIcon.removeClass("active")},_updateLikeCount:function(){var a=parseInt(this.ui.likeButton.data("likecount"),10)||0,b=a>0;a=this.model.get("liked")?a+1:b?a-1:0,this.ui.likeButton.data("likecount",a),this.ui.likeCountPlaceholder.text(a||"")}}));return g}),define("app/post/mixins/post.userPermissionsHelper",["singleton/Feature","singleton/CurrentUser","singleton/CurrentBlog"],function(a,b,c){"use strict";return{canEditPost:function(c){var d=15,e=function(a){var b=new Date(a+60*d*1e3),c=new Date;return b>c},f=b.isLoggedIn(),g=b.id===c.get("authorId"),h=b.hasRole("OWNER",c.get("defaultBlogId")),i=b.hasRole("ADMIN",c.get("defaultBlogId")),j=c.has("parentId"),k=f&&(g||h||i)&&!j,l=f&&j&&g&&e(c.get("publishTimeMillis"));return b.isSuperuser()&&a.isOn("superuser")||k||l},canDeletePost:function(a){var c=b.isLoggedIn(),d=b.id===a.get("authorId"),e=b.hasRole("OWNER",a.get("defaultBlogId")),f=a.has("parentId");return c&&(d||e)&&!f},canInviteToPostManually:function(c){return a.isOn("invitetoken")&&c.get("authorId")===b.id},canPromote:function(){return b.hasPermission("SALES")||b.isSuperuser()&&a.isOn("superuser")},canDismissPost:function(d){var e=b.hasRole("ADMIN",c.id)||b.hasRole("ADMIN",d.get("defaultBlogId")),f=b.id===d.get("authorId"),g=b.id===d.get("parentAuthorId"),h=d.has("parentId");return h&&(b.isSuperuser()&&a.isOn("superuser")||!f&&(e||g))},canUnshareRepostedPost:function(){return b.hasRole("ADMIN",c.id)},canBlock:function(a){return this.userIsOwner(a)||this.userIsAdmin(a)||this.userIsSuper()},canSharePost:function(){return b.isLoggedIn()},userIsAuthor:function(a){return b.hasRole("AUTHOR",a.get("defaultBlogId"))&&b.id!==a.get("authorId")},userIsOwner:function(a){return b.hasRole("OWNER",a.get("defaultBlogId"))&&b.id!==a.get("authorId")},userIsAdmin:function(a){return b.hasRole("ADMIN",a.get("defaultBlogId"))&&b.id!==a.get("authorId")},userIsSuper:function(){return b.isSuperuser()&&a.isOn("superuser")}}}),define("app/post/mixins/post.userPermissions",["underscore","app/post/mixins/post.userPermissionsHelper"],function(a,b){"use strict";var c=["canEditPost","canDeletePost","canInviteToPostManually","canPromote","canDismissPost","canUnshareRepostedPost","canBlock","canSharePost","userIsAuthor","userIsOwner","userIsAdmin","userIsSuper"];return a.reduce(c,function(c,d){return c[d]=a.wrap(b[d],function(a){return a.call(this,this.model)}),c},{})}),define("app/post/mixins/post.confirmationPrompt",["jquery","singleton/Renderer"],function(a,b){"use strict";var c={_confirmationPrompt:function(c,d){return window.confirm(a(b.renderTemplate(c,d||{})).text())}};return c}),define("app/post/common/post.menuitemview",["backbone.marionette"],function(a){"use strict";var b=a.ItemView.extend({_show:function(){this.$el.removeClass("hide")},_hide:function(){this.$el.addClass("hide")},_isDisabled:function(){return!1},_canShow:function(){throw new Error("method _canShow not implemented!")},onRender:function(){this._canShow()?(this._show(),this._isDisabled()?this.$el.addClass("disabled"):this.$el.removeClass("disabled")):this._hide()}});return b}),define("app/post/posttools/view/posttools.menuitemview",["underscore","app/post/mixins/post.userPermissions","app/post/mixins/post.confirmationPrompt","app/post/common/post.menuitemview"],function(a,b,c,d){"use strict";var e=d.extend(a.extend({},b,c,{_canShow:function(){var b=this,c=function(a){return b[a]};return a.chain(this.permissions).map(c).invoke("call",this).all().value()},render:function(){return this.isClosed=!1,this.triggerMethod("before:render",this),this.triggerMethod("item:before:render",this),this.bindUIElements(),this.triggerMethod("render",this),this.triggerMethod("item:rendered",this),this}}));return e}),define("app/post/posttools/view/posttools.editview",["app/post/posttools/view/posttools.menuitemview","singleton/Feature","singleton/Utils"],function(a,b,c){"use strict";var d=a.extend({permissions:["canEditPost"],onRender:function(){var d=b.isOn("editor_own_page_test")?window.location.search:"",e=this.$el.find("a");a.prototype.onRender.call(this,arguments),e.attr("href","//"+c.getKinjaHost()+"/write/"+this.model.id+d)}});return d}),define("app/post/posttools/view/posttools.editreplyview",["app/post/posttools/view/posttools.menuitemview"],function(a){"use strict";var b=a.extend({permissions:["canEditPost"]});return b}),define("app/post/posttools/view/posttools.deleteview",["app/post/posttools/view/posttools.menuitemview"],function(a){"use strict";var b=a.extend({permissions:["canDeletePost"],triggers:{click:"posttools:delete"}});return b}),define("apiclient/invite",["config","apiclient/apirequest","apiclient/gettoken"],function(a,b,c){"use strict";return{addInvite:b.postJson(c.append(a.api.core.url+"/invite")),requestInviteToken:b.postJson(c.append(a.api.core.url+"/invite/create?postId={{postId}}")),approveInvitedCommenter:b.postJson(a.api.core.url+"/invite/approve")}}),define("templates/tiger/components/invites/modals",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(a,b,c,d,e,f){b.components.invites.modals.inviteToPostManually=function(a,b,c){return'<form class="invite-to-post-form js_invite-to-post-form"><div class="row"><div class="columns"><input type="url" class="mbn js_invite-manually-field" value="'+e.$$escapeHtmlAttribute(a.permalink)+"?invite="+e.$$escapeHtmlAttribute(a.inviteUid)+'" autofocus /></div></div></form>'},d.DEBUG&&(b.components.invites.modals.inviteToPostManually.soyTemplateName="tiger.components.invites.modals.inviteToPostManually")}),define("view/forms/invite/InviteToPostManuallyModalView",["backbone.marionette","singleton/EventDispatcher","templates/tiger/components/invites/modals"],function(a,b){"use strict";var c=a.ItemView.extend({id:"modal-invite-to-post-manually",template:tiger.components.invites.modals.inviteToPostManually,ui:{inviteToPostManuallyField:"#js_invite-to-post-manually-field"},initialize:function(){b.on("modal:login:close",this.close,this)}});return c}),define("app/invites/behaviors/invites.token.posttools",["backbone.marionette","apiclient/invite","app/modal/modal.controller","view/forms/invite/InviteToPostManuallyModalView"],function(a,b,c,d){"use strict";var e=a.Behavior.extend({events:{click:"onInviteModalToPostManuallyOpen"},onInviteModalToPostManuallyOpen:function(a){a.preventDefault(),b.requestInviteToken({postId:this.view.model.id}).done(function(a){var b=c.instantiate(d,{templateData:{permalink:this.view.model.get("permalink"),inviteUid:a.inviteUid}});c.create(b,{name:"invite",className:"reveal-modal kinja-modal small proxima"})}.bind(this))}});return e}),define("app/post/posttools/view/posttools.invitemanuallyview",["app/post/posttools/view/posttools.menuitemview","app/invites/behaviors/invites.token.posttools"],function(a,b){"use strict";var c=a.extend({permissions:["canInviteToPostManually"],behaviors:{InvitesTokenPostTools:{behaviorClass:b}}});return c}),define("app/post/posttools/view/posttools.dismissview",["app/post/posttools/view/posttools.menuitemview","singleton/CurrentUser","singleton/Utils"],function(a,b,c){"use strict";var d=a.extend({permissions:["canDismissPost"],ui:{dismissButton:"a.dismiss",undismissButton:"a.undismiss"},triggers:{"click @ui.dismissButton":"posttools:dismiss","click @ui.undismissButton":"posttools:undismiss"},modelEvents:{"change:actionState":"_finishRender"},_finishRender:function(){this._setDismissState(),a.prototype.onRender.call(this)},_setDismissState:function(){var a=this.model.get("actionState"),b=this.model.get("defaultBlogId");a=a?a[b]:"","dismiss"===a?(this.$el.removeClass(".js_dismiss").addClass("js_undismiss"),this.ui.dismissButton.addClass("hide"),this.ui.undismissButton.removeClass("hide")):(this.$el.removeClass(".js_undismiss").addClass("js_dismiss"),this.ui.undismissButton.addClass("hide"),this.ui.dismissButton.removeClass("hide"))},onRender:function(){var a,d,e=this;"permalink"===c.getKinjaMeta().pageType?(a=parseInt(c.getKinjaMeta().postId||0,10),d=parseInt(c.getKinjaMeta().starterId||0,10),a!==d&&a===this.model.id?b.onAuth.always(function(){b.isLoggedIn()?e.triggerMethod("posttools:getDismissState",{model:e.model}):e._finishRender()}):this._finishRender()):this._finishRender()}});return d}),define("app/post/posttools/view/posttools.promoteview",["app/post/posttools/view/posttools.menuitemview","singleton/Utils"],function(a,b){"use strict";var c=a.extend({permissions:["canPromote"],triggers:{click:"posttools:promote"},onPosttoolsOpened:function(){var a=this.model&&parseInt(b.getKinjaMeta().postId,10)===this.model.get("sharedPostId");a&&this.$el.addClass("hide")}});return c}),define("app/post/posttools/view/posttools.blockview",["app/post/posttools/view/posttools.menuitemview","singleton/CurrentUser"],function(a,b){"use strict";var c=a.extend({permissions:["canBlock"],events:{click:"_blockBlog"},modelEvents:{"posttools:blockStatusUpdated":"_finishRender"},collectionEvents:{"posttools:block posttools:unblock sync":"_checkBlockStatus"},_checkBlockStatus:function(){this.triggerMethod("posttools:checkBlockStatus",{model:this.model,collection:this.collection})},_blockBlog:function(a){a.preventDefault(),this.triggerMethod("posttools:block",{model:this.model,collection:this.collection,targetBlogName:this._getTargetBlogName(),targetAuthorName:this._getTargetAuthorName()}),this.$el.siblings(".js_unfollowforblog").addClass("hide"),this.$el.siblings(".js_followforblog").removeClass("hide"),this.$el.siblings(".js_unfollowforuser").addClass("hide"),this.$el.siblings(".js_followforuser").removeClass("hide")},_correctBlockText:function(a){var b=this.$el.find("span"),c=b.text(),d=a?"Unblock":"Block";d=c.replace(/Unblock|Block/,d),b.text(d)},_finishRender:function(b){this._correctBlockText(b),a.prototype.onRender.call(this)},_getTargetBlogName:function(){return this.$el.data("targetblogname")},_getTargetAuthorName:function(){return this.$el.data("targetauthorname")},onRender:function(){var a=this;b.onAuth.always(function(){a._canShow()?a._checkBlockStatus():a._hide()})}});return c}),define("app/post/posttools/view/posttools.hideview",["app/post/posttools/view/posttools.menuitemview"],function(a){"use strict";var b=a.extend({permissions:["userIsSuper"],triggers:{click:"posttools:hide"}});return b}),define("app/post/posttools/view/posttools.kinjashareview",["app/post/posttools/view/posttools.menuitemview","singleton/Utils"],function(a,b){"use strict";var c=a.extend({permissions:[],events:{click:"onKinjaShareClick"},onKinjaShareClick:function(){var a=parseInt(b.getKinjaMeta().postId,10)===this.model.get("sharedPostId"),c=this.model.get("isStarter");this.trigger("posttools:kinjaShare",this.model,{showReframe:!a&&c})}});return c}),define("app/post/posttools/view/posttools.kinjaunshareview",["app/post/posttools/view/posttools.menuitemview"],function(a){"use strict";var b=a.extend({permissions:["canSharePost","canUnshareRepostedPost"],triggers:{click:"posttools:undorepost"}});return b}),define("app/post/posttools/view/posttools.externalshareview",["jquery","app/post/posttools/view/posttools.menuitemview"],function(a,b){"use strict";var c=b.extend({permissions:[],ui:{sharePostButton:".js_share-post-item"},triggers:{"click @ui.sharePostButton":"posttools:externalShare"},onRender:function(){var b=function(b){return a("<div/>").html(b).text()},c=function(a){return a?a.replace(/&#(\d+);/g,function(a,b){return String.fromCharCode(b)}):""},d=this.model.get("headline")||this.model.get("first100Characters")||this.model.get("compact"),e=this.ui.sharePostButton.attr("href");this.ui.sharePostButton.attr("href",e.replace("POST_TITLE",encodeURIComponent(b(c(d)))))}});return c}),define("app/post/posttools/view/posttools.flagview",["app/post/posttools/view/posttools.menuitemview","module/flagging/ReplyFlaggingModule"],function(a,b){"use strict";var c=a.extend({modelEvents:{"change:flagged":"_flaggedChanged","change:flaggingInProgress":"_flaggedChanged"},permissions:[],events:{click:"_onFlagClicked"},_flaggedChanged:function(){this.render()},_canShow:function(){return this.model.get("flagged")!==!0},_isDisabled:function(){return this.model.get("flaggingInProgress")===!0},_onFlagClicked:function(a){a.preventDefault();var c=this.$el.parents(".js_reply");b.openFlagView(c,this.model)}});return c}),define("app/post/posttools/view/posttools.unflagview",["app/post/posttools/view/posttools.menuitemview"],function(a){"use strict";var b=a.extend({modelEvents:{"change:flagged":"_flaggedChanged","change:flaggingInProgress":"_flaggedChanged"},permissions:[],triggers:{click:"posttools:unflag"},_flaggedChanged:function(){this.render()},_canShow:function(){return this.model.get("flagged")===!0},_isDisabled:function(){return this.model.get("flaggingInProgress")===!0}});return b}),define("app/post/posttools/view/reposttools.unscheduleview",["app/post/posttools/view/posttools.menuitemview"],function(a){"use strict";return a.extend({permissions:["canSharePost"],triggers:{click:"reposttools:unschedule"}})}),define("app/post/posttools/view/posttools.pupilview",["jquery","underscore","app/post/posttools/view/posttools.menuitemview"],function(a,b,c){"use strict";var d=c.extend({permissions:["canPromote"],triggers:{click:"posttools:pupil"}});return d}),define("templates/tiger/components/post/meta/post-dropdown",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(a,b,c,d,e,f){b.components.post.meta.postDropdown=function(a,c,d){var f="",g=a.post.defaultBlogId!=(null==a.blog?null:a.blog.id)&&"POSTACTION"==(null==a.post.meta?null:a.post.meta.typ),h=null!=(null==a.blog?null:a.blog.name)?null==a.blog?null:a.blog.name:a.post.defaultBlogName,i=null!=(null==a.blog?null:a.blog.displayName)?null==a.blog?null:a.blog.displayName:h;return f+='<ul id="dropdown-'+e.$$escapeHtmlAttribute(a.post.id)+'" class="f-dropdown proxima js_post-dropdown js_follow-controls js_user-follow-controls whitelisted-links" data-postid="'+e.$$escapeHtmlAttribute(a.post.id)+'" data-starterid="'+e.$$escapeHtmlAttribute(a.post.starterId)+'" data-authorid="'+e.$$escapeHtmlAttribute(a.post.author.id)+'" data-blogid="'+e.$$escapeHtmlAttribute(a.post.authorBlogId)+'" data-sourceblogid="'+e.$$escapeHtmlAttribute(null==a.blog?null:a.blog.id)+'" data-dropdown-content>'+("reply"==a.mode?'<li class="js_edit-reply hover-icon hide readonly-hide"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">'+b.icons.actions.write(null,null,d)+"Edit</a></li>":'<li class="js_edit-post hover-icon hide readonly-hide"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">'+b.icons.actions.write(null,null,d)+"Edit</a></li>")+(g?'<li class="js_kinja-unshare hover-icon hide readonly-hide"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">'+b.icons.essential.externalLink(null,null,d)+"Unshare</a></li>":'<li class="js_delete-post hover-icon hide readonly-hide"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">'+b.icons.essential.close(null,null,d)+"Delete</a></li>")+("DRAFT"!=a.post.status?b.components.invites.menuItems.invitePostDropdownItems(null,null,d):"")+("reply"==a.mode&&"profilepage"!=a.pageType?'<li data-analytics-target="groupChat" class="js_followforuser hover-icon readonly-hide" onclick="window.ga(\'send\', \'event\', \'Group Chats\', \'click\', \'Drop down - follow user click\');"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">'+b.icons.essential.add(null,null,d)+"Follow "+e.$$escapeHtml(a.post.authorBlogName)+'</a></li><li class="js_unfollowforuser hover-icon hide readonly-hide"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">'+b.icons.essential.checkmark(null,null,d)+"Unfollow "+e.$$escapeHtml(a.post.authorBlogName)+"</a></li>"+("private"!=a.pageType&&"dashboard"!=a.pageType?'<li class="js_followforblog js_approveforblog hover-icon hide readonly-hide"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">'+(d.features.approvemessage?b.icons.essential.add(null,null,d)+"Approve "+e.$$escapeHtml(a.post.authorBlogName)+" on "+e.$$escapeHtml(i):b.icons.essential.add(null,null,d)+"Follow "+e.$$escapeHtml(a.post.authorBlogName)+" for "+e.$$escapeHtml(h))+'</a></li><li class="js_unfollowforblog js_unapproveforblog hover-icon hide readonly-hide"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">'+(d.features.approvemessage?b.icons.essential.checkmark(null,null,d)+"Remove "+e.$$escapeHtml(a.post.authorBlogName)+" from "+e.$$escapeHtml(i)+" approve list":b.icons.essential.checkmark(null,null,d)+"Unfollow "+e.$$escapeHtml(a.post.authorBlogName)+" for "+e.$$escapeHtml(h))+"</a></li>":""):"DRAFT"!=a.post.status?'<li class="js_promote hover-icon hide readonly-hide"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">'+b.icons.essential.starCircle(null,null,d)+"Promote</a></li>":"")+("DRAFT"!=a.post.status&&"dashboard"!=a.pageType?"<li class=\"js_dismiss hover-icon hide readonly-hide\"><a href=\"#\" class=\"dismiss icon--svg u-darkened--onhover u-prepended\" rel=\"nofollow\" onclick=\"window.ga('send', 'event', 'Group Chats', 'click', 'Dismiss click');\">"+b.icons.actions.userRemove(null,null,d)+"Dismiss</a><a href=\"#\" class=\"undismiss icon--svg u-darkened--onhover u-prepended\" rel=\"nofollow\" onclick=\"window.ga('send', 'event', 'Group Chats', 'click', 'Undismiss click');\">"+b.icons.actions.userRemove(null,null,d)+'Undismiss</a></li><li class="js_block hover-icon hide disabled readonly-hide" data-blogid="'+e.$$escapeHtmlAttribute(a.post.defaultBlogId)+'" data-targetblogid="'+e.$$escapeHtmlAttribute(a.post.authorBlogId)+'" data-targetblogname="'+e.$$escapeHtmlAttribute(h)+'" data-targetauthorname="'+e.$$escapeHtmlAttribute(a.post.author.displayName)+'"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">'+b.icons.actions.disabled(null,null,d)+"<span>Block for "+e.$$escapeHtml(h)+'</span></a></li><li class="js_hide-post hover-icon hide readonly-hide"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">'+b.icons.actions.disabled(null,null,d)+"Hide</a></li>":"")+("permalink"==a.pageType&&"DRAFT"!=a.post.status?("reply"==a.mode?'<li class="js_flag-post hover-icon readonly-hide"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">'+b.icons.actions.flag(null,null,d)+'Flag</a></li><li class="js_unflag-post unflag-post hover-icon readonly-hide"><a href="#" rel="nofollow" class="icon--svg u-darkened--onhover u-prepended">'+b.icons.actions.flag(null,null,d)+"Unflag</a></li>":d.features.pupil_rating?'<li class="js_pupil-rules-block"><a class="js_pupil-rules hover-icon icon--svg u-darkened--onhover u-prepended" href="#" rel="nofollow">'+b.icons.actions.writePaper(null,null,d)+"Open Pupil Rules</a></li>":"")+'<li class="js_kinja-share-block readonly-hide"><a class="js_kinja-share hover-icon icon--svg u-darkened--onhover u-prepended" href="#" rel="nofollow">'+b.icons.essential.externalLink(null,null,d)+'Share to Kinja</a></li><li class="js_go-to-permalink"><a class="hover-icon icon--svg u-darkened--onhover u-prepended" href="'+e.$$escapeHtmlAttribute(e.$$filterNormalizeUri(a.post.permalink))+"\" onclick=\"window.ga('send', 'event', 'Group Chats', 'click', 'Drop down - Go to permalink click');\">"+b.icons.essential.link(null,null,d)+"Go to permalink</a></li>":"")+("dashboard"==a.pageType&&"reply"==a.mode&&"DRAFT"!=a.post.status?'<li class="js_block readonly-hide" data-blogid="'+e.$$escapeHtmlAttribute(a.post.defaultBlogId)+'" data-targetblogid="'+e.$$escapeHtmlAttribute(a.post.authorBlogId)+'" data-targetblogname="'+e.$$escapeHtmlAttribute(h)+'" data-targetauthorname="'+e.$$escapeHtmlAttribute(a.post.author.displayName)+"\"><a href=\"#\" rel=\"nofollow\" onclick=\"window.ga('send', 'event', 'Group Chats', 'click', 'Block User click');\" class=\"icon--svg u-darkened--onhover u-prepended\">"+b.icons.essential.close(null,null,d)+"Block user for blog</a></li>":"")+"</ul>"},d.DEBUG&&(b.components.post.meta.postDropdown.soyTemplateName="tiger.components.post.meta.postDropdown"),b.components.post.meta.postDropdownTrigger=function(a,c,d){return'<a href="#" target="_self" class="post-dropdown-trigger js_post-menu-toggler icon--svg u-highlighted--onhover" data-dropdown="dropdown-'+e.$$escapeHtmlAttribute(a.post.id)+"\" onclick=\"window.ga('send', 'event', 'Group Chats', 'click', 'Drop down click');\">"+(d.features.newstream?b.icons.essential.toolsGiant(null,null,d):b.icons.essential.chevronBottom(null,null,d))+"</a>"},d.DEBUG&&(b.components.post.meta.postDropdownTrigger.soyTemplateName="tiger.components.post.meta.postDropdownTrigger")}),define("app/post/posttools/posttools.menuview",["jquery","underscore","backbone","backbone.marionette","singleton/CurrentUser","singleton/CurrentBlog","singleton/EventDispatcher","singleton/Utils","app/post/mixins/post.userPermissions","app/post/posttools/view/posttools.editview","app/post/posttools/view/posttools.editreplyview","app/post/posttools/view/posttools.deleteview","app/post/posttools/view/posttools.invitemanuallyview","app/post/posttools/view/posttools.dismissview","app/post/posttools/view/posttools.promoteview","app/post/posttools/view/posttools.blockview","app/post/posttools/view/posttools.hideview","app/post/posttools/view/posttools.kinjashareview","app/post/posttools/view/posttools.kinjaunshareview","app/post/posttools/view/posttools.externalshareview","app/post/posttools/view/posttools.flagview","app/post/posttools/view/posttools.unflagview","app/post/posttools/view/reposttools.unscheduleview","app/post/posttools/view/posttools.pupilview","templates/tiger/components/post/meta/post-dropdown"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){"use strict";var y=["profilepage","dashboard","manageblog"],z=d.ItemView.extend(b.extend({},i,{menuItemViewClasses:{".js_pupil-rules":x,".js_-post":j,".js_edit-post":j,".js_edit-reply":-1===b.indexOf(y,h.getKinjaMeta().pageType)?k:j,".js_delete-post":l,".js_invite-to-post-manually":m,".js_dismiss":n,".js_promote":o,".js_block":p,".js_hide-post":q,".js_kinja-share":r,".js_kinja-unshare":s,".js_external-share":t,".js_flag-post":u,".js_unflag-post":v,".js_unschedule-repost":w},events:{"requested.fndtn.dropdown .js_post-menu-toggler":"onPosttoolsRequested"},triggers:{"opened.fndtn.dropdown .js_post-dropdown":"posttools:opened"},menuItemViews:[],permissions:["userIsSuper","canEditPost","canPromote","canDismissPost","canSharePost"],initialize:function(a){g.on("blog:block:success"+this.model.id,this.render,this),this.blockedBlogCollection=a.blockedBlogCollection},_instantiateMenuItemViewClasses:function(a){return a=a||this.$el,Object.keys(this.menuItemViewClasses).reduce(function(c,d){var e=a.find(d),f=b.partial(this._createMenuItemClass.bind(this),d);return e.length?c.concat(b.map(e,f)):c}.bind(this),[])},_createMenuItemClass:function(b,c){var d=this.menuItemViewClasses[b],e={el:a(c),model:this.model};return".js_block"===b&&(e.collection=this.blockedBlogCollection),new d(e)},_bindEvents:function(){e.onAuthStateChange(this._refreshMenu.bind(this))},_refreshMenu:function(){var a="permalink"===h.getKinjaMeta().pageType,b=this,c=function(){return b.$("li:not(.hide)").length};b._renderMenuItems(),b.trigger("posttools:menuview:togglehidden",!a&&!c())},_renderMenuItems:function(){this.menuItemViews.call("render")},_captureMenuItemEvents:function(){this.menuItemViews.call("on","all",this.trigger,this)},_adjustMenuHeight:function(){var b,c=this.$(".js_post-dropdown"),d=a(window.document).height(),e=this.$el.offset().top,f=d-e-c.height();0>f&&(b=d-e,c.height(b+"px"),c.addClass("scroll"))},onPosttoolsOpened:function(){b.isEmpty(this.menuItemViews)?this.listenToOnce(this,"posttools:content:render",this.onPosttoolsOpened):(this.menuItemViews.call("triggerMethod","posttools:opened"),this._adjustMenuHeight())},onPosttoolsRequested:function(a,b){var c;c=d.Renderer.render(tiger.components.post.meta.postDropdown,{post:this.model.toJSON(),mode:"reply",pageType:h.getKinjaMeta().pageType,blog:f}),b.resolve(c),this.onContentRender()},render:function(){var a="permalink"===h.getKinjaMeta().pageType;return this.onContentRender(),a&&this.trigger("posttools:menuview:togglehidden",!1),this},onContentRender:function(){var a;this.menuItemViews.length||(a=this._instantiateMenuItemViewClasses(),this.menuItemViews=new c.ChildViewContainer(a),this._captureMenuItemEvents()),this._renderMenuItems(),this._bindEvents(),this.trigger("posttools:content:render")}}));return z}),define("templates/tiger/components/groupchats/unapproved-warning",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(a,b,c,d,e,f){b.components.groupchats.unapprovedWarning=function(a,b,c){return a=a||{},'<div class="js_toggle-pending unapproved-filter"><div class="filtered-view js_toggle-block"><div class="alert-container">'+(a.noReplies?"There are no approved replies for this post. To see additional replies that are pending approval, click Show Pending. Warning: These may contain graphic material.":"The following replies are approved. To see additional replies that are pending approval, click Show Pending. Warning: These may contain graphic material.")+'</div><div class="button-container"><a href="#" class="secondary js_pending-reply-switch" onclick="window.ga(\'send\', \'event\', \'Group Chats\', \'click\', \'Show Pending Toggle\');">Show pending</a></div></div><div class="unapproved-view js_toggle-block hide"><div class="alert-container">Warning: Replies that are pending approval may contain graphic material. Please proceed with caution.</div><div class="button-container"><a href="#" class="js_pending-reply-switch">Hide pending</a></div></div></div>'},d.DEBUG&&(b.components.groupchats.unapprovedWarning.soyTemplateName="tiger.components.groupchats.unapprovedWarning"),b.components.groupchats.unapprovedWarningThread=function(a,b,c){return'<div class="js_toggle-pending unapproved-filter unapproved-filter--thread"><div class="filtered-view js_toggle-block"><div class="alert-container">The following replies are approved. Click to show additional replies that are pending approval. Warning: These may contain graphic material.</div><div class="button-container"><a href="#" class="js_pending-reply-thread-switch">Show replies</a></div><div class="close-button-container"><a href="#" class="js_pending-close close-button"></a></div></div></div>'},d.DEBUG&&(b.components.groupchats.unapprovedWarningThread.soyTemplateName="tiger.components.groupchats.unapprovedWarningThread"),b.components.groupchats.unapprovedAnnotationWarning=function(a,b,c){return'<div class="js_toggle-pending unapproved-filter"><div class="filtered-view js_toggle-block"><div class="alert-container">The following reply is unapproved. Warning: It may contain graphic material.</div><div class="button-container"><a href="#" class="js_pending-reply-thread-switch">Show reply</a></div></div></div>'},d.DEBUG&&(b.components.groupchats.unapprovedAnnotationWarning.soyTemplateName="tiger.components.groupchats.unapprovedAnnotationWarning")}),define("module/discussion/view/warning.view",["backbone.marionette","templates/tiger/components/groupchats/unapproved-warning"],function(a){"use strict";var b=a.ItemView.extend({ui:{toggleBlocks:".js_toggle-block"},getTemplate:function(){var a=b.warningTypes,c=function(){};switch(this.options.warningType){case a.THREAD:c=tiger.components.groupchats.unapprovedWarningThread;break;case a.COMPLETE:c=tiger.components.groupchats.unapprovedWarning}return c},serializeData:function(){return{noReplies:this.options.noReplies}},toggleFilter:function(){this.ui.toggleBlocks.toggleClass("hide")}},{warningTypes:{THREAD:"thread",COMPLETE:"complete"}});return b}),define("view/ImageLoader",["jquery","underscore","singleton/EventDispatcher","view/BaseView","singleton/Feature","lib/waypoints","lib/jquery.browser.mobile"],function(a,b,c,d,e){"use strict";var f=a(document),g=a(window),h={initialLookaheadFactor:.8,lookaheadFactor:2.6,containerClass:"lazy-image"},i="loaded",j=d.extend({$allWrappers:a(),$allImages:a(),_watchedImages:[],viewportHeight:0,scrollTop:0,initialize:function(a){this.options=b.defaults(a||{},h),b.bindAll(this,"loadIfVisible","handleScroll","handleScrollNew"),this.registerImages(this.$el),this.addScrollEvents(),c.on("rendered.postlist.reply",function(a){this.registerImages(a.el)}.bind(this))},registerImages:function(c){var d=this.options.containerClass,e=c.find("."+d),f=e.find("img, iframe");this.$allWrappers=this.$allWrappers.add(e),this.$allImages=this.$allImages.add(f),this._watchedImages=this._watchedImages.concat(b.map(f,function(b){var c=a(b);return[c,c.outerHeight(),c.offset().top]})),this.$allImages.each(function(b,c){var e=a(c);e.data("wrapper",e.closest("."+d))}),this.trigger("images:registered")},addScrollEvents:function(){var c=b.bind(function(){this.viewportHeight=a.waypoints("viewportHeight")},this);c(),g.resize(b.debounce(c,1e3)),e.isOn("imageloader")?(g.scroll(b.throttle(b.partial(this.handleScrollNew,this.options.lookaheadFactor),500)),this.handleScrollNew(this.options.initialLookaheadFactor)):(g.scroll(b.throttle(b.partial(this.handleScroll,this.options.lookaheadFactor),500)),
this.handleScroll(this.options.initialLookaheadFactor))},loadImage:function(b){var c=a(b);c.data(i)||this.waitForPlaceholder(c)},reinitializeInterchange:b.once(function(){a(document).foundation("interchange")}),updateInterchange:b.throttle(function(){this.reinitializeInterchange(),a(document).foundation("interchange","reflow")},150),_loadImage:function(a){var c,d=a.data("src"),e=a.data("lazyInterchange");this.trigger("imageLoading",{$el:a}),c=b.bind(function(){a.off("load",c).addClass("lazy-loaded"),this.trigger("imageLoaded",{$el:a}),this._watchedImages=this._watchedImages.filter(function(b){return!a.is(b[0])})},this),a.load(c).data(i,!0),d?a.attr("src",d):e?(a.attr("data-interchange",e),this.updateInterchange()):a.load()},waitForPlaceholder:function(a){var c,d="await-placeholder",e=a.data("wrapper");e.hasClass("asset-loading")?a.data(d)||(a.data(d,!0),c=b.bind(function(){a.off("load",c),this._loadImage(a)},this),a.load(c)):this._loadImage(a)},loadIfVisible:function(a,b,c){!a.data(i)&&this.inViewPort(a,b,c)&&this.loadImage(a)},loadIfVisibleNew:function(a,b,c,d){!a.data(i)&&this.inViewPortNew(a,b,c,d)&&this.loadImage(a)},inViewPort:function(a,b,c,d){var e=this.scrollTop,f=d||this.options.lookaheadFactor,g=this.viewportHeight,h=g*f,i=e+g+h,j=e-h,k=Math.round(c),l=Math.round(k+b),m=l>j,n=i>k;return m&&n},inViewPortNew:function(a,b,c,d){var e=this.scrollTop,f=d||this.options.lookaheadFactor,g=this.viewportHeight,h=g*f,i=e+g+h,j=e-h,k=Math.round(c),l=Math.round(k+b),m=l>j,n=i>k;return m&&n},handleScrollNew:function(a){this._watchedImages.length&&(this.scrollTop=window.pageYOffset||f.scrollTop(),b.each(this._watchedImages,function(b){var c=b[0],d=b[1],e=b[2];this.loadIfVisibleNew(c,d,e,a)},this))},handleScroll:function(a){this._watchedImages.length&&(this.scrollTop=window.pageYOffset||f.scrollTop(),b.each(this._watchedImages,function(b){var c=b[0],d=b[1],e=b[2];this.loadIfVisible(c,d,e,a)},this))}});return j}),define("templates/tiger/components/spinner",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(a,b,c,d,e,f){b.components.spinner.bounce=function(a,b,c){return'<span class="spinner bounce"><span class="one"></span><span class="two"></span><span class="three"></span></span>'},d.DEBUG&&(b.components.spinner.bounce.soyTemplateName="tiger.components.spinner.bounce"),b.components.spinner.gifthaw=function(a,b,c){return'<div class="animationContainer"><svg width="26" height="12" viewBox="0 0 26 12" version="1.1" xmlns="http://www.w3.org/2000/svg" class="loading-animation loading-animation--small grey"><circle cx="4" cy="6" r="3" class="circle-1" /><circle cx="4" cy="6" r="3" class="circle-2" /><circle cx="13" cy="6" r="3" class="circle-3" /><circle cx="22" cy="6" r="3" class="circle-4" /></svg></div>'},d.DEBUG&&(b.components.spinner.gifthaw.soyTemplateName="tiger.components.spinner.gifthaw")}),define("view/GifImageLoader",["jquery","underscore","singleton/EventDispatcher","singleton/Feature","view/ImageLoader","lib/jquery.browser.mobile","templates/tiger/components/spinner"],function(a,b,c,d,e){"use strict";var f,g={mobileGifs:!0,gifClass:"lazy-gif",thawableClass:"thawable",thawingClass:"thawing",thawedClass:"thawed"};return f=e.extend({initialize:function(a){b.extend(this.options,b.defaults(a||{},g)),this.addEvents(),this.on("images:registered",this.markImagesThawable),e.prototype.initialize.apply(this,arguments)},addEvents:function(){var b=this.options.gifClass,e=function(a){return a.data("wrapper").hasClass(b)};a.browser.mobile||(d.isOn("webm")||this.on("imageLoading",function(b){var c=b.$el,d=new Image,f=c.data("anim-src");e(c)&&a(d).attr("src",f)},this),this.on("imageLoaded",function(a){var b=a.$el;e(b)&&this.thawImage(b)},this)),c.on("thawImage",function(a){var b=a.$el;"IMG"!==b.prop("tagName")&&(b=b.find("img")),this.thawImage(b)},this)},markImagesThawable:function(){var b=this.options;a.browser.mobile&&b.mobileGifs&&this.$allWrappers.addClass(b.thawableClass)},thawImage:function(b){var c,e,f,g;d.isOn("webm")?(c=a("<video>"),e=c[0].canPlayType("video/webm")?b.data("webm-src"):b.data("mp4-src"),c.attr({autoplay:!0,controls:a.browser.mobile,loop:!0,muted:!0,src:e,poster:b.attr("src"),"class":b.attr("class"),style:b.attr("style"),width:b.attr("width"),height:b.attr("height"),"data-chomp-id":b.data("chomp-id")}),c.data("wrapper",b.data("wrapper")),this.startLoadIndicator(c),b.replaceWith(c)):(f=b.data("animSrc")||b.data("assetUrl"),g=b.data("animInterchange"),this.startLoadIndicator(b),f&&b.attr("src",f),g&&(b.attr("data-interchange",g),this.updateInterchange()))},startLoadIndicator:function(b){var c=a(b),e=c.data("wrapper"),f=this.options,g=function(){e.removeClass(f.thawingClass).addClass(f.thawedClass),h.remove()},h=a(tiger.components.spinner.gifthaw()).appendTo(e);e.removeClass(f.thawableClass).addClass(f.thawingClass),c.load(g).error(g),d.isOn("webm")&&c.on("loadedmetadata",g)}})}),define("singleton/util/loadEditor",["underscore","jquery","singleton/Feature","singleton/StringUtils"],function(a,b,c,d){"use strict";function e(c,e,f){var g,h,i,j=b("head>meta[id="+e+"-css-url]");1===j.length?(g=j.attr("content"),h=0,i=function(){var b=a.find(document.styleSheets,function(a){return d.endsWith(a.href,g)});return"undefined"!=typeof b},document.createStyleSheet?document.createStyleSheet(g):b("head").append('<link rel="stylesheet" type="text/css" href="'+g+'" />'),j.remove(),require([c],function(){if(i())f.apply();else var a=window.setInterval(function(){(i()||h>99)&&(window.clearInterval(a),f.apply()),h+=1},250)})):require([c],f)}function f(){var a=b.Deferred();return c.isOn("webpack")?require(["module/MarionetteEditor","stylesheets/editor.css"],function(){require(["app/editor/editor.app"],a.resolve)}):e("module/MarionetteEditor","editor",function(){require(["app/editor/editor.app"],a.resolve)}),a.promise()}return f}),define("templates/tiger/components/groupchats/pending-image-message",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(a,b,c,d,e,f){b.components.groupchats.pendingImageMessage=function(a,b,c){return'<span class="label pending-image-label">Click to Reveal</span>'},d.DEBUG&&(b.components.groupchats.pendingImageMessage.soyTemplateName="tiger.components.groupchats.pendingImageMessage")}),define("singleton/ImageBlurHelper",["jquery","backbone.marionette","templates/tiger/components/groupchats/pending-image-message"],function(a,b){"use strict";var c={addImageBlur:function(c){var d=b.Renderer.render(tiger.components.groupchats.pendingImageMessage);c.find(".img-border").length||c.find("img").wrap(a("<span>").addClass("img-border")),c.addClass("blurred"),c.find(".img-border").prepend(d.cloneNode(!0)),c.find(".magnifier.lightBox").hide()},removeImageBlur:function(b){b.stopPropagation(),b.preventDefault();var c=a(b.currentTarget);c.find("img").addClass("unblur"),c.find(".pending-image-label").remove(),c.parents(".has-media").find(".magnifier.lightBox").show()}};return c}),define("module/discussion/regionManager/discussionRegionManager",["backbone.marionette"],function(a){"use strict";var b=a.RegionManager.extend({addCommentRegion:function(b){var c=this.get("commentRegion"),d=c?c.currentView:!1;return(!d||d.confirmRemove())&&(c&&(c.reset(),c.off()),c=new a.Region({el:b}),this.addRegion("commentRegion",c)),c}});return new b}),define("app/post/posttools/controller/posttools.dismiss.controller",[],function(){"use strict";var a={API:{dismiss:function(a){a.setAction("dismiss",a.get("defaultBlogId"),{success:function(){a.trigger("posttools:post:dismissed"),a.trigger("annotation:remove")}.bind(this),error:function(a){throw new Error("PostTools.dismissPost(): "+a.reason)}})},undismiss:function(a){a.setAction("actionreset",a.get("defaultBlogId"),{success:function(){a.trigger("posttools:post:undismissed")}.bind(this),error:function(a){throw new Error("PostTools.undismissPost(): "+a.reason)}})}}};return a.API}),define("collection/blog.subscribersCollection",["config","underscore","backbone","singleton/CurrentUser"],function(a,b,c,d){"use strict";var e=c.Collection.extend({idCache:[],initialize:function(a,b){if(!b||b&&(!b.blogId||!b.type))throw new Error("Missing options for BlogSubscribersCollection");this.type=b.type,this.blogId=b.blogId,b.userId&&(this.userId=b.userId),void 0!==b.withNames&&(this.withNames=b.withNames),this.enableShortening=b.enableShortening||!1,this.on("add remove request sync",function(){this.idCache=[]})},parse:function(a){var c=this,d=a&&a.data?a.data:null,e=[];return d&&(e=this.withNames?d.map(function(a){return b.isUndefined(a.id)&&(a.id=a.authorId?a.defaultBlogId:a.blogId),a.sourceBlogId=c.blogId,a}):d.map(function(a){return{id:a}})),this.enableShortening===!0&&e.length>1e3&&(e=e.slice(e.length-1e3,e.length),this.shortened=!0),e},sync:function(e,f,g){var h,i;switch(this.idCache=[],e){case"read":switch(h="GET",f.type){case"followed":i=this.withNames?a.api.profile.url+"/blogfollow/views/followedByWithNames?blogId="+f.blogId:a.api.profile.url+"/blogfollow/views/followedBy?blogId="+f.blogId;break;case"followers":i=a.api.profile.url+"/blogfollow/views/followersOf?blogId="+f.blogId;break;case"followedUsers":i=a.api.profile.url+"/userfollow/views/followedUsers?userId="+f.userId+"&token="+d.get("token");break;case"followedBlogs":i=a.api.profile.url+"/userfollow/views/followedBlogs?userId="+f.userId+"&token="+d.get("token");break;case"blocked":i=this.withNames?a.api.profile.url+"/blogblock/views/byBlogWithNames?blogId="+f.blogId:a.api.profile.url+"/blogblock/views/byBlog?blogId="+f.blogId;break;default:throw new Error("blog.subscribersCollection.sync(): unsupported method in sync")}break;default:throw new Error("blog.subscribersCollection.sync(): unsupported method in sync")}return c.ajax(b.extend({type:h,dataType:"json",url:i},g))},getIds:function(){var a=this.idCache.length;return a&&a===this.length?this.idCache:this.pluck("id")}});return e}),define("templates/tiger/messages/postAction",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(a,b,c,d,e,f){b.messages.postAction.areYouSureToDelPost=function(a,b,c){return"Are you sure you want to delete this post?"},d.DEBUG&&(b.messages.postAction.areYouSureToDelPost.soyTemplateName="tiger.messages.postAction.areYouSureToDelPost"),b.messages.postAction.confirmHidePost=function(a,b,c){return"Are you sure you want to hide this?"},d.DEBUG&&(b.messages.postAction.confirmHidePost.soyTemplateName="tiger.messages.postAction.confirmHidePost"),b.messages.postAction.confirmDismissPost=function(a,b,c){return"Are you sure you want to dismiss this reply?"},d.DEBUG&&(b.messages.postAction.confirmDismissPost.soyTemplateName="tiger.messages.postAction.confirmDismissPost"),b.messages.postAction.confirmBlockBlog=function(a,b,c){return""+("block"==a.action?"Are you sure you want to block "+e.$$escapeHtml(a.username)+" on "+e.$$escapeHtml(a.sitename)+"?":"Are you sure you want to unblock "+e.$$escapeHtml(a.username)+" on "+e.$$escapeHtml(a.sitename)+"?")},d.DEBUG&&(b.messages.postAction.confirmBlockBlog.soyTemplateName="tiger.messages.postAction.confirmBlockBlog"),b.messages.postAction.selfBlockError=function(a,b,c){return"You should not block yourself."},d.DEBUG&&(b.messages.postAction.selfBlockError.soyTemplateName="tiger.messages.postAction.selfBlockError"),b.messages.postAction.blogBockMember=function(a,b,c){return"Can't block a member of the blog."},d.DEBUG&&(b.messages.postAction.blogBockMember.soyTemplateName="tiger.messages.postAction.blogBockMember"),b.messages.postAction.postReposted=function(a,b,c){return"Shared to "+e.$$escapeHtml(a.blogName)+'. <a href="'+e.$$escapeHtmlAttribute(e.$$filterNormalizeUri(a.blogUrl))+'">View &raquo;</a>'},d.DEBUG&&(b.messages.postAction.postReposted.soyTemplateName="tiger.messages.postAction.postReposted"),b.messages.postAction.postScheduledRepost=function(a,b,c){return"Your post has been scheduled to publish."},d.DEBUG&&(b.messages.postAction.postScheduledRepost.soyTemplateName="tiger.messages.postAction.postScheduledRepost"),b.messages.postAction.repostRemoved=function(a,b,c){return"Post successfully un-shared from this blog (it may take 1-2 minutes for it to stop displaying)"},d.DEBUG&&(b.messages.postAction.repostRemoved.soyTemplateName="tiger.messages.postAction.repostRemoved"),b.messages.postAction.unsharePost=function(a,b,c){return"Removed share"},d.DEBUG&&(b.messages.postAction.unsharePost.soyTemplateName="tiger.messages.postAction.unsharePost"),b.messages.postAction.areYouSureToUnschedRepost=function(a,b,c){return"Are you sure you want to unschedule this repost?"},d.DEBUG&&(b.messages.postAction.areYouSureToUnschedRepost.soyTemplateName="tiger.messages.postAction.areYouSureToUnschedRepost"),b.messages.postAction.postDeleted=function(a,b,c){return"The post has been deleted successfully."},d.DEBUG&&(b.messages.postAction.postDeleted.soyTemplateName="tiger.messages.postAction.postDeleted"),b.messages.postAction.repostUnscheduled=function(a,b,c){return"The repost has been unscheduled successfully."},d.DEBUG&&(b.messages.postAction.repostUnscheduled.soyTemplateName="tiger.messages.postAction.repostUnscheduled"),b.messages.postAction.postRecommended=function(a,b,c){return"You recommended a post."},d.DEBUG&&(b.messages.postAction.postRecommended.soyTemplateName="tiger.messages.postAction.postRecommended"),b.messages.postAction.undoDismissMsg=function(a,b,c){return"You have successfully dismissed this reply."},d.DEBUG&&(b.messages.postAction.undoDismissMsg.soyTemplateName="tiger.messages.postAction.undoDismissMsg"),b.messages.postAction.undoBlockMsg=function(a,b,c){return"You have successfully dismissed this reply and blocked "+e.$$escapeHtml(a.userName)+" from "+e.$$escapeHtml(a.blogName)},d.DEBUG&&(b.messages.postAction.undoBlockMsg.soyTemplateName="tiger.messages.postAction.undoBlockMsg"),b.messages.postAction.undoResolveMsg=function(a,b,c){return"You have successfully resolved the flag on this reply."},d.DEBUG&&(b.messages.postAction.undoResolveMsg.soyTemplateName="tiger.messages.postAction.undoResolveMsg")}),define("app/post/posttools/controller/posttools.block.controller",["jquery","singleton/CurrentUser","singleton/EventDispatcher","collection/blog.subscribersCollection","templates/tiger/messages/postAction"],function(a,b,c,d){"use strict";var e={_blogsBlockedHash:{},_postIsBlocked:function(a,b){return-1!==b.indexOf(a.get("authorBlogId"))},_blockBlog:function(a,c){var d,f=c.targetBlogId,g=c.confirmation,h=c.blockedBlogCollection,i=a.get("defaultBlogId"),j=c.targetBlogName,k=c.targetAuthorName,l=c.forceAction;"undefined"!=typeof l?(d=l,b.set("forceAction",l)):d=e._postIsBlocked(a,c.blockedBlogIds)?"unblock":"block",("boolean"==typeof g&&g||g({action:d,username:k,sitename:j}))&&b.setBlogAction(d,i,f,{success:function(c){var e,g=b.get("forceAction");c?"block"===d?(h.add({id:f}),h.trigger("posttools:block"),a.trigger("posttools:block")):(e=h.findWhere({id:f}),e&&h.remove(e),h.trigger("posttools:unblock"),a.trigger("posttools:unblock")):("block"===g||"unblock"===g)&&(h.trigger("posttools:"+g),a.trigger("posttools:"+g))},error:function(a,b){var c;switch(b.code){case"BLOG_BLOCK_MEMBER":c=tiger.messages.postAction.blogBockMember;break;default:c=b?b.message:a.reason}e._showErrorMessage(c)}})},_blockedBlogsInitialized:function(b){var c;return e._blogsBlockedHash.hasOwnProperty(b)||(e._blogsBlockedHash[b]=e.API.getBlockedBlogCollection(b)),e._blogsBlockedHash[b].fetched?(c=a.Deferred(),c.resolve(e._blogsBlockedHash[b]),c):(e._blogsBlockedHash[b].fetched=!0,e._blogsBlockedHash[b].fetch())},_showErrorMessage:function(a){c.trigger("successbox:display",{message:a,warningBox:!0,dismissable:!0})},API:{block:function(b,c,d,f,g,h){var i,j=b.get("defaultBlogId"),k=b.get("authorBlogId");return j===k?(e._showErrorMessage(tiger.messages.postAction.selfBlockError),!1):void a.when(e._blockedBlogsInitialized(j)).then(function(){i={targetBlogId:k,blockedBlogIds:c.getIds(),blockedBlogCollection:c,confirmation:d,targetBlogName:f,targetAuthorName:g,forceAction:h},e._blockBlog(b,i)})},getBlockedBlogCollection:function(a){return e._blogsBlockedHash.hasOwnProperty(a)||(e._blogsBlockedHash[a]=new d([],{blogId:a,type:"blocked",withNames:!1})),e._blogsBlockedHash[a]},checkBlockStatus:function(b,c){var d=b.get("defaultBlogId");a.when(e._blockedBlogsInitialized(d)).then(function(){b.trigger("posttools:blockStatusUpdated",e._postIsBlocked(b,c.getIds()))})}}};return window.__karma__&&(e.API.__testonly__=e),e.API}),define("app/post/mixins/post.successMessage",["singleton/Renderer","singleton/EventDispatcher"],function(a,b){"use strict";var c={_displaySuccessMessage:function(c,d){b.trigger("successbox:display",{message:a.renderTemplate(c,d||{})})},_displayChannelMessage:function(c,d){b.trigger("successbox:display",{message:a.renderTemplate(c,d||{}),timeout:5e3})}};return c}),define("app/post/posttools/controller/posttools.like.controller",["jquery","underscore","singleton/CurrentUser","module/KinjaAnalytics","singleton/Utils","app/post/mixins/post.successMessage","templates/tiger/messages/postAction"],function(a,b,c,d,e,f){"use strict";var g={};return g=b.extend(g,f,{_trackRecommendation:function(a,b){var c,f=a.get("isStarter")?"Post":"Comment",g="sharingBottom"===b.$el.attr("data-analytics-target"),h="groupChat"===b.$el.parent().attr("data-analytics-target"),i="permalink"===e.getKinjaMeta().pageType;window.ga("send","event","Recommendation",f+" Recommended",a.get("permalink")),(!i||g||h)&&(e.getKinjaMeta().pageType===e.pageTypes.frontpage?c="homepage":e.getKinjaMeta().pageType===e.pageTypes.dashboard?c="dashboard":g?c="sharingBottom":h&&(c="groupChat"),d.pushEvent("RECOMMENDATION","POST",b.model.get("id"),{uiElement:c}))},_likePost:function(c,d){var e=c.get("liked")?"unlike":"like",f=c.setLike(e,{success:function(a){if("like"===e&&(g._trackRecommendation(c,d),g._displaySuccessMessage(tiger.messages.postAction.postRecommended),!c.get("isStarter")&&!c.get("approved"))){var f=b.pluck(a.response.approvalResult.approvedReplies,"postId"),h=d.model.get("id");-1!==b.indexOf(f,h)&&d.model.set({approved:!0})}},error:function(a){throw new Error("PostTools.likePost(): "+a.reason)}}),h=function(){c.trigger("posttools:post:likeCount:updated")};a.when(f).then(h)},API:{like:function(b,d){return a("body").hasClass("read-only")?!0:void c.requireLogin("likePost").done(function(){g._likePost(b,d)})}}}),g.API}),define("app/post/posttools/controller/posttools.hide.controller",["config","jquery","singleton/Feature","singleton/CurrentUser","model/post/Post"],function(a,b,c,d,e){"use strict";var f={API:{hide:function(f,g){var h=f.get("id"),i=a.api.core.url+"/post/"+h+"/hide?token="+d.get("token"),j=null,k="/";d.isSuperuser()&&c.isOn("superuser")&&g()&&(f.has("parentId")&&(j=new e({id:f.get("parentId")}),k=j.has("permalink")?j.get("permalink"):"/"+j.id),b.ajax({url:i,type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",success:function(a){void 0!==a.meta&&a.meta.success===!0&&window.setTimeout(function(){window.location.href=k},1e3)}}))}}};return f.API}),define("templates/tiger/components/fullscreen-spinner",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(a,b,c,d,e,f){b.components.fullscreenSpinner=function(a,c,d){return'<div class="loading-full animate"><div class="loading-message-box">'+b.components.spinner.bounce(null,null,d)+"</div></div>"},d.DEBUG&&(b.components.fullscreenSpinner.soyTemplateName="tiger.components.fullscreenSpinner")}),define("view/Spinner",["jquery","view/BaseView","templates/tiger/components/spinner","templates/tiger/components/fullscreen-spinner"],function(a,b){"use strict";var c=b.extend({visible:!0,fullscreen:!1,tagName:"div",className:"spinner-wrapper",initialize:function(a){this.visible=void 0===a.initiallyVisible?!0:a.initiallyVisible,this.fullscreen=void 0===a.fullscreen?!1:a.fullscreen,this.render()},render:function(){var b;return this.visible&&(b=this.fullscreen?this.soyToHtml(tiger.components.fullscreenSpinner):this.soyToHtml(tiger.components.spinner.bounce,{})),this.$el.html(b),this.fullscreen?a(this.el).find(".animate").addClass("in"):a(this.el).addClass("with-margin"),this}});return c}),define("apiclient/repost",["config","apiclient/apirequest","apiclient/gettoken"],function(a,b,c){"use strict";return{unschedule:b.postJson(c.append(a.api.core.url+"/blog/{{blogId}}/removeRepostJob/{{postId}}")),reschedule:b.postJson(c.append(a.api.core.url+"/blog/{{blogId}}/updateRepostJob/{{postId}}?repostTime={{repostTime}}"))}}),define("app/post/posttools/posttools.controller",["jquery","underscore","singleton/CurrentUser","singleton/EventDispatcher","singleton/Feature","singleton/Utils","singleton/util/loadEditor","module/KinjaAnalytics","view/BaseView","app/post/common/post.layout","app/post/mixins/post.confirmationPrompt","app/post/posttools/posttools.menuview","app/post/posttools/controller/posttools.dismiss.controller","app/post/posttools/controller/posttools.block.controller","app/post/posttools/controller/posttools.like.controller","app/post/posttools/controller/posttools.hide.controller","module/flagging/ReplyFlaggingModule","app/post/mixins/post.successMessage","app/MarionetteApp","view/Spinner","apiclient/repost","templates/tiger/messages/postAction"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){"use strict";var v=b.extend({},k,r,{_openSpinnerUntil:function(c,d){d=b.defaults({},{fullscreen:!0});var e=new t(d);return e.$el.appendTo("body"),a.when(c).then(e.remove.bind(e))},_like:function(a){a.model.get("tags")&&a.model.get("tags").length&&e.isOn("channels")&&!a.model.get("liked")&&s.vent.trigger("add:channel",{channelName:a.model.get("tags")[0].name,url:a.model.get("tags")[0].urlName}),o.like(a.model,a.view)},_reply:function(){require(["module/DiscussionModule"],function(a){a.replyToStarterPost()})},_dismiss:function(a){v._confirmationPrompt(tiger.messages.postAction.confirmDismissPost)&&m.dismiss(a.model)},_undismiss:function(a){m.undismiss(a.model)},_getDismissState:function(a){a.model.getActionState()},_delete:function(a){var c,d=a.model,e=this,g="dashboard"===f.getKinjaMeta().pageType||"manageblog"===f.getKinjaMeta().pageType;v._confirmationPrompt(tiger.messages.postAction.areYouSureToDelPost)&&(d.on("destroy",function(){e._displaySuccessMessage(tiger.messages.postAction.postDeleted),c=function(){window.location=g?window.location.pathname:i.prototype.cachebuster.call(i.prototype,"/")},b.delay(c,2e3)}),d.destroy({wait:!0}))},_unscheduleRepost:function(a){var c=this,d=a.view.el.getAttribute("data-postid"),e=a.view.el.getAttribute("data-blogid"),g=function(){window.location="private"===f.getKinjaMeta().pageType?window.location.pathname:i.prototype.cachebuster.call(i.prototype,"/")},h=function(){c._displaySuccessMessage(tiger.messages.postAction.repostUnscheduled),b.delay(g,2e3)};v._confirmationPrompt(tiger.messages.postAction.areYouSureToUnschedRepost)&&u.unschedule({postId:d,blogId:e}).done(h)},_promote:function(a){var b=a.model.id,d=c.hasPermission("SALES")||c.isSuperUser(),e=window.location.port?"http://kinja.dev:9000":"http://kinja.com";d&&(window.location.href=e+"/dfp/promotions/"+b)},_checkBlockStatus:function(a){n.checkBlockStatus(a.model,a.collection)},_postIsBlocked:function(a,b){return-1!==b.indexOf(a.get("authorBlogId"))},_block:function(a){var b=function(a){return v._confirmationPrompt(tiger.messages.postAction.confirmBlockBlog,a)};n.block(a.model,a.collection,b,a.targetBlogName,a.targetAuthorName)},_hide:function(a){var b=function(){return v._confirmationPrompt(tiger.messages.postAction.confirmHidePost)};p.hide(a.model,b)},_unflag:function(a){q.unflag(a,a.model)},_kinjaShare:function(a){var b;c.requireLogin("kinjaSharePost").done(function(){b=function(){return g().then(function(b){b.sharePost(a)})},a.has("original")?this._openSpinnerUntil(b()):this._openSpinnerUntil(a.fetch({success:b,preview:"PUBLISHED"!==a.get("status")}).then(b)),h.pushEvent("SHARE","POST",a.get("id"),{uiElement:"dropdown"})}.bind(this))},_externalShare:function(a){var c=a.view.$(".js_share-post-item"),d=c.attr("href"),e={twitter:"toolbar=0,status=0,width=480,height=360",facebook:"toolbar=0,status=0,width=480,height=360",tumblr:"toolbar=0,status=0,width=450,height=430"},f=b.intersection(c.attr("class").split(/\s+/),["twitter","facebook","tumblr"])[0];window.open(d,"share"+f,e[f])},_repost:function(a,b){var d="repost",e=this,f=c.get("membership").find(function(a){return a.get("blogId")===parseInt(b,10)});a.setAction(d,b,{success:function(){e._displaySuccessMessage(tiger.messages.postAction.postReposted,{blogName:f.get("blog").displayName,blogUrl:"http://"+f.get("blog").canonicalHost})},error:function(a){throw new Error("PostTools.repostPost(): "+a.reason)}})},_undoRepost:function(a){var b="actionreset",c=a.targetBlogId,d=a.model,e=this;d.setAction(b,c,{success:function(){e._displaySuccessMessage(tiger.messages.postAction.repostRemoved)},error:function(a){throw new Error("PostTools.undoRepost(): "+a.reason)}})},_openPupilModal:function(){var b=a.Deferred();return require(["app/pupil/PupilController"],function(a){a.show().then(b.resolve.bind(b))}.bind(this)),this._openSpinnerUntil(b)},_bindEvents:function(a,b){a.on("posttools:like",this._like.bind(this)),a.on("posttools:reply",this._reply.bind(this)),b.on("posttools:dismiss",this._dismiss.bind(this)),b.on("posttools:undismiss",this._undismiss.bind(this)),b.on("posttools:getDismissState",this._getDismissState.bind(this)),b.on("posttools:delete",this._delete.bind(this)),b.on("posttools:promote",this._promote.bind(this)),b.on("posttools:block",this._block.bind(this)),b.on("posttools:checkBlockStatus",this._checkBlockStatus.bind(this)),b.on("posttools:hide",this._hide.bind(this)),b.on("posttools:unflag",this._unflag.bind(this)),b.on("posttools:kinjaShare",this._kinjaShare.bind(this)),b.on("posttools:externalShare",this._externalShare.bind(this)),b.on("posttools:repost",this._repost.bind(this)),b.on("posttools:undorepost",this._undoRepost.bind(this)),b.on("close",function(){c.off(null,null,b),d.off(null,null,b),b.model.off(null,null,b)}),b.on("posttools:menuview:togglehidden",function(b){a.togglePostToolsVisibility(b)}),b.on("reposttools:unschedule",this._unscheduleRepost.bind(this)),b.on("posttools:pupil",this._openPupilModal.bind(this))},API:{startPostTools:function(a,b){var e="undefined"!=typeof b.get("defaultBlogId")?b.get("defaultBlogId"):f.getKinjaMeta().blog.id,g=new l({el:a.find(".js_post-dropdown-ct"),model:b,blockedBlogCollection:n.getBlockedBlogCollection(e)}),h=new j({el:a,model:b});h.post.attachView(g),h.bindUIElements(),h.updateUserState(),v._bindEvents(h,g),d.on("posttools:close:"+b.get("id"),function(){g.close()}),c.onAuth.done(g.render.bind(g))},closePostTools:function(a){d.trigger("posttools:close:"+a)},bindEvents:function(a,b){v._bindEvents(a,b)}}});return v.API}),define("templates/tiger/icons/essential/definitions",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(a,b,c,d,e,f){b.icons.essential.definitions=function(a,b,c){return'<svg id="svggroup--essential" class="hide"><symbol id="iconset-search" viewBox="0 0 15 15"><path d="M9.5 8C11.433 8 13 6.433 13 4.5S11.433 1 9.5 1 6 2.567 6 4.5 7.567 8 9.5 8zm-3.233-.975c.196-.195.518-.19.708 0 .195.195.19.517 0 .708l-4.95 4.95c-.195.194-.517.19-.707 0-.195-.196-.19-.518 0-.708l4.95-4.95zM9.5 9C7.015 9 5 6.985 5 4.5S7.015 0 9.5 0 14 2.015 14 4.5 11.985 9 9.5 9z" /></symbol><symbol id="iconset-add" viewBox="0 0 18 18"><path d="M9 2.494C9 2.226 8.776 2 8.5 2c-.268 0-.5.22-.5.494V8H2.494C2.226 8 2 8.224 2 8.5c0 .268.22.5.494.5H8v5.506c0 .268.224.494.5.494.268 0 .5-.22.5-.494V9h5.506c.268 0 .494-.224.494-.5 0-.268-.22-.5-.494-.5H9V2.494z" /></symbol><symbol id="iconset-add--small" viewBox="0 0 10 10"><path d="M6 1.007C6 .45 5.552 0 5 0c-.556 0-1 .45-1 1.007V4H1.007C.45 4 0 4.448 0 5c0 .556.45 1 1.007 1H4v2.993C4 9.55 4.448 10 5 10c.556 0 1-.45 1-1.007V6h2.993C9.55 6 10 5.552 10 5c0-.556-.45-1-1.007-1H6V1.007z"></path></symbol><symbol id="iconset-site-default" viewBox="0 0 18 18"><path d="M9 16.158c3.953 0 7.158-3.205 7.158-7.158 0-3.953-3.205-7.158-7.158-7.158-3.953 0-7.158 3.205-7.158 7.158 0 3.953 3.205 7.158 7.158 7.158zM9 17c-4.418 0-8-3.582-8-8s3.582-8 8-8 8 3.582 8 8-3.582 8-8 8z"/><path d="M9 16.158c1.97 0 3.79-3.143 3.79-7.158 0-4.015-1.82-7.158-3.79-7.158S5.21 4.985 5.21 9c0 4.015 1.82 7.158 3.79 7.158zM9 17c-2.558 0-4.632-3.582-4.632-8S6.442 1 9 1s4.632 3.582 4.632 8S11.558 17 9 17z"/><path d="M2.742 4.674c1.69.883 3.947 1.383 6.345 1.383 2.396 0 4.65-.5 6.34-1.38l-.39-.746c-1.564.82-3.684 1.29-5.95 1.29-2.27 0-4.39-.47-5.955-1.28l-.39.746zm.39 9.403c1.564-.817 3.686-1.288 5.955-1.288 2.266 0 4.386.47 5.95 1.28l.39-.75c-1.69-.88-3.944-1.38-6.34-1.38-2.398 0-4.654.5-6.345 1.38l.39.744z"/><path d="M8.58 8.58H1.083v.84H8.58v7.496h.84V9.42h7.496v-.84H9.42V1.083h-.84V8.58z" /></symbol><symbol id="iconset-zoom-in" viewBox="0 0 18 18"><path d="M9 4.494C9 4.226 9.224 4 9.5 4c.268 0 .5.22.5.494V7h2.506c.268 0 .494.224.494.5 0 .268-.22.5-.494.5H10v2.506c0 .268-.224.494-.5.494-.268 0-.5-.22-.5-.494V8H6.494C6.226 8 6 7.776 6 7.5c0-.268.22-.5.494-.5H9V4.494zM9.5 13C6.462 13 4 10.538 4 7.5S6.462 2 9.5 2 15 4.462 15 7.5 12.538 13 9.5 13zm-4.877-1.36l-3.48 3.51c-.194.194-.188.514 0 .703.196.195.51.196.704.002l3.48-3.51c-.304-.275-.416-.34-.704-.706zM9.5 14c3.59 0 6.5-2.91 6.5-6.5S13.09 1 9.5 1 3 3.91 3 7.5 5.91 14 9.5 14z" /></symbol><symbol id="iconset-star" viewBox="0 0 18 18"><path d="M9.005 13.115L4.083 16.88l1.895-6.07-4.943-3.563 6.094.014L9 1.01l1.866 6.25 6.093-.01-4.93 3.563 1.89 6.07z" /></symbol><symbol id="iconset-star--giant" viewBox="0 0 24 24"><path d="M12 17.8l-7.053 4.908 2.488-8.225-6.848-5.19 8.592-.176L12 1l2.82 8.117 8.593.175-6.848 5.19 2.488 8.226z" /></symbol><symbol id="iconset-star-circle" viewBox="0 0 18 18"><path d="M9 17c4.418 0 8-3.582 8-8s-3.582-8-8-8-8 3.582-8 8 3.582 8 8 8zM9 3.7c.093 0 .185.06.208.158l1.146 3.39 3.413.085c.104 0 .185.073.22.17.034.097 0 .207-.08.267l-2.72 2.175.972 3.44c.03.096 0 .206-.09.266-.05.04-.097.05-.14.05-.05 0-.09-.02-.13-.05L9 11.61l-2.81 2.04c-.036.038-.082.05-.13.05-.045 0-.09-.012-.138-.05-.07-.06-.104-.17-.08-.266l.97-3.44L4.095 7.77c-.08-.06-.115-.17-.08-.267.034-.097.127-.17.22-.17l3.412-.085 1.134-3.39c.04-.098.13-.158.22-.158z" /></symbol><symbol id="iconset-chevron-right" viewBox="0 0 18 18"><path d="M6.165 3.874c-.217-.204-.22-.53-.008-.73.206-.192.56-.195.776.008l5.902 5.48c.11.102.165.236.165.37-.002.126-.055.262-.165.365l-5.902 5.478c-.217.204-.564.207-.776.007-.206-.193-.21-.525.008-.728L11.69 9 6.165 3.873z" /></symbol><symbol id="iconset-chevron-right--small" viewBox="0 0 10 10"><path d="M7.782 4.497L3.272.207c-.287-.274-.763-.278-1.054 0-.292.277-.29.724.002 1L6.205 5 2.22 8.79c-.288.273-.292.726-.002 1.002.293.28.763.276 1.054 0l4.51-4.29C7.926 5.363 8 5.18 8 5c.002-.183-.072-.364-.218-.503z" /></symbol><symbol id="iconset-flame" viewBox="0 0 18 18"><path d="M3.923 10.89c0 2.678 2.447 5.17 5.077 5.17s5.077-2.492 5.077-5.17c0-1.752-.618-3.036-1.977-4.664-1.196-1.433-1.154-3.453-1.093-3.453-.356-.04-2.164 2.918-2.49 5.764-.507 1.5-2.29 1.018-2.543-.126-.245-.62-.296-1.97-.296-2.47 0-.5-1.755 2.72-1.755 4.95zm2.962-2.617c.25.344.63.345.72.077.185-2.933 2.015-5.63 2.643-6.247.78-.766 1.7-1.444 1.984-.915.072.135-.047.438-.167.826-.267.863-.412 2.224.738 3.602C13.883 6.912 15 8.516 15 10.89c0 3.2-2.86 6.11-6 6.11s-6-2.912-6-6.11c0-2.018 1.45-5.456 2.972-6.798l.198-.17c.233-.197.806-.146.715.164-.837 2.85 0 4.187 0 4.187z" /></symbol><symbol id="iconset-flame--giant" viewBox="0 0 24 24"><path d="M9.004 10.954c.353.496.89.497 1.02.112.262-4.217 2.854-8.093 3.743-8.98C14.872.984 16.177.01 16.577.77c.103.194-.065.63-.235 1.187-.378 1.242-.583 3.198 1.046 5.18 1.532 1.86 3.112 4.166 3.112 7.58 0 4.597-4.052 8.783-8.5 8.783s-8.5-4.186-8.5-8.782c0-3.652 2.056-7.844 4.21-9.773l.28-.243c.33-.285 1.143-.212 1.014.234-1.186 4.096 0 6.018 0 6.018z" /></symbol><symbol id="iconset-logo-kinja" viewBox="0 0 18 18"><path d="M2.898 8.293c.746.24 1.423.978 1.734 1.495.31.517 2.246 3.78 2.905 4.916.726 1.253 1.743 1.294 2.308 1.294h4.125s-3.023-5.378-3.943-6.846c-.622-.994-1.452-1.11-2.374-1.11H2.1C2.093 8.042 3 7.065 5 7c2-.065 5.284.006 6.64 0 1.354-.006 2.046-.727 2.33-1.195.284-.468 2.03-3.8 2.03-3.8S8.793 1.995 6.992 2c-1.21.006-1.734.647-2.197 1.41l-2.792 4.6c-.01.017.007.07.017.098 0 0 .35.018.878.186z" /><</symbol><symbol id="iconset-bubble" viewBox="0 0 18 18"><path d="M6.292 13.952l.34-.503.577.1c.43.07.86.11 1.29.11 3.65 0 6.56-2.65 6.56-5.84 0-3.186-2.91-5.836-6.57-5.836-3.657 0-6.566 2.65-6.566 5.836 0 1.918 1.054 3.7 2.83 4.84l.437.256c0 .18-.375 2.06-.57 2.54-.054.132 1.12-.71 1.66-1.51zm-2.01-.426C2.3 12.254 1 10.182 1 7.832 1 4.06 4.358 1 8.5 1 12.642 1 16 4.06 16 7.832c0 3.774-3.36 6.833-7.5 6.833-.495 0-.978-.047-1.447-.13-.32.473-2.45 2.172-3.165 2.4-.714.226-.823-.164-.51-.713.313-.548.903-1.95.903-2.696z" /></symbol><symbol id="iconset-bubble--giant" viewBox="0 0 24 24"><path d="M6.094 18.506C3.324 16.678 1.5 13.7 1.5 10.32 1.5 4.9 6.2.5 12 .5s10.5 4.398 10.5 9.82c0 5.425-4.702 9.823-10.5 9.823-.694 0-1.37-.067-2.025-.187-.45.68-3.432 3.123-4.432 3.45-1 .326-1.15-.235-.713-1.024.438-.788 1.264-2.802 1.264-3.876z" /></symbol><symbol id="iconset-checkmark" viewBox="0 0 18 18"><path d="M14.855 5.87c.192-.195.195-.523 0-.722-.19-.194-.51-.2-.706 0l-7.418 7.62-2.88-2.978c-.19-.195-.515-.2-.71-.002-.19.194-.194.525.003.726L6.38 13.85c.095.1.224.15.353.15.128 0 .257-.047.355-.147l7.767-7.982z" /></symbol><symbol id="iconset-checkmark--small" viewBox="0 0 10 10"><path d="M.292 5.078c-.39.4-.388 1.044-.002 1.442l2.038 2.15c.313.344 1.125.526 1.703 0L9.71 2.746c.39-.402.388-1.046 0-1.445-.39-.402-1.014-.4-1.4 0l-5.11 5.39L1.69 5.075C1.31 4.683.68 4.68.293 5.078z"></path></symbol><symbol id="iconset-close" viewBox="0 0 18 18"><path d="M1.737 1.12c-.16-.158-.44-.164-.61.006-.165.165-.172.443-.005.61L7.885 8.5l-6.763 6.764c-.167.167-.16.445.005.61.17.17.45.164.61.005L8.5 9.11l6.763 6.764c.16.158.44.164.61-.006.165-.164.172-.442.005-.61L9.115 8.5l6.763-6.764c.167-.167.16-.445-.005-.61-.17-.17-.45-.164-.61-.005L8.5 7.89 1.737 1.12z" /></symbol><symbol id="iconset-close--small" viewBox="0 0 10 10"><path d="M2.884 1.47c-.394-.394-1.03-.395-1.42-.005-.392.393-.387 1.026.006 1.42L3.586 5 1.47 7.116c-.394.394-.395 1.03-.005 1.42.393.392 1.026.387 1.42-.006L5 6.414 7.116 8.53c.394.394 1.03.395 1.42.005.392-.393.387-1.026-.006-1.42L6.414 5 8.53 2.884c.394-.394.395-1.03.005-1.42-.393-.392-1.026-.387-1.42.006L5 3.586 2.884 1.47z" /></symbol><symbol id="iconset-facebook" viewBox="0 0 18 18"><path d="M7.003 17l-.006-7H4l.006-3h2.997V4.995C7.003 2.408 8.457 1 10.808 1c1.126 0 1.91.082 2.192.12v2.877h-1.447c-1.278 0-1.526.597-1.526 1.472V7h2.866l-.403 3h-2.47l.007 7H7.003z" /></symbol><symbol id="iconset-twitter" viewBox="0 0 18 18"><path d="M12.077 2c-1.812 0-3.282 1.582-3.282 3.534 0 .277.03.547.085.806-2.728-.148-5.147-1.555-6.766-3.693-.283.522-.445 1.13-.445 1.777 0 1.226.58 2.308 1.46 2.942-.54-.02-1.05-.178-1.49-.443v.045c0 1.712 1.13 3.14 2.63 3.465-.28.08-.57.124-.87.124-.21 0-.418-.022-.62-.063.418 1.404 1.63 2.426 3.067 2.455-1.125.94-2.54 1.51-4.078 1.51-.267 0-.528-.02-.785-.05 1.46 1 3.185 1.59 5.04 1.59 6.037 0 9.34-5.39 9.34-10.06 0-.153-.005-.306-.01-.457.64-.5 1.197-1.12 1.637-1.83-.59.28-1.22.47-1.885.557.677-.437 1.198-1.13 1.443-1.955-.633.405-1.336.7-2.084.858C13.88 2.43 13.028 2 12.08 2" /></symbol><symbol id="iconset-googleplus" viewBox="0 0 18 18"><path d="M13.657 13.42c0 .914-.4 1.74-1.202 2.475-.4.354-.916.62-1.545.796-.573.208-1.245.31-2.017.31-1.402 0-2.575-.264-3.52-.795C4.457 15.645 4 14.938 4 14.085c0-.62.2-1.18.6-1.68.43-.59 1.002-1.033 1.718-1.327.658-.324 1.46-.487 2.403-.487.03 0 .798-.15.827-.15-.458-.382-.653-.57-.653-1.04 0-.355.043-.665.214-.93h-.472c-1.058 0-1.903-.574-2.618-1.28-.686-.708-1.03-1.56-1.03-2.565 0-.972.43-1.812 1.288-2.52C7.106 1.37 8.09 1 9.236 1H14l-1.073.796h-1.502c.486.236.872.604 1.16 1.105.284.59.428 1.166.428 1.725 0 1.032-.472 1.9-1.416 2.608-.373.295-.63.546-.773.752-.115.147-.172.383-.172.707 0 .325.444.84 1.33 1.548.573.413 1.002.87 1.288 1.37.258.472.387 1.076.387 1.812zM11.31 4.483c-.145-.705-.46-1.29-.95-1.75-.487-.488-1.06-.73-1.72-.73-.604-.025-1.077.18-1.422.62-.373.46-.517 1.057-.43 1.787.143.73.473 1.337.99 1.824.517.51 1.076.766 1.68.766.66 0 1.162-.243 1.506-.73.373-.486.488-1.082.345-1.787zm.153 10.713c.55-.38.826-.862.826-1.445 0-1.7-2.757-2.05-3.06-2.05-.88 0-1.667.19-2.356.573-.69.403-1.033.873-1.033 1.41 0 .54.304 1.01.91 1.413.58.403 1.295.605 2.15.605 1.13 0 1.983-.167 2.56-.503z" fill-rule="evenodd"/></symbol><symbol id="iconset-external-link" viewBox="0 0 18 18"><path d="M3.006 17C1.898 17 1 16.103 1 14.994V5.006C1 3.898 1.897 3 3.006 3H5.5c.276 0 .5.224.5.5s-.224.5-.5.5H3.006C2.45 4 2 4.45 2 5.006v9.988C2 15.55 2.45 16 3.006 16h9.988C13.55 16 14 15.55 14 14.994V11.5c0-.276.224-.5.5-.5s.5.224.5.5v3.494C15 16.102 14.103 17 12.994 17H3.006zM10 1.5c0-.276.228-.5.51-.5h5.98c.51 0 .51.5.51.51v5.98c0 .282-.232.51-.5.51-.276 0-.5-.228-.5-.51V2.75l-8.095 8.1c-.206.204-.548.197-.75-.004-.207-.207-.205-.545-.002-.748L15.247 2H10.51c-.282 0-.51-.232-.51-.5z" /></symbol><symbol id="iconset-link" viewBox="0 0 18 18"><path d="M8.72 13.36l-2.044 2.017c-.954.952-2.418.797-3.05.083L2.53 14.18c-.942-.93-.59-2.446 0-3.072.96-1.017 3.698-3.656 3.698-3.656.952-.975 2.245-1.038 3.27 0 1.023 1.038.97.997.97.997.262.26.64.21.835 0 .195-.22.16-.58-.102-.85l-.94-.93c-1.31-1.35-3.322-1.3-4.61 0l-3.68 3.75c-1.28 1.26-1.28 3.38 0 4.68l.92.93c.627.63 1.45.96 2.337.96.887 0 1.71-.335 2.334-.966L9.4 14.17c.263-.266.263-.555 0-.82-.263-.266-.673 0-.673 0zm.56-8.72l2.044-2.017c.954-.952 2.418-.797 3.05-.083l1.095 1.28c.94.93.59 2.446 0 3.072-.96 1.017-3.7 3.656-3.7 3.656-.95.975-2.25 1.038-3.27 0s-.97-.997-.97-.997c-.26-.26-.64-.21-.84 0-.2.22-.16.58.1.85l.944.93c1.31 1.35 3.327 1.3 4.61 0l3.68-3.75c1.284-1.26 1.284-3.38 0-4.68l-.92-.93c-.62-.63-1.443-.96-2.33-.96-.888 0-1.71.334-2.335.965L8.6 3.825c-.262.266-.262.555 0 .82.264.266.674 0 .674 0z" /></symbol><symbol id="iconset-image" viewBox="0 0 18 18"><path d="M1 2.994v12.012c0 .548.446.994.995.994h14.01c.55 0 .995-.445.995-.994V2.994c0-.548-.446-.994-.995-.994H1.995C1.445 2 1 2.445 1 2.994zm-1 0C0 1.894.893 1 1.995 1h14.01C17.107 1 18 1.895 18 2.994v12.012c0 1.1-.893 1.994-1.995 1.994H1.995C.893 17 0 16.105 0 15.006V2.994z"/><path d="M1.38 15.804L5.807 8.24l-.86.007 3.682 6.068c.17.288.573.324.8.073l2.5-2.82-.74.01 4.514 4.832c.188.202.504.213.706.024.203-.19.213-.505.025-.707l-4.515-4.83c-.2-.216-.543-.212-.74.008l-2.5 2.82.8.07L5.8 7.728c-.197-.324-.67-.32-.86.007L.51 15.298c-.137.24-.057.545.18.684.24.14.546.06.685-.178zM12 9c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zm0 1c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3z"/></symbol><symbol id="iconset-burner" viewBox="0 0 18 18"><path d="M14.24 10.837c-.39.175-.853.28-1.387.28-.27 0-.593-.044-.955-.126-.344-.07-.713-.19-1.093-.32-.284-.1-1.218-.51-1.31-.54-.158-.06-.32-.093-.488-.093-.175 0-.336.038-.493.096-.092.035-1.035.444-1.32.545-.38.136-.748.247-1.093.326-.36.083-.68.127-.95.127-.53 0-.99-.103-1.39-.28-.22-.1-.55-.353-.65-.46-.17-.18-.34-.39-.502-.634-.38-.57-.635-1.22-.712-1.934l-.006.14c.268-1.33 1.078-2.07 2.03-2.07 1.53 0 2.884.31 4.662 1.284 0 0 .266.147.41.147.146 0 .43-.143.43-.143 1.78-.974 3.137-1.282 4.666-1.282.95 0 1.762.74 2.038 2.057l-.002-.14c-.076.72-.33 1.364-.71 1.94-.162.24-.335.453-.507.633-.1.105-.43.36-.657.46zm1.907-.61c.453-.684.76-1.463.853-2.33l-.007-.137C16.635 6.053 15.48 5 14.083 5c-1.672 0-3.175.34-5.093 1.393C7.092 5.34 5.59 5 3.916 5c-1.397 0-2.55 1.053-2.91 2.76L1 7.897c.093.867.4 1.646.853 2.33.33.498.664.846.9 1.036.114.1.332.24.64.38.503.223 1.09.357 1.754.357.346 0 .732-.052 1.154-.15.39-.086.79-.207 1.2-.354.31-.108.6-.223.87-.34.16-.068.6-.248.647-.248.045 0 .474.18.636.25.27.115.56.23.865.338.41.147.813.268 1.195.355.42.1.805.15 1.15.15.666 0 1.25-.13 1.755-.35.31-.14.528-.28.65-.39.228-.18.56-.53.89-1.03zm-9.99-2.604c-.155-.077-.316-.133-.483-.17-.53-.118-1.078-.037-1.605.164-.22.08-.38.164-.48.223l-.24.146.03.28c.07.623.45 1.266 1.22 1.502.34.11.77.117 1.27.05.3-.044.63-.115.95-.206.19-.053.373-.11.54-.167.1-.034.174-.062.22-.078l.735-.285-.628-.477c-.07-.052-.2-.145-.394-.273-.315-.21-.69-.444-1.13-.696l-.02-.013zm.243 1.19s-.447.1-.654.13c-.374.05-.68.046-.878-.017-.367-.114-.48-.485-.48-.485s.76-.2 1.093-.12c.1.02.92.5.92.5zm5.42-1.177c-.437.252-.813.485-1.128.696-.192.128-.322.22-.39.273l-.63.477.74.285c.042.016.117.044.218.078.167.057.35.114.542.167.33.09.652.162.96.205.493.068.92.06 1.27-.05.762-.235 1.146-.88 1.214-1.502l.03-.28-.24-.145c-.1-.06-.263-.142-.475-.223-.52-.2-1.07-.282-1.6-.164-.16.037-.32.093-.48.17l-.02.013zm.7.68c.333-.075 1.09.125 1.09.125s-.11.38-.475.49c-.202.07-.507.07-.88.02-.265-.032-.64-.15-.64-.15s.808-.45.904-.472z" /></symbol><symbol id="spinner" viewBox="0 0 37 12" stroke="#aaa" fill="none"><circle cx="6" cy="6" r="4"><animate attributeName="r" begin="0s" dur="0.65s" values="0;4" calcMode="spline" keySplines="0.51 0 0.21 0.9" repeatCount="indefinite"/><animate attributeName="stroke-opacity" begin="0s" dur="0.65s" values="0;1" calcMode="spline" keySplines="0.51 0 0.21 0.9" repeatCount="indefinite"/></circle><circle cx="6" cy="6" r="4"><animate attributeName="cx" begin="0s" dur="0.65s" values="6;19" calcMode="spline" keySplines="0.51 0 0.21 0.9" repeatCount="indefinite"/></circle><circle cx="19" cy="6" r="4"><animate attributeName="cx" begin="0s" dur="0.65s" values="19;32" calcMode="spline" keySplines="0.51 0 0.21 0.9" repeatCount="indefinite"/></circle><circle cx="32" cy="6" r="4"><animate attributeName="r" begin="0s" dur="0.65s" values="4;0" calcMode="spline" keySplines="0.51 0 0.21 0.9" repeatCount="indefinite"/><animate attributeName="stroke-opacity" begin="0s" dur="0.65s" values="1;0" calcMode="spline" keySplines="0.51 0 0.21 0.9" repeatCount="indefinite"/></circle></symbol><symbol id="iconset-tools--giant" viewBox="0 0 24 24"><path d="M12 5.5c1.38 0 2.5-1.12 2.5-2.5S13.38.5 12 .5 9.5 1.62 9.5 3s1.12 2.5 2.5 2.5zm0 18c1.38 0 2.5-1.12 2.5-2.5s-1.12-2.5-2.5-2.5-2.5 1.12-2.5 2.5 1.12 2.5 2.5 2.5zm0-9c1.38 0 2.5-1.12 2.5-2.5S13.38 9.5 12 9.5 9.5 10.62 9.5 12s1.12 2.5 2.5 2.5z" /></symbol></svg>';
},d.DEBUG&&(b.icons.essential.definitions.soyTemplateName="tiger.icons.essential.definitions")}),define("templates/tiger/icons/essential/usage",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(a,b,c,d,e,f){b.icons.essential.search=function(a,b,c){return'<svg class="svg-icon svg-search"><use xlink:href="#iconset-search" /></svg>'},d.DEBUG&&(b.icons.essential.search.soyTemplateName="tiger.icons.essential.search"),b.icons.essential.add=function(a,b,c){return'<svg class="svg-icon svg-add"><use xlink:href="#iconset-add" /></svg>'},d.DEBUG&&(b.icons.essential.add.soyTemplateName="tiger.icons.essential.add"),b.icons.essential.adDMSall=function(a,b,c){return'<svg class="svg-icon small svg-add--small"><use xlink:href="#iconset-add--small" /></svg>'},d.DEBUG&&(b.icons.essential.adDMSall.soyTemplateName="tiger.icons.essential.adDMSall"),b.icons.essential.siteDefault=function(a,b,c){return'<svg class="svg-icon svg-site-default"><use xlink:href="#iconset-site-default" /></svg>'},d.DEBUG&&(b.icons.essential.siteDefault.soyTemplateName="tiger.icons.essential.siteDefault"),b.icons.essential.zoomIn=function(a,b,c){return'<svg class="svg-icon svg-zoom-in"><use xlink:href="#iconset-zoom-in" /></svg>'},d.DEBUG&&(b.icons.essential.zoomIn.soyTemplateName="tiger.icons.essential.zoomIn"),b.icons.essential.star=function(a,b,c){return'<svg class="svg-icon svg-star"><use xlink:href="#iconset-star" /></svg>'},d.DEBUG&&(b.icons.essential.star.soyTemplateName="tiger.icons.essential.star"),b.icons.essential.starGiant=function(a,b,c){return'<svg class="svg-icon giant stroked svg-star--giant"><use xlink:href="#iconset-star--giant" /></svg>'},d.DEBUG&&(b.icons.essential.starGiant.soyTemplateName="tiger.icons.essential.starGiant"),b.icons.essential.starCircle=function(a,b,c){return'<svg class="svg-icon svg-star-circle"><use xlink:href="#iconset-star-circle" /></svg>'},d.DEBUG&&(b.icons.essential.starCircle.soyTemplateName="tiger.icons.essential.starCircle"),b.icons.essential.chevronRight=function(a,b,c){return'<svg class="svg-icon svg-chevron chevron--right"><use xlink:href="#iconset-chevron-right" /></svg>'},d.DEBUG&&(b.icons.essential.chevronRight.soyTemplateName="tiger.icons.essential.chevronRight"),b.icons.essential.chevronRightSmall=function(a,b,c){return'<svg class="svg-icon small svg-chevron--small chevron--right"><use xlink:href="#iconset-chevron-right--small" /></svg>'},d.DEBUG&&(b.icons.essential.chevronRightSmall.soyTemplateName="tiger.icons.essential.chevronRightSmall"),b.icons.essential.chevronBottom=function(a,b,c){return'<svg class="svg-icon svg-chevron chevron--bottom"><use xlink:href="#iconset-chevron-right" /></svg>'},d.DEBUG&&(b.icons.essential.chevronBottom.soyTemplateName="tiger.icons.essential.chevronBottom"),b.icons.essential.chevronBottomSmall=function(a,b,c){return'<svg class="svg-icon small svg-chevron--small chevron--bottom"><use xlink:href="#iconset-chevron-right--small" /></svg>'},d.DEBUG&&(b.icons.essential.chevronBottomSmall.soyTemplateName="tiger.icons.essential.chevronBottomSmall"),b.icons.essential.chevronLeft=function(a,b,c){return'<svg class="svg-icon svg-chevron chevron--left"><use xlink:href="#iconset-chevron-right" /></svg>'},d.DEBUG&&(b.icons.essential.chevronLeft.soyTemplateName="tiger.icons.essential.chevronLeft"),b.icons.essential.chevronLeftSmall=function(a,b,c){return'<svg class="svg-icon small svg-chevron--small chevron--left"><use xlink:href="#iconset-chevron-right--small" /></svg>'},d.DEBUG&&(b.icons.essential.chevronLeftSmall.soyTemplateName="tiger.icons.essential.chevronLeftSmall"),b.icons.essential.chevronTop=function(a,b,c){return'<svg class="svg-icon svg-chevron chevron--top"><use xlink:href="#iconset-chevron-right" /></svg>'},d.DEBUG&&(b.icons.essential.chevronTop.soyTemplateName="tiger.icons.essential.chevronTop"),b.icons.essential.chevronTopSmall=function(a,b,c){return'<svg class="svg-icon small svg-chevron--small chevron--top"><use xlink:href="#iconset-chevron-right--small" /></svg>'},d.DEBUG&&(b.icons.essential.chevronTopSmall.soyTemplateName="tiger.icons.essential.chevronTopSmall"),b.icons.essential.flame=function(a,b,c){return'<svg class="svg-icon svg-flame"><use xlink:href="#iconset-flame" /></svg>'},d.DEBUG&&(b.icons.essential.flame.soyTemplateName="tiger.icons.essential.flame"),b.icons.essential.flameGiant=function(a,b,c){return'<svg class="svg-icon giant stroked svg-flame--giant"><use xlink:href="#iconset-flame--giant" /></svg>'},d.DEBUG&&(b.icons.essential.flameGiant.soyTemplateName="tiger.icons.essential.flameGiant"),b.icons.essential.kinja=function(a,b,c){return'<svg class="svg-icon svg-logo-kinja"><use xlink:href="#iconset-logo-kinja" /></svg>'},d.DEBUG&&(b.icons.essential.kinja.soyTemplateName="tiger.icons.essential.kinja"),b.icons.essential.bubble=function(a,b,c){return'<svg class="svg-icon svg-bubble"><use xlink:href="#iconset-bubble" /></svg>'},d.DEBUG&&(b.icons.essential.bubble.soyTemplateName="tiger.icons.essential.bubble"),b.icons.essential.bubbleGiant=function(a,b,c){return'<svg class="svg-icon giant stroked svg-bubble--giant"><use xlink:href="#iconset-bubble--giant" /></svg>'},d.DEBUG&&(b.icons.essential.bubbleGiant.soyTemplateName="tiger.icons.essential.bubbleGiant"),b.icons.essential.checkmark=function(a,b,c){return'<svg class="svg-icon svg-checkmark"><use xlink:href="#iconset-checkmark" /></svg>'},d.DEBUG&&(b.icons.essential.checkmark.soyTemplateName="tiger.icons.essential.checkmark"),b.icons.essential.checkmarkSmall=function(a,b,c){return'<svg class="svg-icon small svg-checkmark--small"><use xlink:href="#iconset-checkmark--small" /></svg>'},d.DEBUG&&(b.icons.essential.checkmarkSmall.soyTemplateName="tiger.icons.essential.checkmarkSmall"),b.icons.essential.close=function(a,b,c){return'<svg class="svg-icon svg-close"><use xlink:href="#iconset-close" /></svg>'},d.DEBUG&&(b.icons.essential.close.soyTemplateName="tiger.icons.essential.close"),b.icons.essential.closeSmall=function(a,b,c){return'<svg class="svg-icon small svg-close--small"><use xlink:href="#iconset-close--small" /></svg>'},d.DEBUG&&(b.icons.essential.closeSmall.soyTemplateName="tiger.icons.essential.closeSmall"),b.icons.essential.facebook=function(a,b,c){return'<svg class="svg-icon svg-facebook"><use xlink:href="#iconset-facebook" /></svg>'},d.DEBUG&&(b.icons.essential.facebook.soyTemplateName="tiger.icons.essential.facebook"),b.icons.essential.twitter=function(a,b,c){return'<svg class="svg-icon svg-twitter"><use xlink:href="#iconset-twitter" /></svg>'},d.DEBUG&&(b.icons.essential.twitter.soyTemplateName="tiger.icons.essential.twitter"),b.icons.essential.googleplus=function(a,b,c){return'<svg class="svg-icon svg-googleplus"><use xlink:href="#iconset-googleplus" /></svg>'},d.DEBUG&&(b.icons.essential.googleplus.soyTemplateName="tiger.icons.essential.googleplus"),b.icons.essential.externalLink=function(a,b,c){return'<svg class="svg-icon svg-external-link"><use xlink:href="#iconset-external-link" /></svg>'},d.DEBUG&&(b.icons.essential.externalLink.soyTemplateName="tiger.icons.essential.externalLink"),b.icons.essential.burner=function(a,b,c){return'<svg class="svg-icon svg-burner"><use xlink:href="#iconset-burner" /></svg>'},d.DEBUG&&(b.icons.essential.burner.soyTemplateName="tiger.icons.essential.burner"),b.icons.essential.link=function(a,b,c){return'<svg class="svg-icon svg-link"><use xlink:href="#iconset-link" /></svg>'},d.DEBUG&&(b.icons.essential.link.soyTemplateName="tiger.icons.essential.link"),b.icons.essential.image=function(a,b,c){return'<svg class="svg-icon svg-image"><use xlink:href="#iconset-image" /></svg>'},d.DEBUG&&(b.icons.essential.image.soyTemplateName="tiger.icons.essential.image"),b.icons.essential.spinner=function(a,b,c){return'<svg class="svg-icon svg-image"><use xlink:href="#spinner" /></svg>'},d.DEBUG&&(b.icons.essential.spinner.soyTemplateName="tiger.icons.essential.spinner"),b.icons.essential.toolsGiant=function(a,b,c){return'<svg class="svg-icon giant stroked svg-tools--giant"><use xlink:href="#iconset-tools--giant" /></svg>'},d.DEBUG&&(b.icons.essential.toolsGiant.soyTemplateName="tiger.icons.essential.toolsGiant"),b.icons.essential.facebook__C17=function(a,b,c){return'<svg class="svg-icon svg-facebook"><use xlink:href="#iconset-facebook" /></svg>'},d.DEBUG&&(b.icons.essential.facebook__C17.soyTemplateName="tiger.icons.essential.facebook__C17"),b.icons.essential.twitter__C17=function(a,b,c){return'<svg class="svg-icon svg-twitter"><use xlink:href="#iconset-twitter" /></svg>'},d.DEBUG&&(b.icons.essential.twitter__C17.soyTemplateName="tiger.icons.essential.twitter__C17"),b.icons.essential.googleplus__C17=function(a,b,c){return'<svg class="svg-icon svg-googleplus"><use xlink:href="#iconset-googleplus" /></svg>'},d.DEBUG&&(b.icons.essential.googleplus__C17.soyTemplateName="tiger.icons.essential.googleplus__C17"),b.icons.essential.chevronBottomSmall__C17=function(a,b,c){return'<svg class="svg-icon small svg-chevron--small chevron--bottom"><use xlink:href="#iconset-chevron-right--small" /></svg>'},d.DEBUG&&(b.icons.essential.chevronBottomSmall__C17.soyTemplateName="tiger.icons.essential.chevronBottomSmall__C17"),b.icons.essential.closeSmall__C17=function(a,b,c){return'<svg class="svg-icon small svg-close--small"><use xlink:href="#iconset-close--small" /></svg>'},d.DEBUG&&(b.icons.essential.closeSmall__C17.soyTemplateName="tiger.icons.essential.closeSmall__C17")}),define("module/EssentialIconModule",["jquery","templates/tiger/icons/essential/definitions","templates/tiger/icons/essential/usage"],function(a){"use strict";var b=a("#svggroup--essential");b&&b.length||a("#js_svg-definitions").append(a.trim(tiger.icons.essential.definitions()))}),define("lib/amd-wrapped/jquery.lightbox-0.5",["jquery"],function(a){a.fn.lightBox=function(b){function c(){return d(this,s),!1}function d(c,d){var g=a(c).siblings("span").find("img");if(a("embed, object, select").css({visibility:"hidden"}),e(),b.imageArray.length=0,b.activeImage=0,1==d.length)b.imageArray.push(new Array(g.attr("data-original-src"),c.getAttribute("title")));else for(var h=0;h<d.length;h++){var i=d.eq(h).siblings("span").find("img");b.imageArray.push(new Array(i.attr("data-original-src"),d[h].getAttribute("title")))}for(;b.imageArray[b.activeImage][0]!=g.attr("data-original-src");)b.activeImage++;f()}function e(){a("body").append('<div id="jquery-overlay"></div><div id="jquery-lightbox"><div id="lightbox-container-image-data-box"><div id="lightbox-container-image-data"><div id="lightbox-image-details"><span id="lightbox-image-details-caption"></span><span id="lightbox-image-details-currentNumber" class="proxima"></span></div><div id="lightbox-secNav"><a href="#" id="lightbox-secNav-btnClose" class="icon--svg svg-icon--white u-giant u-full--onhover"><svg class="svg-icon svg-close"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#iconset-close"></use></svg></a></div></div></div><div id="lightbox-container-image-box"><div id="lightbox-container-image"><img id="lightbox-image"><a href="#" id="lightbox-nav-btnPrev"></a><a href="#" id="lightbox-nav-btnNext"></a></div></div></div>');var c=p();a("#jquery-overlay").css({backgroundColor:b.overlayBgColor,opacity:b.overlayOpacity,width:c[0],height:c[1]}).fadeIn();var d=q();a("#jquery-lightbox").css({top:d[1]+c[3]/10,left:d[0]}).show(),a("#jquery-overlay,#jquery-lightbox").click(function(){o()}),a("#lightbox-loading-link,#lightbox-secNav-btnClose").click(function(){return o(),!1}),a(window).resize(function(){var b=p();a("#jquery-overlay").css({width:b[0],height:b[1]});var c=q();a("#jquery-lightbox").css({top:c[1]+b[3]/10,left:c[0]})})}function f(){b.fixedNavigation?a("#lightbox-image,#lightbox-container-image-data-box,#lightbox-image-details-currentNumber").hide():a("#lightbox-image,#lightbox-nav,#lightbox-nav-btnPrev,#lightbox-nav-btnNext,#lightbox-container-image-data-box,#lightbox-image-details-currentNumber").hide();var c=new Image;c.onload=function(){a("#lightbox-image").attr("src",b.imageArray[b.activeImage][0]),g(c.width,c.height),c.onload=function(){}},c.src=b.imageArray[b.activeImage][0],b.activeImage>-1}function g(c,d){a("#lightbox-container-image-box").hide();var e=a("#lightbox-container-image-box").width(),f=a("#lightbox-container-image-box").height(),g=c+2*b.containerBorderSize,i=d+2*b.containerBorderSize,j=e-g,k=f-i;a("#lightbox-container-image-box").css({width:g,height:i}),h(),0==j&&0==k&&r(a.browser.msie?250:100),a("#lightbox-container-image-data-box").css({width:c+20})}function h(){a("#lightbox-image").fadeIn(function(){i(),j(),a("#lightbox-container-image-box").show()}),n()}function i(){a("#lightbox-container-image-data-box").slideDown("fast"),a("#lightbox-image-details-caption").hide(),b.imageArray[b.activeImage][1]&&a("#lightbox-image-details-caption").html(b.imageArray[b.activeImage][1]).show(),b.imageArray.length>1}function j(){0!=b.activeImage?b.fixedNavigation?a("#lightbox-nav-btnPrev").unbind().html('<span class="button-box"><span class="icon icon-white icon-chevron-left"></span></span>').bind("click",function(){return b.activeImage=b.activeImage-1,f(),!1}):a("#lightbox-nav-btnPrev").unbind().hover(function(){a(this).html('<span class="button-box"><span class="icon icon-white icon-chevron-left"></span></span>')},function(){a(this).html("")}).show().bind("click",function(){return b.activeImage=b.activeImage-1,f(),!1}):a("#lightbox-nav-btnPrev").html(""),b.activeImage!=b.imageArray.length-1?b.fixedNavigation?a("#lightbox-nav-btnNext").unbind().html('<span class="button-box"><span class="icon icon-white icon-chevron-right"></span></span>').bind("click",function(){return b.activeImage=b.activeImage+1,f(),!1}):a("#lightbox-nav-btnNext").unbind().hover(function(){a(this).html('<span class="button-box"><span class="icon icon-white icon-chevron-right"></span></span>')},function(){a(this).html("")}).show().bind("click",function(){return b.activeImage=b.activeImage+1,f(),!1}):(a("#lightbox-nav-btnNext").unbind(),a("#lightbox-nav-btnNext").html("")),k()}function k(){a(document).keydown(function(a){m(a)})}function l(){a(document).unbind()}function m(a){null==a?(keycode=event.keyCode,escapeKey=27):(keycode=a.keyCode,escapeKey=a.DOM_VK_ESCAPE||27),key=String.fromCharCode(keycode).toLowerCase(),(key==b.keyToClose||"x"==key||keycode==escapeKey)&&o(),(key==b.keyToPrev||37==keycode)&&0!=b.activeImage&&(b.activeImage=b.activeImage-1,f(),l()),(key==b.keyToNext||39==keycode)&&b.activeImage!=b.imageArray.length-1&&(b.activeImage=b.activeImage+1,f(),l())}function n(){b.imageArray.length-1>b.activeImage&&(objNext=new Image,objNext.src=b.imageArray[b.activeImage+1][0]),b.activeImage>0&&(objPrev=new Image,objPrev.src=b.imageArray[b.activeImage-1][0])}function o(){a("#jquery-lightbox").remove(),a("#jquery-overlay").fadeOut(function(){a("#jquery-overlay").remove()}),a("embed, object, select").css({visibility:"visible"})}function p(){var a,b;window.innerHeight&&window.scrollMaxY?(a=window.innerWidth+window.scrollMaxX,b=window.innerHeight+window.scrollMaxY):document.body.scrollHeight>document.body.offsetHeight?(a=document.body.scrollWidth,b=document.body.scrollHeight):(a=document.body.offsetWidth,b=document.body.offsetHeight);var c,d;return self.innerHeight?(c=document.documentElement.clientWidth?document.documentElement.clientWidth:self.innerWidth,d=self.innerHeight):document.documentElement&&document.documentElement.clientHeight?(c=document.documentElement.clientWidth,d=document.documentElement.clientHeight):document.body&&(c=document.body.clientWidth,d=document.body.clientHeight),d>b?pageHeight=d:pageHeight=b,c>a?pageWidth=a:pageWidth=c,arrayPageSize=new Array(pageWidth,pageHeight,c,d),arrayPageSize}function q(){var a,b;return self.pageYOffset?(b=self.pageYOffset,a=self.pageXOffset):document.documentElement&&document.documentElement.scrollTop?(b=document.documentElement.scrollTop,a=document.documentElement.scrollLeft):document.body&&(b=document.body.scrollTop,a=document.body.scrollLeft),arrayPageScroll=new Array(a,b),arrayPageScroll}function r(a){var b=new Date;c=null;do var c=new Date;while(a>c-b)}b=a.extend({overlayBgColor:"#000",overlayOpacity:.85,fixedNavigation:!1,containerBorderSize:10,containerResizeSpeed:400,txtImage:"Image",txtOf:" / ",keyToClose:"c",keyToPrev:"p",keyToNext:"n",imageArray:[],activeImage:0},b);var s=this;return this.unbind("click").click(c)}}),define("gawkerlib/lightboxer",["jquery","underscore","singleton/Utils","module/EssentialIconModule","lib/amd-wrapped/jquery.lightbox-0.5","templates/tiger/icons/essential/usage"],function(a,b,c){"use strict";function d(d){var e=d.find(".lightBoxWrapper .img-border img"),f=d.find(".lightBox");b.each(e,function(b){var d=a(b);d.attr("data-original-src",c.imageUrl(d.data("chomp-id"),"original",d.data("format")))}),f.find(".icon-search-plus").replaceWith(a.trim(tiger.icons.essential.zoomIn())),f.removeClass("hide").lightBox()}return d}),define("templates/tiger/components/discussion/comment",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(a,b,c,d,e,f){b.components.discussion.comment=function(a,c,d){var f="",g=(d.features.superuser,a.reply.authorStats&&a.reply.authorStats.contributors.length?a.reply.authorStats.contributors.length:1,((null==d.replyData?null:d.replyData.query)==a.reply.author.screenName||!(null==d.replyData?null:d.replyData.query))&&(a.reply.approved||(null==a.reply.qiMeta?null:a.reply.qiMeta.dynamicApproved)),"");if(a.reply.blogs)for(var h=a.reply.blogs,i=h.length,j=0;i>j;j++){var k=h[j];g+=k.id==a.reply.author.defaultBlogId?e.$$escapeHtml(k.canonicalHost):""}return f+='<article id="reply_'+e.$$escapeHtmlAttribute(a.reply.id)+'" class="reply reply--depth-'+e.$$escapeHtmlAttribute(a.depth)+" js_reply"+(a.reply.approved?"":" reply--unapproved")+(a.reply.flagged?" reply--flagged":"")+'" data-id="'+e.$$escapeHtmlAttribute(a.reply.id)+'" data-parentid="'+e.$$escapeHtmlAttribute(a.reply.parentId)+'" data-authorname="'+e.$$escapeHtmlAttribute(a.reply.authorBlogName)+'">'+b.components.discussion.replyHeader(a,null,d)+'<div class="reply__content js_reply-content post-content blurable whitelisted-links">'+("IMAGE"==(null==a.reply.annotation?null:a.reply.annotation.annotationType)?'<div class="image-annotation--reply" style="background-image: url(\''+e.$$escapeHtmlAttribute(e.$$filterNormalizeUri(a.reply.annotation.imageUrl))+"'); background-position: "+e.$$escapeHtmlAttribute(e.$$filterCssValue(a.reply.annotation.x))+"% "+e.$$escapeHtmlAttribute(e.$$filterCssValue(a.reply.annotation.y))+'%;"></div>':"")+("TEXT"==(null==a.reply.annotation?null:a.reply.annotation.annotationType)?'<blockquote class="text-annotation--reply" style=""><span class="icon--svg mrs">'+b.icons.actions.quote(null,null,d)+"</span>"+(a.reply.annotation.annotationShortText?'<div class="js_annotation-long text-annotation--reply__content--long hide">'+e.$$filterNoAutoescape(a.reply.annotation.annotationText)+'</div><div class="js_annotation-short text-annotation--reply__content--short">'+e.$$filterNoAutoescape(a.reply.annotation.annotationShortText)+' <a href="'+e.$$escapeHtmlAttribute(e.$$filterNormalizeUri(a.reply.permalink))+'" class="js_annotation-expand">Show all</a></div>':e.$$filterNoAutoescape(a.reply.annotation.annotationText))+"</blockquote>":"")+e.$$filterNoAutoescape(a.reply.display)+"</div>"+b.components.discussion.replySidebar(a,null,d)+b.components.discussion.replyTools(a,null,d)+'<div class="js_reply-flagged reply__flagged-indicator">Flagged</div></article><div class="js_region--warning"></div><div class="js_editor-placeholder"></div><div class="js_region--children"></div>'},d.DEBUG&&(b.components.discussion.comment.soyTemplateName="tiger.components.discussion.comment"),b.components.discussion.replyHeader=function(a,c,d){var f="",g="avt-small";f+='<header class="reply__header without-dropdown js_author" data-authorid="'+e.$$escapeHtmlAttribute(a.reply.author.id)+'" data-blogid="'+e.$$escapeHtmlAttribute(a.reply.author.defaultBlogId)+'">';var h="gif"==a.reply.author.avatar.format?"jpg":a.reply.author.avatar.format;return f+=b.components.discussion.replyAvatarDisplay({url:"//kinja.com/"+a.reply.author.screenName,avatar:window.kinja.imageUrl(a.reply.author.avatar.id,g,h),nofollow:a.reply.isPromoted},null,d)+(d.features.hide_pending_replies&&!a.reply.approved?'<span class="reply__pending-label">Pending approval</span>':"")+b.components.discussion.replyByline(a,null,d)+'<div class="reply__publish-time">'+b.components.discussion.replyPublishTime(a,null,d)+'</div><div class="post-dropdown-ct js_post-dropdown-ct'+("permalink"==a.pageType?" js_post-dropdown-ct-sticky":"")+'">'+b.components.post.meta.postDropdownTrigger({post:a.reply},null,d)+"</div></header>"},d.DEBUG&&(b.components.discussion.replyHeader.soyTemplateName="tiger.components.discussion.replyHeader"),b.components.discussion.replySidebar=function(a,c,d){return'<div class="reply__sidebar"><a href="#" class="js_like reply__recommend readonly-hide icon--svg u-undecorated u-darkened--onhover js_like_icon" title="Recommend">'+(d.features.newstream?b.icons.essential.starGiant(null,null,d):b.icons.essential.star(null,null,d))+(a.reply.likes&&a.reply.likes>0?'<span class="like-count js_like_count">'+e.$$escapeHtml(a.reply.likes)+"</span>":"")+"</a></div>"},d.DEBUG&&(b.components.discussion.replySidebar.soyTemplateName="tiger.components.discussion.replySidebar"),b.components.discussion.replyByline=function(a,c,d){var f='<span class="reply__byline"><a href="//kinja.com/'+e.$$escapeHtmlAttribute(a.reply.author.screenName)+'" target="_self" '+(a.reply.isPromoted?'rel="nofollow"':"")+" class=\"fn url\" onclick=\"window.ga('send', 'event', 'byline', 'click', 'permalink');\">"+e.$$escapeHtml(a.reply.author.displayName)+"</a>",g=(null==d.replyData?null:d.replyData.atUser)==a.reply.authorBlogName;return f+=(g?"<span>, Host</span>":"")+((null==a.reply.replyMeta?null:null==a.reply.replyMeta.parentAuthor?null:a.reply.replyMeta.parentAuthor.displayName)?'<span class="reply__to-author"><span class="icon--svg u-downsized">'+b.icons.essential.chevronRight(null,null,d)+"</span>"+((null==a.reply.replyMeta?null:a.reply.replyMeta.showParentByline)&&""!=(null==a.reply.replyMeta?null:a.reply.replyMeta.parentByline)?e.$$escapeHtml(window.kinja.stripHtmlTags(a.reply.replyMeta.parentByline,"")):e.$$escapeHtml(a.reply.replyMeta.parentAuthor.displayName))+"</span>":"")+"</span>"},d.DEBUG&&(b.components.discussion.replyByline.soyTemplateName="tiger.components.discussion.replyByline"),b.components.discussion.replyAvatarDisplay=function(a,c,d){return'<a href="'+(a.url&&"http://"!=a.url?e.$$escapeHtmlAttribute(e.$$filterNormalizeUri(a.url)):"javascript:void(0)")+'"'+(a.nofollow?' rel="nofollow"':"")+' class="avatar avatar-container"><span class="icon--svg">'+b.icons.essential.checkmarkSmall(null,null,d)+'</span><span class="img-border'+(a.avatar?"":" hide")+'"><img src="'+(a.avatar?e.$$escapeHtmlAttribute(e.$$filterNormalizeUri(a.avatar)):"")+'" /></span><span class="avatar-default'+(a.avatar?" hide":"")+'"></span></a>'},d.DEBUG&&(b.components.discussion.replyAvatarDisplay.soyTemplateName="tiger.components.discussion.replyAvatarDisplay"),b.components.discussion.replyPublishTime=function(a,b,c){return'<a href="'+e.$$escapeHtmlAttribute(e.$$filterNormalizeUri(a.reply.permalink))+'" target="_self"><span class="published updated">'+e.$$escapeHtml(a.reply.publishTime.Mddyyhmma)+"</span></a>"},d.DEBUG&&(b.components.discussion.replyPublishTime.soyTemplateName="tiger.components.discussion.replyPublishTime"),b.components.discussion.replyTools=function(a,c,d){var f="",g=a.reply.replyCount?a.reply.replyCount:0;return f+='<div class="reply__tools js_reply-tools '+(a.reply.flagged?"hide":"")+'" data-analytics-target="groupChat">'+b.icons.discussion.replyRight(null,null,d)+'<a href="#" class="js_reply-to-selected-post reply__link readonly-hide" data-id="'+e.$$escapeHtmlAttribute(a.reply.id)+"\" title=\"Reply\" onclick=\"window.ga('send', 'event', 'Group Chats', 'click', 'Reply button click');\">Reply</a>"+("ReplyList"!=a.discussionType&&a.reply._surfaced&&g&&a.depth<2?'<a href="#" class="js_toggle-descendants reply__count icon--svg u-undecorated u-darkened--onhover" data-id="'+e.$$escapeHtmlAttribute(a.reply.id)+'" title="Show replies"><span>'+e.$$escapeHtml(g)+"</span> replies</a>":"")+"</div>"},d.DEBUG&&(b.components.discussion.replyTools.soyTemplateName="tiger.components.discussion.replyTools")}),define("templates/tiger/components/post/meta/post-meta-container",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(a,b,c,d,e,f){b.components.post.meta.postMetaContainer=function(a,c,d){return'<div class="meta-container without-dropdown">'+("permalink"==a.pageType?b.components.post.meta.metaAvatar(a,null,d):b.components.post.meta.meta(a,null,d))+(a.forSharedPost?"":'<div class="post-dropdown-ct js_post-dropdown-ct'+("permalink"!=a.pageType||a.mode?"":" js_post-dropdown-ct-sticky")+'">'+b.components.post.meta.postDropdown(a,null,d)+b.components.post.meta.postDropdownTrigger(a,null,d)+"</div>")+"</div>"},d.DEBUG&&(b.components.post.meta.postMetaContainer.soyTemplateName="tiger.components.post.meta.postMetaContainer")}),define("templates/tiger/components/post/meta/meta-avatar",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(a,b,c,d,e,f){b.components.post.meta.metaAvatar=function(a,c,d){for(var f="",g="",h=a.post.blogs,i=h.length,j=0;i>j;j++){var k=h[j];g+=k.id==a.post.author.defaultBlogId?e.$$escapeHtml(k.canonicalHost):""}return f+='<div class="meta-avatar js_author" data-authorid="'+e.$$escapeHtmlAttribute(a.post.author.id)+'" data-blogid="'+e.$$escapeHtmlAttribute(a.post.author.defaultBlogId)+'">'+("reply"!=a.mode?b.components.post.meta.postInfo(a,null,d):"")+'<div class="floated-container img-30">'+b.components.post.meta.avatarContainer({post:a.post,canonicalHost:g},null,d)+'<div class="txt">'+(d.features.hide_pending_replies&&!a.post.approved?'<span class="pending-label">Pending approval</span>':"")+(a.forSharedPost?"Original post by":"")+b.components.post.meta.topByline({post:a.post,mode:""+e.$$escapeHtml(a.mode?a.mode:"post"),forSharedPost:a.forSharedPost,contributors:a.contributors,blog:a.blog},null,d)+'<div class="second-line post-meta">'+(a.post.sponsored||a.post.isBillboardPost||a.post.isPromoted?b.components.post.meta.promotedByline(a,null,d):"")+(a.post.tags&&a.post.tags[0]&&!a.forSharedPost?"Filed to: "+b.components.post.tag({tag:a.post.tags[0],hasDropdown:a.post.tags.length>1,tagClasses:"first-tag"},null,d)+(a.post.tags.length>1?b.components.post.tagList({tags:a.post.tags},null,d):""):"")+(0==a.showDate||a.forSharedPost?"":b.components.post.meta.publishTime(a,null,d))+"</div></div></div></div>"},d.DEBUG&&(b.components.post.meta.metaAvatar.soyTemplateName="tiger.components.post.meta.metaAvatar")}),define("templates/tiger/components/post/meta/formatted-time",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(a,b,c,d,e,f){b.components.post.meta.relativeTime=function(a,c,d){return""+b.messages.time.relativeTime({type:a.time.relative.type,amount:a.time.relative.amount,hmma:a.time.hmma,day:a.time.day,Mddyyhmma:a.time.Mddyyhmma,timestamp:a.time.timestamp},null,d)},d.DEBUG&&(b.components.post.meta.relativeTime.soyTemplateName="tiger.components.post.meta.relativeTime")}),define("templates/tiger/components/invites/menu-items",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(a,b,c,d,e,f){b.components.invites.menuItems.invitePostDropdownItems=function(a,c,d){return'<li class="js_invite-to-post-manually hover-icon hide"><a href="#" rel="nofollow" class="icon--svg">'+b.icons.places.mail(null,null,d)+"Invite manually</a></li>"},d.DEBUG&&(b.components.invites.menuItems.invitePostDropdownItems.soyTemplateName="tiger.components.invites.menuItems.invitePostDropdownItems")}),define("module/discussion/view/comment.layout",["jquery","underscore","module/discussion/model/comment.collection","module/discussion/discussion.channel","app/post/common/post.layout","app/post/posttools/posttools.menuview","module/discussion/view/warning.view","view/GifImageLoader","singleton/Utils","singleton/util/loadEditor","singleton/CurrentBlog","singleton/CurrentUser","singleton/ImageBlurHelper","module/discussion/regionManager/discussionRegionManager","app/post/posttools/posttools.controller","app/post/posttools/controller/posttools.block.controller","singleton/EventDispatcher","gawkerlib/lightboxer","templates/tiger/components/discussion/comment","templates/tiger/components/post/meta/post-meta-container","templates/tiger/components/post/meta/post-dropdown","templates/tiger/components/post/meta/meta-avatar","templates/tiger/components/post/meta/formatted-time","templates/tiger/components/invites/menu-items"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";var s,t="KinjaNSFWCookie";return s=e.extend({_updateLikeCount:function(){var a=window.parseInt(this.ui.likeCountPlaceholder.text(),10)||0,b=a>0;a=this.model.get("liked")?a+1:b?a-1:0,this.ui.likeCountPlaceholder.text(a||"")},_expanded:!1,_gifImageLoader:null,_renderDeferred:a.Deferred(),_commentListView:null,tagName:"li",className:function(){var a=this.model,b=a.collection.getDiscussionType(),d=a.getChildren(),e=b===c.discussionTypes.ALL&&d.hasMore();return["commentlist__item","commentlist__item--depth-"+a.collection.getDepth(),a.get("_surfaced")?"surfaced":"",e?"commentlist__item--expandable":""].join(" ")},template:tiger.components.discussion.comment,regions:{warningRegion:".js_region--warning:first",childrenRegion:".js_region--children"},ui:b.extend({},e.prototype.ui,{replyContent:".js_reply-content",replyTools:".js_reply-tools",replyFlag:".js_reply-flagged",editorPlaceholder:".js_editor-placeholder",replyButton:".js_reply-to-selected-post",editReply:".js_edit-reply",reply:".js_reply",replyBubbleIcon:".js_bubble-icon"}),events:b.extend({},e.prototype.events,{"click @ui.replyButton":"onClickReplyTo","click @ui.replyContent, .js_toggle-descendants":"onClickReplyContent","click .js_pending-reply-thread-switch":"onClickPendingSwitch","click .js_pending-close:first":"onClickPendingClose","click .blurred .img-border":"onClickImageBlur","click @ui.editReply":"onClickEditReply","click .lazy-gif.thawable":"onClickThawImage"}),modelEvents:b.extend({},e.prototype.modelEvents,{"change:liked":"onChangeLiked","change:approved":"onChangeApproved","change:display":"onChangeDisplay","change:flagged":"onChangeFlagged","posttools:post:dismissed":"onDismissed"}),initialize:function(){},onClickReplyTo:function(){var a,c=n.addCommentRegion(this.ui.editorPlaceholder),e=this.model;return this.listenToOnce(c,"editor:post:save",function(c,f){a=b.extend(c.toJSON(),{_surfaced:!0,_viaEditor:!0}),e._commentCollection.unshift(a),d.trigger("newComment",{comment:a}),f&&f.length&&e.set("approved",!0)}),j().then(function(a){a.createComment(e)}),!1},serializeData:function(){var a,b=this.model.collection,c=i.getKinjaMeta();return a={reply:this.model.attributes,pageType:c.pageType,discussionType:b.getDiscussionType(),depth:b.getDepth(),starterAuthor:c.post.authorScreenName}},renderBlurs:function(){var b=this.$(".post-content .has-media:not(.blurred)");b.each(function(b,c){m.addImageBlur(a(c))})},renderPostTools:function(){this.postToolsMenuView=new f({el:this.$(".js_post-dropdown-ct").eq(0),model:this.model,blockedBlogCollection:p.getBlockedBlogCollection(k.id)}),o.bindEvents(this,this.postToolsMenuView),this.postToolsMenuView.on("posttools:content:render",this.renderFollowUnfollowForBlog.bind(this)),this.$(".without-dropdown").removeClass("without-dropdown")},renderFollowUnfollowForBlog:function(){l.onAuth.done(function(){var a=l.hasRole("OWNER",k.id)||l.hasRole("ADMIN",k.id)||l.hasRole("AUTHOR",k.id),b=l.hasRole("OWNER",k.id)||l.hasRole("ADMIN",k.id)||l.isSuperuser();
(a||l.isSuperuser())&&k.getFollowedBlogIds().done(function(a){var b=this.postToolsMenuView.$(".js_follow-controls"),c=this.postToolsMenuView.$(".js_followforblog"),d=this.postToolsMenuView.$(".js_unfollowforblog"),e=b.data("sourceblogid"),f=b.data("blogid");e!==f&&(-1!==a.indexOf(f)?(d.removeClass("hide"),c.addClass("hide")):(c.removeClass("hide"),d.addClass("hide")))}.bind(this)),b&&this.postToolsMenuView.trigger("posttools:checkBlockStatus",{model:this.postToolsMenuView.model,collection:this.postToolsMenuView.blockedBlogCollection})}.bind(this))},onRender:function(){var a=this.model._commentCollection;a&&a.getSurfacedCommentLength()&&this.ui.reply.addClass("expanded"),this.renderMediaEmbeds(),this.model.get("approved")||this.renderBlurs(),this.renderPostTools(),this.showChildrenView(),this.listenTo(q,"followforblog",function(a){a.id===this.model.id&&this.model.set("approved",!0)}),this._renderDeferred.resolve()},onClickReplyContent:function(b){var d=this.model,e=d.collection,f=e.getDiscussionType(),g=d.get("replyCount");return i.clickedOnLink(b)?void 0:this.model.get("_surfaced")&&f!==c.discussionTypes.ALL&&g?a.cookie(t)||this._expanded?(this._toggleDescendants(),!1):(this.showWarning(),!1):!1},onClickEditReply:function(){var a,c=n.addCommentRegion(this.ui.editorPlaceholder),d=this.model;return this.listenToOnce(c,"editor:post:save",function(c){a=b.extend(c.toJSON(),{_surfaced:!0}),this.model.set({display:a.display})}),j().then(function(a){a.editComment(d.get("id"))}),!1},onClickPendingSwitch:function(){return a.cookie(t,!0),this._toggleDescendants(),!1},onClickPendingClose:function(){return this.warningRegion.reset(),!1},onClickImageBlur:function(a){return m.removeImageBlur(a),!1},onClickThawImage:function(b){b.preventDefault(),q.trigger("thawImage",{$el:a(b.target)})},onChangeLiked:function(){this._renderDeferred.done(function(){this.ui.likeIcon.toggleClass("active",this.model.get("liked"))}.bind(this))},onChangeApproved:function(){this._renderDeferred.done(function(){this.ui.reply.toggleClass("reply--unapproved",!this.model.get("approved"))}.bind(this))},onChangeDisplay:function(){this._renderDeferred.done(function(){this.ui.replyContent.html(this.model.get("display"))}.bind(this))},onChangeFlagged:function(){this._renderDeferred.done(function(){var a=this.model.get("flagged");this.ui.reply.toggleClass("reply--flagged",a)}.bind(this))},onDismissed:function(){this.$el.fadeOut()},_toggleDescendants:function(){var a=this.getChildrenView();this.hideWarning(),this._expanded?(a.hideNestedChildren(),this.ui.reply.removeClass("expanded"),this.ui.replyBubbleIcon.removeClass("icon-bubble-round-x").addClass("icon-bubble-round")):(a.showNestedChildren(),this.ui.reply.addClass("expanded"),this.ui.replyBubbleIcon.removeClass("icon-bubble-round").addClass("icon-bubble-round-x")),this._expanded=!this._expanded},showWarning:function(){this.warningRegion.show(new g({warningType:g.warningTypes.THREAD}))},hideWarning:function(){this.warningRegion.reset("hide")},getChildrenView:function(){if(!this._commentListView){var a=require("module/discussion/view/commentList.view"),b=this.model.getChildren();this._commentListView=new a({collection:b})}return this._commentListView},showChildrenView:function(){this.childrenRegion.show(this.getChildrenView())},renderMediaEmbeds:function(){this._gifImageLoader=new h({el:this.el}),r(this.$el)}},{slideAnimationTime:200})}),define("templates/tiger/components/discussion/comment-list",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(a,b,c,d,e,f){b.components.discussion.commentList=function(a,c,d){var f="",g="commentlist--depth-"+e.$$escapeHtml(a.depth);return f+=("ReplyList"==a.discussionType?'<div class="js_commentlist-wrap--surface"><ul data-analytics-target="groupChat" class="commentlist commentlist--surface js_commentlist--surface '+e.$$escapeHtmlAttribute(g)+'"></ul></div><div class="js_commentlist-wrap--nested" style="display: none"><ul class="commentlist commentlist--nested js_commentlist--nested '+e.$$escapeHtmlAttribute(g)+'"></ul></div>'+(a.depth<2?b.components.discussion.replyFooter(null,null,d):""):'<div class="js_commentlist-wrap--nested" style="display: none"><ul class="commentlist commentlist--nested js_commentlist--nested '+e.$$escapeHtmlAttribute(g)+'"></ul>'+b.components.discussion.replyFooter(null,null,d)+'</div><div class="js_commentlist-wrap--surface"><ul class="commentlist commentlist--surface js_commentlist--surface '+e.$$escapeHtmlAttribute(g)+'"></ul></div>')+(a.depth<1?'<footer class="commentlist__pagination js_commentlist__pagination hide"><a class="js_button--pagination button--pagination icon--svg u-full">Load more'+b.icons.essential.chevronBottomSmall(null,null,d)+'</a></footer><div class="js_spinner-wrap spinner-wrap hide row">'+b.components.spinner.bounce(null,null,d)+"</div>":"")},d.DEBUG&&(b.components.discussion.commentList.soyTemplateName="tiger.components.discussion.commentList"),b.components.discussion.replyFooter=function(a,c,d){return'<footer class="reply-footer-bar js_reply-footer-bar"><a class="discussion__button js_discussion__button js_load-more-replies icon--svg u-full hide">Show more replies'+b.icons.essential.chevronBottomSmall(null,null,d)+'</a><a class="discussion__button js_discussion__button js_load-all-replies icon--svg u-full hide">Show more replies in this thread'+b.icons.essential.chevronBottomSmall(null,null,d)+'</a><a class="discussion__button js_discussion__button js_close-replies icon--svg u-full hide">Collapse replies'+b.icons.essential.chevronTopSmall(null,null,d)+"</a></footer>"},d.DEBUG&&(b.components.discussion.replyFooter.soyTemplateName="tiger.components.discussion.replyFooter")}),define("module/discussion/view/commentList.view",["jquery","backbone.marionette","module/discussion/model/comment.collection","module/discussion/view/comment.layout","singleton/WindowController","templates/tiger/components/discussion/comment-list"],function(a,b,c,d,e){"use strict";var f=b.CompositeView.extend({_expanded:!1,className:function(){return"commentlist-wrap "+this.collection.getDiscussionType().toLowerCase()},itemView:d,template:tiger.components.discussion.commentList,ui:{surfaceList:".js_commentlist--surface",surfaceListWrap:".js_commentlist-wrap--surface",nestedList:".js_commentlist--nested",nestedListWrap:".js_commentlist-wrap--nested",repliesFooter:".js_reply-footer-bar",discussionButtons:".js_discussion__button",loadAllRepliesButton:".js_load-all-replies",loadMoreRepliesButton:".js_load-more-replies",closeRepliesButton:".js_close-replies",paginationContainer:".js_commentlist__pagination",paginationButton:".js_button--pagination",spinner:".js_spinner-wrap"},events:{"click @ui.loadAllRepliesButton":"onClickLoadAllReplies","click @ui.loadMoreRepliesButton":"onClickLoadMoreReplies","click @ui.closeRepliesButton":"onClickCloseReplies","click @ui.paginationButton":"onClickPaginationButton"},collectionEvents:{sync:"onCollectionSync"},serializeData:function(){var a=this.collection;return{depth:a.getDepth(),discussionType:a.getDiscussionType()}},onRender:function(){var a=this.collection,b=a.getDepth();a.hasMore()&&(b>0&&this._toggleButtons(),0===b&&this.showPaginationButton())},appendHtml:function(a,b){var c=b.$el,d=this.collection.getApprovedOnly(),e=b.model.get("_viaEditor")||!1;e?this.ui.surfaceList.prepend(c):(!d||d&&b.model.get("approved"))&&(b.model.get("_surfaced")?this.ui.surfaceList.append(c):this.ui.nestedList.append(c))},_toggleButtons:function(a){var b=this.ui.closeRepliesButton,c=this.ui.loadAllRepliesButton,d=this.ui.loadMoreRepliesButton;this.ui.discussionButtons.addClass("hide"),a?(c.addClass("hide"),b.removeClass("hide"),this.collection.hasMore()&&d.removeClass("hide")):(b.addClass("hide"),d.addClass("hide"),c.removeClass("hide"))},showNestedChildren:function(){var a,b,c=this.collection;a=function(){this.ui.nestedListWrap.slideDown(f.slideAnimationTime),this._toggleButtons(!0),this._expanded=!0,this.$el.addClass("expanded")}.bind(this),b=function(){this.listenToOnce(c,"sync",a),c.fetch({remove:!1})}.bind(this),this._expanded?c.hasMore()&&b():c.length&&c.length-c.getSurfacedCommentLength()?a():b()},hideNestedChildren:function(){this.ui.nestedListWrap.slideUp(f.slideAnimationTime),this._toggleButtons(),this._expanded=!1,this.$el.removeClass("expanded"),this.collection.getDiscussionType()===c.discussionTypes.ALL&&a.scrollTo(this.ui.surfaceList,f.slideAnimationTime)},onClickLoadAllReplies:function(){return this.showNestedChildren(),!1},onClickLoadMoreReplies:function(){return this.showNestedChildren(),!1},onClickCloseReplies:function(){return this.hideNestedChildren(),!1},onClickPaginationButton:function(){this.showSpinner(),this.hidePaginationButton(),this.collection.fetch({remove:!1})},onCollectionSync:function(){var b=this.collection;b.hasMore()&&a(this.ui.repliesFooter).length&&this._toggleButtons(),0===b.getDepth()&&(this.hideSpinner(),b.hasMore()?this.showPaginationButton():this.hidePaginationButton())},initializeWaypoint:function(){var a=this.$(".js_spinner-wrap");a.removeClass("hide"),e.registerWaypoint(a,"100%",function(){this._onWaypointReached()}.bind(this))},teardownWaypoint:function(){e.teardownWaypoint(this.$(".js_spinner-wrap"))},_onWaypointReached:function(){var a=this.$(".js_spinner-wrap");e.teardownWaypoint(a),this.collection.fetch({remove:!1}),this.listenToOnce(this.collection,"sync",function(){a.detach(),this.collection.hasMore()&&(this.$el.append(a),this.initializeWaypoint())})},showPaginationButton:function(){this.ui.paginationButton.removeClass("hide"),this.ui.paginationContainer.removeClass("hide")},hidePaginationButton:function(){this.ui.paginationContainer.addClass("hide"),this.ui.paginationButton.addClass("hide")},showSpinner:function(){this.$el.append(this.ui.spinner.removeClass("hide"))},hideSpinner:function(){this.ui.spinner.detach()}},{slideAnimationTime:200});return f}),define("templates/tiger/messages",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(a,b,c,d,e,f){b.messages.areYouSureToDisconnect=function(a,b,c){return"Are you sure you want to disconnect this account?"},d.DEBUG&&(b.messages.areYouSureToDisconnect.soyTemplateName="tiger.messages.areYouSureToDisconnect"),b.messages.settingsSaved=function(a,b,c){return"Settings saved successfully."},d.DEBUG&&(b.messages.settingsSaved.soyTemplateName="tiger.messages.settingsSaved"),b.messages.confirmationEmail=function(a,b,c){return"Confirmation email has been sent."},d.DEBUG&&(b.messages.confirmationEmail.soyTemplateName="tiger.messages.confirmationEmail"),b.messages.blogPropertySaved=function(a,b,c){return"Blog property saved successfully."},d.DEBUG&&(b.messages.blogPropertySaved.soyTemplateName="tiger.messages.blogPropertySaved"),b.messages.blogPropertyCreated=function(a,b,c){return"Blog property created successfully."},d.DEBUG&&(b.messages.blogPropertyCreated.soyTemplateName="tiger.messages.blogPropertyCreated"),b.messages.blogPropertyDeleted=function(a,b,c){return"Blog property deleted successfully."},d.DEBUG&&(b.messages.blogPropertyDeleted.soyTemplateName="tiger.messages.blogPropertyDeleted"),b.messages.ownerSet=function(a,b,c){return"New owner has been set."},d.DEBUG&&(b.messages.ownerSet.soyTemplateName="tiger.messages.ownerSet"),b.messages.cannotDisconnectLoginAccount=function(a,b,c){return"You cannot disconnect your login account from Kinja. Please switch your login account, save, and try again."},d.DEBUG&&(b.messages.cannotDisconnectLoginAccount.soyTemplateName="tiger.messages.cannotDisconnectLoginAccount"),b.messages.repliesDisabled=function(a,c,d){return'<div class="twelve columns end mbx"><div class="reply-create media"><div class="img mrm icon--svg">'+b.icons.discussion.bubbleClose(null,null,d)+'</div><div class="bd proxima"><span class="msg text-small text-light">This discussion is closed</span></div></div></div>'},d.DEBUG&&(b.messages.repliesDisabled.soyTemplateName="tiger.messages.repliesDisabled"),b.messages.imageUploadError=function(a,b,c){return"Image upload error."},d.DEBUG&&(b.messages.imageUploadError.soyTemplateName="tiger.messages.imageUploadError"),b.messages.assetRecommended=function(a,b,c){return"Media recommended."},d.DEBUG&&(b.messages.assetRecommended.soyTemplateName="tiger.messages.assetRecommended"),b.messages.assetUnrecommended=function(a,b,c){return"Removed media recommendation."},d.DEBUG&&(b.messages.assetUnrecommended.soyTemplateName="tiger.messages.assetUnrecommended"),b.messages.amazonBestSellerReport=function(a,b,c){return"<p><small>If the blog list is omitted, all blogs will be taken into account. If the limit is set to 0, no limit is set.</small></p>"},d.DEBUG&&(b.messages.amazonBestSellerReport.soyTemplateName="tiger.messages.amazonBestSellerReport"),b.messages.amazonTagReport=function(a,b,c){return"<p><small>Beware: If the checkbox above is unchecked, Amazon statistics and posts will both be filtered by the date picker. This means that earnings and orders for posts which were published earlier will <strong>not</strong> be shown here.</small></p>"},d.DEBUG&&(b.messages.amazonTagReport.soyTemplateName="tiger.messages.amazonTagReport")}),define("module/discussion/view/loading.view",["backbone.marionette","templates/tiger/components/spinner","templates/tiger/messages"],function(a){"use strict";var b=a.ItemView.extend({template:tiger.components.spinner.bounce});return b}),define("view/behaviors/googleAnalytics.behavior",["jquery","underscore","backbone.marionette","singleton/Utils"],function(a,b,c,d){"use strict";var e=c.Behavior.extend({events:{"click [data-ga]:not(form)":"onGAClick","submit form[data-ga]":"onGASubmit"},onGAClick:function(b){var c,d=a(b.currentTarget),e=d.closest("a[href]").eq(0);return this.logGAEvent(b),e.length&&(c=e.attr("href"),!/^((http|https):)?\/\//.test(c)||"_blank"===e.attr("target")||b.shiftKey||b.ctrlKey||b.metaKey||(b.preventDefault(),window.setTimeout(function(){window.location.href=c},500))),!0},onGASubmit:function(b){var c=a(b.currentTarget),d=c.attr("action"),e=c.serialize();this.logGAEvent(b),b.preventDefault(),window.setTimeout(function(){window.location.href=d+"?"+e},500)},logGAEvent:function(c){var d,f=a(c.currentTarget),g=f.attr("data-ga").replace(/[\[\]]/g,"").split(/\s*,\s*/g);g=g.map(function(a){return b.contains(e.validKeys,a)?e.replacePlaceholder(a):a}),d=["send","event"].concat(g),window.ga.apply(this,d)}},{validKeys:["js_pageType","js_pageUrl"],replacePlaceholder:function(a){var b=d.getKinjaMeta();switch(a=a.replace(/js_/g,"")){case"pageType":return b.pageType;case"pageUrl":return window.location.url;default:return""}}});return e}),define("templates/tiger/components/discussion/applet",["overlord","tiger","mantle","lib/amd-wrapped/soy/goog","lib/amd-wrapped/soy/soy","lib/amd-wrapped/soy/soydata"],function(a,b,c,d,e,f){b.components.discussion.applet=function(a,c,d){var f="",g=""+(a.replyCount>1?"View all "+e.$$escapeHtml(a.replyCount)+" replies":"View all replies");return f+='<ul class="reply-filters js_reply-filters-container hide"><li class="js_permalink-replies reply-filter reply-filter--permalink js_groupchats__filter sitecolored--hover hide"><a class="tab-author"><span class="js_author-name">'+e.$$escapeHtml(window.kinja.stripHtmlTags(a.permalinkByline,""))+'</span>s Discussions</a><div class="reply-filter__active-marker icon--svg">'+b.icons.essential.chevronBottom(null,null,d)+'</div></li><li class="js_personalized reply-filter reply-filter--personalized js_groupchats__filter sitecolored--hover hide"><a class="tab-author" data-ga="[Group Chats, click, Author Chat click]"><span class="js_author-name">'+e.$$escapeHtml(window.kinja.stripHtmlTags(a.byline,""))+'</span>s Discussions</a><div class="reply-filter__active-marker icon--svg">'+b.icons.essential.chevronBottom(null,null,d)+'</div></li><li  class="js_allview reply-filter reply-filter--all js_groupchats__filter sitecolored--hover"><a data-ga="[Group Chats, click, All Replies click, __DEFAULT]" title="'+e.$$escapeHtmlAttribute(g)+'">All replies</a><div class="reply-filter__active-marker icon--svg">'+b.icons.essential.chevronBottom(null,null,d)+'</div></li></ul><div class="js_editor-placeholder js_reply-form-container"></div><div class="js_region--warning"></div><div class="js_flagging-admin-placeholder"></div><div class="js_content-region"></div><div class="js_replycol js_ad300-companion"><div class="js_reply-loading-progress reply-spinner hide">'+b.components.spinner.bounce(null,null,d)+'</div><div class="js_load-more"></div><div class="reply-views js_reply-views hide"><a class="js_author-view-footer js_groupchats__filter personalized icon--svg u-full commentlist__filter-button hide" data-ga="[Group Chats, click, Popular Chat click]">View '+e.$$escapeHtml(a.byline)+"'s discussions"+b.icons.essential.chevronBottomSmall(null,null,d)+'</a><a class="js_allview-footer js_groupchats__filter allview icon--svg u-full commentlist__filter-button hide" data-ga="[Group Chats, click, All Replies click, __DEFAULT]">'+e.$$escapeHtml(g)+b.icons.essential.chevronBottomSmall(null,null,d)+"<a></div></div>"},d.DEBUG&&(b.components.discussion.applet.soyTemplateName="tiger.components.discussion.applet")}),define("module/DiscussionModule",["jquery","underscore","backbone.marionette","model/post/Post","module/discussion/model/comment.collection","module/discussion/model/comment.model","module/discussion/view/commentList.view","module/discussion/view/warning.view","module/discussion/view/loading.view","module/discussion/discussion.channel","module/flagging/ReplyFlaggingModule","view/behaviors/googleAnalytics.behavior","module/discussion/regionManager/discussionRegionManager","singleton/Utils","singleton/Feature","singleton/util/loadEditor","templates/tiger/components/discussion/applet","templates/tiger/components/groupchats/flagging-admin-link"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";var q,r,s,t,u,v;return t=new d(n.getKinjaMeta().post),s=new f(t.attributes),q={personalized:{collection:new e([],{parent:s,discussionType:e.discussionTypes.PERSONALIZED,approvedOnly:!0}),onFacetShow:function(){}},allApproved:{collection:new e([],{parent:s,discussionType:e.discussionTypes.ALL,approvedOnly:!0}),onFacetShow:function(){this.warningRegion.show(new h({warningType:h.warningTypes.COMPLETE,noReplies:0===r.collection.length})),r.collection.loadFlaggedCommentCount().done(function(){var a=k.flagCount(),b={flagCount:a,blogName:n.getKinjaMeta().blog.name},d=c.Renderer.render(tiger.components.groupchats.flaggingAdminLink,b);a>0&&this.ui.flaggingAdminPlaceholder.append(d)}.bind(this))}},allUnapproved:{collection:new e([],{parent:s,discussionType:e.discussionTypes.ALL,approvedOnly:!1}),onFacetShow:function(){var a=new h({warningType:h.warningTypes.COMPLETE,noReplies:0===r.collection.length});this.warningRegion.show(a),a.toggleFilter()}}},new(u=c.Layout.extend({showFacet:function(a,b){var c,d=a.collection;r=a,o.isOn("delaydiscussion")&&this.contentRegion.show(new i),this.toggleFooterLinks(),c=function(){this.contentRegion.show(new g({collection:r.collection})),r.onFacetShow.call(this),this.toggleFooterLinks()}.bind(this),b&&(this.warningRegion.reset(),this.ui.flaggingAdminPlaceholder.html(""),d.length||d._hasFirstFetched?c():(d.fetch(),this.contentRegion.reset(),this.listenToOnce(d,"sync",c)))},regions:{contentRegion:".js_content-region",warningRegion:".js_region--warning:first"},ui:{replyFilterContainer:".js_reply-filters-container",filterButtons:".js_groupchats__filter",personalizedRepliesButton:".js_personalized",allRepliesButton:".js_allview",permalinkRepliesButton:".js_permalink-replies",disabledReplies:".js_disabled-replies",spinner:".js_loading-layer",editorPlaceholder:".js_editor-placeholder",flaggingAdminPlaceholder:".js_flagging-admin-placeholder",footerButtonsContainer:".js_reply-views",authorViewFooter:".js_author-view-footer",allViewFooter:".js_allview-footer"},events:{"click @ui.filterButtons":"onClickFilter","click .js_pending-reply-switch":"onClickPendingSwitch"},behaviors:{GoogleAnalyticsBehavior:{behaviorClass:l}},template:tiger.components.discussion.applet,className:"replies-wrapper",initialize:function(){var b=n.getKinjaMeta(),c=b.postId;n.isCommentPermalinkPage()&&(v=new f({id:c}),q.permalink={collection:new e([],{discussionType:e.discussionTypes.PERMALINK,parent:s,permalinkComment:v,approvedOnly:!1}),onFacetShow:function(){var b=this.$el.find(".reply[data-id="+c+"]").addClass("anchor");b.length&&a.scrollTo(b,250,{offset:-20})}}),this.listenTo(this.contentRegion,"close",function(){this.contentRegion.show(new i)}),this.listenTo(this.contentRegion,"show",function(a){var b=a.collection;b&&this.$el.parent().css({"min-height":this.$el.outerHeight()})})},_initializeFallbacks:function(){var a,b;a=[q.allApproved],v?(a.unshift(q.permalink),this.ui.personalizedRepliesButton.remove()):(a.unshift(q.personalized),this.ui.permalinkRepliesButton.remove()),(b=function(){var c,d=a.shift();d&&(c=d.collection,this.listenToOnce(c,"sync",function(){this.showFacet(d,!0),c.hasMore()||c.length?(d.$button.removeClass("hide").addClass("active"),this.ui.replyFilterContainer.removeClass("hide")):(d.$button.remove(),d.$footerButton.remove(),b())}),c.fetch({reset:!0}))}.bind(this))()},replyToStarterPost:function(){var a,c=m.addCommentRegion(this.ui.editorPlaceholder);this.listenToOnce(c,"editor:post:save",function(c){a=b.extend(c.toJSON(),{_surfaced:!0,_viaEditor:!0}),this.contentRegion.currentView.collection.unshift(a),j.trigger("newComment",{comment:a})}),p().then(function(a){a.createComment(s)})},onClickFilter:function(b){var c,d,e=b.currentTarget.className;if(b.preventDefault(),-1===e.indexOf("active")){if(this.contentRegion.currentView.teardownWaypoint(),-1!==e.indexOf("personalized"))c=q.personalized;else if(-1!==e.indexOf("allview"))c=q.allApproved;else{if(-1===e.indexOf("permalink-replies"))return;c=q.permalink}d=c.collection,this.ui.filterButtons.removeClass("active"),c.$button.addClass("active"),a.scrollTo(this.$el,250,{offset:-100}),this.showFacet(c,!0)}},onClickPendingSwitch:function(b){var c,d,e=r.collection;return b.preventDefault(),e===q.allApproved.collection?d=q.allUnapproved:e===q.allUnapproved.collection&&(d=q.allApproved),c=d.collection,this.showFacet(d,!0),a.scrollTo(this.$el,250,{offset:-50}),!1},onRender:function(){b.extend(q.personalized,{$button:this.ui.personalizedRepliesButton,$footerButton:this.ui.authorViewFooter}),b.extend(q.allApproved,{$button:this.ui.allRepliesButton,$footerButton:this.ui.allViewFooter}),b.extend(q.permalink,{$button:this.ui.permalinkRepliesButton,$footerButton:this.ui.allViewFooter}),this._initializeFallbacks(),this.listenToOnce(this.contentRegion,"show",function(){this.listenToOnce(q.personalized.collection,"pagination:done",this.toggleFooterLinks).listenToOnce(q.allApproved.collection,"pagination:done",this.toggleFooterLinks).listenToOnce(q.allUnapproved.collection,"pagination:done",this.toggleFooterLinks),q.permalink&&this.listenToOnce(q.permalink.collection,"pagination:done",this.toggleFooterLinks)})},toggleFooterLinks:function(){var a=r.collection,b=a._hasFirstFetched&&!a.hasMore();this.ui.footerButtonsContainer.addClass("hide"),this.ui.allViewFooter.addClass("hide"),this.ui.authorViewFooter.addClass("hide"),b&&a.length&&(this.ui.footerButtonsContainer.removeClass("hide"),a.getDiscussionType()===e.discussionTypes.ALL?this.ui.authorViewFooter.removeClass("hide"):this.ui.allViewFooter.removeClass("hide"))},serializeData:function(){var a=s.get("byline")||s.get("author").displayName;return{byline:a,permalinkByline:a,permalink:s.get("permalink"),replyCount:s.get("replyCount")}}}))});