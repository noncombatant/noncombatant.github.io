(function(){const g=window.wpcom||{};g.actionbar={},g.actionbar.data=window.actionbardata;const t=g.actionbar.data;function l(e={},n=()=>{}){if(!e.action)return;fetch(t.xhrURL,{method:"POST",body:new URLSearchParams(e),headers:{'Content-Type':"application/x-www-form-urlencoded; charset=UTF-8",'X-Requested-With':"XMLHttpRequest"}}).then(n)}let f;function S(){return f||(f=new Promise((e,n)=>{if(window.WPCOM_Proxy_Request)e(window.WPCOM_Proxy_Request);else{const s=document.createElement("script");s.src=t.proxyScriptUrl,s.async=!0,document.body.appendChild(s),s.addEventListener("load",()=>e(window.WPCOM_Proxy_Request)),s.addEventListener("error",e=>n(e))}})),f}function c(e,t,n={}){const s={path:e,body:n,method:"POST",apiNamespace:t};S().then(e=>e(s))}function o(e,t){l({action:"actionbar_stats",stat:e},t)}function _(e){l({action:e,_wpnonce:t.nonce,source:"actionbar",blog_id:t.siteID})}let x=window.scrollY||window.pageYOffset||0;if(window!=window.top)return;const e=document.querySelector("#actionbar");if(!e)return;e.removeAttribute("style"),t.statusMessage&&C(t.statusMessage);let j=!1;const s=e.querySelector(".actnbr-actn-follow"),d=e.querySelector("#toggle-input-notify-posts"),m=e.querySelector("#toggle-input-email-posts"),O=e.querySelector("#toggle-input-email-comments"),p=e.querySelectorAll(".segmented-control__link"),F=e.querySelector(".frequency-instantly"),A=e.querySelector(".frequency-daily"),E=e.querySelector(".frequency-weekly");d&&d.addEventListener("click",e=>{e.preventDefault();const n=e.target.parentElement.classList.toggle("is-checked"),s=`/read/sites/${t.siteID}/notification-subscriptions/${n?"new":"delete"}`;c(s,"wpcom/v2"),v("wpcom_actionbar_site_notifications",{enabling:n,follow_source:"actionbar",url:t.siteURL})}),m&&m.addEventListener("click",s=>{s.preventDefault();const n=s.target.parentElement.classList.toggle("is-checked"),i=`/read/site/${t.siteID}/post_email_subscriptions/${n?"new":"delete"}`;let o={};n&&(o.delivery_frequency=t.subsEmailDefault,p.forEach(e=>e.parentElement.classList.remove("is-selected")),e.querySelector(`.frequency-${t.subsEmailDefault}`).parentElement.classList.add("is-selected")),e.querySelector("#email-new-posts-details").classList.toggle("is-visible",n),c(i,"rest/v1.2",o)}),O&&O.addEventListener("click",e=>{e.preventDefault();const n=e.target.parentElement.classList.toggle("is-checked"),s=`/read/site/${t.siteID}/comment_email_subscriptions/${n?"new":"delete"}`;c(s,"rest/v1.2")});const u=(e,n)=>{p.forEach(e=>e.parentElement.classList.remove("is-selected")),e.target.parentElement.classList.add("is-selected");const s=`/read/site/${t.siteID}/post_email_subscriptions/update`;c(s,"rest/v1.2",{delivery_frequency:n})};p.length>0&&(F.addEventListener("click",e=>u(e,"instantly")),A.addEventListener("click",e=>u(e,"daily")),E.addEventListener("click",e=>u(e,"weekly"))),s&&s.addEventListener("click",e=>{if(e.preventDefault(),e.stopPropagation(),j=!0,t.isLoggedIn){C(`<div class="actnbr-reader">${t.i18n.followedText}</div>`),o("followed"),v("wpcom_actionbar_site_followed",{follow_source:"actionbar",url:t.siteURL}),_("ab_subscribe_to_blog");const e=t.subsEmailDefault;e!=="never"&&m.click(),d&&d.click()}else M()});const i=e.querySelector(".actnbr-actn-following");i&&i.addEventListener("click",n=>{n.preventDefault(),i.classList.add("no-display"),s.classList.remove("no-display"),o("unfollowed"),v("wpcom_actionbar_site_unfollowed",{follow_source:"actionbar",url:t.siteURL}),_("ab_unsubscribe_from_blog");const a=e.querySelector(".actnbr-btn");a.classList.add("actnbr-hidden");const r=e.querySelectorAll(".actnbr-site-settings__toggle.is-checked");r.forEach(e=>e.classList.remove("is-checked"))}),document.addEventListener("click",n=>{const s=!!n.target.closest("#follow-bubble");if(s)return;const t=e.querySelector(".actnbr-btn");j&&!t.classList.contains("actnbr-hidden")&&(j=!1,t.classList.add("actnbr-hidden"))});const r=e.querySelector(".actnbr-shortlink a");r&&r.addEventListener("click",e=>{e.preventDefault(),window.electron?window.electron.send("copy-text-to-clipboard",t.shortlink):window.prompt("Shortlink: ",t.shortlink)});const a=e.querySelector(".actnbr-ellipsis");let h=!1;a&&a.addEventListener("click",t=>{const e=t.target.closest("a");if(e&&e.classList.contains("actnbr-action"))return!1;a.classList.toggle("actnbr-hidden"),setTimeout(()=>{a.classList.contains("actnbr-hidden")||(o("show_more_menu"),h=!0)},10)}),document.addEventListener("click",()=>{h&&(a.classList.add("actnbr-hidden"),h=!1)});const y=e.querySelector(".actnbr-fold");y&&y.addEventListener("click",s=>{s.preventDefault();const n=y.querySelector("a");e.classList.contains("actnbr-folded")?(n.textContent=t.i18n.foldBar,e.classList.remove("actnbr-folded"),l({action:"unfold_actionbar"})):(n.textContent=t.i18n.unfoldBar,e.classList.add("actnbr-folded"),l({action:"fold_actionbar"}))});function n(n,s,o){const t=e.querySelector(n);t&&t.addEventListener("click",w(s,o))}n(".actnbr-sitename a","clicked_site_title"),n(".actnbr-customize a","customized"),n(".actnbr-folded-customize a","customized"),n(".actnbr-theme a","explored_theme"),n(".actnbr-edit a","edited"),n(".actnbr-stats a","clicked_stats"),n(".flb-report a","reported_content"),n(".actnbr-follows a","managed_following"),n(".actnbr-login-nudge a","clicked_login_nudge"),n(".actnbr-signup a","clicked_signup_link"),n(".actnbr-login a","clicked_login_link"),n(".actnbr-subs a","clicked_manage_subs_link"),n(".actnbr-reader a","view_reader"),r&&r.addEventListener("click",o("copied_shortlink"));const b=e.querySelector(".actnbr-follow-bubble form");b&&b.addEventListener("submit",w("submit_follow_form",()=>{const e=b.querySelector("button");e&&e.setAttribute("disabled",!0)}));function k(){const t=window.scrollY||window.pageYOffset||0,n=e.classList.contains("actnbr-hidden");t<x?e.classList.remove("actnbr-hidden"):!n&&document.querySelectorAll("#actionbar > ul > li:not(.actnbr-hidden) > .actnbr-popover").length===0&&(e.classList.add("actnbr-hidden"),e.querySelectorAll("li").forEach(e=>e.classList.add("actnbr-hidden"))),x=t}document.addEventListener("scroll",k,{passive:!0});function v(t,e){e=e||{},window._tkq=window._tkq||[],window._tkq.push(["recordEvent",t,e])}function w(n,t){const e={};return function(s){if(e[s.timeStamp])return delete e[s.timeStamp],s.type==="submit"&&s.target.submit(),typeof t!="function"||t(s);s.preventDefault(),s.stopPropagation();function i(){const t=new s.constructor(s.type,s);e[t.timeStamp]=!0,s.target.dispatchEvent(t)}o(n,i)}}function M(){const n=e.querySelector(".actnbr-follow-bubble form");n.removeAttribute("style");const t=e.querySelector(".actnbr-btn");t&&t.classList.toggle("actnbr-hidden"),setTimeout(()=>{e.querySelector(".actnbr-email-field").focus()},10)}function C(o){s&&s.classList.add("no-display"),i&&i.classList.remove("no-display");const t=e.querySelector(".actnbr-follow-bubble .actnbr-message");t&&(t.innerHTML=o);const n=e.querySelector(".actnbr-btn");n&&n.classList.remove("actnbr-hidden")}})()