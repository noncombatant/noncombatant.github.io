(function(){const h=window.wpcom||{};h.actionbar={},h.actionbar.data=window.actionbardata;const t=h.actionbar.data;function r(e={},n=()=>{}){if(!e.action)return;fetch(t.xhrURL,{method:"POST",body:new URLSearchParams(e),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","X-Requested-With":"XMLHttpRequest"}}).then(n)}let y;function M(){return y||(y=new Promise((e,n)=>{if(window.WPCOM_Proxy_Request)e(window.WPCOM_Proxy_Request);else{const s=document.createElement("script");s.src=t.proxyScriptUrl,s.async=!0,document.body.appendChild(s),s.addEventListener("load",()=>e(window.WPCOM_Proxy_Request)),s.addEventListener("error",e=>n(e))}})),y}function c(e,t,n={}){const s={path:e,body:n,method:"POST",apiNamespace:t};M().then(e=>e(s))}function a(e,t){r({action:"actionbar_stats",stat:e},t)}function O(e){r({action:e,_wpnonce:t.nonce,source:"actionbar",blog_id:t.siteID})}let _=window.scrollY||window.pageYOffset||0;if(window!=window.top)return;const e=document.querySelector("#actionbar");if(!e)return;e.removeAttribute("style"),t.statusMessage&&C(t.statusMessage);let u=!1;const s=e.querySelector(".actnbr-actn-follow"),l=e.querySelector("#toggle-input-notify-posts"),m=e.querySelector("#toggle-input-email-posts"),w=e.querySelector("#toggle-input-email-comments"),p=e.querySelectorAll(".segmented-control__link"),A=e.querySelector(".frequency-instantly"),k=e.querySelector(".frequency-daily"),E=e.querySelector(".frequency-weekly");l&&l.addEventListener("click",e=>{e.preventDefault();const n=e.target.parentElement.classList.toggle("is-checked"),s=`/read/sites/${t.siteID}/notification-subscriptions/${n?"new":"delete"}`;c(s,"wpcom/v2"),b("wpcom_actionbar_site_notifications",{enabling:n,follow_source:"actionbar",url:t.siteURL})}),m&&m.addEventListener("click",n=>{n.preventDefault();const s=n.target.parentElement.classList.toggle("is-checked"),i=`/read/site/${t.siteID}/post_email_subscriptions/${s?"new":"delete"}`;let o={};s&&(o.delivery_frequency=t.subsEmailDefault,p.forEach(e=>e.parentElement.classList.remove("is-selected")),e.querySelector(`.frequency-${t.subsEmailDefault}`).parentElement.classList.add("is-selected")),e.querySelector("#email-new-posts-details").classList.toggle("is-visible",s),c(i,"rest/v1.2",o)}),w&&w.addEventListener("click",e=>{e.preventDefault();const n=e.target.parentElement.classList.toggle("is-checked"),s=`/read/site/${t.siteID}/comment_email_subscriptions/${n?"new":"delete"}`;c(s,"rest/v1.2")});const j=(e,n)=>{p.forEach(e=>e.parentElement.classList.remove("is-selected")),e.target.parentElement.classList.add("is-selected");const s=`/read/site/${t.siteID}/post_email_subscriptions/update`;c(s,"rest/v1.2",{delivery_frequency:n})};p.length>0&&(A.addEventListener("click",e=>j(e,"instantly")),k.addEventListener("click",e=>j(e,"daily")),E.addEventListener("click",e=>j(e,"weekly"))),s&&s.addEventListener("click",e=>{if(e.preventDefault(),e.stopPropagation(),u=!0,t.isLoggedIn){C(`<div class="actnbr-reader">${t.i18n.followedText}</div>`),a("followed"),b("wpcom_actionbar_site_followed",{follow_source:"actionbar",url:t.siteURL}),O("ab_subscribe_to_blog");const e=t.subsEmailDefault;e!=="never"&&m.click(),l&&l.click()}else F()});const o=e.querySelector(".actnbr-actn-following");o&&o.addEventListener("click",n=>{n.preventDefault(),o.classList.add("no-display"),s.classList.remove("no-display"),a("unfollowed"),b("wpcom_actionbar_site_unfollowed",{follow_source:"actionbar",url:t.siteURL}),O("ab_unsubscribe_from_blog");const i=e.querySelector(".actnbr-btn");i.classList.add("actnbr-hidden");const r=e.querySelectorAll(".actnbr-site-settings__toggle.is-checked");r.forEach(e=>e.classList.remove("is-checked"))}),document.addEventListener("click",t=>{const s=!!t.target.closest("#follow-bubble");if(s)return;const n=e.querySelector(".actnbr-btn");u&&!n.classList.contains("actnbr-hidden")&&(u=!1,n.classList.add("actnbr-hidden"))});const d=e.querySelector(".actnbr-shortlink a");d&&d.addEventListener("click",e=>{e.preventDefault(),window.electron?window.electron.send("copy-text-to-clipboard",t.shortlink):window.prompt("Shortlink: ",t.shortlink)});const i=e.querySelector(".actnbr-ellipsis");let v=!1;i&&i.addEventListener("click",e=>{const t=e.target.closest("a");if(t&&t.classList.contains("actnbr-action"))return!1;i.classList.toggle("actnbr-hidden"),setTimeout(()=>{i.classList.contains("actnbr-hidden")||(a("show_more_menu"),v=!0)},10)}),document.addEventListener("click",()=>{v&&(i.classList.add("actnbr-hidden"),v=!1)});const g=e.querySelector(".actnbr-fold");g&&g.addEventListener("click",n=>{n.preventDefault();const s=g.querySelector("a");e.classList.contains("actnbr-folded")?(s.textContent=t.i18n.foldBar,e.classList.remove("actnbr-folded"),r({action:"unfold_actionbar"})):(s.textContent=t.i18n.unfoldBar,e.classList.add("actnbr-folded"),r({action:"fold_actionbar"}))});function n(t,n,s){const o=e.querySelector(t);o&&o.addEventListener("click",x(n,s))}n(".actnbr-sitename a","clicked_site_title"),n(".actnbr-customize a","customized"),n(".actnbr-folded-customize a","customized"),n(".actnbr-theme a","explored_theme"),n(".actnbr-edit a","edited"),n(".actnbr-stats a","clicked_stats"),n(".flb-report a","reported_content"),n(".actnbr-follows a","managed_following"),n(".actnbr-login-nudge a","clicked_login_nudge"),n(".actnbr-signup a","clicked_signup_link"),n(".actnbr-login a","clicked_login_link"),n(".actnbr-subs a","clicked_manage_subs_link"),n(".actnbr-reader a","view_reader"),d&&d.addEventListener("click",a("copied_shortlink"));const f=e.querySelector(".actnbr-follow-bubble form");f&&f.addEventListener("submit",x("submit_follow_form",()=>{const e=f.querySelector("button");e&&e.setAttribute("disabled",!0)}));function S(){const t=window.scrollY||window.pageYOffset||0,n=e.classList.contains("actnbr-hidden");t<_?e.classList.remove("actnbr-hidden"):!n&&document.querySelectorAll("#actionbar > ul > li:not(.actnbr-hidden) > .actnbr-popover").length===0&&(e.classList.add("actnbr-hidden"),e.querySelectorAll("li").forEach(e=>e.classList.add("actnbr-hidden"))),_=t}document.addEventListener("scroll",S,{passive:!0});function b(e,t){t=t||{},window._tkq=window._tkq||[],window._tkq.push(["recordEvent",e,t])}function x(e,t){const n={};return function(o){if(n[o.timeStamp])return delete n[o.timeStamp],o.type==="submit"&&o.target.submit(),typeof t!="function"||t(o);o.preventDefault(),o.stopPropagation();function i(){const e=new o.constructor(o.type,o);n[e.timeStamp]=!0,o.target.dispatchEvent(e)}a(e,i)}}function F(){const n=e.querySelector(".actnbr-follow-bubble form");n.removeAttribute("style");const t=e.querySelector(".actnbr-btn");t&&t.classList.toggle("actnbr-hidden"),setTimeout(()=>{e.querySelector(".actnbr-email-field").focus()},10)}function C(t){s&&s.classList.add("no-display"),o&&o.classList.remove("no-display");const n=e.querySelector(".actnbr-follow-bubble .actnbr-message");n&&(n.innerHTML=t);const i=e.querySelector(".actnbr-btn");i&&i.classList.remove("actnbr-hidden")}})()